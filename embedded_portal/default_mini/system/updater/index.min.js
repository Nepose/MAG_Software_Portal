"use strict";function getWindowKey(windowName){return"window."+windowName+".id"}function getWindowIdByName(windowName){return stbStorage.getItem(getWindowKey(windowName))}function openWindow(windowName,url){var windowInfo,windowKey=getWindowKey(windowName),windowID=stbStorage.getItem(windowKey);if(windowID)try{windowInfo=JSON.parse(stbWindowMgr.windowInfo(windowID)),-1===windowInfo.result.url.indexOf(url)&&stbWebWindow.messageSend(windowID,"window.load",url),windowName===WINDOWS.BROWSER?(windowID=stbWindowMgr.openWebFace(url),stbStorage.setItem(windowKey,windowID)):stbWindowMgr.windowShow(windowID)}catch(e){echo(e),stbWindowMgr.openWebFace(url)}else windowID=windowName===WINDOWS.BROWSER?stbWindowMgr.openWebFace(url):stbWindowMgr.windowInit(JSON.stringify({url:url,backgroundColor:"#000"})),stbStorage.setItem(windowKey,windowID);return windowID}function openWindowHelp(path){openWindow(WINDOWS.HELP,PATH_ROOT+"public/app/help/index.html?path="+path)}function elattr(obj,attr){if(obj&&obj.nodeType&&attr&&attr instanceof Object)for(var key in attr)attr.hasOwnProperty(key)&&(obj[key]=attr[key]);return obj}function element(name,attr,data){var tag=document.createElement(name);return elattr(tag,attr),elchild(tag,data),tag}function elchild(obj,value){if(obj&&value)if(value.nodeType)obj.appendChild(value);else if(Array.isArray(value))for(var i=0;i<value.length;i++)elchild(obj,value[i]);else obj.appendChild(document.createTextNode(value));return obj}function elclear(obj){if(null!==obj&&obj.nodeName&&obj.hasChildNodes())for(;obj.hasChildNodes();)obj.removeChild(obj.firstChild);return obj}function loadScript(src,onload,onerror){var elem=document.createElement("script");elem.type="text/javascript",elem.src=src,"function"==typeof onload&&(elem.onload=onload),"function"==typeof onerror&&(elem.onerror=onerror),document.head.appendChild(elem)}function getCurrentLanguage(langList){var langEnv=JSON.parse(gSTB.GetEnv('{"varList":["language"]}')),langVal="en";return langList=langList||["en","ru","uk","de","tr"],!langEnv.errMsg&&langEnv.result&&langEnv.result.language&&"string"==typeof langEnv.result.language&&(langEnv.result.language=langEnv.result.language.toLowerCase(),-1!==langList.indexOf(langEnv.result.language)&&(langVal=langEnv.result.language)),langVal}function getEnvList(list){var data;try{if(data=JSON.parse(gSTB.GetEnv(JSON.stringify({varList:list}))),""!==data.errMsg)throw new Error(data.errMsg);return data.result}catch(e){echo(e)}return!1}function getEnv(name){var data=getEnvList([name]);return data!==!1&&void 0!==data[name]?data[name]:data}function setEnv(key,value){var vars={};return vars[key]=value,setEnvList(vars)}function setEnvList(hash){try{return gSTB.SetEnv(JSON.stringify(hash))}catch(e){echo(e)}return!1}function eventPrepare(event,stopBubble,label){return void 0!==event.code?!0:(event.code=event.keyCode||event.which,0===event.code?!1:(event.shiftKey&&(event.code+=1e3),event.altKey&&(event.code+=2e3),event.code===KEYS.USB_MOUNTED||event.code===KEYS.USB_UNMOUNTED?!1:(stopBubble!==!1&&event.stopPropagation(),echo(event.code+"	"+event.shiftKey+"	"+event.ctrlKey+"	"+event.altKey+"	"+event.srcElement.id+"	"+event.target.id+"	"+(label||""),"keyDown [code/shift/ctrl/alt/src/target]"),!0)))}function ajax(method,url,callback,headers,type,async){var hname,jdata=null,timeout=null,xhr=new XMLHttpRequest,title="AJAX "+method.toUpperCase()+" "+url;if(async=async!==!1,xhr.onreadystatechange=function(){if(4===xhr.readyState)if(clearTimeout(timeout),ajax.stop)echo(xhr.status,title),"function"==typeof callback&&callback(null,null,null);else{if(echo("status:"+xhr.status+", length:"+xhr.responseText.length,title),"json"===type&&200===xhr.status)try{jdata=JSON.parse(xhr.responseText)}catch(e){echo(e,"AJAX JSON.parse"),jdata=null}"function"==typeof callback&&callback("xml"===type?xhr.responseXML:"json"===type?jdata:xhr.responseText,xhr.status,xhr)}},xhr.open(method,url,async),headers)for(hname in headers)headers.hasOwnProperty(hname)&&xhr.setRequestHeader(hname,headers[hname]);return xhr.send(),echo("sent",title),timeout=setTimeout(function(){xhr.abort(),echo("ABORT on timeout",title),"function"==typeof callback&&callback(null,0)},6e4),xhr}function imageLoader(imgList,callback){var count=1,onload=function(){imgList.length===count&&"function"==typeof callback?callback():count++};Array.isArray(imgList)&&imgList.length>0?imgList.forEach(function(item){var img=new Image;img.src=item,img.onload=onload,img.onerror=function(){throw"Image "+item+" load fail"}}):0===imgList.length&&callback()}function getStorageInfo(){var snList={},info=JSON.parse(gSTB.GetStorageInfo("{}"));Array.isArray(info.result)&&""===info.errMsg&&info.result.length>0?(info.result.forEach(function(item){item.mediaType="000022272228"===item.sn?3:item.mediaType,item.label=item.label.trim(),snList[item.sn]?snList[item.sn]++:snList[item.sn]=1}),info.result.forEach(function(item){item.label||(item.label=item.vendor+" "+item.model.replace(/\//,""),snList[item.sn]>1&&(item.label+=" #"+item.partitionNum)),item.isReadOnly&&(item.label+=" ("+_("Read only")+")")}),info.result.sort(function(a,b){return a.mountPath<b.mountPath?-1:1}),window.STORAGE_INFO=info.result):window.STORAGE_INFO=[];try{window.HDD_INFO=JSON.parse(gSTB.RDir("get_hdd_info")||"[]")}catch(e){echo(e,"get_hdd_info"),window.HDD_INFO=[]}echo(STORAGE_INFO,"STORAGE_INFO"),echo(HDD_INFO,"HDD_INFO")}function parseUri(str){for(var o=parseUri.options,m=o.parser[o.strictMode?"strict":"loose"].exec(str),uri={},i=14;i--;)uri[o.key[i]]=m[i]||"";return uri[o.q.name]={},uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){$1&&(uri[o.q.name][$1]=$2)}),uri}function validateUrl(url,sol,isSolutionOptional,isProtocolOptional){var solReg="((ffmpeg|auto|rtp|rtsp|mp3|mpegps|mpegts|mp4|ifm|fm|ffrt|ffrt2|ffrt3|ffrt4)(\\s))";return isProtocolOptional=typeof isProtocolOptional==typeof!0?isProtocolOptional:!0,new RegExp("^"+(sol?solReg:"")+["","?"][+!!isSolutionOptional]+"(((http|https|udp|rtp|rtsp|mms|mmsh|mmst|rtmp|igmp):\\/\\/)"+["","?"][+isProtocolOptional]+"@?(([a-zA-Z0-9а-яА-Я$\\-_.+!*'(),;:&=]|%[0-9a-fA-Fа-яА-Я]{2})+@)?(((25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])(\\.(25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])){3})|localhost|([a-zA-Zа-яА-Я0-9\\-\\u00C0-\\u017F]+\\.)+([a-zA-Zа-яА-Я]{2,}))(:[0-9]+)?|((file:///|/)[a-zA-Zа-яА-Я0-9\\-\\u00C0-\\u017F]+))(\\/(([a-zA-Zа-яА-Я0-9$\\-_.+!*'(),;:@&=\\s]|%[0-9a-fA-Fа-яА-Я]{2})*(\\/([a-zA-Zа-яА-Я0-9$\\-_.+!*'(),;:@&=\\s]|%[0-9a-fA-Fа-яА-Я]{2})*)*)?(\\?([a-zA-Zа-яА-Я0-9$\\-_.+!*'(),;:@&=\\/?]|%[0-9a-fA-Fа-яА-Я]{2})*)?(\\#([a-zA-Zа-яА-Я0-9$\\-_.+!*'(),;:@&=\\/?]|%[0-9a-fA-Fа-яА-Я]{2})*)?)?$").test(url)}function extend(target,source,override){var _target=override===!1?extend({},target):target||{};for(var prop in source)"object"!=typeof _target[prop]||"object"!=typeof source[prop]||Array.isArray(_target[prop])||Array.isArray(source[prop])?_target[prop]=source[prop]:_target[prop]=extend(_target[prop],source[prop],override);return _target}function base64Encode(data){return btoa(unescape(encodeURIComponent(data)))}function base64Decode(data){try{return decodeURIComponent(escape(atob(data)))}catch(error){echo(error,"base64Decode Error")}}function cutTextWithEllipsis(text,length){return text.length>length?text.toString().slice(0,length)+"...":text}function parseDate(dateStr){if(!dateStr)return new Date(NaN);var date=new Date(dateStr.match(/\w{3}\s\w{3}\s\d{1,2}\s\d{1,2}:\d{1,2}:\d{1,2}/)+" "+dateStr.match(/\d{4}/)),timeZone=dateStr.match(/(\w{1,4}|((\+|-)\d{1,2}))\s+\d{4}/)[1],offset=timeZoneOffsets[timeZone];return date.setMinutes(date.getMinutes()-date.getTimezoneOffset()),0!==offset.index&&date.setMinutes(date.getMinutes()+(offset.minutes||0)*offset.index),date}function getMediaType(file){var extension=file.split(".").pop().toLowerCase();if(extension&&-1!==configuration.registersTypes.indexOf(extension))for(var type,i=0;i<MEDIA_TYPES.length,type=MEDIA_TYPES[i];i++)if(-1!==MEDIA_EXTENSION[type].indexOf(extension))return type;return MEDIA_TYPE_NONE}function readJSON(path,fileName){var result,xmlhttp=new XMLHttpRequest;path=path+"/"+fileName;try{xmlhttp.open("GET",path,!1),xmlhttp.send(null),result=xmlhttp.responseText}catch(e){echo(e,"some xmlhttp error"),result=""}return echo(result,"file "+path),result}function CBase(parent){this.name="CBase",this.handle=null,this.parent=null,this.handleInner=null,this.showAttr="block",this.baseClass="",this.prevFocus=null,this.isActive=!1,this.activeChild=null,this.isVisible=!0,this.SetParent(parent)}function Update(events){this.bind(events),this.check_url=this.update_url="",this.checked=!1}function CPage(parent){CBase.call(this,parent||null),this.name="CPage",this.previous=null,this.isVisible=!1}function CModal(parent){CPage.call(this,parent),this.name="CModal",this.baseClass="cmodal-main",this.showAttr="table",this.focusList=[],this.focusPos=0}function CModalBox(parent){CModal.call(this,parent),this.name="CModalBox",this.header=element("div",{className:"cmodal-header"}),this.content=element("div",{className:"cmodal-content"}),this.footer=element("div",{className:"cmodal-footer"})}function CModalHint(parent,data,time,isForced){if(data){CModalBox.call(this,parent),this.name="CModalHint";var self=this;this.SetHeader(),this.SetContent(data),this.SetFooter(),this.onHide=function(){self.Free()},this.onClick=function(){self.Show(!1)},this.Init(),this.Show(!0),isForced!==!0&&(this.EventHandler=function(event){self.Show(!1),self.timer&&clearTimeout(self.timer),event.preventDefault()}),time&&(this.timer=setTimeout(function(){self.Show(!1)},time||5e3))}}function CModalAlert(parent,title,data,btnExitTitle,btnExitClick){if(data){CModalBox.call(this,parent),this.name="CModalAlert";var self=this;this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.btnExit=this.bpanel.Add(KEYS.EXIT,"exit.png",btnExitTitle||"",function(){"function"==typeof btnExitClick&&btnExitClick.call(self),self.Show(!1)}),this.SetHeader(title),this.SetContent(data),this.SetFooter(this.bpanel.handle),this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(e){eventPrepare(e,!0,this.name)&&self.bpanel.EventHandler(e)},this.Init(),this.Show(!0)}}function CModalConfirm(parent,title,data,btnExitTitle,btnExitClick,btnOKTitle,btnOKClick){CModalAlert.call(this,parent,title,data,btnExitTitle,btnExitClick),this.name="CModalConfirm";var self=this;this.bpanel.Add(KEYS.OK,"ok.png",btnOKTitle,function(){self.Show(!1),"function"==typeof btnOKClick&&(btnOKClick.call(self),btnOKClick=null)})}function CButtonPanel(parent){CBase.call(this,parent),this.name="CButtonPanel",this.baseClass="cbpanel-main",this.path="",this.isActive=!0}function CScrollList(parent){CBase.call(this,parent),this.name="CScrollList",this.baseClass="cslist-main",this.multipleSelection=!0,this.activeItem=null,this.states={},this.manageFocus=!0,this.defaultParams={hidden:!1,marked:!1,disabled:!1,focused:!1,href:"#",self:this,manageFocus:!0,oncontextmenu:EMULATION?null:function(){return!1},onclick:function(){return this.self.Focused(this,!0),!1},onmouseover:function(){return this.self.Focused(this,!0),!1}},this.defaultFilter={hidden:!1,disabled:!1},this.scrollMode=2,this.RENDER_MODE_SINGLE=1,this.RENDER_MODE_BULK=2,this.renderMode=this.RENDER_MODE_SINGLE,this.fragment=document.createDocumentFragment()}function CSimpleSelect(parent,parameters){this.parameters=parameters||{},this.tagName="SELECT",this.attributes={content:{className:"csimple-select-content"},left_arrow:{className:"csimple-select-arrow left"},right_arrow:{className:"csimple-select-arrow right"},wrapper:{className:"csimple-select-wrapper",tabIndex:"1"},content_wrapper:{className:"csimple-content-wrapper"},hint:{className:"csimple-select-hint csimple-select-content"}},this.style=parameters.style||"",this.type="select",void 0!==parameters.attributes&&extend(this.attributes,parameters.attributes),this.bind(parameters.events||{}),CBase.call(this,parent||null),(this.parentNode=parameters.parent)||(void 0===parameters.content?this.parentNode=element("div"):this.parentNode=parameters.content.parentNode)}function CSelectBox(parent,parameters){CSimpleSelect.call(this,parent||null,parameters),this.attributes.wrapper.className+=" cselect-box",this.Init(this.GenerateHandle());var _selectedIndex,_default,_data=parameters.data||[],idField=parameters.idField||"id",nameField=parameters.nameField||"name",_autocomplete="",self=this,placeholder=parameters.placeholder||_("No data");this.name=parameters.name||"CSelectBox",this.dropdown=new CSelectDropdown(this,{select:this,scrollMode:2,container:parameters.container}),this.SetData=function(data){if(0===data.length)throw"data cannot be empty";_data=data||[],data.length-1<_selectedIndex&&(_selectedIndex=data.length-1),self.RefreshContent(),self.trigger("dataChanged")},this.GetNameField=function(){return nameField},this.GetIdField=function(){return idField},this.GetData=function(){return _data},this.Autocomplete=function(keyCode){var find=!1,text="";if(text=keyCode===KEYS.BACK?_autocomplete.slice(0,-1):_autocomplete+String.fromCharCode(keyCode).toLowerCase(),""!==text){for(var el,i=0;i<_data.length,el=_data[i];i++)if("object"==typeof el&&(el=el[nameField]),0===el.toLowerCase().indexOf(text)){this.SetIndex(i),find=!0;break}find===!0&&(self.handle.classList.add("autocomplete"),_autocomplete=text),text=this.GetLabel(),text&&(text=text.substr(0,_autocomplete.length)),self.SetHint(text)}else self.ClearAutocomplete()},this.ClearAutocomplete=function(){self.handle.classList.remove("autocomplete"),self.SetHint(_autocomplete="")},this.GetSelected=function(){return _data[_selectedIndex]},this.Next=function(){_selectedIndex<_data.length-1&&this.SetIndex(++_selectedIndex)},this.Previous=function(){0!==_selectedIndex&&this.SetIndex(--_selectedIndex)},this.GetValue=function(){var selected=self.GetSelected();return"object"==typeof selected?selected[idField]:selected},this.GetLabel=function(){var selected=self.GetSelected();return"object"==typeof selected?selected[nameField]:selected},this.RefreshContent=function(){return self.SetContent(self.GetLabel(),placeholder),self.value=self.GetValue(),1===self.GetData().length?(self.DisableElement(self.leftArrow,!0),void self.DisableElement(self.rightArrow,!0)):void(0===self.GetIndex()?(self.DisableElement(self.leftArrow,!0),self.DisableElement(self.rightArrow,!1)):self.GetIndex()===self.GetData().length-1?(self.DisableElement(self.rightArrow,!0),self.DisableElement(self.leftArrow,!1)):(self.DisableElement(self.leftArrow,!1),self.DisableElement(self.rightArrow,!1)))},this.SelectById=function(id,quiet){for(var i=0;i<_data.length;i++)if(_data[i][idField]===id)return self.SetIndex(i,quiet),i},this.IsChanged=function(){return _selectedIndex!==_default},this.GetIndex=function(){return _selectedIndex},this.SetIndex=function(index,quiet){var old=this.GetSelected();self.ClearAutocomplete(),_selectedIndex=void 0===index||index>=_data.length||0>index?0:index,self.RefreshContent(),quiet!==!0&&self.trigger("onChange",{"new":self.GetSelected(),old:old})},this.SetIndex(parameters.selected,!0),void 0!==parameters.selectedId&&this.SelectById(parameters.selectedId,!0),_default=_selectedIndex,this.EventHandler=function(event){switch(eventPrepare(event),event.stopped=!0,event.code){case KEYS.FRAME:this.dropdown.Show(!this.dropdown.isVisible,!1);break;case KEYS.LEFT:case KEYS.RIGHT:this.dropdown.isVisible||(CSimpleSelect.prototype.EventHandler.call(this,event),this.dropdown.EventHandler(event));break;case KEYS.OK:case KEYS.UP:case KEYS.DOWN:case KEYS.PAGE_UP:case KEYS.PAGE_DOWN:event.stopped=!1,this.dropdown.isVisible&&(this.dropdown.EventHandler(event,null,!1),event.stopped=!0);break;case KEYS.EXIT:this.dropdown.isVisible?this.dropdown.Show(!1,!1):event.stopped=!1;break;default:event.stopped=!1}},this.handle.onkeypress=function(event){event.ctrlKey!==!0&&event.altKey!==!0&&self.Autocomplete(event.charCode)},this.dropdown.Refresh(),this.bind("onBlur",function(){self.ClearAutocomplete()})}function CSelectDropdown(parent,options){CScrollList.call(this,parent||null,options);var self=this;this.isVisible=!1,this.manageFocus=!1,this.multipleSelection=!1,this.attributes={wrapper:{className:"csimple-select-dropdown"},element:{className:"dropdown-element"}},this.select=null,this.baseClass="csimple-dropdown-main",CSelectDropdown.parameters.forEach(function(key){void 0!==options[key]&&(self[key]=options[key])}),this.base=this.select.handle,this.Init(element("div",this.attributes.wrapper)),this.base.parentNode.appendChild(this.handle),this.select.bind("dataChanged",function(){self.Refresh()}),this.select.bind("onChange",function(){if(self.isVisible){var item=self.handleInner.children[this.GetIndex()];self.SetPosition(item,!0,!1),self.Focused(item,!0),self.Marked(item,!0)}}),this.select.bind("onBlur",function(){setTimeout(function(){self.Show(!1,self.manageFocus)},100)}),this.select.handle.addEventListener("click",function(event){self.Show(!self.isVisible,self.manageFocus),event.stopPropagation(),event.stopImmediatePropagation(),event.preventDefault()}),this.Show(!1,self.manageFocus)}function CIntervalBox(parent,parameters){var _default,_oldValue,self=this,_value=0,_inputValue="";CSimpleSelect.call(this,parent||null,parameters),this.inputTimer={},this.attributes.wrapper.className+=" cinterval-box",void 0===parameters.align&&(this.attributes.content.className+=" center"),void 0!==parameters.contentStyle&&(this.attributes.content.className+=" "+parameters.contentStyle),this.Init(this.GenerateHandle()),this.name=parameters.name||"input",this.type="interval",this.parameters=parameters,void 0!==parameters.align&&(this.content.className+=" "+parameters.align,this.content.style.textAlign=parameters.align),this.max=parameters.max,this.min=parameters.min,this.interval=parameters.interval||1,void 0!==parameters.value?_value=void 0!==this.max&&parameters.value>this.max?this.max:void 0!==this.min&&parameters.value<this.min?this.min:parameters.value:void 0!==this.min?_value=this.min:void 0!==this.max&&(_value=this.max),_default=_value=parseInt(_value),this.SetValue=function(value){_value=parseInt(value),self.SetContent(_value),self.trigger("onChange",_value)},this.GetValue=function(){return _value},this.Next=function(){if(_inputValue.length&&(clearInterval(this.inputTimer),this.inputDone()),CSimpleSelect.prototype.Next.call(),void 0!==self.max){if(!(_value+self.interval<=self.max))return;_value+=self.interval}else _value+=self.interval;self.RefreshContent(),self.trigger("onNext",self.GetValue()),self.trigger("onChange",self.GetValue())},this.Previous=function(){if(_inputValue.length&&(clearInterval(this.inputTimer),this.inputDone()),CSimpleSelect.prototype.Next.call(),void 0!==self.min){if(!(_value-self.interval>=self.min))return;_value-=self.interval}else _value-=self.interval;self.RefreshContent(),self.trigger("onPrevious",self.GetValue()),self.trigger("onChange",self.GetValue())},this.RefreshContent=function(){this.SetContent(self.GetValue()),self.value=self.GetValue(),self.DisableElement(self.leftArrow,!1),self.DisableElement(self.rightArrow,!1),void 0!==self.min&&_value-self.interval<self.min&&self.DisableElement(self.leftArrow,!0),void 0!==self.max&&_value+self.interval>self.max&&self.DisableElement(self.rightArrow,!0)},this.onInput=function(str){_inputValue.length||(_oldValue=_value,this.DisableElement(this.leftArrow,!0),this.DisableElement(this.rightArrow,!0)),_inputValue+=str,this.SetValue(_inputValue),clearInterval(this.inputTimer),this.inputTimer=window.setTimeout(function(){self.inputDone()},2e3)},this.inputClear=function(){_inputValue="",_oldValue=null,this.actionBack()},this.inputDone=function(){_inputValue="",_oldValue=null,_value=Math.floor(_value/this.interval)*this.interval,_value>this.max&&(_value=this.max),_value<this.min&&(_value=this.min),this.SetValue(_value),this.RefreshContent()},this.actionBack=function(){clearInterval(this.inputTimer),_inputValue.length>1?(_inputValue=_inputValue.slice(0,-1),this.SetValue(_inputValue),this.inputTimer=window.setTimeout(function(){self.inputDone()},2e3)):(_oldValue||0===_oldValue)&&this.SetValue(_oldValue)},this.EventHandler=function(event){if(eventPrepare(event,!0,"CSimpleSelect"),this.disabled!==!0)switch(event.stopped=!0,event.code){case KEYS.LEFT:this.Previous();break;case KEYS.RIGHT:this.Next();break;case KEYS.BACK:this.actionBack();break;case KEYS.NUM0:case KEYS.NUM1:case KEYS.NUM2:case KEYS.NUM3:case KEYS.NUM4:case KEYS.NUM5:case KEYS.NUM6:case KEYS.NUM7:case KEYS.NUM8:case KEYS.NUM9:this.parameters.noInput||this.onInput(event.code-KEYS.NUM0);break;default:event.stopped=!1}},this.IsChanged=function(){return _value!==_default},this.RefreshContent()}var DEBUG=!0,DEBUG_NAME="",DEBUG_SERVER="",EMULATION=!1,PATH_MODE_WEB=!1,PATH_ROOT=null,PATH_SYSTEM=null,PATH_MEDIA="/media/",WINDOW_WIDTH=screen.width,WINDOW_HEIGHT=screen.height,URL_PARAMS={},initFound=!1,proxy;PATH_ROOT=location.pathname.split("/"),PATH_ROOT[PATH_ROOT.length-1]="",PATH_ROOT=PATH_ROOT.join("/"),PATH_ROOT=location.protocol+"//"+location.host+PATH_ROOT+PATH_BASE,PATH_SYSTEM=PATH_ROOT+"system/",document.location.search&&document.location.search.substring(1).split("&").forEach(function(part){part=part.split("="),2===part.length&&(URL_PARAMS[part[0]]=decodeURIComponent(part[1]))}),void 0===window.gSTB?(DEBUG=EMULATION=!0,DEBUG_SERVER=DEBUG_SERVER||localStorage.getItem("DEBUG_SERVER"),DEBUG_NAME=DEBUG_NAME||localStorage.getItem("DEBUG_NAME"),WINDOW_WIDTH=parseInt(URL_PARAMS.width,10)||window.outerWidth,WINDOW_HEIGHT=parseInt(URL_PARAMS.height,10)||window.outerHeight,document.write('<script type="text/javascript" src="'+PATH_SYSTEM+'gstb.js"></script>\n'),document.write('<script type="text/javascript" src="'+PATH_SYSTEM+'debug.js"></script>\n'),document.write('<script type="text/javascript" src="http://'+DEBUG_SERVER+':8800/file/client.js"></script>\n'),document.write('<script type="text/javascript">if ( window.proxyClient ) {proxy = new proxyClient();if ( DEBUG_NAME && DEBUG_SERVER ) proxy.init({name:"'+DEBUG_NAME+'", host:"'+DEBUG_SERVER+'"}); }</script>\n'),window.addEventListener("load",function(){document.body.style.backgroundColor="black"})):(gSTB.SetNativeStringMode(!0),function(){var vars=JSON.parse(gSTB.GetEnv(JSON.stringify({varList:["debug","debug_name","debug_server"]})));!vars.errMsg&&vars.result&&(DEBUG="1"===vars.result.debug,DEBUG&&!URL_PARAMS.nodebug&&(document.write('<script type="text/javascript" src="'+PATH_SYSTEM+'debug.js"></script>\n'),DEBUG_NAME=DEBUG_NAME||vars.result.debug_name,DEBUG_SERVER=DEBUG_SERVER||vars.result.debug_server,DEBUG_NAME&&DEBUG_SERVER&&"1"!==stbStorage.getItem("spyjs.active")&&document.write('<script type="text/javascript" src="http://'+DEBUG_SERVER+":8000/target/target-script-min.js#"+DEBUG_NAME+'"></script>\n')))}());var PATH_IMG_SYSTEM=PATH_SYSTEM+"img/"+WINDOW_WIDTH+"/",PATH_IMG_PUBLIC=PATH_ROOT+"public/img/"+WINDOW_WIDTH+"/",WINDOWS={PORTAL:"portal",HELP:"help",DOWNLOAD_MANAGER:"dlman",PVR:"recordsManager",BROWSER:"ibman",BROWSER_VIEW:"ibmanView",PORTALS_LOADER:"portalsLoader",SYSTEM_SETTINGS:"systemSettings"},configuration=function(){var config={newRemoteControl:!1,allowMulticastUpdate:!1,videoOutputMode:[{value:"Auto",title:"Auto",translated:!1},{value:"PAL",title:"PAL (576i)",translated:!0},{value:"576p-50",title:"576p-50",translated:!0},{value:"720p-50",title:"720p-50",translated:!0},{value:"1080i-50",title:"1080i-50",translated:!0},{value:"1080p-50",title:"1080p-50",translated:!0},{value:"NTSC",title:"NTSC (480i)",translated:!0},{value:"720p-60",title:"720p-60",translated:!0},{value:"1080i-60",title:"1080i-60",translated:!0},{value:"1080p-60",title:"1080p-60",translated:!0}]},model=gSTB.GetDeviceModelExt(),control=null;switch(model){case"AuraHD2":case"AuraHD3":case"AuraHD8":case"MAG275":case"WR320":config.newRemoteControl=!0;break;case"MAG256":case"MAG257":config.videoOutputMode=[{value:"Auto",title:"Auto",translated:!1},{value:"PAL",title:"PAL (576i)",translated:!0},{value:"720p-50",title:"720p-50",translated:!0},{value:"1080i-50",title:"1080i-50",translated:!0},{value:"1080p-50",title:"1080p-50",translated:!0},{value:"NTSC",title:"NTSC (480i)",translated:!0},{value:"720p-60",title:"720p-60",translated:!0},{value:"1080i-60",title:"1080i-60",translated:!0},{value:"1080p-60",title:"1080p-60",translated:!0}];break;case"MAG351":case"MAG352":case"MAG424":case"MAG425":config.videoOutputMode=[{value:"Auto",title:"Auto",translated:!1},{value:"PAL",title:"PAL (576i)",translated:!0},{value:"576p-50",title:"576p-50",translated:!0},{value:"720p-50",title:"720p-50",translated:!0},{value:"1080i-50",title:"1080i-50",translated:!0},{value:"1080p-50",title:"1080p-50",translated:!0},{value:"NTSC",title:"NTSC (480i)",translated:!0},{value:"720p-60",title:"720p-60",translated:!0},{value:"1080i-60",title:"1080i-60",translated:!0},{value:"1080p-60",title:"1080p-60",translated:!0},{value:"3840x2160p50",title:"3840x2160p-50",translated:!0},{value:"3840x2160p60",title:"3840x2160p-60",translated:!0}]}try{control=JSON.parse(gSTB.GetEnv('{"varList":["controlModel"]}')),!control.errMsg&&control.result&&control.result.controlModel&&("SRC4513"===control.result.controlModel?config.newRemoteControl=!0:config.newRemoteControl=!1)}catch(e){echo(e,"controlModel parse")}return config}(),KEYS={BACK:8,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,NUM0:48,DELETE:46,CHANNEL_PREV:1009,CHANNEL_NEXT:9,OK:13,EXIT:27,UP:38,DOWN:40,LEFT:37,RIGHT:39,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,VOLUME_UP:107,VOLUME_DOWN:109,F1:112,F2:113,F3:114,F4:115,REFRESH:116,FRAME:117,PHONE:119,EPG:119,SET:120,TV:121,MENU:122,WEB:123,MIC:2032,REWIND:2066,FORWARD:2070,APP:2076,USB_MOUNTED:2080,USB_UNMOUNTED:2081,PLAY_PAUSE:2082,STOP:2083,POWER:2085,RECORD:2087,INFO:2089,MUTE:2192,CLOCK:2032,AUDIO:2071,KEYBOARD:2076},gettext=function(){var module={},data=null;return module.init=function(options,onReady){options.name=options.name||"en",options.ext=options.ext||"js",options.path=options.path||"lang",data=null,"en"!==options.name?loadScript(options.path+"/"+options.name+"."+options.ext,onReady,onReady):"function"==typeof onReady&&onReady()},module.load=function(input){data=input},module.data=function(key){return null===data?key:void 0!==data[key]?data[key]:key},module}(),_=gettext.data;if(void 0===window.echo&&(window.echo=function(data,title){}),ajax.stop=!1,parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},!("classList"in document.documentElement)){var prototype=Array.prototype,indexOf=prototype.indexOf,slice=prototype.slice,push=prototype.push,splice=prototype.splice,join=prototype.join;window.DOMTokenList=function(el){if(this._element=el,el.className!==this._classCache){if(this._classCache=el.className,!this._classCache)return;var i,classes=this._classCache.replace(/^\s+|\s+$/g,"").split(/\s+/);for(i=0;i<classes.length;i++)push.call(this,classes[i])}},window.DOMTokenList.prototype={add:function(token){this.contains(token)||(push.call(this,token),this._element.className=slice.call(this,0).join(" "))},contains:function(token){return-1!==indexOf.call(this,token)},item:function(index){return this[index]||null},remove:function(token){var i=indexOf.call(this,token);-1!==i&&(splice.call(this,i,1),this._element.className=slice.call(this,0).join(" "))},toString:function(){return join.call(this," ")},toggle:function(token){return this.contains(token)?this.remove(token):this.add(token),this.contains(token)}},Object.defineProperty(Element.prototype,"classList",{get:function(){return new window.DOMTokenList(this)}})}var Events={bind:function(event,callback){if(this._events||(this._events={}),"object"==typeof event)for(var name in event)this.bind(name,event[name]);else"string"==typeof event&&"function"==typeof callback&&(void 0===this._events[event]&&(this._events[event]=[]),this._events[event].push(callback))},trigger:function(event,data){var result,results=[],self=this;return void 0!==event&&void 0!==this._events&&void 0!==this._events[event]&&this._events[event].forEach(function(ev){result=ev.call(self,data),void 0!==result&&results.push(result)}),results},unbind:function(event){delete this._events[event]},inject:function(obj){"function"==typeof obj?extend(obj.prototype,this):"object"==typeof obj&&extend(obj,this)}},timeZoneOffsets={A:{index:-1,minutes:60},ACDT:{index:-1,minutes:60},ACST:{index:-1,minutes:570},ACT:{index:1,minutes:300},ACWST:{index:-1,minutes:525},ADT:{index:1,minutes:180},AEDT:{index:-1,minutes:61},AEST:{index:-1,minutes:60},AFT:{index:-1,minutes:270},AKDT:{index:1,minutes:480},AKST:{index:1,minutes:540},ALMT:{index:-1,minutes:360},AMST:{index:1,minutes:180},AMT:{index:1,minutes:240},ANAST:{index:-1,minutes:62},ANAT:{index:-1,minutes:62},AQTT:{index:-1,minutes:300},ART:{index:1,minutes:180},AST:{index:1,minutes:240},AWDT:{index:-1,minutes:540},AWST:{index:-1,minutes:480},AZOST:{index:0,minutes:0},AZOT:{index:1,minutes:60},AZST:{index:-1,minutes:300},AZT:{index:-1,minutes:240},B:{index:-1,minutes:120},BNT:{index:-1,minutes:480},BOT:{index:1,minutes:240},BRST:{index:1,minutes:120},BRT:{index:1,minutes:180},BST:{index:-1,minutes:60},BTT:{index:-1,minutes:360},C:{index:-1,minutes:180},CAST:{index:-1,minutes:480},CAT:{index:-1,minutes:120},CCT:{index:-1,minutes:390},CDT:{index:1,minutes:300},CEST:{index:-1,minutes:120},CET:{index:-1,minutes:60},CHADT:{index:-1,minutes:63},CHAST:{index:-1,minutes:62},CHOT:{index:-1,minutes:480},CHUT:{index:-1,minutes:600},CKT:{index:1,minutes:60},CLST:{index:1,minutes:180},CLT:{index:1,minutes:240},COT:{index:1,minutes:300},CST:{index:1,minutes:360},CVT:{index:1,minutes:60},CXT:{index:-1,minutes:420},ChST:{index:-1,minutes:60},D:{index:-1,minutes:240},DAVT:{index:-1,minutes:420},E:{index:-1,minutes:300},EASST:{index:1,minutes:300},EAST:{index:1,minutes:360},EAT:{index:-1,minutes:180},ECT:{index:1,minutes:300},EDT:{index:-1,minutes:61},EEST:{index:-1,minutes:180},EET:{index:-1,minutes:120},EGST:{index:0,minutes:0},EGT:{index:1,minutes:60},EST:{index:1,minutes:300},ET:{index:1,minutes:300},F:{index:-1,minutes:360},FET:{index:-1,minutes:180},FJST:{index:-1,minutes:63},FJT:{index:-1,minutes:62},FKST:{index:1,minutes:180},FKT:{index:1,minutes:240},FNT:{index:1,minutes:120},G:{index:-1,minutes:420},GALT:{index:1,minutes:360},GAMT:{index:1,minutes:540},GET:{index:-1,minutes:240},GFT:{index:1,minutes:180},GILT:{index:-1,minutes:62},GMT:{index:0,minutes:0},GST:{index:-1,minutes:240},GYT:{index:1,minutes:240},H:{index:-1,minutes:480},HAA:{index:1,minutes:180},HAC:{index:1,minutes:300},HADT:{index:1,minutes:540},HAE:{index:1,minutes:240},HAP:{index:1,minutes:420},HAR:{index:1,minutes:360},HAST:{index:1,minutes:60},HAT:{index:1,minutes:150},HAY:{index:1,minutes:480},HKT:{index:-1,minutes:480},HLV:{index:1,minutes:270},HNA:{index:1,minutes:240},HNC:{index:1,minutes:360},HNE:{index:1,minutes:300},HNP:{index:1,minutes:480},HNR:{index:1,minutes:420},HNT:{index:1,minutes:210},HNY:{index:1,minutes:540},HOVT:{index:-1,minutes:420},I:{index:-1,minutes:540},ICT:{index:-1,minutes:420},IDT:{index:-1,minutes:180},IOT:{index:-1,minutes:360},IRDT:{index:-1,minutes:270},IRKST:{index:-1,minutes:540},IRKT:{index:-1,minutes:540},IRST:{index:-1,minutes:210},IST:{index:-1,minutes:60},JST:{index:-1,minutes:540},K:{index:-1,minutes:60},KGT:{index:-1,minutes:360},KOST:{index:-1,minutes:660},KRAST:{index:-1,minutes:480},KRAT:{index:-1,minutes:480},KST:{index:-1,minutes:540},KUYT:{index:-1,minutes:240},L:{index:-1,minutes:61
},LHDT:{index:-1,minutes:61},LHST:{index:-1,minutes:60},LINT:{index:-1,minutes:64},M:{index:-1,minutes:62},MAGST:{index:-1,minutes:62},MAGT:{index:-1,minutes:62},MART:{index:1,minutes:570},MAWT:{index:-1,minutes:300},MDT:{index:1,minutes:360},MESZ:{index:-1,minutes:120},MEZ:{index:-1,minutes:60},MHT:{index:-1,minutes:62},MMT:{index:-1,minutes:390},MSD:{index:-1,minutes:240},MSK:{index:-1,minutes:240},MST:{index:1,minutes:420},MUT:{index:-1,minutes:240},MVT:{index:-1,minutes:300},MYT:{index:-1,minutes:480},N:{index:1,minutes:60},NCT:{index:-1,minutes:61},NDT:{index:1,minutes:150},NFT:{index:-1,minutes:61},NOVST:{index:-1,minutes:420},NOVT:{index:-1,minutes:360},NPT:{index:-1,minutes:345},NRT:{index:-1,minutes:720},NST:{index:1,minutes:210},NUT:{index:1,minutes:61},NZDT:{index:-1,minutes:63},NZST:{index:-1,minutes:62},O:{index:1,minutes:120},OMSST:{index:-1,minutes:420},OMST:{index:-1,minutes:420},ORAT:{index:-1,minutes:300},P:{index:1,minutes:180},PDT:{index:1,minutes:420},PET:{index:1,minutes:300},PETST:{index:-1,minutes:62},PETT:{index:-1,minutes:62},PGT:{index:-1,minutes:60},PHOT:{index:-1,minutes:63},PHT:{index:-1,minutes:480},PKT:{index:-1,minutes:300},PMDT:{index:1,minutes:120},PMST:{index:1,minutes:180},PONT:{index:-1,minutes:61},PST:{index:1,minutes:480},PT:{index:1,minutes:480},PWT:{index:-1,minutes:540},PYST:{index:1,minutes:180},PYT:{index:1,minutes:240},Q:{index:1,minutes:240},QYZT:{index:1,minutes:360},R:{index:1,minutes:300},RET:{index:-1,minutes:240},S:{index:1,minutes:360},SAKT:{index:1,minutes:600},SAMT:{index:-1,minutes:240},SAST:{index:-1,minutes:120},SBT:{index:-1,minutes:61},SCT:{index:-1,minutes:240},SGT:{index:-1,minutes:480},SRET:{index:-1,minutes:660},SRT:{index:1,minutes:180},SST:{index:1,minutes:61},T:{index:1,minutes:420},TAHT:{index:1,minutes:60},TFT:{index:-1,minutes:300},TJT:{index:-1,minutes:300},TKT:{index:-1,minutes:63},TLT:{index:-1,minutes:540},TMT:{index:-1,minutes:300},TOT:{index:-1,minutes:780},TVT:{index:-1,minutes:62},U:{index:1,minutes:480},ULAT:{index:-1,minutes:480},UTC:{index:0,minutes:0},UYST:{index:1,minutes:120},UYT:{index:1,minutes:180},UZT:{index:-1,minutes:300},V:{index:1,minutes:540},VET:{index:1,minutes:270},VLAST:{index:-1,minutes:61},VLAT:{index:-1,minutes:61},VUT:{index:-1,minutes:61},W:{index:1,minutes:60},WARST:{index:1,minutes:180},WAST:{index:-1,minutes:120},WAT:{index:-1,minutes:60},WEST:{index:-1,minutes:60},WESZ:{index:-1,minutes:60},WET:{index:0,minutes:0},WEZ:{index:0,minutes:0},WFT:{index:-1,minutes:62},WGST:{index:1,minutes:120},WGT:{index:1,minutes:180},WIB:{index:-1,minutes:420},WIT:{index:-1,minutes:540},WITA:{index:-1,minutes:480},WST:{index:-1,minutes:63},WT:{index:0,minutes:0},X:{index:1,minutes:61},Y:{index:1,minutes:62},YAKST:{index:-1,minutes:60},YAKT:{index:-1,minutes:60},YAPT:{index:-1,minutes:60},YEKST:{index:-1,minutes:360},YEKT:{index:-1,minutes:360},Z:{index:0,minutes:0},"-12":{index:-1,minutes:720},"-11":{index:-1,minutes:660},"-10":{index:-1,minutes:600},"-09":{index:-1,minutes:540},"-08":{index:-1,minutes:480},"-07":{index:-1,minutes:420},"-06":{index:-1,minutes:360},"-05":{index:-1,minutes:300},"-04":{index:-1,minutes:240},"-03":{index:-1,minutes:180},"-02":{index:-1,minutes:120},"-01":{index:-1,minutes:60},"+01":{index:1,minutes:60},"+02":{index:1,minutes:120},"+03":{index:1,minutes:180},"+04":{index:1,minutes:240},"+05":{index:1,minutes:300},"+06":{index:1,minutes:360},"+07":{index:1,minutes:420},"+08":{index:1,minutes:480},"+09":{index:1,minutes:540},"+10":{index:1,minutes:600},"+11":{index:1,minutes:660},"+12":{index:1,minutes:720}};Array.prototype.shuffle=function(){for(var i,tmp,n=this.length;n--;)i=Math.floor(n*Math.random()),tmp=this[i],this[i]=this[n],this[n]=tmp;return this},CBase.prototype.SetParent=function(parent){parent instanceof CBase&&(this.parent=parent)},CBase.prototype.Init=function(handle){if(handle&&handle.nodeName){this.handle=handle,this.baseClass&&-1===handle.className.indexOf(this.baseClass)?this.handleInner=this.handle.appendChild(element("div",{className:this.baseClass})):this.handleInner=this.handle;var self=this;this.handle.addEventListener("click",function(event){"function"==typeof self.onClick&&self.onClick()===!1&&event.stopPropagation()}),"function"==typeof this.onInit&&this.onInit()}},CBase.prototype.Activate=function(active){this.isActive=active!==!1,this.isActive?("function"==typeof this.onActivate&&this.onActivate(),this.parent&&(this.parent.activeChild&&this.parent.activeChild!==this&&this.parent.activeChild.Activate(!1),this.parent.activeChild=this)):("function"==typeof this.onDeactivate&&this.onDeactivate(),this.parent&&(this.parent.activeChild=null))},CBase.prototype.Show=function(visible,manageFocus){var success=!1;return this.handle&&(this.isVisible=visible!==!1,this.isVisible?this.handle.style.display!==this.showAttr&&(this.prevFocus=document.activeElement,manageFocus!==!1&&document.activeElement&&document.activeElement.blur(),this.handle.style.display=this.showAttr,manageFocus!==!1&&this.handle.focus(),"function"==typeof this.onShow&&this.onShow(),success=!0):"none"!==this.handle.style.display&&(manageFocus!==!1&&document.activeElement&&document.activeElement.blur(),this.handle.style.display="none",manageFocus!==!1&&this.prevFocus&&this.prevFocus.focus(),"function"==typeof this.onHide&&this.onHide(),this.isActive&&this.Activate(!1),success=!0)),success},CBase.prototype.Visible=function(mode){this.handle.style.visibility=Boolean(mode)?"visible":"hidden"},CBase.prototype.EventHandler=null,CBase.prototype.onInit=null,CBase.prototype.onShow=null,CBase.prototype.onHide=null,CBase.prototype.onActivate=null,CBase.prototype.onDeactivate=null,CBase.prototype.onClick=function(){return this.Activate(!0),!0},Update.CrashStatuses=[1,2,3,4,7,17,19,20,22,25,27],Update.OkStatus=21,Update.StatusMessages={1:"Signature init error",2:"Wrong device model",3:"Section size exceeds partition size on FLASH",4:"Required FLASH section not found. Aborting update",5:"Updating kernel",6:"Updating image",7:"Internal error",8:"Inspecting firmware",9:"Updating environment variables",10:"Updating Bootstrap section",11:"Skipping Bootstrap section",12:"Updating User FS section",13:"Skipping User FS section",14:"Updating second boot",15:"Updating logotype",16:"Update finished OK",17:"Wrong signature",18:"Erasing flash section",19:"Flash write error",20:"File write error",21:"Idle",22:"Invalid file header",23:"Inspecting update file",24:"File check finished",25:"File not found",26:"Initialising",27:"Read error"},Update.StartTFTP=function(timeout){var bootstrap_url=parseUri(Update.DefaultUpdateUrls.bootstrap_url),lan_params=["ipaddr","gatewayip","dnsip","netmask","ipaddr_conf"],lan_config=getEnvList(lan_params),type="up_dhcp_tftp",count=0;if(lan_config.ipaddr_conf&&"0.0.0.0"!==lan_params.ipaddr_conf){for(var i=0;i<lan_params.length;i++)lan_config[lan_params[i]]&&count++;if(count!==lan_params.length)return!1;type="up_ip_tftp"}return this.CheckUpdateByTFTP()?(setEnvList({serverip_conf:bootstrap_url.host,tftp_path_conf:bootstrap_url.relative.substr(1)})&&setTimeout(function(){gSTB.ExecAction("UpdateSW "+type)},timeout||0),!0):!1},Update.CheckUpdateByTFTP=function(){var update_url=parseUri(Update.DefaultUpdateUrls.update_url),ip_regexp=/^((?:[0-9]{1,3}\.){3}[0-9]{1,3})$/,bootstrap_regexp=/^(tftp):\/\/((?:[0-9]{1,3}\.){3}[0-9]{1,3})(:[0-9]+)?(\/.+)+$/;return-1===["igmp","tftp","http"].indexOf(update_url.protocol)?!1:"igmp"===update_url.protocol&&""!==update_url.relative?!1:"tftp"!==update_url.protocol&&"igmp"!==update_url.protocol||update_url.host.match(ip_regexp)?"Aura"===gSTB.GetDeviceModelExt().substr(0,4)?!1:!!Update.DefaultUpdateUrls.bootstrap_url.match(bootstrap_regexp):!1},Update.StartMulticast=function(timeout){var bootstrap_url=parseUri(Update.DefaultUpdateUrls.bootstrap_url);return this.CheckUpdateByMulticast&&setEnvList({mcip_conf:bootstrap_url.host,mcport_conf:bootstrap_url.port})?(setTimeout(function(){gSTB.ExecAction("UpdateSW up_mc_url")},timeout||0),!0):!1},Update.CheckUpdateByMulticast=function(){var regexp=/^(igmp):\/\/((?:[0-9]{1,3}\.){3}[0-9]{1,3})(:[0-9]+)?$/;return configuration.allowMulticastUpdate?!!Update.DefaultUpdateUrls.bootstrap_url.match(regexp)&&!!Update.DefaultUpdateUrls.update_url.match(regexp):!1},Update.DefaultUpdateUrls=getEnvList(["update_url","bootstrap_url"]),Update.prototype.Start=function(update_url,force){var realActiveBank,status=stbUpdate.getStatus(),activeBank=stbUpdate.getActiveBank(),modelTemp=gSTB.RDir("Model").toUpperCase();if(echo("Update.Start(update_url="+update_url+", force="+force+");"),status!=Update.OkStatus&&!force||this.update_url!==update_url)echo("Update.Start(); => not ready for update. Status:"+status+", is forced? "+force+", url is wrong? "+(this.update_url!==update_url)),echo("this.update_url ("+this.update_url+") === update_url ("+update_url+")"),this.CheckUpdate(update_url,!0);else{if(echo("Update.Start(); => ready for update. Status:"+status+", by force? "+force),this.trigger("onStart"),echo("Update.Start(); => after onStart"),this.SystemButtons(!1),"MAG250"!==modelTemp&&"MAG270"!==modelTemp&&"MAG275"!==modelTemp&&-1!=activeBank&&2!=stbUpdate.GetFlashBankCount())return echo('Update.Start(); => trigger("onError") : bank error'),void this.trigger("onError",{errorMessage:_("Unable to update active memory bank"),logMessage:"Unable to update active memory bank",status:30});(realActiveBank=stbStorage.getItem("nandEmergencyLoadingLogs"))&&(realActiveBank=(JSON.parse(realActiveBank)||"").bootmedia,"bank0"===realActiveBank&&(activeBank=0),"bank1"===realActiveBank&&(activeBank=1)),echo("Update.Start(); => start stbUpdate.startUpdate for bank "+(0==activeBank?1:0)),0==activeBank?stbUpdate.startUpdate(1,update_url):stbUpdate.startUpdate(0,update_url)}this.CheckProgress()},Update.prototype.CheckProgress=function(){var status=stbUpdate.getStatus(),percent=stbUpdate.getPercents(),self=this;self.CheckError(status)&&(echo("Update.CheckProgress() => auto start if ready? "+this.auto_start),this.auto_start===!0&&status===Update.OkStatus&&(this.auto_start=!1,this.Start(this.update_url)),16===status&&(percent=100),echo("Update.CheckProgress() => set new progress value "+stbUpdate.getPercents()),this.trigger("onProgress",{percent:percent,statusMessage:_(100===percent?Update.StatusMessages[16]:Update.StatusMessages[status]),logMessage:100===percent?Update.StatusMessages[16]:Update.StatusMessages[status],status:100===percent?16:status}),this.progress_timeout=setTimeout(function(){self.CheckProgress()},1e3))},Update.prototype.CheckError=function(status){return echo("Update.CheckError(status); => status code: "+status),-1!==Update.CrashStatuses.indexOf(status)?(echo("Update.CheckError(status); => error status found!: "+status),this.trigger("onError",{errorMessage:_(Update.StatusMessages[status]),logMessage:Update.StatusMessages[status],status:status}),this.SystemButtons(!0),!1):!0},Update.prototype.CheckUpdate=function(update_url,start_on_ready){var status,self;if(echo("Update.CheckUpdate(update_url="+update_url+", start_on_ready="+start_on_ready+");"),"string"==typeof update_url&&stbUpdate.startCheck(this.check_url=update_url),status=stbUpdate.getStatus(),self=this,echo("Update.CheckUpdate(); => stop check if some error or got ready status. Current status: "+status),this.CheckError(status)){if(this.trigger("onCheck",{statusMessage:_(Update.StatusMessages[status]),logMessage:Update.StatusMessages[status],status:status}),status===Update.OkStatus)return this.update_url=this.check_url,this.trigger("onReady"),echo("Update.CheckUpdate(); => check is ok. Start autoupdate? "+start_on_ready),void(start_on_ready===!0&&this.Start(this.update_url));clearTimeout(this.check_update_timeout),this.check_update_timeout=setTimeout(function(){self.CheckUpdate(null,start_on_ready)},100)}},Update.prototype.GetImageInfo=function(){return echo("Update.GetImageInfo(); => is info about new image ready? status:"+stbUpdate.getStatus()),stbUpdate.getStatus()===Update.OkStatus?(echo("Update.GetImageInfo(); => {date:"+parseDate(stbUpdate.getImageDateStr())+", description:"+stbUpdate.getImageDescStr()+", version:"+stbUpdate.getImageVersionStr()+"}"),{date:parseDate(stbUpdate.getImageDateStr()),description:stbUpdate.getImageDescStr(),version:stbUpdate.getImageVersionStr()}):null},Update.prototype.GetCurrentImageInfo=function(){if(void 0===this.curr_info){var info=JSON.parse(gSTB.GetEnv(JSON.stringify({varList:["Image_Desc","Image_Date","Image_Version"]}))).result;this.curr_info={date:parseDate(info.Image_Date),description:info.Image_Desc,version:info.Image_Version}}return this.curr_info},Update.prototype.Clear=function(){clearTimeout(this.check_update_timeout),clearTimeout(this.progress_timeout),this.auto_start=!1,this.update_url=""},Update.prototype.SystemButtons=function(enable){gSTB.EnableServiceButton(enable),gSTB.EnableVKButton(enable),gSTB.EnableAppButton(enable),gSTB.EnableTvButton(enable)},Events.inject(Update);var CProgressBar=function(parent,parentNode){CBase.call(this,parent||null),void 0===parentNode&&(parentNode=element("div")),elchild(parentNode,this.$bar=element("div",{className:"cprogressbar"},element("div",{className:"progressbar_bg"},[this.$line=element("div",{className:"progressbar_line"}),this.$digit=element("div",{className:"progressbar_digit"},"0 %")]))),this.Init(parentNode)};CProgressBar.prototype=Object.create(CBase.prototype),CProgressBar.prototype.constructor=CProgressBar,CProgressBar.prototype.SetProgress=function(percent){this.$line.style.width=percent+"%",this.$digit.innerHTML=percent+"%"};var CLog=function(parent,options){var self=this;CBase.call(this,parent||null),this.newest=!1,CLog.parameters.forEach(function(option){void 0!==options[option]&&(self[option]=options[option])}),this.bind(options.events||{}),this.Init(element("div",{className:"clog"},this.$log=element("ul",{})))};CLog.parameters=["time","autofocus","parentNode","events","defaultType","newest","isVisible"],CLog.prototype=Object.create(CBase.prototype),CLog.prototype.constructor=CLog,CLog.prototype.onInit=function(){elchild(this.parentNode,this.handle)},CLog.prototype.onShow=function(){this.autofocus===!0&&0!==this.$log.childElementCount&&this.$log.lastElementChild.focus(),this.trigger("onShow")},CLog.prototype.onHide=function(){this.trigger("onHide")},CLog.prototype.Add=function(message,type){if(this.newest===!1||this.newest===!0&&this._lastMessage!==message){this._lastMessage=message;var currTime=new Date,$data=[element("span",{className:"message"},message)];this.time===!0&&$data.push(element("span",{className:"time"},("0"+currTime.getHours()).slice(-2)+":"+("0"+currTime.getMinutes()).slice(-2)+":"+("0"+currTime.getSeconds()).slice(-2))),elchild(this.$log,element("li",{className:type||this.defaultType,tabIndex:"1"},$data)),this.autofocus===!0&&this.$log.lastElementChild.focus(),this.trigger("onAdd")}},Events.inject(CLog),CPage.prototype=Object.create(CBase.prototype),CPage.prototype.constructor=CPage,CPage.prototype.Show=function(visible,previous){visible===!1?(this.activeChild&&this.activeChild.Activate(!1),CBase.prototype.Show.call(this,!1,!0,!0),window.currCPage=this.previous||window.baseCPage,this.previous=null,window.currCPage&&window.currCPage!==this&&CBase.prototype.Show.call(window.currCPage,!0,!0,!0)):(this.previous=previous||null,window.currCPage&&window.currCPage!==this&&(window.currCPage.activeChild&&window.currCPage.activeChild.Activate(!1),CBase.prototype.Show.call(window.currCPage,!1,!0,!0)),CBase.prototype.Show.call(this,!0,!0,!0),window.currCPage=this)},CPage.prototype.onClick=function(){return!1},CPage.prototype.EventHandler=function(){};var CMODAL_IMG_PATH=window.configuration&&configuration.newRemoteControl?PATH_IMG_SYSTEM+"buttons/new/":PATH_IMG_SYSTEM+"buttons/old/";CModal.prototype=Object.create(CPage.prototype),CModal.prototype.constructor=CModal,CModal.prototype.Init=function(body){CPage.prototype.Init.call(this,element("div",{className:this.baseClass},element("div",{className:"cmodal-cell"},body)));var owner=this.parent&&this.parent.handle&&this.parent.handle.nodeName?this.parent.handle:document.body;this.parent instanceof CModal&&this.parent.parent&&(owner=this.parent.parent.handle),owner.appendChild(this.handle)},CModal.prototype.Free=function(){this.handle&&this.handle.parentNode&&this.handle.parentNode.removeChild(this.handle),elclear(this.handle)},CModal.prototype.Show=function(visible,manageFocus){CBase.prototype.Show.call(this,visible,manageFocus!==!1),visible===!1?window.currCPage=this.parent:window.currCPage=this},CModal.prototype.FocusPrev=function(event,manageVK){if(this.focusList.length>0){--this.focusPos<0&&(this.focusPos=this.focusList.length-1);var el=this.focusList[this.focusPos];manageVK!==!1&&gSTB.HideVirtualKeyboard(),el.focus(),event&&"INPUT"===el.tagName&&"text"===el.type&&(event.preventDefault(),manageVK!==!1&&gSTB.ShowVirtualKeyboard())}},CModal.prototype.FocusNext=function(event,manageVK){if(this.focusList.length>0){++this.focusPos>=this.focusList.length&&(this.focusPos=0);var el=this.focusList[this.focusPos];manageVK!==!1&&gSTB.HideVirtualKeyboard(),el.focus(),event&&"INPUT"===el.tagName&&"text"===el.type&&(event.preventDefault(),manageVK!==!1&&gSTB.ShowVirtualKeyboard())}},CModalBox.prototype=Object.create(CModal.prototype),CModalBox.prototype.constructor=CModalBox,CModalBox.prototype.SetData=function(place,data){return elclear(place),data instanceof Node||Array.isArray(data)?elchild(place,data):place.innerHTML=data,data&&data.nodeName&&(data.style.display="block"),place.style.display=data?"block":"none",place},CModalBox.prototype.SetHeader=function(data){return this.SetData(this.header,data||"")},CModalBox.prototype.SetContent=function(data){return this.SetData(this.content,data||"")},CModalBox.prototype.SetFooter=function(data){return this.SetData(this.footer,data||"")},CModalBox.prototype.Init=function(){CModal.prototype.Init.call(this,element("div",{className:"cmodal-body"},[this.header,this.content,this.footer]))},CModalHint.prototype=Object.create(CModalBox.prototype),CModalHint.prototype.constructor=CModalHint,CModalAlert.prototype=Object.create(CModalBox.prototype),CModalAlert.prototype.constructor=CModalAlert,CModalConfirm.prototype=Object.create(CModalAlert.prototype),CModalConfirm.prototype.constructor=CModalConfirm,CButtonPanel.prototype=Object.create(CBase.prototype),CButtonPanel.prototype.constructor=CButtonPanel,CButtonPanel.prototype.Init=function(path,handle){this.path=path,handle&&handle.nodeName?CBase.prototype.Init.call(this,handle):CBase.prototype.Init.call(this,element("div",{className:"cbpanel-main"}))},CButtonPanel.prototype.Add=function(code,icon,text,callback,hidden){var html=null,self=this,func=function(){self.isActive&&"function"==typeof callback&&(gSTB.HideVirtualKeyboard(),callback(code))};text&&(html=element("div",{className:"cbpanel-text",onclick:func}),html.innerHTML=text);var item=element("div",{className:"cbpanel-item",data:{code:code,onclick:func}},[element("img",{className:"cbpanel-icon",onclick:func,src:this.path+"/"+icon}),html]);return item.$name=html,this.Hidden(item,hidden||!1),elchild(this.handleInner,item),item},CButtonPanel.prototype.Hidden=function(item,state){item&&item.nodeName&&item.data.hidden!==state&&(item.data.hidden=state,item.style.display=state?"none":"table-cell")},CButtonPanel.prototype.SetName=function(item,name){var html=null;item&&item.nodeName&&name&&(item.$name?this.Rename(item,name):(html=element("div",{className:"cbpanel-text",onclick:item.data.onclick}),html.innerHTML=name,item.$name=html,item.appendChild(html)))},CButtonPanel.prototype.Rename=function(item,name){item&&item.nodeName&&(item.$name.innerHTML=name)},CButtonPanel.prototype.Activate=function(active){this.isActive=active!==!1},CButtonPanel.prototype.EventHandler=function(event){if(event.stopped!==!0&&this.isActive)for(var data,i=0,items=this.handleInner.children,length=items.length;length>i;i++)if(data=items[i].data,!data.hidden&&data.code===event.code&&"function"==typeof data.onclick)return void(data.onclick()&&event.preventDefault())},CButtonPanel.prototype.onClick=function(){return!1},CScrollList.prototype=Object.create(CBase.prototype),CScrollList.prototype.constructor=CScrollList,CScrollList.prototype.Init=function(handle){CBase.prototype.Init.call(this,handle);var self=this;this.handleInner.onmousewheel=function(event){var direction=event.wheelDeltaY>0,found=self.Next(null,direction);return found&&(self.MoveNext(direction?-1:1),self.Focused(found,!0)),event.stopPropagation(),!1}},CScrollList.prototype.Add=function(body,attrs){attrs=attrs||{};var item=element("a",this.defaultParams,body);this.renderMode===this.RENDER_MODE_BULK?this.fragment.appendChild(item):this.handleInner.appendChild(item),attrs.hidden&&this.Hidden(item,!0),attrs.marked&&this.Marked(item,!0),attrs.disabled&&this.Disabled(item,!0),attrs.focused&&this.Focused(item,!0,attrs.manageFocus);for(var name in attrs)attrs.hasOwnProperty(name)&&(item[name]=attrs[name]);return item},CScrollList.prototype.Render=function(){this.fragment.childNodes.length>0&&this.handleInner.appendChild(this.fragment)},CScrollList.prototype.Clear=function(){this.handleInner.innerHTML=null,this.activeItem=null,this.states={}},CScrollList.prototype.Reset=function(item){item&&item.nodeName&&(this.Hidden(item,this.defaultParams.hidden),this.Marked(item,this.defaultParams.marked),this.Disabled(item,this.defaultParams.disabled),this.Focused(item,this.defaultParams.focused),item!==this.activeItem||item.focused||(this.activeItem=null))},CScrollList.prototype.DeleteAll=function(items){var self=this,curPos=null;Array.isArray(items)&&items.length>0&&(null!==document.activeElement&&document.activeElement.parentNode===this.handleInner&&document.activeElement.blur(),-1===items.indexOf(this.Current())?curPos=this.Current():(curPos=this.Next({marked:!1,hidden:!1,disabled:!1}),(null===curPos||curPos===this.Current())&&(curPos=this.Next({marked:!1,hidden:!1,disabled:!1},!0))),items.forEach(function(item){self.Delete(item)}),null!==curPos&&(this.Focused(curPos,!0),this.SetPosition(curPos,!0)))},CScrollList.prototype.Delete=function(item){if(item&&item.nodeName&&item.parentNode===this.handleInner){for(var name in this.states)if(this.states.hasOwnProperty(name)){var index=this.states[name].indexOf(item);-1!==index&&this.states[name].splice(index,1)}item===this.activeItem&&(this.activeItem=null),this.handleInner.removeChild(item)}},CScrollList.prototype.Current=function(){return this.activeItem},CScrollList.prototype.Length=function(){return this.handleInner.children.length+this.fragment.childNodes.length},CScrollList.prototype.SetState=function(item,option,state){if(state=Boolean(state),item[option]!==state){this.states[option]||(this.states[option]=[]);var index=this.states[option].indexOf(item);state?-1===index&&this.states[option].push(item):-1!==index&&this.states[option].splice(index,1);var oldVal=item[option];return item[option]=state,state?item.classList.add(option):item.classList.remove(option),"function"==typeof this.onStateChange&&this.onStateChange(item,option,oldVal,state),!0}return!1},CScrollList.prototype.Hidden=function(item,state){if(state=Boolean(state),item&&item.nodeName){var changed=this.SetState(item,"hidden",state);return changed&&state&&(item.focused&&(this.activeItem=null),this.SetState(item,"marked",!1),this.SetState(item,"focused",!1)),changed}return!1},CScrollList.prototype.Marked=function(item,state){var self=this;return state=Boolean(state),item&&item.nodeName&&!item.disabled&&!item.hidden?(this.multipleSelection===!1&&(this.states.marked||[]).forEach(function(marked){self.SetState(marked,"marked",!1)}),this.SetState(item,"marked",state)):!1},CScrollList.prototype.Disabled=function(item,state){if(state=Boolean(state),item&&item.nodeName){var changed=this.SetState(item,"disabled",state);return changed&&state&&(item.focused&&(this.activeItem=null),this.SetState(item,"marked",!1),this.SetState(item,"focused",!1)),changed}return!1},CScrollList.prototype.Focused=function(item,state,manageFocus){var changed=!1,prevent=!1;return state=state!==!1,void 0===manageFocus&&(manageFocus=this.manageFocus),item&&item.nodeName&&!item.disabled&&!item.hidden&&state!==item.focused&&(state?item!==this.activeItem&&("function"==typeof this.onFocus&&(prevent=this.onFocus(item,this.activeItem)),prevent||(changed=this.SetState(item,"focused",state),this.Focused(this.activeItem,!1,manageFocus),this.activeItem=item,manageFocus!==!1&&this.activeItem.focus())):(changed=this.SetState(item,"focused",state),manageFocus!==!1&&this.activeItem.blur(),this.activeItem=null)),changed},CScrollList.prototype.Activate=function(state,manageFocus){if(void 0===manageFocus&&(manageFocus=this.manageFocus),CBase.prototype.Activate.call(this,state),this.isActive){if(this.activeItem=this.activeItem||this.FindOne(),null===this.activeItem)return!1;this.SetState(this.activeItem,"focused",!0),this.SetPosition(this.activeItem),manageFocus!==!1&&this.activeItem.focus()}else this.activeItem&&this.activeItem.blur();return!0},CScrollList.prototype.Each=function(callback){Array.prototype.forEach.call(this.handleInner.children,callback)},CScrollList.prototype.Find=function(filter,limit,reverse){var match,found=[],items=this.handleInner.children,itlen=items.length,citem=null;filter=filter||this.defaultFilter;for(var i=0;itlen>i;i++){citem=items[reverse?itlen-i-1:i],match=!0;for(var attr in filter)filter.hasOwnProperty(attr)&&(match=match&&citem[attr]===filter[attr]);if(match&&(found.push(citem),limit&&found.length>=limit))break}return found},CScrollList.prototype.FindOne=function(filter,reverse){return this.Find(filter,1,reverse).pop()||null},CScrollList.prototype.Next=function(filter,reverse,nskip,toend){var match,suitable=this.activeItem,pointer=this.activeItem,skipcount=0;if(nskip=nskip||0,pointer)for(filter=filter||this.defaultFilter;pointer=reverse?pointer.previousSibling:pointer.nextSibling;){match=!0;for(var attr in filter)filter.hasOwnProperty(attr)&&(match=match&&pointer[attr]===filter[attr]);if(pointer.hidden||skipcount++,match&&(toend!==!1&&(suitable=pointer),0===nskip||nskip>0&&skipcount>=nskip))return pointer}return suitable},CScrollList.prototype.SetPosition=function(item,makeFocused,manageFocus){var index,page;makeFocused&&(void 0===manageFocus&&(manageFocus=this.manageFocus),this.Focused(item||this.FindOne(),!0,manageFocus)),null!==this.activeItem&&(index=this.activeItem.offsetTop/this.itemHeight,page=Math.floor(index/this.itemsPerPage),1===this.scrollMode?this.handleInner.scrollTop=(index-Math.floor((this.itemsPerPage-1)/2))*this.itemHeight:2===this.scrollMode&&(this.handleInner.scrollTop=this.itemsPerPage*this.itemHeight*page))},CScrollList.prototype.EventHandler=function(event,filter,manageFocus){var found=null;if(void 0===manageFocus&&(manageFocus=this.manageFocus),event.stopped!==!0){switch(event.code){case KEYS.PAGE_UP:case KEYS.PAGE_DOWN:found=this.Next(filter,event.code!==KEYS.PAGE_DOWN,this.itemsPerPage),this.handleInner.scrollTop=this.handleInner.scrollTop+(event.code===KEYS.PAGE_UP?-1:1)*this.itemsPerPage*this.itemHeight;break;case KEYS.LEFT:case KEYS.RIGHT:case KEYS.HOME:case KEYS.END:found=this.FindOne(filter,event.code===KEYS.RIGHT||event.code===KEYS.END);break;case KEYS.UP:case KEYS.DOWN:found=this.Next(filter,event.code===KEYS.UP),this.MoveNext(event.code===KEYS.UP?-1:1);break;case KEYS.OK:return this.activeItem&&this.activeItem.onclick(),void event.preventDefault();default:return}event.preventDefault(),this.Focused(found||this.FindOne(filter),!0,manageFocus)}},CScrollList.prototype.MoveNext=function(direction){null!==this.activeItem&&(1===this.scrollMode?this.handleInner.scrollTop=this.activeItem.offsetTop-Math.floor((this.itemsPerPage-1)/2)*this.itemHeight+direction*this.itemHeight:2===this.scrollMode&&(-1===direction?this.activeItem.offsetTop===this.handleInner.scrollTop&&(this.handleInner.scrollTop=this.handleInner.scrollTop-this.itemsPerPage*this.itemHeight):this.activeItem.offsetTop-this.handleInner.scrollTop===(this.itemsPerPage-1)*this.itemHeight&&(this.handleInner.scrollTop=this.handleInner.scrollTop+this.itemsPerPage*this.itemHeight)))},CScrollList.prototype.onFocus=null,CScrollList.prototype.onStateChange=null,Object.defineProperty(CScrollList.prototype,"itemsPerPage",{get:function(){return this._itemsPerPage?this._itemsPerPage:this._itemsPerPage=Math.round(this.handleInner.offsetHeight/this.handleInner.firstChild.offsetHeight)}}),Object.defineProperty(CScrollList.prototype,"itemHeight",{get:function(){return this.handleInner.firstChild?this.handleInner.firstChild.offsetHeight:0}}),CSimpleSelect.prototype=Object.create(CBase.prototype),CSimpleSelect.prototype.constructor=CSimpleSelect,CSimpleSelect.prototype.GenerateHandle=function(){var wrapper,content_wrapper,self=this;return void 0!==this.parameters.content&&"DIV"===this.parameters.content.tagName?(this.content=this.parameters.content,this.content.parentNode.removeChild(this.content),void 0!==this.content.className&&(this.attributes.content.className+=" "+this.content.className),this.content=element("div",this.attributes.content,this.content||"")):(void 0!==this.parameters.content&&"DIV"!==this.parameters.content.tagName&&(this.content=this.parameters.content),this.content=element("div",this.attributes.content,this.content||"")),content_wrapper=element("div",this.attributes.content_wrapper,[this.content,this.hint=element("div",this.attributes.hint)]),this.parameters.leftArrow?(this.leftArrow=this.parameters.leftArrow,this.leftArrow.parentNode.removeChild(this.leftArrow),this.leftArrow=element("div",this.attributes.left_arrow,this.leftArrow)):this.leftArrow=element("div",this.attributes.left_arrow,this.leftArrow||element("p")),this.parameters.rightArrow?(this.rightArrow=this.parameters.rightArrow,this.rightArrow.parentNode.removeChild(this.rightArrow),this.rightArrow=element("div",this.attributes.right_arrow,this.rightArrow)):this.rightArrow=element("div",this.attributes.right_arrow,this.rightArrow||element("p")),wrapper=element("div",this.attributes.wrapper,element("div",{className:"content-wrapper",onfocus:function(){}},[this.leftArrow,content_wrapper,this.rightArrow])),wrapper.className+=" "+this.style,void 0!==this.parameters.width&&(wrapper.style.width=this.parameters.width),this.leftArrow.onclick=function(event){self.disabled||(self.Previous(),event.stopPropagation(),event.preventDefault())},this.rightArrow.onclick=function(event){self.disabled||(self.Next(),event.stopPropagation(),event.preventDefault())},wrapper},CSimpleSelect.prototype.onInit=function(){var self=this;elchild(this.parentNode,this.handle),this.handle.component=this,this.handle.onblur=function(){self.trigger("onBlur")},this.handle.onfocus=function(){self.trigger("onFocus")}},CSimpleSelect.prototype.EventHandler=function(event){if(eventPrepare(event,!0,"CSimpleSelect"),this.disabled!==!0)switch(event.stopped=!0,event.code){case KEYS.LEFT:this.Previous();break;case KEYS.RIGHT:this.Next();break;default:event.stopped=!1}},CSimpleSelect.prototype.SetContent=function(content,placeholder){void 0===content&&placeholder&&(content=placeholder,this.content.classList.add("placeholder")),this.content.innerHTML="",this.content.innerHTML=content},CSimpleSelect.prototype.DisableElement=function(element,disable){disable===!0?-1===element.className.indexOf("disabled")&&(element.className+=" disabled"):element.className=element.className.replace(" disabled","")},CSimpleSelect.prototype.SetHint=function(hint){this.hint.innerHTML=hint},CSimpleSelect.prototype.Next=function(){},CSimpleSelect.prototype.Previous=function(){this.autocomplete=""},CSimpleSelect.prototype.focus=function(){this.handle.focus()},CSimpleSelect.prototype.blur=function(){this.handle.blur()},CSimpleSelect.prototype.IsFocused=function(){return document.activeElement===this.handle},CSimpleSelect.prototype.Disable=function(disable){this.DisableElement(this.handle,this.disabled=disable===!0)},Events.inject(CSimpleSelect),
CSelectBox.prototype=Object.create(CSimpleSelect.prototype),CSelectBox.prototype.constructor=CSelectBox,CSelectDropdown.prototype=Object.create(CScrollList.prototype),CSelectDropdown.prototype.constructor=CSelectDropdown,CSelectDropdown.parameters=["scrollMode","select","container"],CSelectDropdown.prototype.Refresh=function(){var el,i,self=this,data=this.select.GetData();for(this.Clear(),i=0;i<data.length,el=data[i];i++)"object"==typeof el&&(el=el[this.select.GetNameField()]),this.Add(element("div",extend(this.attributes.element,{innerHTML:el})),{onclick:function(){self.select.SetIndex(self.activeItem.index),self.Marked(self.activeItem,!0),self.Show(!1,self.manageFocus)},index:i})},CSelectDropdown.prototype.onShow=function(){this.UpdateGeometry();var item=this.handleInner.children[this.select.GetIndex()];this.SetPosition(item,!0,!1),this.Focused(item,!0),this.Marked(item,!0)},CSelectDropdown.prototype.UpdateGeometry=function(){var containerRect,inputRect=this.base.getBoundingClientRect(),top=this.base.offsetTop+inputRect.height,height=WINDOW_HEIGHT;void 0!==this.container&&(containerRect=this.container.getBoundingClientRect(),height=containerRect.top+containerRect.height),inputRect.top+inputRect.height+this.itemHeight*this.itemsPerPage>height&&(top=this.base.offsetTop-this.itemHeight*this.itemsPerPage),1===this.scrollMode&&(top-=this.itemHeight*Math.abs(Math.floor(this.itemsPerPage/2*-1))),this.handle.style.top=top+"px",this.handle.style.left=this.base.offsetLeft+"px",this.handle.style.width=inputRect.width-2*parseInt(document.defaultView.getComputedStyle(this.handle,"")["border-left-width"])+"px"},Events.inject(CSelectDropdown),CIntervalBox.prototype=Object.create(CSimpleSelect.prototype),CIntervalBox.prototype.constructor=CIntervalBox;var MODAL_IMG_PATH=configuration.newRemoteControl?PATH_IMG_SYSTEM+"buttons/new/":PATH_IMG_SYSTEM+"buttons/old/",CUpdateModal=function(parent,options){var self=this;CModalBox.call(this,parent||null),this.isVisible=!1,this.name="CUpdateModal",this.baseClass="cmodal-main cupdate-modal",this.$status=element("td",{className:"right"}),this.F1_func=null,this.Info_func=null,this.image_info={},CUpdateModal.parameters.forEach(function(option){void 0!==options[option]&&(self[option]=options[option])}),this.bind(this.events),this.bpanel=new CButtonPanel,this.bpanel.Init(MODAL_IMG_PATH),this.Exit_btn=this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Update.Clear(),self.Show(!1)},this.auto===!0),this.Info_btn=this.bpanel.Add(KEYS.INFO,"info.png",_("Show log"),function(){self.Info_func()},this.log!==!0),this.OK_btn=this.bpanel.Add(KEYS.F1,"f1.png",_("Update"),function(){self.F1_func()},!0),this.ProgressBar=new CProgressBar(this,element("div")),this.SetHeader(this.header_text),this.SetFooter(this.bpanel.handle),this.EventHandler=function(event){eventPrepare(event),void 0!==self.select&&"function"==typeof self.select.EventHandler&&self.select.EventHandler(event),self.bpanel.EventHandler(event)},this.Init()};CUpdateModal.parameters=["update_url","check","auto","images","log","select","header_text","info","events","warning"],CUpdateModal.prototype=Object.create(CModalBox.prototype),CUpdateModal.prototype.constructor=CUpdateModal,CUpdateModal.prototype.onHide=function(){this.trigger("onHide")},CUpdateModal.prototype.onShow=function(){this.trigger("onShow")},CUpdateModal.prototype.onInit=function(){var self=this;this.Update=new Update({onReady:function(){echo("CUpdateModal.Update: onReady listener"),self.image_info=self.Update.GetImageInfo(),self.image_description=self.image_info.description,self.image_date=self.image_info.date,self.auto===!0?self.UpdateStart():self.ImageSelect(),self.trigger("onReady")},onCheck:function(data){echo("CUpdateModal.Update: onCheck listener"),self._addLogMessage(data.logMessage),self.$status.innerHTML=data.statusMessage,self.$status.className="right",self.trigger("onCheck",data),self.bpanel.Rename(self.OK_btn,_("Update"))},onError:function(data){echo("CUpdateModal.Update: onError listener"),self._addLogMessage(data.logMessage,"error"),self.bpanel.Hidden(self.OK_btn,!1),self.bpanel.Hidden(self.Exit_btn,!1),self.bpanel.Rename(self.OK_btn,_("Retry")),self.bpanel.Rename(self.Exit_btn,_("Exit")),self.$status.innerHTML=data.errorMessage,self.$status.classList.add("error"),self.trigger("onError",data)},onProgress:function(data){echo("CUpdateModal.Update: onProgress listener"),self._addLogMessage(data.logMessage),self.$status.innerHTML=data.statusMessage,self.ProgressBar.SetProgress(data.percent),self.trigger("onProgress",data)},onStart:function(){echo("CUpdateModal.Update: onStart listener"),self.UpdateStart(),CModalBox.prototype.Show.call(self,!0)}}),this.log===!0&&(this.log=new CLog(document.body,{autofocus:!0,time:!0,newest:!0,defaultType:"success",isVisible:!1,events:{onShow:function(){self.$status.parentNode.style.display="none"},onHide:function(){self.$status.parentNode.style.display=""}}})),this.curr_info=this.Update.GetCurrentImageInfo(),"string"==typeof this.update_url?this.check=!0:Array.isArray(this.images)&&(this.check=!1,this.image_description=cutTextWithEllipsis(this.images[0].descr,200),this.image_date=new Date(this.images[0].date),this.select===!0&&this.images.length>1?(this.select=new CSelectBox(this,{parent:this.new_version=element("div"),data:this.images,nameField:"title",idField:"url",events:{onChange:function(){self.$curr_update_descr.innerHTML=cutTextWithEllipsis(this.GetSelected().descr,200),self.update_url=this.GetValue(),self.$curr_update_date.innerHTML=new Date(this.GetSelected().date).toDateString()+" "+new Date(this.GetSelected().date).toLocaleTimeString()}}}),this.update_url=this.select.GetValue()):(this.new_version=this.images[0].title,this.new_version_date=new Date(this.images[0].date),this.update_url=this.images[0].url))},CUpdateModal.prototype._addLogMessage=function(message,type){void 0!==this.log&&this.log.Add(message,type)},CUpdateModal.prototype._addLog=function(elements){var self=this;"undefined"!=typeof this.log&&(elements.push(element("tr",{className:"row"},[element("td",{className:"log",colSpan:2},this.log.handle)])),this.Info_func=function(){self.log.Show(!self.log.isVisible),this.bpanel.Rename(this.Info_btn,_(self.log.isVisible?"Hide log":"Show log")),self.content.querySelector("table").classList.toggle("hidden")},this.bpanel.Rename(this.Info_btn,_(self.log.isVisible?"Hide log":"Show log")),this.bpanel.Hidden(this.Info_btn,!1))},CUpdateModal.prototype.Show=function(show){if(echo("CUpdateModal.prototype.Show:show? "+show+", auto? "+this.auto+", check? "+this.check),show!==!1){if(this.auto===!0)return void this.Update.Start(this.update_url);this.check===!0?this.CheckStatus():this.ImageSelect(),this.log&&this.log.isVisible&&this.log.Show(!1)}CModalBox.prototype.Show.call(this,show)},CUpdateModal.prototype.CheckStatus=function(){echo("CUpdateModal.CheckStatus"),this.layer=this.CheckStatus;var self=this,elements=[element("tr",{className:"row"},[element("td",{className:"left"},_("Status")+":"),this.$status=element("td",{className:"right"})])];this._addLog(elements),this.SetHeader(_("Check image")),this.SetContent(element("table",{className:"cmodal-update status"},elements)),this.F1_func=function(){self.$status.innerHtml=status,self.$status.className="right",self.bpanel.Hidden(this.OK_btn,!0),self.bpanel.Rename(this.Exit_btn,_("Cancel")),self.Update.CheckUpdate(self.update_url),self.trigger("onCheckStatus")},self.Update.CheckUpdate(self.update_url)},CUpdateModal.prototype.ImageSelect=function(){this.layer=this.ImageSelect;var $new_version,self=this,elements=[element("tr",{className:"row info"},[element("td",{className:"left"},_("Current version")+":"),element("td",{className:"right",innerHTML:this.curr_info.version})]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Description")+":"),element("td",{className:"right"},element("div",{className:"ellipsis",innerHTML:this.curr_info.description||""}))]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Date")+":"),element("td",{className:"right",innerHTML:isNaN(this.curr_info.date)?"n/a":this.curr_info.date.toDateString()+" "+this.curr_info.date.toLocaleTimeString()})]),element("tr",{className:"row padding info"},[element("td",{className:"left"},_("New version")+":"),element("td",{className:"right"},$new_version=element("div"))]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Description")+":"),element("td",{className:"right"},self.$curr_update_descr=element("div",{className:"ellipsis",innerHTML:this.image_description||""}))]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Date")+":"),self.$curr_update_date=element("td",{className:"right",innerHTML:this.image_date.toDateString()+" "+this.image_date.toLocaleTimeString()})])];this.warning!==!1&&elements.unshift(element("tr",{className:"row info"},[element("td",{className:"center",colSpan:2,innerHTML:_('<span class="alert">Warning!</span> Device will be rebooted after update')})])),this.bpanel.Hidden(this.Info_btn,this.info!==!0),this._addLog(elements),this.SetContent(element("table",{className:"cmodal-update"},elements)),void 0!==this.new_version?"string"==typeof this.new_version?($new_version.innerHTML=this.new_version,self.$curr_update_date.innerHTML=this.new_version_date.toDateString()+" "+this.new_version_date.toLocaleTimeString()):elchild($new_version,this.new_version):($new_version.innerHTML=this.image_info.version,self.$curr_update_date.innerHTML=this.image_info.date.toDateString()+" "+this.image_info.date.toLocaleTimeString()),this.SetHeader(this.header_text||""),this.info===!0&&(this.Info_func=function(){self.ShowInfoWindow()},this.bpanel.Rename(this.Info_btn,_("Change log"))),this.F1_func=function(){self.Update.Start(this.update_url)},this.bpanel.Hidden(this.OK_btn,!1),this.bpanel.Hidden(this.Exit_btn,!1),this._binded!==!0&&(this.bind("onShow",function(){this.layer===this.ImageSelect&&this.select&&this.select.focus&&this.select.focus()}),this._binded=!0)},CUpdateModal.prototype.UpdateStart=function(){this.layer=this.UpdateStart;var self=this,elements=[element("tr",{className:"row info"},[element("td",{className:"center",colSpan:2,innerHTML:_('<span class="alert">Warning!</span> Device will be rebooted after update')})]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Current version")+":"),element("td",{className:"right",innerHTML:this.curr_info.version})]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Description")+":"),element("td",{className:"right"},element("div",{className:"ellipsis",innerHTML:this.curr_info.description||""}))]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Date")+":"),element("td",{className:"right",innerHTML:isNaN(this.curr_info.date)?"n/a":this.curr_info.date.toDateString()+" "+this.curr_info.date.toLocaleTimeString()})]),element("tr",{className:"row info padding"},[element("td",{className:"left"},_("New version")+":"),element("td",{className:"right",innerHTML:this.image_info.version})]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Description")+":"),element("td",{className:"right"},self.$curr_update_descr=element("div",{className:"ellipsis",innerHTML:this.image_description||""}))]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Date")+":"),element("td",{className:"right",innerHTML:this.image_info.date.toDateString()+" "+this.image_info.date.toLocaleTimeString()})]),element("tr",{className:"row padding"},[element("td",{className:"left"},_("Update status")+":"),this.$status])];this.bpanel.Hidden(this.Info_btn,!0),this.bpanel.Hidden(self.Exit_btn,!0),this._addLog(elements),elements.push(element("tr",{className:"row"},[element("td",{className:"center",colSpan:2},this.ProgressBar.handle)])),this.SetContent(element("table",{className:"cmodal-update"},elements)),this.bpanel.Hidden(this.OK_btn,!0),this.bpanel.Hidden(this.Exit_btn,!0),self.log.isVisible?self.content.querySelector("table").classList.add("hidden"):self.content.querySelector("table").classList.remove("hidden"),this.trigger("onShowUpdateStart"),this.F1_func=function(){self.Update.Start(self.update_url,self.$status.classList.contains("error")),self.$status.innerHtml="",self.$status.classList.remove("error"),self.bpanel.Hidden(this.OK_btn,!0),self.bpanel.Hidden(this.Exit_btn,!0)}},CUpdateModal.prototype.ShowInfoWindow=function(){var $content,modal=new CModalBox(this),self=this;if(modal.SetHeader(_("Change log")),modal.baseClass="cmodal-main image-info-modal",modal.name="CModalImageInfo",modal.bpanel=new CButtonPanel,modal.bpanel.Init(MODAL_IMG_PATH),modal.bpanel.Add(KEYS.EXIT,"exit.png",_("Close"),function(){modal.Show(!1),modal.Free()}),modal.EventHandler=function(event){switch(event.code){case KEYS.UP:$content.parentNode.scrollByLines(-2);break;case KEYS.DOWN:$content.parentNode.scrollByLines(2);break;case KEYS.PAGE_DOWN:$content.parentNode.scrollByPages(1);break;case KEYS.PAGE_UP:$content.parentNode.scrollByPages(-1)}modal.bpanel.EventHandler(event)},modal.SetFooter(modal.bpanel.handle),modal.SetContent(element("div",{className:"image-info-content"},$content=element("div",{className:"info"},_("Information not found")))),modal.Init(),void 0===this.image_info[this.update_url]&&this.update_url){var name=this.update_url.split("/").pop();return void ajax("GET",this.update_url.replace(name,"")+"info/pub/get.php?name="+name+"&lang="+getCurrentLanguage(),function(text,status){200===status?self.image_info[self.update_url]=text:self.image_info[self.update_url]=_("Information not found"),$content.innerHTML=self.image_info[self.update_url],modal.Show(!0),$content.focus()})}$content.innerHTML=self.image_info[self.update_url],modal.Show(!0),$content.focus()},Events.inject(CUpdateModal);var updateWindow;window.onload=function(){var urlKeys=parseUri(window.location).queryKey,language=JSON.parse(gSTB.GetEnv(JSON.stringify({varList:["language"]}))).result.language,remoteControlButtonsImagesPath=configuration.newRemoteControl?PATH_IMG_SYSTEM+"buttons/new/":PATH_IMG_SYSTEM+"buttons/old/",imageList=["exit.png","ok.png","info.png"].map(function(image){return remoteControlButtonsImagesPath+image});window.moveTo(0,0),window.resizeTo(EMULATION?window.outerWidth:screen.width,EMULATION?window.outerHeight:screen.height),echo("load update page. urlKeys.CheckVersion:"+urlKeys.CheckVersion+" with type:"+typeof urlKeys.CheckVersion),gettext.init({name:language,path:"lang"},function(){var url=urlKeys.url,check=Boolean(urlKeys.CheckVersion),options={localizations:[_("Retry"),_("Cancel"),_("Show log"),_("Hide log"),_("Update"),_("Update status"),_("Check image"),_("Exit"),_("Current version"),_("New version"),_("Description"),_("Updating to version"),_("Update status"),_('<span class="alert">Warning!</span> Device will be rebooted after update'),_("Change log"),_("Information not found"),_("Signature init error"),_("Wrong device model"),_("Section size exceeds partition size on FLASH"),_("Required FLASH section not found. Aborting update"),_("Updating kernel"),_("Updating image"),_("Internal error"),_("Inspecting firmware"),_("Updating environment variables"),_("Updating Bootstrap section"),_("Skipping Bootstrap section"),_("Updating User FS section"),_("Skipping User FS section"),_("Updating second boot"),_("Updating logotype"),_("Update finished OK"),_("Wrong signature"),_("Erasing flash section"),_("Flash write error"),_("File write error"),_("Idle"),_("Invalid file header"),_("Inspecting update file"),_("File check finished"),_("File not found"),_("Initialising"),_("Read error"),_("Status"),_("Date")],auto:!1,update_url:url,header_text:_("Autoupdate"),log:!0,events:{onStart:function(){echo("updater.js: onStart listener, this.isVisible:"+this.isVisible),this.isVisible===!1&&(echo("updater.js => update window show."),this.UpdateStart(),this.Show(!0),stbWindowMgr.windowShow(stbWebWindow.windowId()),stbWebWindow.messageSend(getWindowIdByName(WINDOWS.PORTAL)||1,"AutoUpdateWindow:opened",""),echo("updater.js => update window showed."))},onReady:function(){var currImgDate=this.curr_info.date.getTime(),newImgDate=this.image_info.date.getTime();echo("updater.js: onReady listener"),echo("check: "+check),echo("newImgDate :"+newImgDate),echo("currImgDate:"+currImgDate),check===!1||check===!0&&(isNaN(currImgDate)||newImgDate>currImgDate)?(echo("updater.js => need update"),this.Update.Start(this.update_url)):(echo("updater.js => device is ready. no need for update. close itself."),stbWebWindow.messageSend(getWindowIdByName(WINDOWS.PORTAL)||1,"AutoUpdateWindow:closed",""),stbWebWindow.close())},onError:function(){echo("updater.js => onError listener."),this.isVisible===!1&&(echo("updater.js => error happened. close update window."),stbWebWindow.messageSend(getWindowIdByName(WINDOWS.PORTAL)||1,"AutoUpdateWindow:closed",""),stbWebWindow.close())},onHide:function(){echo("updater.js: onHide listener => normal update window close."),stbWebWindow.messageSend(getWindowIdByName(WINDOWS.PORTAL)||1,"AutoUpdateWindow:closed",""),stbWebWindow.close()}}};updateWindow=new CUpdateModal(document.body,options),updateWindow.Update.bind({onStart:function(){echo("updater.js: onStart listener"),echo("is this.isVisible:"+updateWindow.isVisible),updateWindow.isVisible===!1&&(echo("updater.js => update window show."),updateWindow.UpdateStart(),updateWindow.Show(!0)),stbWindowMgr.windowShow(stbWebWindow.windowId()),stbWebWindow.messageSend(getWindowIdByName(WINDOWS.PORTAL)||1,"AutoUpdateWindow:opened",""),echo("updater.js => update window showed.")}}),imageLoader(imageList,function(){-1!==urlKeys.url.indexOf("igmp://")&&(echo("updater.js: multicast update request has been found. Show loader."),updateWindow.Show(!0),stbWindowMgr.windowShow(stbWebWindow.windowId())),updateWindow.Update.CheckUpdate(url)})}),document.body.onkeydown=function(event){updateWindow.EventHandler(event)}};