"use strict";function getWindowKey(windowName){return"window."+windowName+".id"}function getWindowIdByName(windowName){return stbStorage.getItem(getWindowKey(windowName))}function openWindow(windowName,url){var windowInfo,windowKey=getWindowKey(windowName),windowID=stbStorage.getItem(windowKey);if(windowID)try{windowInfo=JSON.parse(stbWindowMgr.windowInfo(windowID)),-1===windowInfo.result.url.indexOf(url)&&stbWebWindow.messageSend(windowID,"window.load",url),windowName===WINDOWS.BROWSER?(windowID=stbWindowMgr.openWebFace(url),stbStorage.setItem(windowKey,windowID)):stbWindowMgr.windowShow(windowID)}catch(e){echo(e),stbWindowMgr.openWebFace(url)}else windowID=windowName===WINDOWS.BROWSER?stbWindowMgr.openWebFace(url):stbWindowMgr.windowInit(JSON.stringify({url:url,backgroundColor:"#000"})),stbStorage.setItem(windowKey,windowID);return windowID}function openWindowHelp(path){openWindow(WINDOWS.HELP,PATH_ROOT+"public/app/help/index.html?path="+path)}function elattr(obj,attr){if(obj&&obj.nodeType&&attr&&attr instanceof Object)for(var key in attr)attr.hasOwnProperty(key)&&(obj[key]=attr[key]);return obj}function element(name,attr,data){var tag=document.createElement(name);return elattr(tag,attr),elchild(tag,data),tag}function elchild(obj,value){if(obj&&value)if(value.nodeType)obj.appendChild(value);else if(Array.isArray(value))for(var i=0;i<value.length;i++)elchild(obj,value[i]);else obj.appendChild(document.createTextNode(value));return obj}function elclear(obj){if(null!==obj&&obj.nodeName&&obj.hasChildNodes())for(;obj.hasChildNodes();)obj.removeChild(obj.firstChild);return obj}function loadScript(src,onload,onerror){var elem=document.createElement("script");elem.type="text/javascript",elem.src=src,"function"==typeof onload&&(elem.onload=onload),"function"==typeof onerror&&(elem.onerror=onerror),document.head.appendChild(elem)}function getCurrentLanguage(langList){var langEnv=JSON.parse(gSTB.GetEnv('{"varList":["language"]}')),langVal="en";return langList=langList||["en","ru","uk","de","tr"],!langEnv.errMsg&&langEnv.result&&langEnv.result.language&&"string"==typeof langEnv.result.language&&(langEnv.result.language=langEnv.result.language.toLowerCase(),-1!==langList.indexOf(langEnv.result.language)&&(langVal=langEnv.result.language)),langVal}function getEnvList(list){var data;try{if(data=JSON.parse(gSTB.GetEnv(JSON.stringify({varList:list}))),""!==data.errMsg)throw new Error(data.errMsg);return data.result}catch(e){echo(e)}return!1}function getEnv(name){var data=getEnvList([name]);return data!==!1&&void 0!==data[name]?data[name]:data}function setEnv(key,value){var vars={};return vars[key]=value,setEnvList(vars)}function setEnvList(hash){try{return gSTB.SetEnv(JSON.stringify(hash))}catch(e){echo(e)}return!1}function eventPrepare(event,stopBubble,label){return void 0!==event.code?!0:(event.code=event.keyCode||event.which,0===event.code?!1:(event.shiftKey&&(event.code+=1e3),event.altKey&&(event.code+=2e3),event.code===KEYS.USB_MOUNTED||event.code===KEYS.USB_UNMOUNTED?!1:(stopBubble!==!1&&event.stopPropagation(),echo(event.code+"	"+event.shiftKey+"	"+event.ctrlKey+"	"+event.altKey+"	"+event.srcElement.id+"	"+event.target.id+"	"+(label||""),"keyDown [code/shift/ctrl/alt/src/target]"),!0)))}function ajax(method,url,callback,headers,type,async){var hname,jdata=null,timeout=null,xhr=new XMLHttpRequest,title="AJAX "+method.toUpperCase()+" "+url;if(async=async!==!1,xhr.onreadystatechange=function(){if(4===xhr.readyState)if(clearTimeout(timeout),ajax.stop)echo(xhr.status,title),"function"==typeof callback&&callback(null,null,null);else{if(echo("status:"+xhr.status+", length:"+xhr.responseText.length,title),"json"===type&&200===xhr.status)try{jdata=JSON.parse(xhr.responseText)}catch(e){echo(e,"AJAX JSON.parse"),jdata=null}"function"==typeof callback&&callback("xml"===type?xhr.responseXML:"json"===type?jdata:xhr.responseText,xhr.status,xhr)}},xhr.open(method,url,async),headers)for(hname in headers)headers.hasOwnProperty(hname)&&xhr.setRequestHeader(hname,headers[hname]);return xhr.send(),echo("sent",title),timeout=setTimeout(function(){xhr.abort(),echo("ABORT on timeout",title),"function"==typeof callback&&callback(null,0)},6e4),xhr}function imageLoader(imgList,callback){var count=1,onload=function(){imgList.length===count&&"function"==typeof callback?callback():count++};Array.isArray(imgList)&&imgList.length>0?imgList.forEach(function(item){var img=new Image;img.src=item,img.onload=onload,img.onerror=function(){throw"Image "+item+" load fail"}}):0===imgList.length&&callback()}function getStorageInfo(){var snList={},info=JSON.parse(gSTB.GetStorageInfo("{}"));Array.isArray(info.result)&&""===info.errMsg&&info.result.length>0?(info.result.forEach(function(item){item.mediaType="000022272228"===item.sn?3:item.mediaType,item.label=item.label.trim(),snList[item.sn]?snList[item.sn]++:snList[item.sn]=1}),info.result.forEach(function(item){item.label||(item.label=item.vendor+" "+item.model.replace(/\//,""),snList[item.sn]>1&&(item.label+=" #"+item.partitionNum)),item.isReadOnly&&(item.label+=" ("+_("Read only")+")")}),info.result.sort(function(a,b){return a.mountPath<b.mountPath?-1:1}),window.STORAGE_INFO=info.result):window.STORAGE_INFO=[];try{window.HDD_INFO=JSON.parse(gSTB.RDir("get_hdd_info")||"[]")}catch(e){echo(e,"get_hdd_info"),window.HDD_INFO=[]}echo(STORAGE_INFO,"STORAGE_INFO"),echo(HDD_INFO,"HDD_INFO")}function parseUri(str){for(var o=parseUri.options,m=o.parser[o.strictMode?"strict":"loose"].exec(str),uri={},i=14;i--;)uri[o.key[i]]=m[i]||"";return uri[o.q.name]={},uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){$1&&(uri[o.q.name][$1]=$2)}),uri}function validateUrl(url,sol,isSolutionOptional,isProtocolOptional){var solReg="((ffmpeg|auto|rtp|rtsp|mp3|mpegps|mpegts|mp4|ifm|fm|ffrt|ffrt2|ffrt3|ffrt4)(\\s))";return isProtocolOptional=typeof isProtocolOptional==typeof!0?isProtocolOptional:!0,new RegExp("^"+(sol?solReg:"")+["","?"][+!!isSolutionOptional]+"(((http|https|udp|rtp|rtsp|mms|mmsh|mmst|rtmp|igmp):\\/\\/)"+["","?"][+isProtocolOptional]+"@?(([a-zA-Z0-9а-яА-Я$\\-_.+!*'(),;:&=]|%[0-9a-fA-Fа-яА-Я]{2})+@)?(((25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])(\\.(25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])){3})|localhost|([a-zA-Zа-яА-Я0-9\\-\\u00C0-\\u017F]+\\.)+([a-zA-Zа-яА-Я]{2,}))(:[0-9]+)?|((file:///|/)[a-zA-Zа-яА-Я0-9\\-\\u00C0-\\u017F]+))(\\/(([a-zA-Zа-яА-Я0-9$\\-_.+!*'(),;:@&=\\s]|%[0-9a-fA-Fа-яА-Я]{2})*(\\/([a-zA-Zа-яА-Я0-9$\\-_.+!*'(),;:@&=\\s]|%[0-9a-fA-Fа-яА-Я]{2})*)*)?(\\?([a-zA-Zа-яА-Я0-9$\\-_.+!*'(),;:@&=\\/?]|%[0-9a-fA-Fа-яА-Я]{2})*)?(\\#([a-zA-Zа-яА-Я0-9$\\-_.+!*'(),;:@&=\\/?]|%[0-9a-fA-Fа-яА-Я]{2})*)?)?$").test(url)}function extend(target,source,override){var _target=override===!1?extend({},target):target||{};for(var prop in source)"object"!=typeof _target[prop]||"object"!=typeof source[prop]||Array.isArray(_target[prop])||Array.isArray(source[prop])?_target[prop]=source[prop]:_target[prop]=extend(_target[prop],source[prop],override);return _target}function base64Encode(data){return btoa(unescape(encodeURIComponent(data)))}function base64Decode(data){try{return decodeURIComponent(escape(atob(data)))}catch(error){echo(error,"base64Decode Error")}}function cutTextWithEllipsis(text,length){return text.length>length?text.toString().slice(0,length)+"...":text}function parseDate(dateStr){if(!dateStr)return new Date(NaN);var date=new Date(dateStr.match(/\w{3}\s\w{3}\s\d{1,2}\s\d{1,2}:\d{1,2}:\d{1,2}/)+" "+dateStr.match(/\d{4}/)),timeZone=dateStr.match(/(\w{1,4}|((\+|-)\d{1,2}))\s+\d{4}/)[1],offset=timeZoneOffsets[timeZone];return date.setMinutes(date.getMinutes()-date.getTimezoneOffset()),0!==offset.index&&date.setMinutes(date.getMinutes()+(offset.minutes||0)*offset.index),date}function getMediaType(file){var extension=file.split(".").pop().toLowerCase();if(extension&&-1!==configuration.registersTypes.indexOf(extension))for(var type,i=0;i<MEDIA_TYPES.length,type=MEDIA_TYPES[i];i++)if(-1!==MEDIA_EXTENSION[type].indexOf(extension))return type;return MEDIA_TYPE_NONE}function readJSON(path,fileName){var result,xmlhttp=new XMLHttpRequest;path=path+"/"+fileName;try{xmlhttp.open("GET",path,!1),xmlhttp.send(null),result=xmlhttp.responseText}catch(e){echo(e,"some xmlhttp error"),result=""}return echo(result,"file "+path),result}function CBase(parent){this.name="CBase",this.handle=null,this.parent=null,this.handleInner=null,this.showAttr="block",this.baseClass="",this.prevFocus=null,this.isActive=!1,this.activeChild=null,this.isVisible=!0,this.SetParent(parent)}function Update(events){this.bind(events),this.check_url=this.update_url="",this.checked=!1}function CPage(parent){CBase.call(this,parent||null),this.name="CPage",this.previous=null,this.isVisible=!1}function CScrollList(parent){CBase.call(this,parent),this.name="CScrollList",this.baseClass="cslist-main",this.multipleSelection=!0,this.activeItem=null,this.states={},this.manageFocus=!0,this.defaultParams={hidden:!1,marked:!1,disabled:!1,focused:!1,href:"#",self:this,manageFocus:!0,oncontextmenu:EMULATION?null:function(){return!1},onclick:function(){return this.self.Focused(this,!0),!1},onmouseover:function(){return this.self.Focused(this,!0),!1}},this.defaultFilter={hidden:!1,disabled:!1},this.scrollMode=2,this.RENDER_MODE_SINGLE=1,this.RENDER_MODE_BULK=2,this.renderMode=this.RENDER_MODE_SINGLE,this.fragment=document.createDocumentFragment()}function CList(parent,customParams){CBase.call(this,parent),customParams||(customParams={}),this.name="CList",this.baseClass="clist-main",this.multipleSelection=!0,this.activeItem=null,this.items=[],this.list=[],this.itemIndex=0,this.listIndex=0,this.pageIndex=0,this.itemsHandle=null,this.scrollHandle=null,this.scrollThumb=null,this.states={},this.manageFocus=!1,this.defaultParams={hidden:!1,marked:!1,disabled:!1,focused:!1,self:this,index:-1,data:null,manageFocus:!1,oncontextmenu:EMULATION?null:function(){return!1},onclick:function(){return this.self.OnMouseover(this),this.self.pressOK(this),!1},onmouseover:function(){return this.self.OnMouseover(this),!1}},customParams.defaultParams&&(this.defaultParams=extend(this.defaultParams,customParams.defaultParams)),this.onPage=customParams.onPage?customParams.onPage:function(){var count={480:5,576:6,720:7,1080:7};return count[screen.height]}(),this.fillsName=customParams.fillsName?customParams.fillsName:{text:"text",data:"data"},this.defaultFilter={hidden:!1,disabled:!1},this.fragment=document.createDocumentFragment()}function VScrollBar(config){this.$node=null,this.$body=null,this.viewSize=10,this.realSize=100,this.value=0,this.thumbRect=null,this.trackRect=null,config=config||{},void 0!==config.$node?this.$node=config.$node:this.$node=document.createElement("div"),void 0!==config.$body?this.$body=config.$body:this.$body=this.$node.appendChild(document.createElement("div")),this.$node.classList.add("scrollBar"),this.$body.classList.add("thumb"),this.init(config)}function VList(parent){switch(this.activeItem=null,this.indexView=null,this.data=[],this.scrollBar=null,this.size=7,this.states={},screen.height){case 480:this.size=5;break;case 576:this.size=5;break;case 720:this.size=7;break;case 1080:this.size=7}CBase.call(this,parent)}function CGroupMenu(parent){CBase.call(this,parent),this.name="CGroupMenu",this.baseClass="cgmenu-main",this.activeGroup=null,this.active=!1,this.autoFocus=!0}function CModal(parent){CPage.call(this,parent),this.name="CModal",this.baseClass="cmodal-main",this.showAttr="table",this.focusList=[],this.focusPos=0}function CModalBox(parent){CModal.call(this,parent),this.name="CModalBox",this.header=element("div",{className:"cmodal-header"}),this.content=element("div",{className:"cmodal-content"}),this.footer=element("div",{className:"cmodal-footer"})}function CModalHint(parent,data,time,isForced){if(data){CModalBox.call(this,parent),this.name="CModalHint";var self=this;this.SetHeader(),this.SetContent(data),this.SetFooter(),this.onHide=function(){self.Free()},this.onClick=function(){self.Show(!1)},this.Init(),this.Show(!0),isForced!==!0&&(this.EventHandler=function(event){self.Show(!1),self.timer&&clearTimeout(self.timer),event.preventDefault()}),time&&(this.timer=setTimeout(function(){self.Show(!1)},time||5e3))}}function CModalAlert(parent,title,data,btnExitTitle,btnExitClick){if(data){CModalBox.call(this,parent),this.name="CModalAlert";var self=this;this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.btnExit=this.bpanel.Add(KEYS.EXIT,"exit.png",btnExitTitle||"",function(){"function"==typeof btnExitClick&&btnExitClick.call(self),self.Show(!1)}),this.SetHeader(title),this.SetContent(data),this.SetFooter(this.bpanel.handle),this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(e){eventPrepare(e,!0,this.name)&&self.bpanel.EventHandler(e)},this.Init(),this.Show(!0)}}function CModalConfirm(parent,title,data,btnExitTitle,btnExitClick,btnOKTitle,btnOKClick){CModalAlert.call(this,parent,title,data,btnExitTitle,btnExitClick),this.name="CModalConfirm";var self=this;this.bpanel.Add(KEYS.OK,"ok.png",btnOKTitle,function(){self.Show(!1),"function"==typeof btnOKClick&&(btnOKClick.call(self),btnOKClick=null)})}function CButtonPanel(parent){CBase.call(this,parent),this.name="CButtonPanel",this.baseClass="cbpanel-main",this.path="",this.isActive=!0}function CBreadCrumb(parent){CBase.call(this,parent),this.name="CBreadCrumb",this.baseClass="cbcrumb-main",this.path="",this.leftItems=3,this.rightItems=2}function CSearchBar(parent){CBase.call(this,parent),this.name="CSearchBar",this.baseClass="csbar-main",this.filter="",this.path="",this.items={},this.timer=0,this.hint=0,this.icoSearch="ico_search2.png",this.icoFilter="ico_filter.png"}function CCheckBox(parent,parameters){var parentNode,_default=!!parameters.checked,self=this;if(CBase.call(this,parent||null),this.parameters=parameters||{},this.parameters.attributes=parameters.attributes||{},this.name=parameters.name||"input",this.type=this.tagName="checkbox",this.style=parameters.style||"",this.events=parameters.events||{},void 0===(parentNode=parameters.parent)){if(void 0===parameters.element)throw"parentNode or element parameter must be specified";parentNode=parameters.element.parentNode}this.bind(this.events),this.IsChanged=function(){return _default!==self.IsChecked()},this.Init(parentNode)}function CInput(parent,parameters){var _default="",self=this;if(this.parameters=parameters,this.attributes={input:{className:"cinput-input",type:parameters.type||"text"},hint:{className:"cinput-hint cinput-input"},icon:{className:"cinput-icon"},wrapper:{className:"cinput-wrapper"},"text-wrapper":{className:"cinput-text-wrapper"}},this.SetAutocomplete(parameters.autocomplete),this.FoldedClass="folded",void 0!==parameters.attributes&&extend(this.attributes,parameters.attributes),parameters.folded===!0&&(this.attributes.wrapper.className+=" "+this.FoldedClass),void 0!==parameters.style&&(this.attributes.wrapper.className+=" "+parameters.style),this.events=parameters.events||{},CBase.call(this,parent||null),this.bind(this.events),this.type="input",this.name=parameters.name||"input",!(this.parentNode=parameters.parent)){if(void 0===parameters.input)throw"parent or input parameter must be specified";this.parentNode=parameters.input.parentNode}this.parameters.icons=this.parameters.icons||[],this.icons={},self.IsChanged=function(){return _default!==self.GetValue()},self.GetDefault=function(){return _default},self.SetDefault=function(def){_default=def},this.Init(this.GenerateHandle()),elchild(this.parentNode,this.handle)}function CFilterInput(parent,parameters){parameters=extend({style:"main-filter-input",icons:[{name:"ico_search",type:"left",style:"black_search"},{name:"ico_search2",type:"left",style:"white_search"},{name:"f4",click:function(){this.Fold(!this.IsFolded(),!0),this.trigger("onKey")}}]},parameters),CInput.call(this,parent||null,parameters)}function CSimpleSelect(parent,parameters){this.parameters=parameters||{},this.tagName="SELECT",this.attributes={content:{className:"csimple-select-content"},left_arrow:{className:"csimple-select-arrow left"},right_arrow:{className:"csimple-select-arrow right"},wrapper:{className:"csimple-select-wrapper",tabIndex:"1"},content_wrapper:{className:"csimple-content-wrapper"},hint:{className:"csimple-select-hint csimple-select-content"}},this.style=parameters.style||"",this.type="select",void 0!==parameters.attributes&&extend(this.attributes,parameters.attributes),this.bind(parameters.events||{}),CBase.call(this,parent||null),(this.parentNode=parameters.parent)||(void 0===parameters.content?this.parentNode=element("div"):this.parentNode=parameters.content.parentNode)}function CSelectBox(parent,parameters){CSimpleSelect.call(this,parent||null,parameters),this.attributes.wrapper.className+=" cselect-box",this.Init(this.GenerateHandle());var _selectedIndex,_default,_data=parameters.data||[],idField=parameters.idField||"id",nameField=parameters.nameField||"name",_autocomplete="",self=this,placeholder=parameters.placeholder||_("No data");this.name=parameters.name||"CSelectBox",this.dropdown=new CSelectDropdown(this,{select:this,scrollMode:2,container:parameters.container}),this.SetData=function(data){if(0===data.length)throw"data cannot be empty";_data=data||[],data.length-1<_selectedIndex&&(_selectedIndex=data.length-1),self.RefreshContent(),self.trigger("dataChanged")},this.GetNameField=function(){return nameField},this.GetIdField=function(){return idField},this.GetData=function(){return _data},this.Autocomplete=function(keyCode){var find=!1,text="";if(text=keyCode===KEYS.BACK?_autocomplete.slice(0,-1):_autocomplete+String.fromCharCode(keyCode).toLowerCase(),""!==text){for(var el,i=0;i<_data.length,el=_data[i];i++)if("object"==typeof el&&(el=el[nameField]),0===el.toLowerCase().indexOf(text)){this.SetIndex(i),find=!0;break}find===!0&&(self.handle.classList.add("autocomplete"),_autocomplete=text),text=this.GetLabel(),text&&(text=text.substr(0,_autocomplete.length)),self.SetHint(text)}else self.ClearAutocomplete()},this.ClearAutocomplete=function(){self.handle.classList.remove("autocomplete"),self.SetHint(_autocomplete="")},this.GetSelected=function(){return _data[_selectedIndex]},this.Next=function(){_selectedIndex<_data.length-1&&this.SetIndex(++_selectedIndex)},this.Previous=function(){0!==_selectedIndex&&this.SetIndex(--_selectedIndex)},this.GetValue=function(){var selected=self.GetSelected();return"object"==typeof selected?selected[idField]:selected},this.GetLabel=function(){var selected=self.GetSelected();return"object"==typeof selected?selected[nameField]:selected},this.RefreshContent=function(){return self.SetContent(self.GetLabel(),placeholder),self.value=self.GetValue(),1===self.GetData().length?(self.DisableElement(self.leftArrow,!0),void self.DisableElement(self.rightArrow,!0)):void(0===self.GetIndex()?(self.DisableElement(self.leftArrow,!0),self.DisableElement(self.rightArrow,!1)):self.GetIndex()===self.GetData().length-1?(self.DisableElement(self.rightArrow,!0),self.DisableElement(self.leftArrow,!1)):(self.DisableElement(self.leftArrow,!1),self.DisableElement(self.rightArrow,!1)))},this.SelectById=function(id,quiet){for(var i=0;i<_data.length;i++)if(_data[i][idField]===id)return self.SetIndex(i,quiet),i},this.IsChanged=function(){return _selectedIndex!==_default},this.GetIndex=function(){return _selectedIndex},this.SetIndex=function(index,quiet){var old=this.GetSelected();self.ClearAutocomplete(),_selectedIndex=void 0===index||index>=_data.length||0>index?0:index,self.RefreshContent(),quiet!==!0&&self.trigger("onChange",{"new":self.GetSelected(),old:old})},this.SetIndex(parameters.selected,!0),void 0!==parameters.selectedId&&this.SelectById(parameters.selectedId,!0),_default=_selectedIndex,this.EventHandler=function(event){switch(eventPrepare(event),event.stopped=!0,event.code){case KEYS.FRAME:this.dropdown.Show(!this.dropdown.isVisible,!1);break;case KEYS.LEFT:case KEYS.RIGHT:this.dropdown.isVisible||(CSimpleSelect.prototype.EventHandler.call(this,event),this.dropdown.EventHandler(event));break;case KEYS.OK:case KEYS.UP:case KEYS.DOWN:case KEYS.PAGE_UP:case KEYS.PAGE_DOWN:event.stopped=!1,this.dropdown.isVisible&&(this.dropdown.EventHandler(event,null,!1),event.stopped=!0);break;case KEYS.EXIT:this.dropdown.isVisible?this.dropdown.Show(!1,!1):event.stopped=!1;break;default:event.stopped=!1}},this.handle.onkeypress=function(event){event.ctrlKey!==!0&&event.altKey!==!0&&self.Autocomplete(event.charCode)},this.dropdown.Refresh(),this.bind("onBlur",function(){self.ClearAutocomplete()})}function CSelectDropdown(parent,options){CScrollList.call(this,parent||null,options);var self=this;this.isVisible=!1,this.manageFocus=!1,this.multipleSelection=!1,this.attributes={wrapper:{className:"csimple-select-dropdown"},element:{className:"dropdown-element"}},this.select=null,this.baseClass="csimple-dropdown-main",CSelectDropdown.parameters.forEach(function(key){void 0!==options[key]&&(self[key]=options[key])}),this.base=this.select.handle,this.Init(element("div",this.attributes.wrapper)),this.base.parentNode.appendChild(this.handle),this.select.bind("dataChanged",function(){self.Refresh()}),this.select.bind("onChange",function(){if(self.isVisible){var item=self.handleInner.children[this.GetIndex()];self.SetPosition(item,!0,!1),self.Focused(item,!0),self.Marked(item,!0)}}),this.select.bind("onBlur",function(){setTimeout(function(){self.Show(!1,self.manageFocus)},100)}),this.select.handle.addEventListener("click",function(event){self.Show(!self.isVisible,self.manageFocus),event.stopPropagation(),event.stopImmediatePropagation(),event.preventDefault()}),this.Show(!1,self.manageFocus)}function CIntervalBox(parent,parameters){var _default,_oldValue,self=this,_value=0,_inputValue="";CSimpleSelect.call(this,parent||null,parameters),this.inputTimer={},this.attributes.wrapper.className+=" cinterval-box",void 0===parameters.align&&(this.attributes.content.className+=" center"),void 0!==parameters.contentStyle&&(this.attributes.content.className+=" "+parameters.contentStyle),this.Init(this.GenerateHandle()),this.name=parameters.name||"input",this.type="interval",this.parameters=parameters,void 0!==parameters.align&&(this.content.className+=" "+parameters.align,this.content.style.textAlign=parameters.align),this.max=parameters.max,this.min=parameters.min,this.interval=parameters.interval||1,void 0!==parameters.value?_value=void 0!==this.max&&parameters.value>this.max?this.max:void 0!==this.min&&parameters.value<this.min?this.min:parameters.value:void 0!==this.min?_value=this.min:void 0!==this.max&&(_value=this.max),_default=_value=parseInt(_value),this.SetValue=function(value){_value=parseInt(value),self.SetContent(_value),self.trigger("onChange",_value)},this.GetValue=function(){return _value},this.Next=function(){if(_inputValue.length&&(clearInterval(this.inputTimer),this.inputDone()),CSimpleSelect.prototype.Next.call(),void 0!==self.max){if(!(_value+self.interval<=self.max))return;_value+=self.interval}else _value+=self.interval;self.RefreshContent(),self.trigger("onNext",self.GetValue()),self.trigger("onChange",self.GetValue())},this.Previous=function(){if(_inputValue.length&&(clearInterval(this.inputTimer),this.inputDone()),CSimpleSelect.prototype.Next.call(),void 0!==self.min){if(!(_value-self.interval>=self.min))return;_value-=self.interval}else _value-=self.interval;self.RefreshContent(),self.trigger("onPrevious",self.GetValue()),self.trigger("onChange",self.GetValue())},this.RefreshContent=function(){this.SetContent(self.GetValue()),self.value=self.GetValue(),self.DisableElement(self.leftArrow,!1),self.DisableElement(self.rightArrow,!1),void 0!==self.min&&_value-self.interval<self.min&&self.DisableElement(self.leftArrow,!0),void 0!==self.max&&_value+self.interval>self.max&&self.DisableElement(self.rightArrow,!0)},this.onInput=function(str){_inputValue.length||(_oldValue=_value,this.DisableElement(this.leftArrow,!0),this.DisableElement(this.rightArrow,!0)),_inputValue+=str,this.SetValue(_inputValue),clearInterval(this.inputTimer),this.inputTimer=window.setTimeout(function(){self.inputDone()},2e3)},this.inputClear=function(){_inputValue="",_oldValue=null,this.actionBack()},this.inputDone=function(){_inputValue="",_oldValue=null,_value=Math.floor(_value/this.interval)*this.interval,_value>this.max&&(_value=this.max),_value<this.min&&(_value=this.min),this.SetValue(_value),this.RefreshContent()},this.actionBack=function(){clearInterval(this.inputTimer),_inputValue.length>1?(_inputValue=_inputValue.slice(0,-1),this.SetValue(_inputValue),this.inputTimer=window.setTimeout(function(){self.inputDone()},2e3)):(_oldValue||0===_oldValue)&&this.SetValue(_oldValue)},this.EventHandler=function(event){if(eventPrepare(event,!0,"CSimpleSelect"),this.disabled!==!0)switch(event.stopped=!0,event.code){case KEYS.LEFT:this.Previous();break;case KEYS.RIGHT:this.Next();break;case KEYS.BACK:this.actionBack();break;case KEYS.NUM0:case KEYS.NUM1:case KEYS.NUM2:case KEYS.NUM3:case KEYS.NUM4:case KEYS.NUM5:case KEYS.NUM6:case KEYS.NUM7:case KEYS.NUM8:case KEYS.NUM9:this.parameters.noInput||this.onInput(event.code-KEYS.NUM0);break;default:event.stopped=!1}},this.IsChanged=function(){return _value!==_default},this.RefreshContent()}function CMap(parent,parameters){this.map=null,this.marker=null,this.container=parameters.container,this.events=parameters.events||{},window.googleMapsApiScriptLoaded=window.googleMapsApiScriptLoaded||!1,CBase.call(this,parent||null),this.bind(this.events)}function Emitter(){this.events={}}function Wamp(socket){var self=this;Emitter.call(this),this.socket=socket,"on"in socket?socket.on("message",function(message){self.router(message)}):"onmessage"in socket&&(socket.onmessage=function(event){self.router(event.data)})}function checkEnvVars(){return!1}function synchronizeOperatorChannels(callback){if(1===OPERATORS_PLS_AUTOREFRESH){var save,group,newList,i,client,currList=[],hash={},changed=!1,timeout=null,root={type:MEDIA_TYPE_GROUP,data:[]};if("string"==typeof OPERATORS_PLS_URL&&validateUrl(OPERATORS_PLS_URL)){try{var text=gSTB.LoadUserData("iptv.json");""!==text&&(text=JSON.parse(text),currList=IPTVChannels.unescapeChanels(text))}catch(e){currList=[],echo(e,"TVChannels parse")}if(OPERATORS_PLS_GROUP_NAME){for(i=0;i<currList.length;i++)if(currList[i].name===OPERATORS_PLS_GROUP_NAME&&Array.isArray(currList[i].data)){group=currList[i];break}group||(currList=[].concat(group={data:[],name:OPERATORS_PLS_GROUP_NAME,type:MEDIA_TYPE_GROUP},currList))}else group=root,group.data=currList;client=new XMLHttpRequest,client.open("GET",OPERATORS_PLS_URL,!0),client.responseType="text",client.onload=function(){var data=client.responseText;if(clearTimeout(timeout),!data||-1===data.indexOf("#EXTINF:"))return callback(),!1;if(newList=MediaBrowser.ParsePlaylist(OPERATORS_PLS_URL.split(".").pop(),data),group.data.length!==newList.length)changed=!0;else{for(i=0,hash.length=newList.length;i<newList.length;i++)void 0!==newList[i].url&&(hash[newList[i].url]=newList[i]);changed=group.data.some(function(channel){return void 0!==channel.url&&void 0!==newList[channel.url]&&newList[channel.url].name===channel.name?!1:!0})}changed&&(OPERATORS_PLS_GROUP_NAME?(group.data=newList,IPTVChannels.checkTS_data(currList),save=IPTVChannels.escapeChanels(currList)):(IPTVChannels.checkTS_data(newList),save=IPTVChannels.escapeChanels(newList)),gSTB.SaveUserData("iptv.json",JSON.stringify(save)),IPTVChannels.loadChanels()),callback()},client.onerror=function(){echo("ajax error happened during playlist update! abort."),clearTimeout(timeout),callback()};try{client.send(null)}catch(e){echo("error during playlist update: "+e)}timeout=setTimeout(function(){client.abort(),callback(),echo("ajax abort on timeout during playlist update")},2e4)}}else callback()}function fillPage(){echo("start filling page"),echo(MODEL_TYPE,"STB mtype"),gSTB.SetObjectCacheCapacities(1e6,7e6,2e7),environment.autoupdateURL&&(configuration.url.updateList=environment.autoupdateURL),SettingsPage.Init(document.getElementById("pageSettings"))}function startPortal(){echo("Start Embeded Portal"),stbWindowMgr.setWebFaceInitAttr(JSON.stringify({url:PATH_ROOT+"public/app/ibman/index.html?mode=2"})),STORAGE_INFO.forEach(function(item){stbDownloadManager.RestoreJobs(item.mountPath)});try{VIDEO_MODE=gSTB.RDir("vmode")}catch(e){echo(e,"vmode rdir error")}echo(VIDEO_MODE,"current video mode"),pageOn()}function pageOn(){gSTB.EnableServiceButton(!0),gSTB.EnableVKButton(!0);var settMaster=JSON.parse(gSTB.GetEnv(JSON.stringify({varList:["settMaster","Image_Desc"]})));if(!settMaster.result.settMaster&&new RegExp("factory image").test(settMaster.result.Image_Desc.toLowerCase())&&configuration.masterSettingOnStart){var currentPage=currCPage;loadMasterSettings(function(){MasterSettings.origin=currentPage})}else ServiceMenu.Init(document.getElementById("pageServiceMenu")),ServiceMenu.needToCheckUpdate=!0,pageOnContinue()}function pageOnContinue(){try{SMB_ARRAY=JSON.parse(gSTB.LoadUserData("smb_data")),SMB_ARRAY&&Array.isArray(SMB_ARRAY)?SMB_ARRAY.forEach(function(item){"/"===item.folder.charAt(item.folder.length-1)&&(item.folder=item.folder.slice(0,-1)),void 0===item.automount&&(SMB_AUTH["//"+item.url+"/"+item.folder]={login:item.login,pass:item.pass})}):SMB_ARRAY=[]}catch(e){echo(e,"SMB data parsing error"),gSTB.SaveUserData("smb_data","[]")}try{NFS_ARRAY=JSON.parse(gSTB.LoadUserData("nfs_data")),NFS_ARRAY&&Array.isArray(NFS_ARRAY)?NFS_ARRAY.forEach(function(item){item.folder&&"/"!==item.folder.charAt(0)&&(item.folder="/"+item.folder),"/"===item.folder.charAt(item.folder.length-1)&&(item.folder=item.folder.slice(0,-1))}):NFS_ARRAY=[]}catch(e){echo(e,"NFS data parsing error"),gSTB.SaveUserData("nfs_data","[]")}}function mainEventListener(event){if(eventPrepare(event,!1,currCPage.name)){if(currCPage&&currCPage.EventHandler(event))return event.preventDefault(),void event.stopPropagation();switch(event.code){case 220:echo("\n\n\n<html><head>\n"+document.head.innerHTML+"\n</head>\n<body>\n"+document.body.innerHTML+"\n</body>\n</html>\n");break;case KEYS.MUTE:toggleMuteState();break;case KEYS.VOLUME_UP:-1!==[MediaBrowser,MediaPlayer,ServiceMenu,IPTVChannels,DVBChannels].indexOf(currCPage)&&(environment.audio_initial_volume<100&&(environment.audio_initial_volume+=configuration.volume.step),volumeSetVolume(environment.audio_initial_volume),event.preventDefault(),event.stopPropagation());break;case KEYS.VOLUME_DOWN:-1!==[MediaBrowser,MediaPlayer,ServiceMenu,IPTVChannels,DVBChannels].indexOf(currCPage)&&(environment.audio_initial_volume>0&&(environment.audio_initial_volume-=configuration.volume.step),volumeSetVolume(environment.audio_initial_volume),event.preventDefault(),event.stopPropagation());break;case KEYS.POWER:stbWebWindow.messageSend(stbWebWindow.windowId(),"portal.standbyMode",""),getNetState(!gSTB.GetStandByStatus());break;case KEYS.TV:if(currCPage!==IPTVChannels&&currCPage.parent!==IPTVChannels&&!(currCPage instanceof CModal)&&currCPage!==window.MasterSettings){if(accessControl.state&&accessControl.data.pages[IPTVChannels.menuId]){accessControl.showLoginForm(function(){MediaPlayer.SubscribersReset(),MediaPlayer.end(),IPTVChannels.Reset(),IPTVChannels.Show(!0,ServiceMenu)});break}MediaPlayer.SubscribersReset(),MediaPlayer.end(),IPTVChannels.Reset(),IPTVChannels.Show(!0,ServiceMenu)}break;case KEYS.WEB:stbWindowMgr.LoadUrl("http://www.google.ru"),stbWindowMgr.raiseWebWindow()}}}function sendVisitData(){var file=gSTB.LoadUserData("visit_data");if(file)try{var post=[],data=JSON.parse(file);for(var name in data)data.hasOwnProperty(name)&&post.push(name+"="+data[name]);if(post.length>0){var xmlhttp=new XMLHttpRequest;xmlhttp.open("PUT","http://stat.infomir.com/"+gSTB.RDir("MACAddress"),!0),xmlhttp.onreadystatechange=function(){4===xmlhttp.readyState&&200===xmlhttp.status&&gSTB.SaveUserData("visit_data","{}")},echo(data,"send user data"),xmlhttp.send(post.join("&"))}}catch(e){echo(e,"sendVisitData"),gSTB.SaveUserData("visit_data","{}");
}}function sendPingRequest(){configuration.url.ping.length>0&&ajax("get",configuration.url.ping[sendPingRequest.linkIndex]+"?time="+Date.now(),function(data,status){var state=status>0&&"ok"===data;document.getElementById("network_status").className=state?"active":"",state?(CURRENT_INTERNET_STATE!==state&&stbEvent.onInternetStateChange(!0),CURRENT_INTERNET_STATE=!0,sendPingRequest.errorCount=0):(sendPingRequest.linkIndex=++sendPingRequest.linkIndex%configuration.url.ping.length,++sendPingRequest.errorCount>=configuration.url.pingAttempts?(sendPingRequest.errorCount=0,CURRENT_INTERNET_STATE!==state&&stbEvent.onInternetStateChange(!1),CURRENT_INTERNET_STATE=!1):sendPingRequest())},{"Cache-Control":"no-cache"})}function getNetworkState(){var lan=gSTB.GetLanLinkStatus(),state=lan||CURRENT_WIFI_STATE;return document.getElementById("lan_status").className=lan?"active":"",state||(document.getElementById("network_status").className=""),CURRENT_NETWORK_STATE!==state&&"function"==typeof stbEvent.onNetworkStateChange&&stbEvent.onNetworkStateChange(state),state||CURRENT_INTERNET_STATE===!1||(CURRENT_INTERNET_STATE=!1,"function"==typeof stbEvent.onInternetStateChange&&stbEvent.onInternetStateChange(CURRENT_INTERNET_STATE)),CURRENT_NETWORK_STATE=state,state}function getNetState(state){var pcounter=0;state?(document.getElementById("wifi_status").className=CURRENT_WIFI_STATE?"active":"",getNetworkState()&&sendPingRequest(),null!==getNetStateTimer&&(clearInterval(getNetStateTimer),getNetStateTimer=null),getNetStateTimer=setInterval(function(){getNetworkState()&&pcounter>=9&&(sendPingRequest(),pcounter=0),pcounter++},EMULATION?7e5:7e3)):(clearInterval(getNetStateTimer),getNetStateTimer=null)}function loadUpdateList(check,forceShow){var req=new XMLHttpRequest,hashData="",environment=gSTB.GetEnv(JSON.stringify({varList:["language","portal1","portal2","autoupdate_cond"]})),currTimeStamp=Math.round((new Date).getTime()/1e3);try{environment=JSON.parse(environment).result,environment.autoupdate_cond=parseInt(environment.autoupdate_cond,10)||0}catch(error){console.log("can't parse environment "+error),environment={}}(check&&(0==environment.autoupdate_cond||1==environment.autoupdate_cond)||forceShow)&&(req.open("GET",configuration.url.updateList+"?mac="+gSTB.GetDeviceMacAddress(),!0),echo(configuration.url.updateList+"?mac="+gSTB.GetDeviceMacAddress(),"update list"),req.onreadystatechange=function(){if(4===req.readyState&&200===req.status){try{SettingsPage.update_list=JSON.parse(req.responseText)}catch(ex){SettingsPage.update_list=[]}if(check)switch(environment.autoupdate_cond){case 0:UpdatePage.Show(!0,!1);break;case 1:UpdatePage.Show(!0,!0)}else forceShow&&UpdatePage.Show(!1,!1)}},hashData+=gSTB.GetDeviceModelExt?gSTB.GetDeviceModelExt():gSTB.GetDeviceModel(),hashData+=gSTB.GetDeviceImageDesc()+gSTB.GetDeviceSerialNumber()+gSTB.GetDeviceMacAddress(),hashData+=(environment.language||"en")+location.href+(environment.portal1||"")+(environment.portal2||""),hashData+=navigator.userAgent+(currTimeStamp-currTimeStamp%60),req.setRequestHeader("X-CurrentVersion",gSTB.GetDeviceImageDesc()),req.setRequestHeader("X-SerialNumber",gSTB.GetDeviceSerialNumber()),req.setRequestHeader("X-MacAddress",gSTB.GetDeviceMacAddress()),req.setRequestHeader("X-ModelNameEx",gSTB.GetDeviceModelExt?gSTB.GetDeviceModelExt():gSTB.GetDeviceModel()),req.setRequestHeader("X-Language",environment.language||"en"),environment.portal1&&req.setRequestHeader("X-Portal1",environment.portal1),environment.portal2&&req.setRequestHeader("X-Portal2",environment.portal2),req.setRequestHeader("X-PortalUrl",location.href),req.setRequestHeader("X-Hash",gSTB.GetHashVersion1(hashData,"")),req.send())}function generate(arr){var obj=[];SettingsPage.FileList.elements=[],elclear(SettingsPage.FileList.handle);for(var i=0;i<arr.length;i++){var ico=element("div",{className:"ico"}),text=element("div",{className:"text",innerHTML:"<div>"+arr[i].name+"</div>"});obj[i]=element("a",{className:arr[i].className,href:"#",onclick:arr[i].func,number:i,onmouseover:SettingsPage.mouse_over,disabled:!1,hidden:!1},[ico,text]),i===SettingsPage.FileList.back_element[SettingsPage.FileList.layer]&&(SettingsPage.FileList.activeItem=obj[i]),SettingsPage.FileList.elements[i]=obj[i]}elchild(SettingsPage.FileList.handle,obj),SettingsPage.FileList.Activate(!0,!1)}function generate_table(arr,tableClass){var left,right,obj=[];tableClass=tableClass?tableClass:"",elclear(SettingsPage.FileList.handle);for(var i=0;i<arr.length;i++)arr[i].title||0===arr[i].title||arr[i].title===!0?arr[i].value||0===arr[i].value||arr[i].value===!0?(left=element("td",{className:"left",id:arr[i].id?arr[i].id+"_left":""},arr[i].title),right=element("td",{className:"right",id:arr[i].id?arr[i].id+"_rigth":""},arr[i].value),obj[i]=element("tr",{},[left,right])):(left=element("td",{className:"info_header",colSpan:"2",id:arr[i].id?arr[i].id+"_header":""},arr[i].title),obj[i]=element("tr",{},left)):(right=element("td",{className:"center",colSpan:"2",id:arr[i].id?arr[i].id+"_center":""},arr[i].value),obj[i]=element("tr",{},right));var table=element("table",{className:tableClass},obj),div=element("div",{className:"box"},table);elchild(SettingsPage.FileList.handle,div),SettingsPage.FileList.Activate(!0,!0)}function generate_elements(arr,callback,page){var i,input,obj=[],onClick=function(){return!1},onChange=function(onChange,page){return function(){"function"==typeof onChange&&onChange(),this.IsChanged()===!0?(this._is_changed||SettingsPage.changes[page]++,this._is_changed=!0):this._is_changed&&(this._is_changed=!1,SettingsPage.changes[page]--),SettingsPage.BPanel.Hidden(SettingsPage.buttons.OK,0===SettingsPage.changes[page]),echo(SettingsPage.changes,this.name)}},onFocus=function(){SettingsPage.FileList.elements[this.number].focus()};for(SettingsPage.changes[page]=0,SettingsPage.FileList.elements=[],SettingsPage.FileList.pre_elements=[],elclear(SettingsPage.FileList.handle),i=0;i<arr.length;i++){var text=element("div",{className:"vertical"},element("div",{className:"title",innerHTML:arr[i].title})),elem=element("div",{className:"control"}),onchange=onChange(arr[i].onChange,page);switch(input=null,obj[i]=element("a",{href:"#",disabled:!1,hidden:!1,onclick:onClick,className:"item",onmouseover:SettingsPage.mouse_over_element,number:i,onfocus:onFocus},[text,elem]),SettingsPage.FileList.pre_elements[i]=obj[i],arr[i].element){case"select":input=new CSelectBox(SettingsPage.FileList,{parent:elem,data:arr[i].option,idField:arr[i].idField?arr[i].idField:"value",nameField:arr[i].nameField?arr[i].nameField:"title",selectedId:arr[i].selected,events:{onChange:onchange},container:SettingsPage.FileList.handle});break;case"button":input=element("input",{type:"button",value:arr[i].value,onclick:arr[i].onClick,className:"elements wide500"}),elchild(elem,input);break;case"input":input=element("input",{type:arr[i].type||"text",value:arr[i].value,className:"elements wide500"}),elchild(elem,input);break;case"cinput":input=new CInput(SettingsPage.FileList,{value:arr[i].value,parent:elem,name:arr[i].name,events:{onChange:onchange,onKey:arr[i].onKey},type:arr[i].type||"text"}),arr[i].id&&(input.element.id=arr[i].id);break;case"checkbox":input=new CCheckBox(SettingsPage.FileList,{checked:!!arr[i].checked,parent:elem,name:arr[i].name,events:{onChange:onchange}});break;case"input_spec":input=new CIntervalBox(SettingsPage,{parent:elem,max:arr[i].maxsize,min:arr[i].minsize||0,interval:arr[i].interval,value:arr[i].value,style:"elements",events:{onChange:onchange,onNext:arr[i].right,onPrevious:arr[i].left}});break;case"info":elem.className="vertical",input=element("div",{className:"info"},arr[i].value),elchild(elem,input)}SettingsPage.FileList.elements[i]=input}elchild(SettingsPage.FileList.handleInner,obj),SettingsPage.FileList.activeItem=null,SettingsPage.FileList.Activate(!0,!0),callback&&callback()}function sett_pressExit(){switch(echo(SettingsPage.FileList.layer,"sett_pressExit"),SettingsPage.advanced=function(){},SettingsPage.FileList.layer){case SettingsPage.FileList.layers.mainPage:SettingsPage.Show(!1);break;case SettingsPage.FileList.layers.SpeedTest:-1!==configuration.setting.settingsList.indexOf("traceroute")||RULES.Traceroute||SettingsPage.speedtest.stop(),SettingsPage.BCrumb.Pop(),SettingsPage.FileList.initPages.Main();break;case SettingsPage.FileList.layers.Traceroute:SettingsPage.FileList.layers.SpeedTest?(SettingsPage.BCrumb.Pop(),SettingsPage.BCrumb.Pop(),SettingsPage.FileList.initPages.SpeedTest()):(SettingsPage.BCrumb.Pop(),SettingsPage.FileList.initPages.Main());break;default:0!==SettingsPage.changes[SettingsPage.FileList.layer]&&void 0!==SettingsPage.changes[SettingsPage.FileList.layer]?new CModalConfirm(SettingsPage,_("Confirm"),_("Some settings have been changed"),_("Cancel"),function(){SettingsPage.BCrumb.Pop(),SettingsPage.FileList.initPages.Main()},_("Save"),function(){SettingsPage.save(),SettingsPage.BCrumb.Pop(),SettingsPage.FileList.initPages.Main()}):(SettingsPage.BCrumb.Pop(),SettingsPage.FileList.initPages.Main())}}function sett_Playback_init(){SettingsPage.BCrumb.Push("","subtitles.png",_("Playback")),SettingsPage.FileList.layer=SettingsPage.FileList.layers.playback,SettingsPage.FileList.back_element[SettingsPage.FileList.layers.mainPage]=SettingsPage.FileList.layer-1;var list1=sortingABC(iso639),list2=list1.slice(),list3=[{value:18,title:_("Small")},{value:20,title:_("Normal")},{value:23,title:_("Large")},{value:26,title:_("Huge")}],list4=[{value:16777215,title:_("White")},{value:0,title:_("Black")},{value:16711680,title:_("Red")},{value:255,title:_("Blue")},{value:65280,title:_("Green")},{value:16776960,title:_("Yellow")},{value:65535,title:_("Cyan")},{value:16711935,title:_("Magenta")},{value:12632256,title:_("Silver")},{value:8421504,title:_("Gray")},{value:8388608,title:_("Maroon")},{value:8421376,title:_("Olive")},{value:8388736,title:_("Purple")},{value:32896,title:_("Teal")},{value:128,title:_("Navy")}],list5=[{value:16,title:_("Fit on")},{value:64,title:_("Zoom")},{value:80,title:_("Optimal")},{value:0,title:_("Stretch")}];list2.unshift({title:_("Disabled"),code:"off",value:-1});var arr=[{element:"select",title:_("Primary audio track language"),option:list1,selected:String(environment.lang_audiotracks)},{element:"select",title:_("Primary subtitle language"),option:list2,selected:environment.subtitles_on?String(environment.lang_subtitles):-1},{element:"select",title:_("Subtitle size"),option:list3,selected:environment.subtitlesSize||20},{element:"select",title:_("Subtitle color"),option:list4,selected:environment.subtitlesColor},{element:"select",title:_("Aspect Ratio"),option:list5,selected:environment.aspect}];return SettingsPage.FileList.AddElement(arr,null,SettingsPage.FileList.layers.playback),!1}function sett_Interface_init(){SettingsPage.BCrumb.Push("","screenmenu.png",_("Interface")),SettingsPage.FileList.layer=SettingsPage.FileList.layers.Interface,SettingsPage.FileList.back_element[SettingsPage.FileList.layers.mainPage]=SettingsPage.FileList.layer-1;for(var dirs,arr,startPageSelected=null,findDVBChannels=!0,screensaverIntervalOptions=null,screensaverOptions=[],options=[],startPageOptions=[{title:_("Main menu"),value:"null"},{title:_("IPTV channels"),value:"tvChannels"},{title:_("Home Media"),value:"mediaBrowser"}],i=0;i<configuration.menu.length;i++)for(var j=0;j<configuration.menu[i].length;j++)if(findDVBChannels&&"dvbChannels"===configuration.menu[i][j].name){findDVBChannels=!1,startPageOptions.push({title:_("DVB channels"),value:configuration.menu[i][j].name});break}startPageSelected=environment.startPage?environment.startPage:configuration.startPage?configuration.startPage:"null";try{var screensavers=JSON.parse(readJSON(configuration.screensaversPath,"screensavers.json"));echo(screensavers,"screensavers"),dirs=Object.keys(screensavers),echo(dirs,"dirs")}catch(error){return void echo(error,"screensavers JSON parse error")}if(dirs&&dirs.length)for(screensaverIntervalOptions=[{title:_("Disabled"),value:0},{title:_("1 minute"),value:6},{title:_("3 minutes"),value:18},{title:_("5 minutes"),value:30},{title:_("10 minutes"),value:60},{title:_("30 minutes"),value:180}],i=0;i<dirs.length;i++)echo(dirs[i],"name"),screensaverOptions.push({title:dirs[i],value:dirs[i]});else screensaverIntervalOptions=[{title:_("Disabled"),value:0}];if(arr=[{element:"select",title:_("Start page"),option:startPageOptions,selected:startPageSelected},{element:"select",title:_("Weather system format"),option:[{title:_("Metric (Celsius, meters per second)"),value:"metricSys"},{title:_("English (Fahrenheit, miles per hour)"),value:"englishSys"}],selected:environment.weather_conf},{element:"select",title:_("HDMI event reaction:"),option:[{title:_("Disabled"),value:"0"},{title:_("Enabled"),value:"5"},{title:_("5 minutes delay"),value:"300"},{title:_("10 minutes delay"),value:"600"}],selected:environment.hdmi_event_delay},{element:"select",title:_("Screensaver interval"),option:screensaverIntervalOptions,selected:environment.ssaverDelay},{element:"select",title:_("Screensaver"),option:screensaverOptions,selected:environment.ssaverName},{element:"checkbox",checked:environment.playerClock,title:_("Clock during playing")},{element:"input_spec",title:_("LED brightness:"),value:environment.defaultLedLevel,interval:5,maxsize:100},{element:"input_spec",title:_("LED brightness(blink/standby):"),value:environment.standbyLedLevel,interval:5,maxsize:100},{element:"select",title:_("RC model"),option:[{title:"SRC-4807",value:"SRC4807"},{title:"SRC-4513 (slim)",value:"SRC4513"}],selected:environment.controlModel?environment.controlModel:configuration.newRemoteControl?"SRC4813":"SRC4807"}],gSTB.SupportedStandByModes&&gSTB.SupportedStandByModes.length>1){for(i=0;i<gSTB.SupportedStandByModes.length;i++)options.push({title:["",_("Active"),"",_("Deep")][gSTB.SupportedStandByModes[i]]||"n/a",value:gSTB.SupportedStandByModes[i]});arr.push({element:"select",title:_("Stand by mode:"),option:options,selected:Number(environment.standByMode)})}return arr.push({element:"select",title:_("Auto power down:"),option:[{title:_("Off"),value:"0"},{title:"20 "+_("minutes"),value:1140},{title:_("1 hour"),value:3540},{title:_("2 hours"),value:7140},{title:_("4 hours"),value:14340},{title:_("8 hours"),value:28740}],selected:environment.autoPowerDownTime}),SettingsPage.FileList.AddElement(arr,null,SettingsPage.FileList.layers.Interface),!1}function sett_AutoUbdate_init(){SettingsPage.BCrumb.Push("","update.png",_("Software autoupdate")),SettingsPage.FileList.layer=SettingsPage.FileList.layers.AutoUpdate,SettingsPage.FileList.back_element[SettingsPage.FileList.layers.mainPage]=SettingsPage.FileList.layer-1;var arr=[{element:"select",title:_("Autoupdate"),option:[{title:_("Enabled"),value:0},{title:_("With confirmation"),value:1},{title:_("Disabled"),value:2}],selected:environment.autoupdate_cond},{element:"checkbox",checked:environment.betaupdate_cond,title:_("Update to beta versions")}];return SettingsPage.BPanel.Hidden(SettingsPage.buttons.F2,!1),SettingsPage.FileList.AddElement(arr,null,SettingsPage.FileList.layers.AutoUpdate),!1}function sett_TS_init(){SettingsPage.BCrumb.Push("","timeshift.png",_("TimeShift")),SettingsPage.FileList.layer=SettingsPage.FileList.layers.TS,SettingsPage.FileList.back_element[SettingsPage.FileList.layers.mainPage]=SettingsPage.FileList.layer-1;var path_list=[],no_path=!0;if(STORAGE_INFO.length>0){for(var i=0;i<STORAGE_INFO.length;i++){var name=STORAGE_INFO[i].label,value=STORAGE_INFO[i].mountPath;path_list[i]={title:name,value:value},environment.ts_path===value&&(no_path=!1)}no_path&&path_list.splice(0,0,{title:_("None"),value:""})}else path_list.splice(0,0,{title:_("None"),value:""});var arr=[{element:"checkbox",checked:environment.ts_on,title:_("Use TimeShift")},{element:"checkbox",checked:environment.ts_icon,title:_("Icon enable")},{element:"select",title:_("File location"),option:path_list,selected:environment.ts_path},{element:"select",title:_("Length"),option:[{title:"15 "+_("minutes"),value:900},{title:"30 "+_("minutes"),value:1800},{title:"1 "+_("hour"),value:3600},{title:_("2 hours"),value:7200},{title:_("3 hours"),value:10800},{title:_("5 hours"),value:18e3},{title:_("10 hours"),value:36e3},{title:_("20 hours"),value:72e3},{title:_("24 hours"),value:86400}],selected:environment.ts_time},{element:"select",title:_("Using buffer mode"),option:[{title:_("Cyclic record mode"),value:1},{title:_("Stop when out of space"),value:2}],selected:environment.ts_endType},{element:"select",title:_("On exit"),option:[{title:_("Do not save buffer"),value:1},{title:_("Save buffer"),value:2},{title:_("Request to save"),value:3}],selected:environment.ts_exitType},{element:"select",title:_("Delay"),option:[{title:_("By pressing Pause button"),value:0},{title:"1 "+_("sec."),value:1},{title:"3 "+_("sec."),value:3},{title:"5 "+_("sec."),value:5},{title:"10 "+_("sec."),value:10}],selected:environment.ts_lag}];return SettingsPage.FileList.AddElement(arr,null,SettingsPage.FileList.layers.TS),!1}function sett_speed_test_init(){return SettingsPage.FileList.layer=SettingsPage.FileList.layers.SpeedTest,SettingsPage.FileList.back_element[SettingsPage.FileList.layers.mainPage]=SettingsPage.FileList.layer-1,-1!==configuration.setting.settingsList.indexOf("traceroute")&&RULES.Traceroute?(SettingsPage.BCrumb.Push("","speedtest.png",_("Network Diagnostics")),elclear(SettingsPage.FileList.handle),SettingsPage.BPanelTraceroute.Init(PATH_IMG_PUBLIC+"settings",SettingsPage.FileList.handle),SettingsPage.BPanelTraceroute.handleInner.classList.add("speedtest-bpanel"),SettingsPage.BPanelTraceroute.listButtons=[],SettingsPage.BPanelTraceroute.listButtons.push(SettingsPage.BPanelTraceroute.Add(KEYS.OK,"inet_speed.png",_("Speed test"),sett_speed_test_start)),SettingsPage.BPanelTraceroute.listButtons.push(SettingsPage.BPanelTraceroute.Add(KEYS.OK,"traceroute.png",_("Extended diagnostics"),sett_traceroute_init)),SettingsPage.BPanelTraceroute.activeItemIndex=0,SettingsPage.BPanelTraceroute.handleInner.firstChild.classList.add("focused")):sett_speed_test_prepare()?(SettingsPage.BCrumb.Push("","speedtest.png",_("Speed test")),SettingsPage.FileList.AddTable([{title:""},{title:"LAN:",value:_(gSTB.GetLanLinkStatus()?"Available":"Not available")},{title:"WiFi:",value:_(gSTB.GetWifiLinkStatus()?"Available":"Not available")},{title:_("Speed:"),value:_("Waiting"),id:"speed_test"}]),SettingsPage.speedtest.onSuccess(function(speed){SettingsPage.FileList.handle.querySelector("#speed_test_rigth").innerHTML=speed}),SettingsPage.speedtest.onCheck(function(result){echo(result,"speedtest.onCheck"),2===result.state?SettingsPage.FileList.handle.querySelector("#speed_test_rigth").innerHTML=_("Testing"):4===result.state||5===result.state?SettingsPage.FileList.handle.querySelector("#speed_test_rigth").innerHTML=_("Error"):1===result.state&&(SettingsPage.FileList.handle.querySelector("#speed_test_rigth").innerHTML=_("Waiting"))}),SettingsPage.speedtest.start()):new CModalHint(SettingsPage,_("Error"),3e3),!1}function sett_speed_test_start(){var modal,resultSpan=element("span",{id:"speed_test_rigth"},_("Waiting"));return sett_speed_test_prepare()?(SettingsPage.speedtest.onSuccess(function(speed){resultSpan&&(resultSpan.innerHTML=speed),sendStatistic()}),SettingsPage.speedtest.onCheck(function(result){resultSpan&&(echo(result,"speedtest.onCheck"),2===result.state?resultSpan.innerHTML=_("Testing"):4===result.state||5===result.state?resultSpan.innerHTML=_("Error"):1===result.state&&(resultSpan.innerHTML=_("Waiting")))}),modal=new CModalAlert(SettingsPage,_("Test results"),[element("div",{},gSTB.GetLanLinkStatus()?"LAN: "+_("Available"):"LAN: "+_("Not available")),element("div",{},gSTB.GetWifiLinkStatus()?"WiFi: "+_("Available"):"WiFi: "+_("Not available")),element("span",{},_("Speed:")+" "),resultSpan],"",function(){resultSpan=null}),modal.handleInner.classList.add("speedtestModal"),SettingsPage.speedtest.start(),!1):void new CModalHint(SettingsPage,_("Error"),3e3)}function sett_speed_test_prepare(){var i,localCoordinates=gSTB.LoadUserData("weatherSet"),speedTestURL=null;try{localCoordinates=JSON.parse(localCoordinates)}catch(error){echo(error,"weatherSet.json parse"),localCoordinates={lat:0,lon:0}}for(i=0;i<configuration.speedTest.dataCenters.length;i++)configuration.speedTest.dataCenters[i].distance=calculateTheDistance(localCoordinates.lat,localCoordinates.lon,configuration.speedTest.dataCenters[i].lat,configuration.speedTest.dataCenters[i]["long"]);return configuration.speedTest.dataCenters.sort(function(a,b){return a.distance-b.distance}),SettingsPage.speedtest=new Speedtest(speedTestURL?speedTestURL:"http://mirror."+configuration.speedTest.dataCenters[0].code+configuration.speedTest.baseURL),!0}function sett_traceroute_start(){var endMinutes,i,len,resultPre=document.createElement("div"),downloads=JSON.parse(stbDownloadManager.GetQueueInfo()),loadingQueue=[],date=new Date,endDate=new Date,minutes=date.getMinutes(),time=configuration.traceroute.time||0,domains=configuration.traceroute.domains;for(resultPre.setAttribute("tabindex",0),endDate.setSeconds(date.getSeconds()+time*domains.length+60),10>minutes&&(minutes="0"+minutes),endMinutes=endDate.getMinutes(),10>endMinutes&&(endMinutes="0"+endMinutes),i=0,len=downloads.length;len>i;++i)(1===downloads[i].state||2===downloads[i].state)&&(loadingQueue.push(downloads[i]),stbDownloadManager.StopJob(downloads[i].id));SettingsPage.FileList.layer=SettingsPage.FileList.layers.Traceroute,SettingsPage.BCrumb.Push("","traceroute.png",_("Test result")),elclear(SettingsPage.FileList.handle),SettingsPage.FileList.handle.appendChild(resultPre),new CModalHint(currCPage,_("Perform diagnostics")+"...<br>"+_("Start")+": "+date.getHours()+":"+minutes+"<br>"+_("Estimated time of completion")+": "+endDate.getHours()+":"+endMinutes,1500),setTimeout(function(){var i,result,table=element("table",{className:"netanalyzeTable"}),handlerLink=SettingsPage.EventHandler,count=domains.length,results="";SettingsPage.EventHandler=function(){},table.appendChild(element("tr",{},[element("th",{},_("IP Address")),element("th",{},_("Loss")),element("th",{},_("Ping"))])),setTimeout(function(){if(time){for(i=0;count>i;++i)result=gSTB.RDir("mtr --report --no-dns --report-cycles "+time+" "+domains[i]),results+="Traceroute to domain: "+domains[i]+"\n"+result+"\n";echo(result,"result"),result=result.split("\n"),result.shift(),result.shift(),result.pop(),result.forEach(function(item){var data=item.trim().replace(/\s{2,}/g," ").split(" ");table.appendChild(element("tr",{},[element("td",{},data[1]),element("td",{},data[2]),element("td",{},""+Math.round(data[5]))]))}),sendStatistic(results)}for(resultPre.innerHTML="",resultPre.appendChild(table),i=0,len=loadingQueue.length;len>i;++i)stbDownloadManager.StartJob(loadingQueue[i].id);setTimeout(function(){SettingsPage.EventHandler=handlerLink,resultPre.focus()},0)},0)},0)}function sett_traceroute_init(){new CModalConfirm(SettingsPage,'<span style="color: red;text-shadow: 1px 1px 1px #000;">'+_("Attention")+"!</span>",_("Estimated time to complete the test - 10 minutes.<br> You can not interrupt the test before it is completed"),_("Cancel"),null,_("Run the test"),sett_traceroute_start)}function sendStatistic(data){var mac,envs,request;if(!(gSTB.GetDeviceModelExt().toLowerCase().indexOf("aura")<0)){if(mac=gSTB.RDir("MACAddress"),envs=gSTB.GetEnv(JSON.stringify({varList:["language","igmp_conf","upnp_conf","mc_proxy_enabled","mc_proxy_url","input_buffer_size","timezone_conf","audio_initial_volume","audio_dyn_range_comp","audio_operational_mode","audio_stereo_out_mode","audio_spdif_mode","audio_hdmi_audio_mode","lan_noip","ipaddr_conf","dnsip","pppoe_enabled","pppoe_login","pppoe_dns1","wifi_ssid","wifi_int_ip","portal1","portal2","portal_dhcp","use_portal_dhcp","bootstrap_url","update_url","update_channel_url","ntpurl","mcip_img_conf","mcport_img_conf","netmask","tvsystem","graphicres","auto_framerate","force_dvi","gatewayip","pppoe_pwd","wifi_int_dns","wifi_auth","wifi_enc","wifi_psk","wifi_wep_key1","wifi_int_mask","wifi_int_gw","wifi_wep_def_key","wifi_wep_key2","wifi_wep_key3","wifi_wep_key4","ethinit","partition","kernel","Ver_Forced","componentout","bootupgrade","do_factory_reset","serial#","Boot_Version","timezone_conf_int","showlogo","logo_x","logo_y","bg_color","fg_color","video_clock","front_panel","ts_endType","Image_Date","Image_Version","Image_Desc","ts_on","lang_audiotracks","autoupdate_cond","settMaster","stdin","stdout","stderr","bootcmd","ethaddr","betaupdate_cond","lang_subtitles","subtitles_on","ssaverDelay","autoupdateURL"]})),request=new XMLHttpRequest,request.open("PUT","http://stat.infomir.com/api/env/"+mac,!0),request.setRequestHeader("Content-Type","application/json"),request.onreadystatechange=function(){4===request.readyState&&(200===request.status?echo(request.responseText,"success stat sending"):(0===request.status||404===request.status)&&echo("Sending vars error"))},data)try{envs=JSON.parse(envs),envs.result.traceroute=data,envs=JSON.stringify(envs)}catch(e){envs={errCode:0,errMsg:"",result:data}}request.send(envs)}}function sett_setup_init(){return gSTB.StartLocalCfg(),!1}function sett_master_settings_init(){if(SettingsPage.FileList.layer=SettingsPage.FileList.layers.MasterSettingsStart,SettingsPage.FileList.back_element[SettingsPage.FileList.layers.mainPage]=SettingsPage.FileList.layer-1,void 0===window.MasterSettings){var currentPage=currCPage;loadMasterSettings(function(){MasterSettings.origin=currentPage})}else MasterSettings.Show(!0),initMasterSettings();return!1}function sett_DVB_init(){var i,j,supported,typeArr,checkedType,arr,typeSelectChange,n=0;for(SettingsPage.BCrumb.Push("","dvb.png",_("DVB")),SettingsPage.FileList.layer=SettingsPage.FileList.layers.DVB,SettingsPage.FileList.back_element[SettingsPage.FileList.layers.mainPage]=SettingsPage.FileList.layer-1,arr=[],i=0;i<DVBChannels.inputs.length;i++){for(supported=DVBChannels.inputs[i].supportedScanTypes,checkedType=DVBChannels.inputs[i].currentScanTypes,checkedType=checkedType.length?checkedType[0]:0,typeArr=[],j=0;j<supported.length;j++)typeArr.push({name:dvbTypes[supported[j]],value:supported[j]});n=2*i-1,typeSelectChange=function(){2===SettingsPage.FileList.elements[n-1].GetValue()||3===SettingsPage.FileList.elements[n-1].GetValue()?SettingsPage.FileList.Hidden(SettingsPage.FileList.pre_elements[n],!1):(SettingsPage.FileList.pre_elements[n]===SettingsPage.FileList.activeItem&&SettingsPage.FileList.Focused(SettingsPage.FileList.pre_elements[n-1],!0),SettingsPage.FileList.Hidden(SettingsPage.FileList.pre_elements[n-1],!0))},arr.push({element:"select",title:DVBChannels.inputs.length>1?_("Signal type")+" "+(i+1):_("Signal type"),option:typeArr,idField:"value",nameField:"name",selected:checkedType,onChange:typeSelectChange}),arr.push({element:"info",title:DVBChannels.inputs.length>1?_("Antenna type")+" "+(i+1):_("Antenna type"),value:_(DVBChannels.inputs[i].antennaPower?"Active":"Passive")})}for(SettingsPage.FileList.AddElement(arr,null,SettingsPage.FileList.layers.DVB),i=0;i<DVBChannels.inputs.length;i++)n=2*i,2===SettingsPage.FileList.elements[n].GetValue()||3===SettingsPage.FileList.elements[n].GetValue()?SettingsPage.FileList.Hidden(SettingsPage.FileList.pre_elements[n+1],!1):SettingsPage.FileList.Hidden(SettingsPage.FileList.pre_elements[n+1],!0);return!1}function settAccessControl(){function isEmpty(obj){for(var prop in obj)if(obj.hasOwnProperty(prop))return!1;return!0}var arr,check,i,j,advanced=!0;if(accessControl.state)return accessControl.showLoginForm(SettingsPage.FileList.initPages.accessControl),!1;for(SettingsPage.BCrumb.Push("","access.png",_("Access control")),SettingsPage.FileList.layer=SettingsPage.FileList.layers.accessControl,SettingsPage.FileList.back_element[SettingsPage.FileList.layers.mainPage]=SettingsPage.FileList.layer-1,check=function(firstcheck){for(SettingsPage.FileList.elements[0].IsChecked()?(SettingsPage.FileList.Hidden(SettingsPage.FileList.pre_elements[1],!1),SettingsPage.FileList.elements[1].SetValue(environment.acPassword),SettingsPage.BPanel.Hidden(SettingsPage.buttons.F1,!1)):(advanced=!0,SettingsPage.FileList.Hidden(SettingsPage.FileList.pre_elements[1],!0),SettingsPage.BPanel.Hidden(SettingsPage.buttons.F1,!0)),firstcheck||SettingsPage.FileList.elements[0].IsChecked()&&isEmpty(accessControl.data.pages)&&(SettingsPage.FileList.elements[2].Check(!0,!0),SettingsPage.FileList.elements[3].Check(!0,!0),SettingsPage.FileList.elements[4].Check(!0,!0)),i=2;i<SettingsPage.FileList.pagesLength.start;i++)SettingsPage.FileList.Hidden(SettingsPage.FileList.pre_elements[i],advanced);if(SettingsPage.FileList.elements[4].IsChecked()||advanced)for(i=SettingsPage.FileList.pagesLength.start;i<SettingsPage.FileList.pagesLength.end;i++)SettingsPage.FileList.Hidden(SettingsPage.FileList.pre_elements[i],!0);else for(i=SettingsPage.FileList.pagesLength.start;i<SettingsPage.FileList.pagesLength.end;i++)SettingsPage.FileList.Hidden(SettingsPage.FileList.pre_elements[i],!1)},arr=[{element:"checkbox",checked:environment.accessControl,onChange:check,title:_("Access control")},{element:"cinput",value:environment.acPassword,title:_("Password")+" ( "+_("Digits only")+" )",type:"password"},{element:"checkbox",checked:accessControl.data.pages.systemSettings,name:"systemSettings",title:_("System settings")},{element:"checkbox",checked:accessControl.data.events.loader,name:"loader",title:_("Portals loader")},{element:"checkbox",checked:accessControl.data.events.portalOpen,name:"portalOpen",title:_("Main menu")}],i=0;i<configuration.menu.length;i++)for(j=0;j<configuration.menu[i].length;j++)arr.push({element:"checkbox",checked:accessControl.data.pages[configuration.menu[i][j].name],name:configuration.menu[i][j].name,title:lang[configuration.menu[i][j].name]||configuration.menu[i][j].name});return SettingsPage.advanced=function(){if(!SettingsPage.FileList.elements[0].IsChecked())return!1;for(advanced=!advanced,i=2;i<SettingsPage.FileList.pagesLength.start;i++)SettingsPage.FileList.Hidden(SettingsPage.FileList.pre_elements[i],advanced);if(SettingsPage.FileList.elements[4].IsChecked()||advanced)for(i=SettingsPage.FileList.pagesLength.start;i<SettingsPage.FileList.pagesLength.end;i++)SettingsPage.FileList.Hidden(SettingsPage.FileList.pre_elements[i],!0);else for(i=SettingsPage.FileList.pagesLength.start;i<SettingsPage.FileList.pagesLength.end;i++)SettingsPage.FileList.Hidden(SettingsPage.FileList.pre_elements[i],!1);advanced&&SettingsPage.FileList.Focused(SettingsPage.FileList.pre_elements[0])},SettingsPage.FileList.pagesLength={start:5,end:arr.length},SettingsPage.FileList.AddElement(arr,null,SettingsPage.FileList.layers.accessControl),check(!0),!1}function sett_Teletext_init(){var arr=[];return SettingsPage.BCrumb.Push("","tvtext.png",_("Teletext")),SettingsPage.FileList.layer=SettingsPage.FileList.layers.teletext,SettingsPage.FileList.back_element[SettingsPage.FileList.layers.mainPage]=SettingsPage.FileList.layer-1,arr.push({element:"checkbox",checked:"on"===environment.teletext_on,title:_("Use Teletext")}),arr.push({element:"select",title:_("Force charset"),option:[{value:"disabled",title:_("Disabled")},{value:"auto",title:_("Auto")},{value:"0x00",title:"English"},{value:"0x05",title:"Portuguese/Spanish"},{value:"0x08",title:"Polish"},{value:"0x09",title:"German"},{value:"0x0a",title:"Swedish/Finnish/Hungarian"},{value:"0x0b",title:"Italian"},{value:"0x0c",title:"French"},{value:"0x0e",title:"Czech/Slovak"},{value:"0x16",title:"Turkish"},{value:"0x1d",title:"Serbian/Croatian/Slovenian"},{value:"0x1f",title:"Rumanian"},{value:"0x20",title:"Serbian/Croatian"},{value:"0x22",title:"Estonian"},{value:"0x23",title:"Lettish/Lithuanian"},{value:"0x24",title:"Russian/Bulgarian"},{value:"0x25",title:"Ukrainian"},{value:"0x37",title:"Greek"},{value:"0x80",title:"English/Arabic"},{value:"0x84",title:"French/Arabic"},{value:"0x87",title:"Arabic"},{value:"0x95",title:"Hebrew/Arabic"},{value:"0x97",
title:"Arabic"}],selected:environment.teletext_charset}),WINDOW_HEIGHT>=720&&arr.push({element:"select",title:_("Aspect Ratio"),option:[{title:"4:3",value:"0"},{title:"16:9",value:"1"}],selected:environment.teletext_ratio}),arr.push({element:"select",title:_("Opacity level"),option:[{value:"0",title:"0"},{value:"25",title:"10"},{value:"50",title:"20"},{value:"75",title:"30"},{value:"100",title:"40"},{value:"125",title:"50"},{value:"150",title:"60"},{value:"175",title:"70"},{value:"200",title:"80"},{value:"225",title:"90"},{value:"255",title:"100"}],selected:environment.teletext_opacity}),SettingsPage.FileList.AddElement(arr,null,SettingsPage.FileList.layers.teletext),!1}function settingsSave(){SettingsPage.changes={};var i,value,reg,wakeUpSources,to_save={},needReboot=!1,needReload=!1,delta=0;switch(SettingsPage.advanced=function(){},SettingsPage.FileList.layer){case SettingsPage.FileList.layers.playback:var defLang="";for(i=0;i<iso639.length;i++){for(var j=0;j<iso639[i].code.length;j++)if(iso639[i].code[j]===environment.language){defLang=iso639[i].code[0];break}if(""!==defLang)break}SettingsPage.FileList.elements[0].GetValue()!==environment.lang_audiotracks&&(environment.lang_audiotracks=SettingsPage.FileList.elements[0].GetValue(),to_save.lang_audiotracks=environment.lang_audiotracks,gSTB.SetAudioLangs(""===environment.lang_audiotracks?"":iso639[environment.lang_audiotracks].code[0],defLang)),SettingsPage.FileList.elements[1].GetValue()!==environment.lang_subtitles&&(environment.lang_subtitles=SettingsPage.FileList.elements[1].GetValue(),-1!==environment.lang_subtitles?(to_save.lang_subtitles=environment.lang_subtitles,to_save.subtitles_on=!0,environment.subtitles_on=!0,MediaPlayer.subtitles_on=!0,gSTB.SetSubtitles(!0),gSTB.SetSubtitleLangs(""===environment.lang_subtitles?"":iso639[environment.lang_subtitles].code[0],defLang)):(to_save.subtitles_on=!1,environment.subtitles_on=!1,MediaPlayer.subtitles_on=!1,gSTB.SetSubtitles(!1))),SettingsPage.FileList.elements[2].GetValue()!==environment.subtitlesSize&&(environment.subtitlesSize=SettingsPage.FileList.elements[2].GetValue(),to_save.subtitlesSize=environment.subtitlesSize,gSTB.SetSubtitlesSize(environment.subtitlesSize)),SettingsPage.FileList.elements[3].GetValue()!==environment.subtitlesColor&&(environment.subtitlesColor=SettingsPage.FileList.elements[3].GetValue(),to_save.subtitlesColor=environment.subtitlesColor,gSTB.SetSubtitlesColor(environment.subtitlesColor)),SettingsPage.FileList.elements[4].GetValue()!==environment.aspect&&(environment.aspect=SettingsPage.FileList.elements[4].GetValue(),to_save.aspect=environment.aspect,MediaPlayer.initAspect());break;case SettingsPage.FileList.layers.Interface:environment.startPage!==SettingsPage.FileList.elements[0].GetValue()&&(environment.startPage=SettingsPage.FileList.elements[0].GetValue(),to_save.startPage=environment.startPage),environment.weather_conf!==SettingsPage.FileList.elements[1].GetValue()&&(environment.weather_conf=SettingsPage.FileList.elements[1].GetValue(),to_save.weather_conf=environment.weather_conf,weather.setDataMainPage(),weather.initWeatherPage()),environment.hdmi_event_delay!==SettingsPage.FileList.elements[2].GetValue()&&(environment.hdmi_event_delay=SettingsPage.FileList.elements[2].GetValue(),to_save.hdmi_event_delay=environment.hdmi_event_delay,"function"==typeof gSTB.GetWakeUpSources&&-1!==(gSTB.SupportedWakeUpSources||[]).indexOf(2)&&(wakeUpSources=gSTB.GetWakeUpSources()||[],0===Number(environment.hdmi_event_delay)&&-1!==wakeUpSources.indexOf(2)?(wakeUpSources.splice(wakeUpSources.indexOf(2),1),gSTB.SetWakeUpSources(wakeUpSources)):0!==Number(environment.hdmi_event_delay)&&-1===wakeUpSources.indexOf(2)&&(wakeUpSources.push(2),gSTB.SetWakeUpSources(wakeUpSources)))),environment.ssaverDelay!==SettingsPage.FileList.elements[3].GetValue()&&(environment.ssaverDelay=SettingsPage.FileList.elements[3].GetValue(),to_save.ssaverDelay=environment.ssaverDelay,gSTB.SetScreenSaverTime(10*environment.ssaverDelay)),environment.ssaverName!==SettingsPage.FileList.elements[4].GetValue()&&(environment.ssaverName=SettingsPage.FileList.elements[4].GetValue(),to_save.ssaverName=environment.ssaverName,gSTB.SetScreenSaverInitAttr(JSON.stringify({url:configuration.screensaversPath+"/"+environment.ssaverName+"/index.html",backgroundColor:"#000"}))),environment.playerClock!==SettingsPage.FileList.elements[5].IsChecked()&&(environment.playerClock=SettingsPage.FileList.elements[5].IsChecked(),to_save.playerClock=environment.playerClock,environment.playerClock?MediaPlayer.domPlayerClockOptional.style.display="block":MediaPlayer.domPlayerClockOptional.style.display="none"),environment.defaultLedLevel!==SettingsPage.FileList.elements[6].GetValue()&&(environment.defaultLedLevel=SettingsPage.FileList.elements[6].GetValue(),to_save.defaultLedLevel=environment.defaultLedLevel,gSTB.SetLedIndicatorLevels(SettingsPage.FileList.elements[6].GetValue(),SettingsPage.FileList.elements[7].GetValue())),environment.standbyLedLevel!==SettingsPage.FileList.elements[7].GetValue()&&(environment.standbyLedLevel=SettingsPage.FileList.elements[7].GetValue(),to_save.standbyLedLevel=environment.standbyLedLevel,gSTB.SetLedIndicatorLevels(SettingsPage.FileList.elements[6].GetValue(),SettingsPage.FileList.elements[7].GetValue())),environment.controlModel!==SettingsPage.FileList.elements[8].GetValue()&&(environment.controlModel=SettingsPage.FileList.elements[8].GetValue(),to_save.controlModel=environment.controlModel,needReload=!0),gSTB.SupportedStandByModes&&gSTB.SupportedStandByModes.length>1&&(Number(environment.standByMode)!==SettingsPage.FileList.elements[9].GetValue()&&(environment.standByMode=SettingsPage.FileList.elements[9].GetValue(),to_save.standByMode=environment.standByMode,gSTB.StandByMode=environment.standByMode),delta++),SettingsPage.FileList.elements[9+delta].GetValue()!==environment.autoPowerDownTime&&(environment.autoPowerDownTime=SettingsPage.FileList.elements[9+delta].GetValue(),to_save.autoPowerDownTime=environment.autoPowerDownTime,gSTB.SetAutoPowerDownTime&&gSTB.SetAutoPowerDownTime(environment.autoPowerDownTime));break;case SettingsPage.FileList.layers.AutoUpdate:environment.autoupdate_cond!==SettingsPage.FileList.elements[0].GetValue()&&(environment.autoupdate_cond=SettingsPage.FileList.elements[0].GetValue(),to_save.autoupdate_cond=environment.autoupdate_cond),environment.betaupdate_cond!==SettingsPage.FileList.elements[1].IsChecked()&&(environment.betaupdate_cond=SettingsPage.FileList.elements[1].IsChecked(),to_save.betaupdate_cond=environment.betaupdate_cond);break;case SettingsPage.FileList.layers.TS:environment.ts_on!==SettingsPage.FileList.elements[0].IsChecked()&&(environment.ts_on=SettingsPage.FileList.elements[0].IsChecked(),to_save.ts_on=environment.ts_on,MediaPlayer.ts_on=environment.ts_on,(MediaPlayer.ModalMenu.Menu.gts.slist.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),MediaPlayer.ModalMenu.Menu.gts.slist.Marked(MediaPlayer.ts_on?MediaPlayer.ModalMenu.Menu.gts.ion:MediaPlayer.ModalMenu.Menu.gts.ioff,!0)),environment.ts_icon!==SettingsPage.FileList.elements[1].IsChecked()&&(environment.ts_icon=SettingsPage.FileList.elements[1].IsChecked(),to_save.ts_icon=environment.ts_icon,MediaPlayer.ts_icon=environment.ts_icon),environment.ts_path!==SettingsPage.FileList.elements[2].GetValue()&&(environment.ts_path=SettingsPage.FileList.elements[2].GetValue(),to_save.ts_path=environment.ts_path,timeShift.SetTimeShiftFolder(environment.ts_path+"/records"),gSTB.ExecAction("make_dir "+environment.ts_path+"/records")),environment.ts_time!==SettingsPage.FileList.elements[3].GetValue()&&(environment.ts_time=SettingsPage.FileList.elements[3].GetValue(),to_save.ts_time=environment.ts_time,timeShift.SetMaxDuration(environment.ts_time)),environment.ts_endType!==SettingsPage.FileList.elements[4].GetValue()&&(environment.ts_endType=SettingsPage.FileList.elements[4].GetValue(),to_save.ts_endType=environment.ts_endType,MediaPlayer.ts_endType=environment.ts_endType),environment.ts_exitType!==SettingsPage.FileList.elements[5].GetValue()&&(environment.ts_exitType=parseInt(SettingsPage.FileList.elements[5].GetValue(),10),to_save.ts_exitType=environment.ts_exitType),environment.ts_lag!==SettingsPage.FileList.elements[6].GetValue()&&(environment.ts_lag=SettingsPage.FileList.elements[6].GetValue(),to_save.ts_lag=environment.ts_lag);break;case SettingsPage.FileList.layers.DVB:for(i=0;i<DVBChannels.inputs.length;i++)DVBChannels.inputs[i].setSignalType(SettingsPage.FileList.elements[2*i+1].GetValue()),-1===DVBChannels.inputs[i].currentScanTypes.indexOf(SettingsPage.FileList.elements[2*i+1].GetValue())&&(needReboot=!0);break;case SettingsPage.FileList.layers.teletext:SettingsPage.FileList.elements[0].IsChecked()?(to_save.teletext_on=environment.teletext_on="on",gSTB.SetTeletext(!0)):(to_save.teletext_on=environment.teletext_on="off",gSTB.SetTeletext(!1)),to_save.teletext_charset=environment.teletext_charset=SettingsPage.FileList.elements[1].GetValue(),""===to_save.teletext_charset||"auto"===to_save.teletext_charset||"disabled"===to_save.teletext_charset?gSTB.ForceTtxCharset(0,!0):gSTB.ForceTtxCharset(+to_save.teletext_charset,!1),WINDOW_HEIGHT>=720?(to_save.teletext_ratio=environment.teletext_ratio=SettingsPage.FileList.elements[2].GetValue(),to_save.teletext_opacity=environment.teletext_opacity=SettingsPage.FileList.elements[3].GetValue()):to_save.teletext_opacity=environment.teletext_opacity=SettingsPage.FileList.elements[2].GetValue();break;case SettingsPage.FileList.layers.accessControl:if(value=SettingsPage.FileList.elements[1].GetValue(),reg=/^[0-9]+$/i,(value.length>10||!reg.test(value)||0===value.length)&&SettingsPage.FileList.elements[0].IsChecked())return void new CModalAlert(currCPage,_("Attention"),_("Incorrect password. Use digits only. Space doesn't allow. Maximum length is 10 symbols."));if(environment.accessControl!==SettingsPage.FileList.elements[0].IsChecked()&&(environment.accessControl=SettingsPage.FileList.elements[0].IsChecked(),to_save.accessControl=environment.accessControl),environment.acPassword!==SettingsPage.FileList.elements[1].GetValue()&&environment.accessControl&&(environment.acPassword=SettingsPage.FileList.elements[1].GetValue(),to_save.acPassword=environment.acPassword,accessControl.password=environment.acPassword),environment.acPassword?accessControl.login(accessControl.password,!0):accessControl.logout(),environment.accessControl){for(accessControl.data.pages[SettingsPage.FileList.elements[2].name]=SettingsPage.FileList.elements[2].IsChecked(),accessControl.data.events[SettingsPage.FileList.elements[3].name]=SettingsPage.FileList.elements[3].IsChecked(),accessControl.data.events[SettingsPage.FileList.elements[4].name]=SettingsPage.FileList.elements[4].IsChecked(),i=SettingsPage.FileList.pagesLength.start;i<SettingsPage.FileList.pagesLength.end;i++)accessControl.data.pages[SettingsPage.FileList.elements[i].name]=SettingsPage.FileList.elements[i].IsChecked();accessControl.save()}}try{var str=JSON.stringify(to_save);echo(str,"settings to save"),gSTB.SetEnv(str),echo(to_save,"to_save"),SettingsPage.BPanel.Hidden(SettingsPage.buttons.OK,!0),needReboot?new CModalConfirm(currCPage,_("Successfully saved"),_("Device reboot is required to apply changes. Reboot now?"),_("Cancel"),function(){},_("Ok"),function(){gSTB.ExecAction("reboot")}):needReload?new CModalConfirm(currCPage,_("Confirm"),_("Restart portal?"),_("Cancel"),null,_("Yes"),function(){var portalWinId=parseInt(getWindowIdByName(WINDOWS.PORTAL)||getWindowIdByName(WINDOWS.PORTALS_LOADER)||1),windowList=JSON.parse(stbWindowMgr.windowList());document.body.style.display="none",gSTB.Stop();for(var i=0;i<windowList.result.length;i++)windowList.result[i]!==portalWinId&&stbWindowMgr.closeWindow(windowList.result[i]);stbStorage.clear(),stbWindowMgr.windowLoad(portalWinId,PATH_SYSTEM+"pages/loader/index.html")}):new CModalHint(currCPage,_("Successfully saved"),2e3)}catch(e){echo(e,"settings save error")}}function loadMasterSettings(handler){gettext.init({name:getCurrentLanguage(),path:"public/portal/master_settings/lang"},function(){loadScript("public/portal/master_settings/variables.js",function(){loadScript("public/portal/master_settings/main.js",function(){void 0!==typeof MasterSettings&&MasterSettings.Init(document.getElementById("pageMasterSettings")),MasterSettings.Show(!0),initMasterSettings(),handler&&"function"==typeof handler&&handler()})})})}function settingsFrontPanelControl(){configuration.frontPanelIndicator?gSTB.ExecAction("front_panel colon-on"):(gSTB.ExecAction("front_panel caption KKKK"),gSTB.ExecAction("front_panel colon-off"))}function settingsClockControl(){environment.ssaverDelay||0===environment.ssaverDelay||(gSTB.SetEnv(JSON.stringify({ssaverDelay:18})),environment.ssaverDelay=18),clockSetup(),clearInterval(clockTimer),clockTimer=setInterval(clockSetup,1e4)}function clockSetup(){var date=new Date,h=date.getHours(),m=date.getMinutes(),today=date.getDate(),month=date.getMonth(),day=date.getDay();1===m.toString().length&&(m="0"+m),document.getElementById("screenClockMinutes_main").innerHTML=h+":"+m,MediaPlayer.domPlayerClock&&(MediaPlayer.domPlayerClock.innerHTML=h+":"+m,MediaPlayer.domPlayerClockOptional.innerHTML=h+":"+m),document.getElementById("screenClockDate_main").innerHTML=fullDaysOfWeek[day]+",<br>"+today+" "+fullMonthNames[month],date.getFullYear()<2012&&(document.getElementById("screenClockMinutes_main").innerHTML=" ",document.getElementById("screenClockDate_main").innerHTML=" <br> "),configuration.frontPanelIndicator&&(1===h.toString().length&&(h="@"+h),gSTB.ExecAction("front_panel caption "+h+m),gSTB.ExecAction("front_panel colon-on"))}function sortingABC(array){var i,langFullName,arr=[],resArray=[];for(i=0;i<array.length;i++)langFullName=array[i].nativeName?array[i].id+" ("+array[i].nativeName+")":array[i].id,arr.push(langFullName+"@"+array[i].code[0]+"@"+i);arr=arr.sort();var item,a;for(i=0;i<arr.length;i++)item={},a=arr[i].split("@"),item.title=a[0],item.code=a[1],item.value=a[2],resArray.push(item);return resArray}function toggleMuteState(){configuration.volume.mute?(document.getElementById("mute").style.visibility="hidden",document.getElementById("toolsPan").style.display="none",configuration.volume.mute=0):(volumeCloseForm(),document.getElementById("mute").style.visibility="visible",document.getElementById("toolsPan").style.display="block",configuration.volume.mute=1,configuration.volume.timer&&clearTimeout(configuration.volume.timer)),gSTB.SetMute(configuration.volume.mute),UPnPRenderer.state&&stbUPnPRenderer.sendMute(configuration.volume.mute)}function volumeSetVolume(vol){configuration.volume.timer&&clearTimeout(configuration.volume.timer),document.getElementById("mute").style.visibility="hidden";var step_px;step_px=1920===WINDOW_WIDTH?15:10;var valueDiv=document.getElementById("volumeForm"),volumeNum=document.getElementById("volume_num"),bar=document.getElementById("volume_right"),control=document.getElementById("volume_bar"),vol_idx=vol/5;if(vol_idx){var value=vol_idx*step_px-5;bar.style.width=value+"px",configuration.volume.mute&&toggleMuteState(),control.style.visibility="visible"}else control.style.visibility="hidden";environment.audio_initial_volume=vol,volumeNum.innerHTML=environment.audio_initial_volume+"%",gSTB.SetVolume(vol),configuration.volume.timer=setTimeout(volumeCloseForm,configuration.volume.hideTimeOut),valueDiv.style.visibility="visible",document.getElementById("toolsPan").style.display="block",UPnPRenderer.state&&stbUPnPRenderer.sendVolume(vol)}function volumeCloseForm(){configuration.volume.timer=null,document.getElementById("volumeForm").style.visibility="hidden",environment.audio_initial_volume>=5&&(document.getElementById("volume_bar").style.visibility="hidden"),document.getElementById("toolsPan").style.display="none"}function secondsToTimeString(time){var h=Math.floor(time/3600),m=Math.floor((time-3600*h)/60),s=time-3600*h-60*m;return(h>9?h:"0"+h)+":"+(m>9?m:"0"+m)+":"+(s>9?s:"0"+s)}function loadEnvironmentVars(volume){var environment,wakeUpSources,query={varList:["front_panel","autoupdate_cond","betaupdate_cond","lang_audiotracks","subtitles_on","lang_subtitles","ts_path","ts_time","ts_endType","ts_exitType","ts_lag","ts_on","ts_icon","settMaster","Image_Desc","Image_Date","Image_Version","weather_place","audio_initial_volume","graphicres","tvsystem","autoupdateURL","ssaverDelay","ssaverName","autoPowerDownTime","subtitles_on","upnp_conf","weather_conf","dvb_type","auto_framerate","standByMode","startPage","hdmi_event_delay","defaultLedLevel","standbyLedLevel","mount_media_ro","playerClock","subtitlesSize","subtitlesColor","teletext_on","teletext_charset","teletext_ratio","teletext_opacity","mount_media_ro","playerClock","subtitlesSize","controlModel","acPassword","accessControl","syslog_srv","aspect"]},keyboardFile=gSTB.LoadUserData("keyboard.json"),remoteControlFileData=gSTB.LoadUserData("remoteControl.json");try{environment=JSON.parse(gSTB.GetEnv(JSON.stringify(query))).result,""===environment.ts_time&&(environment.ts_time=ts_time),""===environment.ts_endType&&(environment.ts_endType=ts_endType),""===environment.ts_exitType&&(environment.ts_exitType=ts_exitType),""===environment.ts_lag&&(environment.ts_lag=ts_lag),""===environment.controlModel&&(environment.controlModel=controlModel),(""===environment.hdmi_event_delay||parseInt(environment.hdmi_event_delay,10)<5&&"0"!==environment.hdmi_event_delay)&&(environment.hdmi_event_delay="5",gSTB.SetEnv(JSON.stringify({hdmi_event_delay:"5"}))),""===environment.standByMode&&(environment.standByMode=gSTB.StandByMode,gSTB.SetEnv(JSON.stringify({standByMode:gSTB.StandByMode}))),""===environment.defaultLedLevel&&(environment.defaultLedLevel=10),""===environment.standbyLedLevel&&(environment.standbyLedLevel=100),null!==volume&&""===environment.audio_initial_volume&&(environment.audio_initial_volume=volume),""===environment.teletext_on&&(environment.teletext_on="on"),""===environment.teletext_charset&&(environment.teletext_charset="disabled"),""===environment.teletext_ratio&&(environment.teletext_ratio="0"),""===environment.teletext_opacity&&(environment.teletext_opacity="125"),""===environment.subtitlesColor&&(environment.subtitlesColor=16777215),environment.aspect||0===environment.aspect||(environment.aspect=16),environment.audio_initial_volume=parseInt(environment.audio_initial_volume,10),["ts_exitType","autoupdate_cond","ssaverDelay","autoPowerDownTime","ts_time","ts_endType","ts_lag","defaultLedLevel","standbyLedLevel","lang_subtitles","subtitlesSize","subtitlesColor","aspect"].forEach(function(item){environment[item]=parseInt(environment[item],10)||0}),["ts_on","ts_icon","subtitles_on","dvb_power","playerClock","accessControl"].forEach(function(item){environment[item]="true"===environment[item]}),environment.betaupdate_cond="1"===environment.betaupdate_cond||"true"===environment.betaupdate_cond,environment.language=getCurrentLanguage()}catch(e){echo(e,"Environment load"),environment={}}if(keyboardFile){try{keyboardFile=JSON.parse(keyboardFile)}catch(error){keyboardFile={layouts:[],order:[]},gSTB.SaveUserData("keyboard.json",JSON.stringify(keyboardFile))}if(keyboardFile.layouts&&keyboardFile.layouts.length){for(var i=0;i<keyboardFile.layouts.length;i++)-1===keyboards.codes.indexOf(keyboardFile.layouts[i])&&keyboardFile.layouts.splice(i,1);if(keyboardFile.layouts.length)for(keyboards[environment.language]=[],i=0;i<keyboardFile.layouts.length;i++)i===keyboardFile.layouts.length-1?keyboards[environment.language][keyboards[environment.language].length]=[keyboardFile.layouts[i],keyboardFile.layouts[0]]:keyboards[environment.language][keyboards[environment.language].length]=[keyboardFile.layouts[i],keyboardFile.layouts[i+1]]}}gSTB.SetInputLang(keyboards[environment.language][0][0]);try{remoteControlFileData=JSON.parse(remoteControlFileData)}catch(error){remoteControlFileData={enable:!1,deviceName:"",password:""},gSTB.SaveUserData("remoteControl.json",JSON.stringify(remoteControlFileData))}return gSTB.ConfigNetRc(remoteControlFileData.deviceName,remoteControlFileData.password),gSTB.SetNetRcStatus(remoteControlFileData.enable),"function"==typeof gSTB.GetWakeUpSources&&-1!==(gSTB.SupportedWakeUpSources||[]).indexOf(2)&&(wakeUpSources=gSTB.GetWakeUpSources()||[],0===Number(environment.hdmi_event_delay)&&-1!==wakeUpSources.indexOf(2)?(wakeUpSources.splice(wakeUpSources.indexOf(2),1),gSTB.SetWakeUpSources(wakeUpSources)):0!==Number(environment.hdmi_event_delay)&&-1===wakeUpSources.indexOf(2)&&(wakeUpSources.push(2),gSTB.SetWakeUpSources(wakeUpSources))),environment}function calculateTheDistance(latA,longA,latB,longB){var earthRadius=6372795,lat1=latA*Math.PI/180,lat2=latB*Math.PI/180,long1=longA*Math.PI/180,long2=longB*Math.PI/180,cosLat1=Math.cos(lat1),cosLat2=Math.cos(lat2),sinLat1=Math.sin(lat1),sinLat2=Math.sin(lat2),delta=long2-long1,cosDelta=Math.cos(delta),sinDelta=Math.sin(delta),x=sinLat1*sinLat2+cosLat1*cosLat2*cosDelta,y=Math.sqrt(Math.pow(cosLat2*sinDelta,2)+Math.pow(cosLat1*sinLat2-sinLat1*cosLat2*cosDelta,2)),ad=Math.atan2(y,x);return Math.ceil(ad*earthRadius)}function SpeedtestStatic(){}function Speedtest(url){url||echo("Empty test download URL!"),this._url=url,this._interval_time=1,this._static=SpeedtestStatic}function random(m,n){return Math.floor(Math.random()*(n-m+1))+m}function createHTMLTree(obj){var tag=document.createElement(obj.tag);for(var key in obj.attrs)obj.attrs.hasOwnProperty(key)&&("html"!==key?tag.setAttribute(key,obj.attrs[key]):tag.innerHTML=obj.attrs[key]);return Array.isArray(obj.child)&&obj.child.forEach(function(item){tag.appendChild(createHTMLTree(item))}),tag}function init2(){var langAuioInd,i,sortediso639=iso639;switch(WINDOW_HEIGHT){case 480:as.image_dir="576";break;case 576:as.image_dir="576";break;case 720:as.image_dir="720";break;case 1080:as.image_dir="1080";break;default:as.image_dir="576"}if(environment.language=environment.language.toLowerCase()||as.default_lang,""===environment.lang_audiotracks){if(null!==configuration.defaultAudioLang)environment.lang_audiotracks=configuration.defaultAudioLang;else{for(langAuioInd=0,i=0;i<sortediso639.length;i++)if(sortediso639[i].code[1]===environment.language||sortediso639[i].code[2]===environment.language){langAuioInd=i;break}environment.lang_audiotracks=langAuioInd}gSTB.SetEnv(JSON.stringify({lang_audiotracks:environment.lang_audiotracks}))}if(""===environment.lang_subtitles){if(null!==configuration.defaultSubtitleLang)environment.lang_subtitles=configuration.defaultSubtitleLang;else{for(langAuioInd=0,i=0;i<sortediso639.length;i++)if(sortediso639[i].code[1]===environment.language||sortediso639[i].code[2]===environment.language){langAuioInd=i;break}environment.lang_subtitles=langAuioInd}gSTB.SetEnv(JSON.stringify({lang_subtitles:environment.lang_subtitles}))}document.getElementById("face").style.background=configuration.logoImagePath?"url("+configuration.logoImagePath+") no-repeat":"none",weather.load();var d=document.getElementById("weather_condition");""!==weather.set.location?d.innerHTML='<span class="weather_text">'+_("Receiving<br>weather<br>data")+"</span>":d.innerHTML='<span class="weather_text">'+_("No<br>weather<br>settings")+"</span>",app.start()}function fade(){document.getElementById("cur_desktop").className="_"+configuration.desktop.number}function CFileList(parent){var self=this;VList.call(this,{size:5}),this.parent=parent,this.name="CFileList",this.bcrumb=null,this.sbar=null,this.ext2type={},this.LEVEL_CHANGE_NONE=0,this.LEVEL_CHANGE_UP=-1,this.LEVEL_CHANGE_DOWN=1,this.path=[],this.subList=[],this.playList=[],this.playListSet=!1,this.mtypes=[],this.hideF2=!0,this.canFav=!1,this.total=0,MEDIA_EXTENSION[MEDIA_TYPE_VIDEO].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_VIDEO}),MEDIA_EXTENSION[MEDIA_TYPE_AUDIO].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_AUDIO}),MEDIA_EXTENSION[MEDIA_TYPE_IMAGE].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_IMAGE}),MEDIA_EXTENSION[MEDIA_TYPE_TEXT].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_TEXT}),MEDIA_EXTENSION[MEDIA_TYPE_ISO].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_ISO}),MEDIA_EXTENSION[MEDIA_TYPE_PLAYLIST].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_PLAYLIST}),MEDIA_EXTENSION[MEDIA_TYPE_CUE].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_CUE}),MEDIA_EXTENSION[MEDIA_TYPE_RECORDS_ITEM].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_RECORDS_ITEM}),FileBrowser.init(this),this.fileBrowser=FileBrowser}function TVList(parent){CScrollList.call(this,parent);var self=this;this.bcrumb=null,this.sbar=null,this.filterType=MEDIA_TYPE_NONE,this.filterText="",this.LEVEL_CHANGE_NONE=0,this.LEVEL_CHANGE_UP=-1,this.LEVEL_CHANGE_DOWN=1,this.mtypes=[],this.path=[],this.parentItem={},this.timer={},this.prevChannel=null,this.lastChannel=null,this.openAction={},this.openAction[MEDIA_TYPE_BACK]=function(){var st=this.Back();return st},this.openAction[MEDIA_TYPE_TV_ROOT]=function(){var j=0,item=null;if(this.channelStart=-1,this.Clear(),this.filterText&&(this.Add({name:".."},{type:MEDIA_TYPE_BACK}),this.channelStart++),this.data.length>0){for(var i=0;i<this.data.length;i++)this.data[i].type===MEDIA_TYPE_GROUP?(item=this.Add({name:this.data[i].name},{name:this.data[i].name,index:i,markable:!0,data:this.data[i].data,type:MEDIA_TYPE_GROUP}),item&&(this.channelStart=i)):(item=this.Add({name:this.data[i].name,number:j+1,tsOn:configuration.mayTimeShift&&this.data[i].tsOn},{name:this.data[i].name,markable:!0,index:i,number:j+1,type:MEDIA_TYPE_STREAM},{stared:FAVORITES_NEW[(this.data[i].sol?this.data[i].sol+" ":"")+this.data[i].url]?!0:!1}),item&&j++);self.parent.domInfoTitle.innerHTML=self.data[0].name?self.data[0].name:"",this.parent.BPanel.Hidden(this.parent.BPanel.btnF1,!1),this.parent.BPanel.Hidden(this.parent.BPanel.btnF2,!1),this.parent.handle.querySelector(".content").querySelector(".crop").className="crop"}else this.filterText&&(self.parent.domURL.innerHTML="",self.parent.domInfoTitle.innerHTML=""),this.parent.BPanel.Hidden(this.parent.BPanel.btnF1,!0),this.parent.BPanel.Hidden(this.parent.BPanel.btnF2,!0),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3add,!0),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,!0),this.parent.handle.querySelector(".content").querySelector(".crop").className="crop defImage";return this.LEVEL_CHANGE_DOWN},this.openAction[MEDIA_TYPE_GROUP]=function(data){var item=null;this.Clear(),this.Add({name:".."},{type:MEDIA_TYPE_BACK});var j=0;if(this.channelStart=-1,data.data.length>0){for(var i=0;i<data.data.length;i++)data.data[i].type===MEDIA_TYPE_GROUP?(item=this.Add({name:data.data[i].name},{name:data.data[i].name,index:i,markable:!0,data:data.data[i].data,type:MEDIA_TYPE_GROUP}),item&&(this.channelStart=i)):(item=this.Add({name:data.data[i].name,number:j+1,tsOn:configuration.mayTimeShift&&data.data[i].tsOn},{name:data.data[i].name,markable:!0,index:i,number:j+1,type:MEDIA_TYPE_STREAM},{stared:FAVORITES_NEW[(data.data[i].sol?data.data[i].sol+" ":"")+data.data[i].url]?!0:!1}),item&&j++);self.parent.domInfoTitle.innerHTML=self.data[0].name?self.data[0].name:""}else this.parent.BPanel.Hidden(this.parent.BPanel.btnF1,!0),this.parent.BPanel.Hidden(this.parent.BPanel.btnF2,!0),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3add,!0),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,!0);return this.LEVEL_CHANGE_DOWN},this.openAction[MEDIA_TYPE_STREAM]=function(data,noPlay){return MediaPlayer.obj===self.parentItem.data[data.index]||noPlay?(MediaPlayer.ts_inProgress&&(environment.ts_icon&&(MediaPlayer.domTSIndicator.style.display="block"),MediaPlayer.runner.start()),MediaPlayer.Show(!0,this.parent),MediaPlayer.showInfo(!0),MediaPlayer.timer.showInfo=setTimeout(function(){MediaPlayer.showInfo(!1)},3e3)):MediaPlayer.preparePlayer(self.parentItem.data[data.index],this.parent,!0,!0,!0),this.LEVEL_CHANGE_NONE}}function DVBList(parent){var customParams={onPage:function(){var count={480:4,576:6,720:7,1080:7};return count[screen.height]}()},self=this;CList.call(this,parent,customParams),this.data=[],this.nativList=null,this.filters=[],this.count=0,this.bcrumb=null,this.sbar=null,this.LEVEL_CHANGE_NONE=0,this.LEVEL_CHANGE_UP=-1,this.LEVEL_CHANGE_DOWN=1,this.filterType=MEDIA_TYPE_NONE,this.filterText="",this.mtypes=[],this.path=[],this.parentItem=null,this.timer={},this.prevChannel=null,this.lastChannel=null,this.openAction={},this.openAction[MEDIA_TYPE_BACK]=function(){var st=this.Back();return st},this.openAction[MEDIA_TYPE_DVB_ROOT]=function(){return this.parent.scanningInProgress?void 0:(this.FillItems(),0===this.list.length?(this.parent.BPanel.Hidden(this.parent.BPanel.btnF3add,!0),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,!0),this.parent.domInfoTitle.innerHTML="",this.parent.handle.querySelector(".content").querySelector(".crop").className="crop defImage"):this.parent.handle.querySelector(".content").querySelector(".crop").className="crop",this.LEVEL_CHANGE_DOWN)},this.openAction[MEDIA_TYPE_DVB]=function(item,noPlay){if(MediaPlayer.obj&&MediaPlayer.obj.id===item.data.id||noPlay)MediaPlayer.Show(!0,this.parent),MediaPlayer.showInfo(!0),MediaPlayer.timer.showInfo=setTimeout(function(){MediaPlayer.showInfo(!1)},3e3);else{var obj={id:item.data.id,name:item.name,url:item.data.uri,type:item.type,sol:"dvb"};echo(obj),MediaPlayer.preparePlayer(obj,this.parent,!0,!0,!0)}return this.LEVEL_CHANGE_NONE},this.pressOK=function(item){self.Open(item)}}function EpgGrid(parent){var customParams={onPage:function(){var count={480:4,576:6,720:6,1080:6};return count[screen.height]}()};this.sheduleWidth=function(){var width={480:327,576:327,720:824,1080:1235};return width[screen.height]}(),CList.call(this,parent,customParams),this.time=null,this.day=0,this.timeStep=function(){var width={480:3600,576:3600,720:7200,1080:7200};return width[screen.height]}(),this.countOfSteps=function(){var width={480:2,576:2,720:4,1080:4};return width[screen.height]}(),this.sheduleBlock=this.sheduleWidth/this.timeStep,this.timeLine=null,this.timeLineMargin=function(){var margin={480:338,576:338,720:390,1080:585};return margin[screen.height]}(),this.startEPGTime=null,this.domTimeblocks=this.parent.handle.querySelector(".content .timeblocks"),this.timer={},this.internal={},this.epgMode=0,this.domEpgItemFocus=null,this.domProgramBlock=this.parent.handle.querySelector(".content .current_prog"),this.pressOK=function(item){var data;if(item.subNavigElements.length){if(data=item.subNavigElements[item.epgActive].data||{},!data.details&&!data.info)return!1;new CModalEPGInfo(currCPage,data)}}}function unTune(){var i,tuners=stbDvbManager.tuners;for(i=0;i<tuners.length;i++)tuners[i].untune()}function CModalAuth(parent,title,lblUser,lblPass,btnExitTitle,btnExitClick,btnOKTitle,btnOKClick){var self=this,html=element("table",{className:"main maxw"},[element("tr",{},[element("td",{className:"name"},lblUser),element("td",{className:"data"},this.user=element("input",{type:"text"}))]),element("tr",{},[element("td",{className:"name"},lblPass),element("td",{className:"data"},this.pass=element("input",{type:"password"}))])]);this.user.onkeydown=this.pass.onkeydown=function(event){if(eventPrepare(event,!1,"CModalAuth"))switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;case KEYS.UP:self.FocusPrev(event);break;case KEYS.DOWN:self.FocusNext(event);break;case KEYS.OK:}},this.onShow=function(){setTimeout(function(){self.user.focus(),gSTB.ShowVirtualKeyboard()},5)},CModalAlert.call(this,parent,title,html,btnExitTitle,btnExitClick),this.focusList.push(this.user),this.focusList.push(this.pass),this.name="CModalAuth",this.bpanel.Add(KEYS.OK,"ok.png",btnOKTitle,function(){"function"==typeof btnOKClick&&btnOKClick.call(self,self.user.value,self.pass.value)&&self.Show(!1)})}function CModalMount(parent,link,type){var smbData=MediaBrowser.FileList.Current().data;CModalBox.call(this,parent),this.name="CModalMount";var self=this;this.type=new CSelectBox(this,{
data:[{id:"smb",name:"SMB"},{id:"nfs",name:"NFS"}],parent:element("div"),events:{onChange:function(){"smb"===this.GetValue()?(self.row_user.className=self.row_pass.className="",self.focusList=[self.url,self.folder,self.local,this.handle,self.login,self.pass],self.login.disabled=!1,self.pass.disabled=!1,self.pass.type="password"):(self.row_user.className=self.row_pass.className="inactive",self.login.value=self.pass.value="",self.focusList=[self.url,self.folder,self.local,this.handle],self.login.disabled=!0,self.pass.disabled=!0,self.pass.type="text")}}});var html=element("table",{className:"main maxw"},[element("tr",{},[element("td",{className:"name"},_("Server address:")),element("td",{className:"data"},this.url=element("input",{type:"text"}))]),element("tr",{},[element("td",{className:"name"},_("Server folder:")),element("td",{className:"data"},this.folder=element("input",{type:"text"}))]),element("tr",{},[element("td",{className:"name"},_("Local folder:")),element("td",{className:"data"},this.local=element("input",{type:"text"}))]),element("tr",{},[element("td",{className:"name"},_("Connection type:")),element("td",{className:"data"},this.type.parentNode)]),this.row_user=element("tr",{},[element("td",{className:"name"},_("Login:")),element("td",{className:"data"},this.login=element("input",{type:"text"}))]),this.row_pass=element("tr",{},[element("td",{className:"name"},_("Password")+":"),element("td",{className:"data"},this.pass=element("input",{type:"text"}))])]);if(echo(link,"link"),void 0!==link||MediaBrowser.FileList.parentItem.type!==MEDIA_TYPE_SAMBA_SHARE&&MediaBrowser.FileList.Current().data.type!==MEDIA_TYPE_SAMBA_SHARE&&MediaBrowser.FileList.parentItem.type!==MEDIA_TYPE_SAMBA_SHARE&&MediaBrowser.FileList.Current().data.type!==MEDIA_TYPE_SAMBA_SHARE)void 0!==link&&link instanceof Object&&(self.url.value=link.url||"",self.folder.value=link.folder||"",self.local.value=link.local||"",self.login.value=link.login||"",self.pass.value=link.pass||"");else{var address=MediaBrowser.FileList.Current().data.address||MediaBrowser.FileList.parentItem.address,smbPath=address.split("/");self.url.value=smbPath[2]||"",self.folder.value=smbPath[3]||"",self.local.value=smbPath[3]||"",self.login.value=SMB_AUTH[address]?SMB_AUTH.login||"":"",self.pass.value=SMB_AUTH[address]?SMB_AUTH.path||"":""}void 0!==type&&(type===MEDIA_TYPE_SAMBA_SHARE&&this.type.SetIndex(0),type===MEDIA_TYPE_NFS_SHARE&&this.type.SetIndex(1)),this.type.trigger("onChange"),this.prepare=function(){if(self.url.value=self.url.value.trim(),self.folder.value=self.folder.value.trim(),self.local.value=self.local.value.trim(),self.login.value=self.login.value.trim(),self.pass.value=self.pass.value.trim(),self.folder.value&&("nfs"===self.type.GetValue()&&"/"!==self.folder.value.charAt(0)&&(self.folder.value="/"+self.folder.value),"smb"===self.type.GetValue()&&"/"===self.folder.value.charAt(0)&&(self.folder.value=self.folder.value.slice(1)),"/"===self.folder.value.charAt(self.folder.value.length-1)&&(self.folder.value=self.folder.value.slice(0,-1))),!self.local.value&&self.folder.value){var parts=self.folder.value.split("/");self.local.value=parts[parts.length-1]}},this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_(void 0!==link?"Save":"Connect"),function(){var addr;if(gSTB.HideVirtualKeyboard(),self.prepare(),self.url.value&&self.folder.value&&self.local.value){var data,exist,dupl=!1;void 0===link&&(SMB_ARRAY.forEach(function(item){item.local===self.local.value&&(dupl=!0)}),NFS_ARRAY.forEach(function(item){item.local===self.local.value&&(dupl=!0)})),dupl?new CModalHint(self,_("Local folder with this name already exists"),4e3):"smb"===self.type.GetValue()?(addr="//"+self.url.value+"/"+self.folder.value,MediaBrowser.UnmountSMB(),void 0!==link||MediaBrowser.MountSMB({addresses:smbData.addresses,name:self.folder.value,address:addr,login:self.login.value,pass:self.pass.value})?(data={addresses:smbData.addresses,url:self.url.value,folder:self.folder.value,local:self.local.value,login:self.login.value||"guest",pass:self.pass.value},exist=!1,void 0===link&&SMB_ARRAY.forEach(function(item){var same=!0;if(!exist){for(var name in data)same=same&&data[name]===item[name];same&&(exist=!0)}}),exist?new CModalHint(self,_("Resource already connected"),4e3):(setTimeout(function(){var size,index=0;if(link&&-1!==SMB_ARRAY.indexOf(link)?SMB_ARRAY[SMB_ARRAY.indexOf(link)]=data:SMB_ARRAY.push(data),echo(SMB_ARRAY,"SMB_ARRAY"),gSTB.SaveUserData("smb_data",JSON.stringify(SMB_ARRAY)),void 0===link){for(MediaBrowser.Reset(!1,!1),size=MediaBrowser.FileList.data.length;size>index;){if(MediaBrowser.FileList.data[index].link===data){MediaBrowser.FileList.Reposition({index:index},!0);break}++index}MediaBrowser.FileList.Open(MediaBrowser.FileList.activeItem.data)}else{var current=MediaBrowser.FileList.Current().data;MediaBrowser.FileList.Refresh(!1),MediaBrowser.FileList.Reposition(current)}echo(SMB_ARRAY,"gSTB.SaveUserData")},5),self.Show(!1),new CModalHint(currCPage,_("Network folder successfully mounted"),2e3))):new CModalHint(self,_("Unable to connect to the resource<br>with the given parameters"),4e3)):(addr=self.url.value+":"+self.folder.value,MediaBrowser.UnmountNFS(),void 0!==link||MediaBrowser.MountNFS({address:addr})?(data={url:self.url.value,folder:self.folder.value,local:self.local.value},exist=!1,void 0===link&&NFS_ARRAY.forEach(function(item){var same=!0;if(!exist){for(var name in data)same=same&&data[name]===item[name];same&&(exist=!0)}}),exist?new CModalHint(self,_("Resource already connected"),4e3):(setTimeout(function(){var size,index=0;if(link&&-1!==NFS_ARRAY.indexOf(link)?NFS_ARRAY[NFS_ARRAY.indexOf(link)]=data:NFS_ARRAY.push(data),gSTB.SaveUserData("nfs_data",JSON.stringify(NFS_ARRAY)),void 0===link){for(MediaBrowser.Reset(!1,!1),size=MediaBrowser.FileList.data.length;size>index;){if(MediaBrowser.FileList.data[index].link===data){MediaBrowser.FileList.Reposition({index:index},!0);break}++index}MediaBrowser.FileList.Open(MediaBrowser.FileList.activeItem.data)}else{var current=MediaBrowser.FileList.Current().data;MediaBrowser.FileList.Refresh(!1),MediaBrowser.FileList.Reposition(current)}echo(NFS_ARRAY,"gSTB.SaveUserData")},5),self.Show(!1),new CModalHint(currCPage,_("Network folder successfully mounted"),2e3))):new CModalHint(self,_("Unable to connect to the resource<br>with the given parameters"),4e3))}else new CModalHint(self,_("Wrong connection parameters"),4e3)}),this.SetHeader(_(void 0!==link?"Edit network folder":"Connect network folder")),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.onShow=function(){setTimeout(function(){self.url.focus(),void 0===link&&gSTB.ShowVirtualKeyboard()},100)},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if(this.focusList[this.focusPos]===self.type.handle&&self.type.EventHandler(event),event.stopped!==!0)switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;case KEYS.UP:self.prepare(),self.FocusPrev(event,!1);break;case KEYS.DOWN:self.prepare(),self.FocusNext(event,void 0===link);break;default:self.bpanel.EventHandler(event)}},this.Init(),this.Show(!0)}function CModalUnmount(parent,share){var selected,i;CModalBox.call(this,parent),this.name="CModalMount";var self=this,shares=[];for(SMB_ARRAY.forEach(function(item){shares.push({type:"smb",id:item,name:item.local})}),NFS_ARRAY.forEach(function(item){shares.push({type:"nfs",id:item,name:item.local})}),i=0;i<shares.length;i++)shares[i].id===share&&(selected=i);this.local=new CSelectBox(this,{data:shares,selected:selected,style:"wide",events:{onChange:function(){var selected=this.GetSelected();"smb"===selected.type&&(self.hint.innerHTML="smb://"+selected.id.url+"/"+selected.id.folder),"nfs"===selected.type&&(self.hint.innerHTML="nfs://"+selected.id.url+selected.id.folder)}},parent:element("div")});var html=element("table",{className:"main maxw"},[element("tr",{},[element("td",{className:"name"},_("Local folder:"))]),element("tr",{},[element("td",{className:"data"},this.local.parentNode)]),element("tr",{},[element("td",{className:"data"},this.hint=element("div",{className:"hint"}))])]);this.local.trigger("onChange"),this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_("Disconnect"),function(){var pos,selected=self.local.GetSelected();"smb"===selected.type?(MediaBrowser.UnmountSMB(),pos=SMB_ARRAY.indexOf(self.local.GetValue()),-1!==pos&&SMB_ARRAY.splice(pos,1),echo(SMB_ARRAY,"SMB_ARRAY saving"),gSTB.SaveUserData("smb_data",JSON.stringify(SMB_ARRAY))):"nfs"===selected.type&&(MediaBrowser.UnmountNFS(),pos=NFS_ARRAY.indexOf(self.local.GetValue()),-1!==pos&&NFS_ARRAY.splice(pos,1),echo(NFS_ARRAY,"NFS_ARRAY saving"),gSTB.SaveUserData("nfs_data",JSON.stringify(NFS_ARRAY))),MediaBrowser.Reset(!1,!1),self.Show(!1),new CModalHint(currCPage,_("Network folder successfully unmounted"),2e3)}),this.SetHeader(_("Disconnect network folder")),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.onShow=function(){self.local.focus()},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if(eventPrepare(event,!0,"CModalAlert")){switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;default:self.bpanel.EventHandler(event)}this.local.EventHandler(event)}},this.Init(),this.Show(!0)}function CModalFormat(parent){CModalBox.call(this,parent),this.name="CModalFormat";var self=this,parts=[];if(this.type=new CSelectBox(this,{style:"format",data:[{id:"ext3",name:"EXT3"},{id:"ext2",name:"EXT2"},{id:"ntfs",name:"NTFS"},{id:"ext4",name:"EXT4"}]}),HDD_INFO.length>0)for(var i=0;i<HDD_INFO.length;i++)HDD_INFO[i].partitionNum||parts.push({name:HDD_INFO[i].vendor+" "+HDD_INFO[i].model.replace(/\//,"")+" "+(""!==HDD_INFO[i].size?Math.floor(HDD_INFO[i].size/1073741824*100/100)+"GB":""),id:"allHDD|"+(""!==HDD_INFO[i].size?Math.floor(HDD_INFO[i].size/1073741824*100)/100:0)});this.part=new CSelectBox(this,{style:"format",data:parts});var html=element("table",{className:"main maxw"},[this.$file_system=element("tr",{},[element("td",{className:"name"},_("File system:")),element("td",{className:"data"},this.type.parentNode)]),this.$partition=element("tr",{},[element("td",{className:"name"},_("Partition:")),element("td",{className:"data"},this.part.parentNode)]),this.$progress_bar_row=element("tr",{},[element("td",{colSpan:2},element("div",{},this.$progress_bar=element("div",{className:"progressbar formatting"},element("div",{className:"progressbar_bg maxh"},[this.line=element("div",{className:"progressbar_line maxh"}),this.text=element("div",{className:"progressbar_digit"})]))))])]);self.focusList=[self.type,self.part],this.finish=function(){this.line.style.width=this.text.innerHTML="",document.addEventListener("keydown",mainEventListener),this.type.disabled=this.part.disabled=!1,this.type.focus(),this.bpanel.Activate(!0)},this.check=function(){function showElements(){self.$partition.style.display=self.$file_system.style.display="table-cell",self.$exit_key.style.display=self.$ok_key.style.display="block"}var read_status={};try{eval("read_status="+gSTB.RDir("tempfile read hdd_progress"))}catch(e){echo(e,"tempfile read hdd_progress")}if(echo(read_status,"read_status"),"undefined"===read_status.state)return this.line.style.width=this.text.innerHTML="0%",setTimeout(function(){self.check()},5e3);if("complete"===read_status.state)return this.finish(),self.Show(!1),void setTimeout(function(){new CModalAlert(parent,_("Formatting"),_("Formatting completed"),_("Close"),function(){echo("exit")})},0);if("error"!==read_status.state)return this.line.style.width=this.text.innerHTML=read_status.percent+"%",setTimeout(function(){self.check()},500);switch(this.finish(),read_status.stage){case"16":showElements(),new CModalAlert(this,_("Formatting error"),_('Formatting impossible.<br>Make sure the device is not used in:<br>"Download manager", "Record manager"<br>or content playback.'),_("Close"),function(){echo("exit")});break;case"2":case"22":showElements(),new CModalAlert(this,_("Formatting error"),_("Formatting impossible"),_("Close"),function(){echo("exit")});break;default:showElements(),new CModalAlert(this,_("Formatting"),_("Formatting error"),_("Close"),function(){echo("exit")})}},this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.$exit_key=this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.$ok_key=this.bpanel.Add(KEYS.OK,"ok.png",_("Start formatting"),function(){var part=self.part.GetValue().split("|");return echo(part),echo(self.part.GetValue()),part[0]?"fat32"===self.type.GetValue()&&parseInt(part[1],10)>320?new CModalAlert(self,_("Formatting error"),_("Selected file system supports disks up to 320GB"),_("Close"),function(){echo("exit")}):void new CModalConfirm(self,_("Formatting"),_('<b style="color:red">Warning: </b>after formatting all data in the<br> selected section will be deleted.'),_("Cancel"),function(){},_("Start formatting"),function(){MediaBrowser.FileList.mode===MEDIA_TYPE_STORAGE_SATA&&MediaBrowser.Reset(),document.removeEventListener("keydown",mainEventListener),self.type.disabled=self.part.disabled=!0,self.bpanel.Activate(!1);var cmd="hdd_format "+self.type.GetValue();echo(cmd,"formatting command"),gSTB.RDir(cmd),self.check(),self.$partition.style.display=self.$file_system.style.display=self.$exit_key.style.display=self.$ok_key.style.display="none"}):new CModalAlert(self,_("Formatting error"),_("Formatting impossible"),_("Close"),function(){echo("exit")})}),this.SetHeader(_("Formatting")),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.onShow=function(){self.type.focus()},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if("function"==typeof self.focusList[self.focusPos].EventHandler&&self.focusList[self.focusPos].EventHandler(event),event.stopped!==!0)switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;case KEYS.UP:self.FocusPrev(event,!1),event.preventDefault();break;case KEYS.DOWN:self.FocusNext(event,!1),event.preventDefault();break;default:self.bpanel.EventHandler(event)}},this.Init(),this.Show(!0),this.handleInner.className="cmodal-main format"}function CModalPlayListOpen(parent){CModalBox.call(this,parent);var $selectBox,isFileInUTF8=gSTB.IsFileUTF8Encoded(this.parent.FileList.Current().data.url),encs=["cp1250","cp1251","cp1252","cp1253","cp1254","cp1254","cp1255","cp1256","cp1257","cp1258","iso8859-1","iso8859-2","iso8859-3","iso8859-4","iso8859-5","iso8859-6","iso8859-7","iso8859-8","iso8859-9","iso8859-10","iso8859-11","iso8859-12","iso8859-13","iso8859-14","iso8859-15","iso8859-16"];this.content.className=this.content.className+" cmodal-pls",this.name="CModalPlayListOpen";var self=this,func=function(code){setTimeout(function(){echo(self.list.value);var data=self.parent.FileList.Current().data;data.code=code,data.encoding=isFileInUTF8?null:self.list.value,self.parent.FileList.Open(data)},5),self.Show(!1)};this.list=new CSelectBox(this,{data:encs,style:"subtitles"}),this.onShow=function(){isFileInUTF8?$selectBox.style.display="none":setTimeout(function(){self.list.focus()},5)},this.bpanelMain=new CButtonPanel,this.bpanelMain.Init(CMODAL_IMG_PATH),this.bpanelMain.Add(KEYS.F1,"f1.png",_("See playlist content"),func),this.bpanelMain.Add(KEYS.F2,"f2.png",_("Start playing all records"),func),this.bpanelMain.Add(KEYS.F3,"f3.png",_("Add all records to IPTV channels"),func),this.bpanelBottom=new CButtonPanel,this.bpanelBottom.Init(CMODAL_IMG_PATH),this.bpanelBottom.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)});var $html=element("table",{className:"main maxw"},[element("tr",{},[element("td",{className:"name"},this.bpanelMain.handle)]),$selectBox=element("tr",{},[element("td",{className:"data"},[_("File encoding:"),this.list.parentNode])])]);this.SetHeader(_("Open playlist")),this.SetContent([$html]),this.SetFooter(this.bpanelBottom.handle),this.onHide=function(){elclear(self.bpanelMain.handle),elclear(self.bpanelBottom.handle),delete self.bpanelMain,delete self.bpanelBottom,self.Free()},this.EventHandler=function(e){self.bpanelMain&&self.bpanelMain.EventHandler(e),self.bpanelBottom&&self.bpanelBottom.EventHandler(e),!isFileInUTF8&&self.list&&self.list.EventHandler(e)},this.Init(),this.Show(!0)}function CModalSubtitleOpen(parent,options){var self=this,encs=["cp1250","cp1251","cp1252","cp1253","cp1254","cp1254","cp1255","cp1256","cp1257","cp1258","iso8859-1","iso8859-2","iso8859-3","iso8859-4","iso8859-5","iso8859-6","iso8859-7","iso8859-8","iso8859-9","iso8859-10","iso8859-11","iso8859-12","iso8859-13","iso8859-14","iso8859-15","iso8859-16"];this.list=new CSelectBox(this,{data:encs,style:"subtitles"});var html=element("table",{className:"main maxw"},[element("tr",{},[element("td",{className:"name"},_("File:")),element("td",{className:"data"},options.data.name||"")]),element("tr",{},[element("td",{className:"name"},_("Encoding:")),element("td",{className:"data"},this.list.parentNode)])]);this.onShow=function(){setTimeout(function(){self.list.focus()},5)},CModalAlert.call(this,parent,_("Accessing subtitle file"),html,_("Cancel"),function(){self.Show(!1)}),this.EventHandler=function(event){eventPrepare(event,!0,this.name)&&(self.list.EventHandler(event),self.bpanel.EventHandler(event))},this.name="CModalSubtitleOpen",this.bpanel.Add(KEYS.OK,"ok.png",_("Connection"),function(){self.Show(!1),"function"==typeof options.onadd&&options.onadd(options,self.list.value)})}function CModalCreateGroup(parent,label,data,toDelete,newGroup){var self=this,group=[],done=!1;CModalBox.call(this,parent),data||(data=[]),toDelete||(toDelete=[]),this.content.className=this.content.className+" cmodal-pls",this.name="CModalCreateGroup";var func=function(code){switch(code){case KEYS.F1:break;case KEYS.F4:toDelete=[]}""===self.newLocal.value?self.local.GetValue()!==!1&&(done=self.parent.TVList.createGroup(self.local.GetValue(),data,toDelete)):done=self.parent.TVList.createGroup(self.newLocal.value,data,toDelete),done&&self.Show(!1)},domArr=[];newGroup?(domArr.push(element("tr",{},[element("td",{className:"name"},_("Group:")),element("td",{className:"data"},this.newLocal=element("input",{type:"text",className:"wide"}))])),this.focusList.push(this.newLocal)):(domArr.push([element("tr",{},[element("td",{className:"name"},_("Group:")),element("td",{className:"data"},this.localDiv=element("div"))]),element("tr",{},[element("td"),element("td",{className:"data"},_("or create and use a new group:"))]),element("tr",{},[element("td"),element("td",{className:"data"},this.newLocal=element("input",{type:"text",className:"wide"}))])]),group=parent.TVList.parentItem.data.slice(parent.TVList.handle.children[0].data.type===MEDIA_TYPE_BACK?1:0,parent.TVList.channelStart+1),group.length?this.local=new CSelectBox(this,{idField:"name",nameField:"name",content:this.localDiv,data:group,style:"cselect-box-wide"}):this.local=new CSelectBox(this,{content:this.localDiv,data:[{id:!1,name:parent.TVList.parentItem.name?parent.TVList.parentItem.name:_("IPTV channels")}],style:"cselect-box-wide"}),this.focusList.push(this.local),this.focusList.push(this.newLocal));var html=element("table",{className:"main maxw"},domArr);this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),newGroup?this.bpanel.Add(KEYS.OK,"ok.png",_("Save"),function(){""!==self.newLocal.value&&(self.Show(!1),self.parent.TVList.createGroup(self.newLocal.value,data,toDelete))}):(this.bpanel.Add(KEYS.F1,"f1.png",_("Move"),func),this.bpanel.Add(KEYS.F4,"f4.png",_("Copy"),func)),this.SetHeader(label),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.onShow=function(){newGroup?self.newLocal.focus():self.local.focus()},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if(eventPrepare(event,!0,"CModalAlert"))switch(newGroup||document.activeElement!==this.local.handle||this.local.EventHandler(event),event.code){case KEYS.UP:self.FocusPrev(event);break;case KEYS.DOWN:self.FocusNext(event);break;case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;default:self.bpanel.EventHandler(event)}},this.Init(),this.Show(!0)}function CModalAddRecord(parent,label,defParams){CModalBox.call(this,parent),this.name="CModalIptvAddRecord";var self=this,autoCorrection=!0;defParams||(defParams={});var time=defParams.time?new Date(defParams.time):new Date,sec=time.getSeconds(),min=time.getMinutes(),hour=time.getHours(),day=time.getDate(),month=time.getMonth()+1,year=time.getFullYear();time=new Date(time.getTime()+(defParams.duration?defParams.duration:36e5));var min1=time.getMinutes(),hour1=time.getHours(),day1=time.getDate(),month1=time.getMonth()+1,year1=time.getFullYear();if(sec=sec>9?sec:"0"+sec,min=10>min?"0"+min:min,hour=10>hour?"0"+hour:hour,day=10>day?"0"+day:day,month=10>month?"0"+month:month,min1=10>min1?"0"+min1:min1,hour1=10>hour1?"0"+hour1:hour1,day1=10>day1?"0"+day1:day1,month1=10>month1?"0"+month1:month1,this.parseTime=function(){var tt=/^([0-9]+)$/;return echo("parseTime : "+this.value+" | "+tt.test(this.value)),tt.test(this.value)?(this.value>this.maxValue&&(this.value=this.maxValue),this.value.length===this.maxLength&&setTimeout(function(){self.FocusRight()},50)):this.value.length>0&&(this.value=this.value.substring(0,this.value.length-2)),!1},this.checkTime=function(){self.startTimeYear.value=self.startTimeYear.value||(new Date).getFullYear(),self.startTimeMonth.value=self.startTimeMonth.value||"01",self.startTimeDay.value=self.startTimeDay.value||"00",self.startTimeHour.value=self.startTimeHour.value||"00",self.startTimeMin.value=self.startTimeMin.value||"00",self.endTimeYear.value=self.endTimeYear.value||(new Date).getFullYear(),self.endTimeMonth.value=self.endTimeMonth.value||"01",self.endTimeDay.value=self.endTimeDay.value||"00",self.endTimeHour.value=self.endTimeHour.value||"00",self.endTimeMin.value=self.endTimeMin.value||"00";var startTime=new Date(self.startTimeYear.value,self.startTimeMonth.value-1,self.startTimeDay.value,self.startTimeHour.value,self.startTimeMin.value),endTime=new Date(self.endTimeYear.value,self.endTimeMonth.value-1,self.endTimeDay.value,self.endTimeHour.value,self.endTimeMin.value),delta=(endTime.getTime()-startTime.getTime())/1e3;if(delta>0){var h=Math.floor(delta/3600),m=Math.floor((delta-3600*h)/60);h>24&&(h=23,m=59,self.checkEndTime()),self.timeHour.value=h>9?h:"0"+h,self.timeMin.value=m>9?m:"0"+m}else self.timeHour.value="00",self.timeMin.value="00";return autoCorrection&&(self.itemName.value=(self.startTimeHour.value<10&&"00"!==self.startTimeHour.value?"0"+Number(self.startTimeHour.value):self.startTimeHour.value)+":"+(self.startTimeMin.value<10&&"00"!==self.startTimeMin.value?"0"+Number(self.startTimeMin.value):self.startTimeMin.value)+":00"),!1},this.checkEndTime=function(){var hour=self.startTimeHour.value,min=self.startTimeMin.value,day=self.startTimeDay.value;self.timeHour.value=self.timeHour.value||"00",self.timeMin.value=self.timeMin.value||"00";var startTime=new Date(self.startTimeYear.value,self.startTimeMonth.value-1,day,hour,min),endTime=new Date(startTime.getTime()+1e3*(3600*self.timeHour.value+60*self.timeMin.value));min=endTime.getMinutes(),min=10>min?"0"+min:min,hour=endTime.getHours(),hour=10>hour?"0"+hour:hour,day=endTime.getDate(),day=10>day?"0"+day:day,month=endTime.getMonth()+1,month=10>month?"0"+month:month,self.endTimeHour.value=hour,self.endTimeMin.value=min,self.endTimeDay.value=day,self.endTimeMonth.value=month,self.endTimeYear.value=endTime.getFullYear()},function(obj){obj.channels=[],IPTVChannels.TVList.parentItem.data.forEach(function(item){item.data||obj.channels.push(item)}),obj.channels.forEach(function(item){item.label=item.name})}(this),this.refreshStorageInfo=function(){this.storage=[],getStorageInfo();var usb,i;for(i=0;i<STORAGE_INFO.length;i++)usb=STORAGE_INFO[i],0===usb.isReadOnly&&(usb.freeSizeGb=Math.floor(usb.freeSize/1024/1024/1024*100)/100,usb.sizeGb=Math.floor(usb.size/1024/1024/1024*100)/100,usb.id=i,this.storage.push(usb))},this.refreshStorageInfo(),echo(this.storage,"this.storage"),this.device=new CSelectBox(this,{data:this.storage.length>0?this.storage:[{id:-1,label:_("No storage device")}],nameField:"label",style:"cselect-box-wide",events:{onChange:function(){self.$freeSize.innerHTML=this.GetSelected().freeSizeGb||"0",self.$totlaSize.innerHTML=this.GetSelected().sizeGb||"0"}}}),this.$channels=new CSelectBox(this,{data:this.channels.length>0?this.channels:[{id:-1,label:_("No channels")}],nameField:"label",style:"cselect-box-wide"}),defParams.activeChannel)defParams.activeChannel.type===MEDIA_TYPE_STREAM&&this.$channels.SetIndex(this.channels.indexOf(defParams.activeChannel));else for(var i=0;i<this.channels.length;i++)IPTVChannels.TVList.activeItem.data.index&&IPTVChannels.TVList.parentItem.data[IPTVChannels.TVList.activeItem.data.index].type===MEDIA_TYPE_STREAM&&this.channels[i].url===IPTVChannels.TVList.parentItem.data[IPTVChannels.TVList.activeItem.data.index].url&&this.$channels.SetIndex(i);var html=element("table",{className:"main maxw"},[element("tr",{},[element("td",{className:"name"},_("Start recording:")),element("td",{className:"data"},[element("div",{className:"box"},[this.startTimeHour=element("input",{className:"time",type:"text",value:hour,maxLength:2,minValue:0,maxValue:23,oninput:this.parseTime,onchange:this.checkTime}),element("div",{className:"colon"},":"),this.startTimeMin=element("input",{className:"time",type:"text",value:min,maxLength:2,minValue:0,maxValue:59,oninput:this.parseTime,onchange:this.checkTime})]),element("div",{className:"box"},[this.startTimeDay=element("input",{className:"time",type:"text",value:day,maxLength:2,minValue:1,maxValue:31,oninput:this.parseTime,onchange:this.checkTime}),element("div",{className:"colon"},"."),this.startTimeMonth=element("input",{className:"time",type:"text",value:month,maxLength:2,minValue:1,maxValue:12,oninput:this.parseTime,onchange:this.checkTime}),element("div",{className:"colon"},"."),this.startTimeYear=element("input",{className:"data_time",type:"text",value:year,maxLength:4,minValue:1,maxValue:9999,oninput:this.parseTime,onchange:this.checkTime})])])]),element("tr",{},[element("td",{className:"name"},_("End recording:")),element("td",{className:"data"},[element("div",{className:"box"},[this.endTimeHour=element("input",{className:"time",type:"text",value:hour1,maxLength:2,minValue:0,maxValue:23,oninput:this.parseTime,onchange:this.checkTime}),element("div",{className:"colon"},":"),this.endTimeMin=element("input",{className:"time",type:"text",value:min1,maxLength:2,minValue:0,maxValue:59,oninput:this.parseTime,onchange:this.checkTime})]),element("div",{className:"box"},[this.endTimeDay=element("input",{className:"time",type:"text",value:day1,maxLength:2,minValue:1,maxValue:31,oninput:this.parseTime,onchange:this.checkTime}),element("div",{className:"colon"},"."),this.endTimeMonth=element("input",{className:"time",type:"text",value:month1,maxLength:2,minValue:1,maxValue:12,oninput:this.parseTime,onchange:this.checkTime}),element("div",{className:"colon"},"."),this.endTimeYear=element("input",{className:"data_time",type:"text",value:year1,maxLength:4,minValue:1,maxValue:9999,oninput:this.parseTime,onchange:this.checkTime})])])]),element("tr",{},[element("td",{className:"name"},_("Record length:")),element("td",{className:"data"},[element("div",{className:"box"},[this.timeHour=element("input",{className:"time",type:"text",value:"01",maxLength:2,minValue:0,maxValue:23,oninput:this.parseTime,onchange:this.checkEndTime}),element("div",{className:"colon"},":"),this.timeMin=element("input",{className:"time",type:"text",value:"00",maxLength:2,minValue:0,maxValue:59,oninput:this.parseTime,onchange:this.checkEndTime})])])]),element("tr",{},[element("td",{className:"name"},_("Channel:")),element("td",{className:"data"},this.$channels.parentNode)]),element("tr",{},[element("td",{className:"name"},_("Record name:")),element("td",{className:"data"},[this.itemName=element("input",{className:"wide",type:"text",value:defParams.name?defParams.name:hour+":"+min+":"+sec,change:!1,onchange:function(){},oninput:function(){this.change=!0,autoCorrection=!1}})])]),element("tr",{},[element("td",{className:"name"},_("Record in:")),element("td",{className:"data"},this.device.parentNode)]),element("tr",{},[element("td"),element("td",{className:"data"},[_("Free space:")+" ",this.$freeSize=element("span",{className:"size"},this.device.GetSelected().freeSizeGb||"0")," "+_("GB")+"   "+_("of")+" ",this.$totlaSize=element("span",{className:"size"},this.device.GetSelected().sizeGb||"0")," "+_("GB")])])]);this.focusList=[[this.startTimeHour,this.startTimeMin,this.startTimeDay,this.startTimeMonth,this.startTimeYear],[this.endTimeHour,this.endTimeMin,this.endTimeDay,this.endTimeMonth,this.endTimeYear],[this.timeHour,this.timeMin],[this.$channels],[this.itemName],[this.device]],this.startTimeHour.oninput=this.parseTime,this.focusPos=0,this.subFocusPos=0,this.FocusNext=function(event,manageVK){if(this.focusList.length>0){++this.focusPos>=this.focusList.length&&(this.focusPos=0);var el=this.focusList[this.focusPos][0];manageVK!==!1&&gSTB.HideVirtualKeyboard(),el.focus(),this.subFocusPos=0,event&&"SELECT"!==el.nodeName&&(event.preventDefault(),el.select&&el.select())}},this.FocusPrev=function(event,manageVK){if(this.focusList.length>0){--this.focusPos<0&&(this.focusPos=this.focusList.length-1);var el=this.focusList[this.focusPos][0];manageVK!==!1&&gSTB.HideVirtualKeyboard(),el.focus(),this.subFocusPos=0,"SELECT"!==el.nodeName&&(el.select&&el.select(),event.preventDefault())}},this.FocusRight=function(event){if(this.focusList[this.focusPos].length>1){++this.subFocusPos>=this.focusList[this.focusPos].length&&(this.subFocusPos=0);var el=this.focusList[this.focusPos][this.subFocusPos];el.focus(),"SELECT"!==el.nodeName&&(el.select&&el.select(),event&&event.preventDefault())}},this.FocusLeft=function(event){if(this.focusList[this.focusPos].length>1){--this.subFocusPos<0&&(this.subFocusPos=this.focusList[this.focusPos].length-1);var el=this.focusList[this.focusPos][this.subFocusPos];el.focus(),"SELECT"!==el.nodeName&&(el.select&&el.select(),event&&event.preventDefault())}},this.startPVR=function(){if(self.$channels.GetSelected().id<0)return void new CModalHint(currCPage,_("Channel list is empty"),3e3);var arr,inProgress=0;try{arr=JSON.parse(pvrManager.GetAllTasks())}catch(e){arr=[]}if(arr.forEach(function(item){2===item.state&&inProgress++}),inProgress>=5)return void new CModalHint(currCPage,_("Error. Too many active records."),3e3);if(0===self.device.GetSelected().freeSize)return void new CModalHint(currCPage,_("Not enough disk space"),3e3);var url=self.$channels.GetSelected().url.replace(/@/gim,""),devPath=self.device.GetSelected().mountPath,chanName=self.$channels.GetSelected().name.replace(/\/|\*|:|\\|\?|\||'|&|"|\^|%|<|>/gim,"");echo(url,"SELECTED CHANNEL IS"),gSTB.ExecAction('make_dir "'+devPath+'/records"'),gSTB.ExecAction('make_dir "'+devPath+"/records/"+chanName+'"'),gSTB.ExecAction('make_dir "'+devPath+"/records/"+chanName+"/"+this.startTimeYear.value+"-"+this.startTimeMonth.value+"-"+this.startTimeDay.value+'"');var name=devPath+"/records/"+chanName+"/"+this.startTimeYear.value+"-"+this.startTimeMonth.value+"-"+this.startTimeDay.value+"/"+this.itemName.value.split(":").join("-").replace(/\/|\*|:|\\|\?|\||'|&|"|\^|%|<|>/gim,"")+".ts",hour=self.startTimeHour.value,min=self.startTimeMin.value,day=self.startTimeDay.value,mon=self.startTimeMonth.value-1,year=self.startTimeYear.value,startTime=new Date(year,mon,day,hour,min),hourE=self.endTimeHour.value,minE=self.endTimeMin.value,dayE=self.endTimeDay.value,monE=self.endTimeMonth.value-1,yearE=self.endTimeYear.value,endTime=new Date(yearE,monE,dayE,hourE,minE),done=pvrManager.CreateTask(url,name,startTime.getTime()/1e3,endTime.getTime()/1e3);
if(echo("DONE:"+done),0>done){var text;switch(done){case"-2":text=_("Not enough disk space");break;case"-3":text=_("Incorrect time");break;case"-5":text=_("Wrong name or path");break;case"-6":text=_("Duplicated file");break;case"-7":text=_("Wrong URL");break;case"-9":text=_("Too many active records processed");break;case"-11":text=_("Not enough disk space");break;default:text=_("Error...")}new CModalHint(currCPage,text,3e3)}else parent===IPTVChannels&&IPTVChannels.pvr.start(),self.Show(!1)},this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_("Start recording"),function(){self.startPVR()}),this.SetHeader(label),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.onShow=function(){self.focusList[self.focusPos][0].focus(),self.focusList[self.focusPos][0].select()},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.onMountAction=function(){echo("IPTV-modals->onMountAction"),this.refreshStorageInfo(),this.device.SetData(this.storage.length>0?this.storage:[{id:-1,label:_("No storage device")}]),this.$freeSize.innerHTML=currCPage.device.GetSelected().freeSizeGb||"0",this.$totlaSize.innerHTML=currCPage.device.GetSelected().sizeGb||"0"},this.EventHandler=function(event){if(eventPrepare(event,!0,"CModalAlert")&&(document.activeElement.component&&document.activeElement.component.constructor===CSelectBox&&document.activeElement.component.EventHandler(event),event.stopped!==!0))switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;case KEYS.UP:self.FocusPrev(event,!1),event.preventDefault();break;case KEYS.DOWN:self.FocusNext(event,!1),event.preventDefault();break;case KEYS.LEFT:self.FocusLeft(event);break;case KEYS.RIGHT:self.FocusRight(event);break;case KEYS.PAGE_UP:document.activeElement.value>=document.activeElement.minValue&&document.activeElement.value<document.activeElement.maxValue&&(document.activeElement.value++,document.activeElement.onchange(),document.activeElement.value<10&&(document.activeElement.value="0"+document.activeElement.value));break;case KEYS.PAGE_DOWN:document.activeElement.value>document.activeElement.minValue&&document.activeElement.value<=document.activeElement.maxValue&&(document.activeElement.value--,document.activeElement.onchange(),document.activeElement.value<10&&(document.activeElement.value="0"+document.activeElement.value));break;case KEYS.VOLUME_DOWN:case KEYS.VOLUME_UP:event.preventDefault();break;default:self.bpanel.EventHandler(event)}},this.Init(),this.Show(!0)}function CModalChannelEdit(parent,item,data){CModalBox.call(this,parent);var self=this;this.name="CModalChannelEdit";var html=null;html=item.data.type===MEDIA_TYPE_GROUP?element("table",{className:"main maxw"},[element("tr",{},[element("td",{className:"name"},_("Name :")),element("td",{className:"data"},this.chName=element("input",{type:"text",value:data.name}))])]):element("table",{className:"main maxw"},[element("tr",{},[element("td",{className:"name"},_("Name :")),element("td",{className:"data"},this.chName=element("input",{type:"text",value:data.name}))]),element("tr",{},[element("td",{className:"name"},_("URL :")),element("td",{className:"data"},this.chURL=element("input",{type:"text",value:(data.sol&&""!==data.sol?data.sol+" ":"")+data.url}))])]),this.focusList=[this.chName,this.chURL],this.focusPos=0,this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_("Save"),function(){var idx,baseUrl,arr=[];if(data.name=self.chName.value,item.data.type===MEDIA_TYPE_STREAM){if(arr=self.chURL.value.trim().split(" "),arr.length>1)for(idx=0;idx<arr.length;idx+=1)if(validateUrl(arr[idx],!1,!1,!1)){baseUrl=arr[idx];break}if(!(validateUrl(self.chURL.value,!0,!0,!1)||arr.length>1&&(!idx||1===idx&&validateUrl(arr[0]+" "+baseUrl,!0,!1,!1))))return void new CModalHint(self,_("Wrong field data"),4e3);data.url=self.chURL.value,data.sol&&(data.sol=""),item.data.url=data.url,IPTVChannels.domURL.innerHTML=data.url,data.changed=!0;var tempList=[JSON.parse(JSON.stringify(IPTVChannels.TVList.parentItem.data[item.data.index]))];tempList=IPTVChannels.checkSolution(tempList,!0),tempList=IPTVChannels.checkTS_data(tempList.a,!0),data=tempList.a[0],IPTVChannels.TVList.parentItem.data[item.data.index]=data,item.children[2].className=data.tsOn&&configuration.mayTimeShift?"timeshift tsOn":"timeshift",IPTVChannels.TVList.timer.OnFocusPlay=setTimeout(function(){MediaPlayer.preparePlayer(data,IPTVChannels,!0,!1,!0)},100)}item.data.name=data.name,item.children[1].innerHTML=data.name,IPTVChannels.needSave=!0,IPTVChannels.domInfoTitle.innerHTML=data.name,self.Show(!1)}),this.SetHeader(_("Edit")),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.onShow=function(){self.focusList[self.focusPos].focus()},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if(eventPrepare(event,!0,"CModalChannelEdit"))switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;case KEYS.UP:self.FocusPrev(event,!1),event.preventDefault();break;case KEYS.DOWN:self.FocusNext(event,!1),event.preventDefault();break;case KEYS.LEFT:case KEYS.RIGHT:break;default:self.bpanel.EventHandler(event)}},this.Init(),this.Show(!0)}function CModalChannelExport(parent,data){CModalBox.call(this,parent);var html,self=this,pathList=[];if(this.name="CModalChannelExport",STORAGE_INFO.length>0)for(var i=0;i<STORAGE_INFO.length;i++){var name=STORAGE_INFO[i].label,value=STORAGE_INFO[i].mountPath;pathList.push({name:name,id:value})}else pathList.push({title:_("None"),value:""});this.path=new CSelectBox(this,{data:pathList,parent:element("div",{className:"control"})}),this.tree=new CCheckBox(this,{parent:element("div",{className:"control"}),checked:!0}),html=element("table",{className:"main maxw"},[element("tr",{},[element("td",{className:"name"},_("File location:")),element("td",{className:"data"},this.path.parentNode)]),element("tr",{},[element("td",{className:"name"},_("File name:")),element("td",{className:"data"},this.file=element("input",{type:"text",value:""}))]),element("tr",{},[element("td",{className:"name"},_("Save from groups:")),element("td",{className:"data"},this.tree.handle)])]),this.focusList=[this.path,this.file,this.tree],this.focusPos=0,this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_("Save"),function(){var good,text=[];if(""===self.path.GetValue()||""===self.file.value)return void new CModalHint(self,_("Wrong field data"),4e3);"function"==typeof parent.exportChannels&&(text=parent.exportChannels(data,self.tree.IsChecked()));try{good=gSTB.SaveFile(self.path.GetValue()+"/"+self.file.value+".m3u",text)}catch(e){echo(e,"SaveFile"),good=!1}return good?(self.Show(!1),void new CModalHint(currCPage,_("Successfully exported"),4e3)):void new CModalHint(self,_("Save error"),4e3)}),this.SetHeader(_("Export channels")),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.onShow=function(){self.focusList[self.focusPos].focus()},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if("function"==typeof this.focusList[this.focusPos].EventHandler&&this.focusList[this.focusPos].EventHandler(event),event.stopped!==!0)switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;case KEYS.UP:self.FocusPrev(event,!1),event.preventDefault();break;case KEYS.DOWN:self.FocusNext(event,!1),event.preventDefault();break;case KEYS.LEFT:case KEYS.RIGHT:break;default:self.bpanel.EventHandler(event)}},this.Init(),this.Show(!0)}function CModalChannelsAdd(parent,IsItPlaylist){CModalBox.call(this,parent);var self=this;this.name="CModalChannelsAdd",this.focusList=[];var $html=element("table",{className:"main maxw"}),playListHint="",encs=["utf-8","cp1250","cp1251","cp1252","cp1253","cp1254","cp1254","cp1255","cp1256","cp1257","cp1258","iso8859-1","iso8859-2","iso8859-3","iso8859-4","iso8859-5","iso8859-6","iso8859-7","iso8859-8","iso8859-9","iso8859-10","iso8859-11","iso8859-12","iso8859-13","iso8859-14","iso8859-15","iso8859-16"];if(IsItPlaylist){try{playListHint=JSON.parse(gSTB.GetEnv(JSON.stringify({varList:["playlist_url"]}))).result.playlist_url}catch(e){echo("Something wrong with last used playlist URL -> "+e),playListHint=""}self.list=new CSelectBox(this,{data:encs,style:"subtitles"}),elchild($html,element("tr",{},[element("td",{className:"name"},_("File encoding:")),element("td",{className:"data"},self.list.parentNode)])),this.focusList.push(self.list)}else elchild($html,element("tr",{},[element("td",{className:"name"},_("Name :")),element("td",{className:"data"},self.chName=element("input",{type:"text",value:"",className:"wide"}))])),this.focusList.push(self.chName);elchild($html,element("tr",{},[element("td",{className:"name"},_("URL :")),element("td",{className:"data"},self.chURL=element("input",{type:"text",value:playListHint,className:"wide"}))])),this.focusList.push(this.chURL),this.focusPos=0,this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_("Save"),function(){var xmlhttp,income,extension,idx,baseUrl,arr=self.chURL.value.trim().split(" ");if(arr.length>1)for(idx=0;idx<arr.length;idx+=1)if(validateUrl(arr[idx],!1,!1,!1)){baseUrl=arr[idx];break}if(validateUrl(self.chURL.value,!0,!0,!1)||arr.length>1&&(!idx||1===idx&&validateUrl(arr[0]+" "+baseUrl,!0,!1,!1)))if(IsItPlaylist)xmlhttp=new XMLHttpRequest,xmlhttp.overrideMimeType("text/html; charset="+self.list.value),xmlhttp.open("GET",self.chURL.value,!1),xmlhttp.send(null),echo(xmlhttp.responseText,"response from list"),income=xmlhttp.responseText,extension=self.chURL.value.substring(self.chURL.value.length-3,self.chURL.value.length),income=MediaBrowser.ParsePlaylist(extension,income),IPTVChannels.TVList.addChannelsToList(IPTVChannels.TVList.parentItem.data,income,!0),IPTVChannels.needSave=!0,gSTB.SetEnv(JSON.stringify({playlist_url:self.chURL.value})),self.Show(!1);else{var in_object=[{name:self.chName.value,url:self.chURL.value,type:MEDIA_TYPE_STREAM}];IPTVChannels.TVList.addChannelsToList(IPTVChannels.TVList.parentItem.data,in_object,!1),IPTVChannels.TVList.Focused(IPTVChannels.TVList.handle.children[IPTVChannels.TVList.handle.children.length-1],!0),IPTVChannels.needSave=!0,self.Show(!1)}else new CModalHint(self,_("Wrong field data"),4e3)});var header=_(IsItPlaylist?"Add IPTV list":"Add IPTV channel");this.SetHeader(header),this.SetContent($html),this.SetFooter(this.bpanel.handle),this.onShow=function(){self.focusList[self.focusPos].focus()},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if(eventPrepare(event,!0,"CModalAlert")&&("function"==typeof this.focusList[this.focusPos].EventHandler&&this.focusList[this.focusPos].EventHandler(event),event.stopped!==!0))switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;case KEYS.UP:self.FocusPrev(event,!1),event.preventDefault();break;case KEYS.DOWN:self.FocusNext(event,!1),event.preventDefault();break;case KEYS.LEFT:case KEYS.RIGHT:break;default:self.bpanel.EventHandler(event)}},this.Init(),this.Show(!0)}function CModalImportTVChannels(parent){CModalBox.call(this,parent),this.name="CModalImportTVChannels";var self=this;this.step1=new CSelectBox(this,{data:[{id:"",name:_("Select country...")}],parent:element("div"),events:{onChange:function(){this.GetValue()&&self.step2.startAction(this.GetValue()),self.step3.GetValue()!==_("Select operator...")&&self.step3.SetData([{id:"",name:_("Select operator...")}]),self.step2.GetValue()!==_("Select city...")&&self.step2.SetData([{id:"",name:_("Select city...")}])}}}),this.step2=new CSelectBox(this,{data:[{id:"",name:_("Select city...")}],parent:element("div"),events:{onChange:function(){this.GetValue()&&self.step3.startAction(self.step2.GetValue())}}}),this.step3=new CSelectBox(this,{data:[{id:"",name:_("Select operator...")}],parent:element("div")});var html=element("table",{className:"main maxw CModalImportTVChannels"},[element("tr",{},[element("td",{className:"name"},_("Country:")),element("td",{className:"data"},this.step1.parentNode)]),element("tr",{},[element("td",{className:"name"},_("City:")),element("td",{className:"data"},this.step2.parentNode)]),element("tr",{},[element("td",{className:"name"},_("Operator:")),element("td",{className:"data"},this.step3.parentNode)])]);self.focusList=[self.step1,self.step2,self.step3],ajax("GET",configuration.url.operatorsTVList+"country/",function(countries){countries.results.unshift({id:"",name:_("Select country...")}),self.step1.SetData(countries.results)},{},"json"),this.step2.startAction=function(country_id){ajax("GET",configuration.url.operatorsTVList+"country_cities/"+country_id,function(cities){cities.results.unshift({id:"",name:_("Select city...")}),self.step2.SetData(cities.results)},{},"json")},this.step3.startAction=function(city_id){ajax("GET",configuration.url.operatorsTVList+"city_isp/"+city_id,function(operators){operators.results.unshift({id:"",name:_("Select operator...")}),self.step3.SetData(operators.results)},{},"json")},this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_("Save"),function(){if(self.step3.GetValue())try{var value=self.step3.GetSelected().playlist;ajax("GET",value,function(income){self.Show(!1);var extencion=value.substring(value.length-3,value.length);income=MediaBrowser.ParsePlaylist(extencion,income),IPTVChannels.TVList.addChannelsToList(IPTVChannels.TVList.parentItem.data,income,!0)},{},"text")}catch(err){new CModalHint(self,_("Bad playlist file"),4e3)}else new CModalHint(self,_("Wrong field data"),4e3);return!1}),this.SetHeader(_("Loading operator playlist")),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.onShow=function(){setTimeout(function(){self.step1.focus()},100)},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if("function"==typeof this.focusList[this.focusPos].EventHandler&&this.focusList[this.focusPos].EventHandler(event),event.stopped!==!0)switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;case KEYS.UP:self.FocusPrev(event,!1),event.preventDefault();break;case KEYS.DOWN:self.FocusNext(event,!1),event.preventDefault();break;case KEYS.RIGHT:case KEYS.LEFT:event.preventDefault();break;default:self.bpanel.EventHandler(event)}},this.Init(),this.SetContent(html),this.Show(!0)}function CModalScanDVB(parent){function changeType(input){var data=[],domArr=[];for(inputNumber=input?input:inputNumber,checkedType=DVBChannels.inputs[inputNumber].currentScanTypes,i=0;i<checkedType.length;i++)data.push({name:dvbTypes[checkedType[i]],value:checkedType[i]});if(oldType!==checkedType[0]){switch(oldType=checkedType[0]){case DVBChannels.inputs[inputNumber].TYPE_DVB_C:switch(model){case"IM2102":break;default:domArr=[element("tr",{},[element("td",{className:"name"},_("Symbol rate:")),element("td",{className:"data"},self.stepSRate.parentNode)]),element("tr",{},[element("td",{className:"name"},_("Modulation:")),element("td",{className:"data"},self.stepModul.parentNode)])],self.focusList=[self.stepSRate,self.stepModul]}break;case DVBChannels.inputs[inputNumber].TYPE_DVB_T:case DVBChannels.inputs[inputNumber].TYPE_DVB_T2:case DVBChannels.inputs[inputNumber].TYPE_DVB_S2:}data.length>1&&(self.stepType=new CSelectBox(self,{data:data,idField:"value",nameField:"name",parent:element("div"),events:{onChange:function(){changeType()}},selected:checkedType[0],name:"type"}),domArr.unshift(element("tr",{},[element("td",{className:"name"},_("DVB type:")),element("td",{className:"data"},self.stepType.parentNode)])),self.focusList.unshift(self.stepType)),DVBChannels.inputs.length>1&&(domArr.splice(0,0,element("tr",{},[element("td",{className:"name"},_("Antenna")+":"),element("td",{className:"data"},self.stepAntenna.parentNode)])),self.focusList.splice(0,0,self.stepAntenna)),html=element("table",{className:"main maxw CModalScanDVB"},domArr),self.SetContent(html),self.focusList.length&&self.focusList[0].focus()}}var html,data,oldType,i,self=this,checkedType=[],model=gSTB.GetDeviceModelExt(),inputNumber=0;if(CModalBox.call(this,parent),this.name="CModalScanDVB",DVBChannels.inputs.length>1){data=[];for(var i=0;i<DVBChannels.inputs.length;i++)data.push({value:i,name:_("Antenna")+" "+(i+1)});this.stepAntenna=new CSelectBox(this,{data:data,idField:"value",nameField:"name",parent:element("div"),events:{onChange:function(){changeType(this.GetValue())}},selected:0})}this.stepSRate=new CIntervalBox(SettingsPage,{parent:element("div"),max:7200,min:870,interval:1,value:6875,style:"elements"}),this.stepModul=new CSelectBox(this,{data:[{value:0,name:_("Auto")},{value:1,name:"16 QAM"},{value:2,name:"32 QAM"},{value:3,name:"64 QAM"},{value:4,name:"128 QAM"},{value:5,name:"256 QAM"}],idField:"value",nameField:"name",parent:element("div"),events:{onChange:function(){}},selected:0}),this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_("Scan"),function(){var type,config={};switch(self.stepType?config.type=type=self.stepType.GetValue():config.type=type=checkedType[0],type){case DVBChannels.inputs[inputNumber].TYPE_DVB_C:switch(model){case"IM2102":break;default:config.symbolRate=1e3*self.stepSRate.GetValue(),config.modulation=self.stepModul.GetValue()}config.scanMode=0,config.networkId=0;default:DVBChannels.startScan(config,inputNumber)}return self.Show(!1),!1}),this.SetHeader(_("Start scanning")),changeType(),this.SetFooter(this.bpanel.handle),this.onShow=function(){setTimeout(function(){self.focusList.length&&self.focusList[0].focus()},100)},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if(this.focusList[this.focusPos]&&"function"==typeof this.focusList[this.focusPos].EventHandler&&this.focusList[this.focusPos].EventHandler(event),event.stopped!==!0)switch(event.code){case KEYS.UP:self.FocusPrev(event,!1),event.preventDefault();break;case KEYS.DOWN:self.FocusNext(event,!1),event.preventDefault();break;default:self.bpanel.EventHandler(event)}},this.Init(),this.Show(!0)}function CModalManualScanDVB(parent){function changeType(input){var html,data=[],domArr=[];for(inputNumber=input?input:inputNumber,checkedType=DVBChannels.inputs[inputNumber].currentScanTypes,i=0;i<checkedType.length;i++)data.push({name:dvbTypes[checkedType[i]],value:checkedType[i]});if(oldType!==checkedType[0]){switch(oldType=checkedType[0]){case DVBChannels.inputs[inputNumber].TYPE_DVB_C:switch(model){case"IM2102":domArr=[element("tr",{},[element("td",{className:"name"},_("Frequency (KHz):")),element("td",{className:"data"},self.stepFreq.parentNode)])],self.focusList=[self.stepFreq];break;default:domArr=[element("tr",{},[element("td",{className:"name"},_("Frequency (KHz):")),element("td",{className:"data"},self.stepFreq.parentNode)]),element("tr",{},[element("td",{className:"name"},_("Symbol rate:")),element("td",{className:"data"},self.stepSRate.parentNode)]),element("tr",{},[element("td",{className:"name"},_("Modulation:")),element("td",{className:"data"},self.stepModul.parentNode)]),element("tr",{},[element("td",{className:"name"},_("Network ID:")),element("td",{className:"data"},self.stepNetId)])],self.focusList=[self.stepFreq,self.stepSRate,self.stepModul,self.stepNetId]}break;case DVBChannels.inputs[inputNumber].TYPE_DVB_T:case DVBChannels.inputs[inputNumber].TYPE_DVB_T2:domArr=[element("tr",{},[element("td",{className:"name"},_("DVB type:")),element("td",{className:"data"},self.stepType.parentNode)]),element("tr",{},[element("td",{className:"name"},_("Frequency (KHz):")),element("td",{className:"data"},self.stepFreq.parentNode)]),element("tr",{},[element("td",{className:"name"},_("Bandwidth (MHz):")),element("td",{className:"data"},self.stepBand.parentNode)])],self.focusList=[self.stepType,self.stepFreq,self.stepBand];break;case DVBChannels.inputs[inputNumber].TYPE_DVB_S2:domArr=[element("tr",{},[element("td",{className:"name"},_("Frequency from(KHz):")),element("td",{className:"data"},self.stepFreqFrom.parentNode)]),element("tr",{},[element("td",{className:"name"},_("Frequency to(KHz):")),element("td",{className:"data"},self.stepFreqTo.parentNode)])],self.focusList=[self.stepFreqFrom,self.stepFreqTo]}data.length>1&&(self.stepType=new CSelectBox(self,{data:data,idField:"value",nameField:"name",parent:element("div"),events:{onChange:function(){changeType()}},selected:checkedType[0],name:"type"}),domArr.unshift(element("tr",{},[element("td",{className:"name"},_("DVB type:")),element("td",{className:"data"},self.stepType.parentNode)])),self.focusList.unshift(self.stepType)),DVBChannels.inputs.length>1&&(domArr.splice(0,0,element("tr",{},[element("td",{className:"name"},_("Antenna")+":"),element("td",{className:"data"},self.stepAntenna.parentNode)])),self.focusList.splice(0,0,self.stepAntenna)),html=element("table",{className:"main maxw CModalScanDVB"},domArr),self.SetContent(html),self.focusList.length&&self.focusList[0].focus()}}var data,oldType,self=this,model=gSTB.GetDeviceModelExt(),checkedType=[],inputNumber=0;if(CModalBox.call(this,parent),this.name="CModalManualScanDVB",DVBChannels.inputs.length>1){data=[];for(var i=0;i<DVBChannels.inputs.length;i++)data.push({value:i,name:_("Antenna")+" "+(i+1)});this.stepAntenna=new CSelectBox(this,{data:data,idField:"value",nameField:"name",parent:element("div"),events:{onChange:function(){changeType(this.GetValue())}},selected:0})}this.stepFreq=new CIntervalBox(SettingsPage,{parent:element("div"),max:86e4,min:5e4,interval:500,value:CModalManualScanDVBtext,style:"elements"}),this.stepFreqFrom=new CIntervalBox(SettingsPage,{parent:element("div"),max:1275e4,min:107e5,interval:1e3,value:CModalManualScanDVBtext,events:{onChange:function(){this.GetValue()>self.stepFreqTo.GetValue()&&self.stepFreqTo.SetValue(this.GetValue())}},style:"elements"}),this.stepFreqTo=new CIntervalBox(SettingsPage,{parent:element("div"),max:1275e4,min:107e5,interval:1e3,value:CModalManualScanDVBtext,events:{onChange:function(){this.GetValue()<self.stepFreqFrom.GetValue()&&self.stepFreqFrom.SetValue(this.GetValue())}},style:"elements"}),this.stepBand=new CSelectBox(this,{data:[{id:6,name:"6"},{id:7,name:"7"},{id:8,name:"8"}],idField:"id",nameField:"name",parent:element("div"),events:{onChange:function(){}},selected:7}),this.stepSRate=new CIntervalBox(SettingsPage,{parent:element("div"),max:7200,min:870,interval:1,value:6875,style:"elements"}),this.stepModul=new CSelectBox(this,{data:[{value:0,name:_("Auto")},{value:1,name:"16 QAM"},{value:2,name:"32 QAM"},{value:3,name:"64 QAM"},{value:4,name:"128 QAM"},{value:5,name:"256 QAM"}],idField:"value",nameField:"name",parent:element("div"),events:{onChange:function(){}},selected:0}),this.stepNetId=element("input",{type:"text"}),this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_("Scan"),function(){var type,config={};switch(self.stepType?config.type=type=self.stepType.GetValue():config.type=type=checkedType[0],type){case DVBChannels.inputs[inputNumber].TYPE_DVB_C:switch(model){case"IM2102":config.networkId=0;break;default:config.symbolRate=1e3*self.stepSRate.GetValue(),config.modulation=self.stepModul.GetValue(),config.networkId=parseInt(self.stepNetId.value)||0}config.scanMode=2,config.frequency=self.stepFreq.GetValue(),DVBChannels.startScan(config,inputNumber);break;case DVBChannels.inputs[inputNumber].TYPE_DVB_T:case DVBChannels.inputs[inputNumber].TYPE_DVB_T2:CModalManualScanDVBtext=self.stepFreq.GetValue(),config.from=config.to=CModalManualScanDVBtext,config.bandwidth=self.stepBand.GetValue(),config.step=1e3,DVBChannels.startScan(config,inputNumber);break;case DVBChannels.inputs[inputNumber].TYPE_DVB_S:case DVBChannels.inputs[inputNumber].TYPE_DVB_S2:if(CModalManualScanDVBtext=self.stepFreqFrom.GetValue(),config.from=CModalManualScanDVBtext,self.stepFreqFrom.GetValue()>self.stepFreqTo.GetValue())return void new CModalHint(self,_("Wrong field data"),4e3);config.to=self.stepFreqTo.GetValue(),DVBChannels.startScan(config,inputNumber)}return self.Show(!1),!1}),this.SetHeader(_("Start scanning")),this.SetFooter(this.bpanel.handle),this.onShow=function(){setTimeout(function(){self.focusList.length&&self.focusList[0].focus()},100)},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if(this.focusList[this.focusPos]&&"function"==typeof this.focusList[this.focusPos].EventHandler&&this.focusList[this.focusPos].EventHandler(event),event.stopped!==!0)switch(event.code){case KEYS.UP:self.FocusPrev(event,!1),event.preventDefault();break;case KEYS.DOWN:self.FocusNext(event,!1),event.preventDefault();break;default:self.bpanel.EventHandler(event)}},this.Init(),changeType(),this.Show(!0)}function CModalInitEPGInfo(parent,id){var data,up,down;this.day=0,this.id=id;try{data=dvbManager.GetEPGSchedule(this.id,this.day)}catch(e){data="{}",echo(e.message)}if(echo(data,"epg shedule"),""===data||"{}"===data)return void new CModalHint(currCPage,_("EPG not available"),3e3);try{data=JSON.parse(data)}catch(e){data={},data.events=[],echo(e,"EPG parse error")}if(!data.events||0===data.events.length)return void new CModalHint(currCPage,_("EPG not available"),3e3);CModalBox.call(this,parent);var date=new Date;this.name="CModalInitEPGInfo";var self=this;this.EventHandler=function(event){switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;case KEYS.UP:case KEYS.DOWN:self.EPGList.EventHandler(event),event.preventDefault();break;case KEYS.RIGHT:event.preventDefault(),self.changeDay(1);break;case KEYS.LEFT:event.preventDefault(),self.changeDay(-1);break;case KEYS.PAGE_DOWN:self.domText.scrollTop+=self.domText.offsetHeight,event.preventDefault();break;case KEYS.PAGE_UP:self.domText.scrollTop-=self.domText.offsetHeight,event.preventDefault();break;case KEYS.INFO:case KEYS.EPG:case KEYS.EXIT:self.Show(!1)}},this.changeDay=function(a){var data;this.day+=a,this.day<0&&(this.day=0);var date=new Date,time=date.getTime();date.setTime(time+864e5*this.day),this.domDay.innerHTML=date.getDate()+" "+fullMonthNames[date.getMonth()];try{data=dvbManager.GetEPGSchedule(this.id,this.day)}catch(e){data="",echo(e.message)}if(""===data||"{}"===data)return void this.EPGList.Clear();try{data=JSON.parse(data)}catch(e){this.EPGList.Clear(),data={},data.events=[],echo(e,"EPG parse error")}return data.events&&0!==data.events.length?(this.EPGList.data=data.events,void this.EPGList.Open({type:MEDIA_TYPE_EPG_ROOT})):void this.EPGList.Clear()},this.Init(),this.handle.querySelector(".cmodal-body").className+=" "+this.name,elchild(this.handle.querySelector(".cmodal-content"),[element("div",{className:"header"},[element("div",{className:"left"},_("The program for:")),element("a",{},[element("div",{className:"day_left"})]),this.domDay=element("div",{className:"left"},date.getDate()+" "+fullMonthNames[date.getMonth()]),element("a",{},[element("div",{className:"day_right"})])]),this.domList=element("div",{className:"list"}),element("div",{className:"rightBlock"},[up=element("div",{className:"textUp"}),this.domText=element("div",{className:"text"}),down=element("div",{className:"textDown"})])]),configuration.newRemoteControl,up.style.backgroundImage="url("+PATH_IMG_SYSTEM+"buttons/new/pgup.png)",down.style.backgroundImage="url("+PATH_IMG_SYSTEM+"buttons/new/pgdown.png)",this.EPGList=new EPGList(this),this.EPGList.Init(this.domList),this.EPGList.data=data.events,this.onHide=function(){self.Free()},this.Show(!0),this.EPGList.Open({type:MEDIA_TYPE_EPG_ROOT})}function CModalEPGInfo(parent,data){var date,self=this;CModalBox.call(this,parent),date=new Date,this.name="CModalEPGInfo",this.EventHandler=function(event){switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;case KEYS.PAGE_DOWN:self.domText.scrollTop+=self.domText.offsetHeight,event.preventDefault();break;case KEYS.PAGE_UP:self.domText.scrollTop-=self.domText.offsetHeight,event.preventDefault();break;case KEYS.UP:self.domText.scrollTop-=100,event.preventDefault();break;case KEYS.DOWN:self.domText.scrollTop+=100,event.preventDefault();break;case KEYS.OK:case KEYS.EXIT:self.Show(!1)}},this.Init(),this.handle.querySelector(".cmodal-body").className+=" "+this.name,elchild(this.handle.querySelector(".cmodal-content"),[element("div",{className:"rightBlock"},[this.domText=element("div",{className:"text"})])]),this.domText.innerHTML=data.info+(data.details?"<p>"+data.details+"</p>":""),this.Show(!0)}function EPGList(parent){CScrollList.call(this,parent),this.data=[]}function CModalAntennaPower(parent,input){var html,data,self=this;CModalBox.call(this,parent),this.name="CModalAntennaPower",DVBChannels.inputs[input].currentScanTypes,this.focusList=[],this.focusPos=0,2===data[0]||3===data[0]?(this.step1=new CCheckBox(this,{parent:element("div",{className:"control"}),checked:dvbManager.GetAntennaPower(input)}),html=element("table",{className:"main maxw CModalScanDVB"},[element("tr",{},[element("td",{className:"name"},_("DVB type:")),element("td",{className:"data"},data[0].name)]),element("tr",{},[element("td",{className:"name"},_("Antenna power supply")+":"),element("td",{className:"data"},this.step1.handle)])]),this.focusList=[this.step1]):html=element("table",{className:"main maxw CModalScanDVB"},[element("tr",{},[element("td",{className:"name"},_("DVB type:")),element("td",{className:"data"},data[0])])]),this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_("Save"),function(){return DVBChannels.inputs[input].antennaPower=self.step1.IsChecked(),self.Show(!1),!1}),this.onShow=function(){setTimeout(function(){self.step1&&self.step1.focus()},100)},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if(event.preventDefault(),this.focusList.length&&"function"==typeof this.focusList[this.focusPos].EventHandler&&this.focusList[this.focusPos].EventHandler(event),event.stopped!==!0)switch(event.code){case KEYS.UP:self.FocusPrev(event,!1),event.preventDefault();break;case KEYS.DOWN:self.FocusNext(event,!1),event.preventDefault();break;default:self.bpanel.EventHandler(event)}},this.Init(),this.SetHeader(_("Antenna")+" "+(input+1)),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.Show(!0)}function CModalStartPlay(parent){CModalBox.call(this,parent),this.name="CModalStartPlay";var domArr,self=this,max=9999999,min=1;this.step1=new CIntervalBox(SettingsPage,{parent:element("div"),max:max,min:min,interval:1,value:min,style:"elements"}),this.focusList=[this.step1],domArr=[element("tr",{},[element("td",{className:"name"},_("Program number:")),element("td",{className:"data"},this.step1.parentNode)])];var html=element("table",{className:"main maxw CModalScanDVB"},domArr);this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_("Scan"),function(){var program=self.step1.GetValue();self.Show(!1),MediaBrowser.FileList.fileBrowser.open(MediaBrowser.FileList.activeItem.data,null,{
program:program})}),this.SetHeader(_("Select program")),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.onShow=function(){setTimeout(function(){self.focusList[0].focus()},100)},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if("function"==typeof this.focusList[this.focusPos].EventHandler&&this.focusList[this.focusPos].EventHandler(event),event.stopped!==!0)switch(event.code){case KEYS.UP:self.FocusPrev(event,!1),event.preventDefault();break;case KEYS.DOWN:self.FocusNext(event,!1),event.preventDefault();break;default:self.bpanel.EventHandler(event)}},this.Init(),this.SetContent(html),this.Show(!0)}function CModalAntennaPower(parent,input){var html,data,self=this;CModalBox.call(this,parent),this.name="CModalAntennaPower",data=input.currentScanTypes,this.focusList=[],this.focusPos=0,input.capabilities.antennaPower?(this.step1=new CCheckBox(this,{parent:element("div",{className:"control"}),checked:input.antennaPower}),html=element("table",{className:"main maxw CModalScanDVB"},[element("tr",{},[element("td",{className:"name"},_("DVB type:")),element("td",{className:"data"},dvbTypes[data[0]||0])]),element("tr",{},[element("td",{className:"name"},_("Antenna power supply")+":"),element("td",{className:"data"},this.step1.handle)])]),this.focusList=[this.step1]):html=element("table",{className:"main maxw CModalScanDVB"},[element("tr",{},[element("td",{className:"name"},_("DVB type:")),element("td",{className:"data"},dvbTypes[data[0]||0])])]),this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_("Save"),function(){return input.antennaPower=self.step1.IsChecked(),self.Show(!1),!1}),this.onShow=function(){setTimeout(function(){self.step1&&self.step1.focus()},100)},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if(event.preventDefault(),this.focusList.length&&"function"==typeof this.focusList[this.focusPos].EventHandler&&this.focusList[this.focusPos].EventHandler(event),event.stopped!==!0)switch(event.code){case KEYS.UP:self.FocusPrev(event,!1),event.preventDefault();break;case KEYS.DOWN:self.FocusNext(event,!1),event.preventDefault();break;default:self.bpanel.EventHandler(event)}},this.Init(),this.SetHeader(_("Antenna")+" "+(input+1)),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.Show(!0)}function importStbParams(){var tv_data=gSTB.LoadUserData("iptv.json"),fv_data=gSTB.LoadUserData("favorites.json"),oldConfFile=gSTB.ReadCFG();if(echo("file iptv.json:"+tv_data),echo("file favorites.json:"+fv_data),echo("file stb_param:"+oldConfFile),oldConfFile){var files=[],tvLastChange,fvLastChange,oldConfLastChange,i,j,data,tv_text="",fv_text="";gSTB.SetListFilesExt("favorites.json iptv.json stb_params");try{eval(gSTB.ListDir("/mnt/Userfs",!0))}catch(e){echo(e),files=[]}oldConfLastChange=files[0]?Number(files[0].last_modified):0;try{eval(gSTB.ListDir("/mnt/Userfs/data",!0))}catch(e){echo(e),files=[]}if(fvLastChange=files[0]&&files[0].last_modified?Number(files[0].last_modified):0,tvLastChange=files[1]&&files[1].last_modified?Number(files[1].last_modified):0,gSTB.SetListFilesExt("."+configuration.registersTypes.join(" .")),echo("iptv LastChange="+tvLastChange+", fav LastChange="+fvLastChange+", oldConf LastChange="+oldConfLastChange),oldConfLastChange>=tvLastChange&&oldConfLastChange>=fvLastChange&&""!==oldConfFile){i=oldConfFile.indexOf("[TV Channels]"),-1!==i&&(j=oldConfFile.indexOf("[/TV Channels]"),-1!==j&&(tv_text=oldConfFile.substr(i+13,j-i-13))),i=oldConfFile.indexOf("[Favorites]"),-1!==i&&(j=oldConfFile.indexOf("[/Favorites]"),-1!==j&&(fv_text=oldConfFile.substr(i+11,j-i-11)));try{""!==tv_text&&void 0!==tv_text?(data=oldTV_to_new(eval(tv_text)),data=IPTVChannels.unescapeChanels(data),IPTVChannels.checkTS(data,!0)):IPTVChannels.saveChanels([])}catch(e){IPTVChannels.saveChanels([]),echo(e,"TVChannels parsing from the old file")}try{""!==fv_text&&void 0!==fv_text?(data=oldFV_to_new(eval(fv_text||"{}")),MediaBrowser.FavSave(data)):MediaBrowser.FavSave({})}catch(e){MediaBrowser.FavSave({}),echo(e,"Favorites parsing from the old file")}}gSTB.WriteCFG("")}else if(""!==tv_data&&""!==fv_data){try{tv_data=JSON.parse(tv_data),IPTVChannels.TVList.data=IPTVChannels.unescapeChanels(tv_data)}catch(e){echo(e,"TVChannels data parsing error"),IPTVChannels.saveChanels([])}try{FAVORITES=JSON.parse(fv_data);for(var name in FAVORITES)FAVORITES[name].markable=!0,FAVORITES_NEW[name]=FAVORITES[name]}catch(e){echo(e,"FAVORITES data parsing error"),FAVORITES={},FAVORITES_NEW={},gSTB.SaveUserData("favorites.json","{}")}}}function oldTV_to_new(data){for(var arr=[],i=0;i<data.length;i++)arr[i]={},arr[i].name=data[i].name||"",data[i].data?(arr[i].data=oldTV_to_new(data[i].data),arr[i].type=MEDIA_TYPE_GROUP):(arr[i].type=MEDIA_TYPE_STREAM,arr[i].url=data[i].source,arr[i].tsOn=data[i].tsOn||!1);return arr}function oldFV_to_new(data){var list={};return Array.isArray(data)&&data.forEach(function(item){var fav={};fav.name=unescape(item.name).trim(),fav.size=fav.size||0,fav.url=unescape(item.source).trim(),fav.markable=!0,"stream"===item.fileType?(fav.type=MEDIA_TYPE_STREAM,fav.tsOn="true"===item.tsOn,fav.ext=""):(fav.ext=fav.name.split(".").pop(),fav.type=MediaBrowser.FileList.ext2type[fav.ext.toLowerCase()]),list[fav.url]=fav}),list}function getLanguageNameByCode(code){var i,j,ref_codes;if(code.length)for(i=0;i<iso639.length;i++)for(ref_codes=iso639[i].code,j=0;j<ref_codes.length;j++)if(ref_codes[j]===code[0].toLowerCase())return code=[],code[0]=iso639[i].name,code[1]=i,code;return null}function getIso639LangCode(langArr){for(var code="",i=0;i<langArr.length;i++)if(langArr[i]){code=langArr[i];break}return code}function PlayList(parent){CScrollList.call(this,parent),this.bcrumb=null,this.sbar=null,this.filterType=MEDIA_TYPE_NONE,this.filterText="",this.mtypes=[],this.path=[],this.parentItem=null}var DEBUG=!0,DEBUG_NAME="",DEBUG_SERVER="",EMULATION=!1,PATH_MODE_WEB=!1,PATH_ROOT=null,PATH_SYSTEM=null,PATH_MEDIA="/media/",WINDOW_WIDTH=screen.width,WINDOW_HEIGHT=screen.height,URL_PARAMS={},initFound=!1,proxy;PATH_ROOT=location.pathname.split("/"),PATH_ROOT[PATH_ROOT.length-1]="",PATH_ROOT=PATH_ROOT.join("/"),PATH_ROOT=location.protocol+"//"+location.host+PATH_ROOT+PATH_BASE,PATH_SYSTEM=PATH_ROOT+"system/",document.location.search&&document.location.search.substring(1).split("&").forEach(function(part){part=part.split("="),2===part.length&&(URL_PARAMS[part[0]]=decodeURIComponent(part[1]))}),void 0===window.gSTB?(DEBUG=EMULATION=!0,DEBUG_SERVER=DEBUG_SERVER||localStorage.getItem("DEBUG_SERVER"),DEBUG_NAME=DEBUG_NAME||localStorage.getItem("DEBUG_NAME"),WINDOW_WIDTH=parseInt(URL_PARAMS.width,10)||window.outerWidth,WINDOW_HEIGHT=parseInt(URL_PARAMS.height,10)||window.outerHeight,document.write('<script type="text/javascript" src="'+PATH_SYSTEM+'gstb.js"></script>\n'),document.write('<script type="text/javascript" src="'+PATH_SYSTEM+'debug.js"></script>\n'),document.write('<script type="text/javascript" src="http://'+DEBUG_SERVER+':8800/file/client.js"></script>\n'),document.write('<script type="text/javascript">if ( window.proxyClient ) {proxy = new proxyClient();if ( DEBUG_NAME && DEBUG_SERVER ) proxy.init({name:"'+DEBUG_NAME+'", host:"'+DEBUG_SERVER+'"}); }</script>\n'),window.addEventListener("load",function(){document.body.style.backgroundColor="black"})):(gSTB.SetNativeStringMode(!0),function(){var vars=JSON.parse(gSTB.GetEnv(JSON.stringify({varList:["debug","debug_name","debug_server"]})));!vars.errMsg&&vars.result&&(DEBUG="1"===vars.result.debug,DEBUG&&!URL_PARAMS.nodebug&&(document.write('<script type="text/javascript" src="'+PATH_SYSTEM+'debug.js"></script>\n'),DEBUG_NAME=DEBUG_NAME||vars.result.debug_name,DEBUG_SERVER=DEBUG_SERVER||vars.result.debug_server,DEBUG_NAME&&DEBUG_SERVER&&"1"!==stbStorage.getItem("spyjs.active")&&document.write('<script type="text/javascript" src="http://'+DEBUG_SERVER+":8000/target/target-script-min.js#"+DEBUG_NAME+'"></script>\n')))}());var PATH_IMG_SYSTEM=PATH_SYSTEM+"img/"+WINDOW_WIDTH+"/",PATH_IMG_PUBLIC=PATH_ROOT+"public/img/"+WINDOW_WIDTH+"/",configuration=function(){var config={newRemoteControl:!1,allowMulticastUpdate:!1,videoOutputMode:[{value:"Auto",title:"Auto",translated:!1},{value:"PAL",title:"PAL (576i)",translated:!0},{value:"576p-50",title:"576p-50",translated:!0},{value:"720p-50",title:"720p-50",translated:!0},{value:"1080i-50",title:"1080i-50",translated:!0},{value:"1080p-50",title:"1080p-50",translated:!0},{value:"NTSC",title:"NTSC (480i)",translated:!0},{value:"720p-60",title:"720p-60",translated:!0},{value:"1080i-60",title:"1080i-60",translated:!0},{value:"1080p-60",title:"1080p-60",translated:!0}]},model=gSTB.GetDeviceModelExt(),control=null;switch(model){case"AuraHD2":case"AuraHD3":case"AuraHD8":case"MAG275":case"WR320":config.newRemoteControl=!0;break;case"MAG256":case"MAG257":config.videoOutputMode=[{value:"Auto",title:"Auto",translated:!1},{value:"PAL",title:"PAL (576i)",translated:!0},{value:"720p-50",title:"720p-50",translated:!0},{value:"1080i-50",title:"1080i-50",translated:!0},{value:"1080p-50",title:"1080p-50",translated:!0},{value:"NTSC",title:"NTSC (480i)",translated:!0},{value:"720p-60",title:"720p-60",translated:!0},{value:"1080i-60",title:"1080i-60",translated:!0},{value:"1080p-60",title:"1080p-60",translated:!0}];break;case"MAG351":case"MAG352":case"MAG424":case"MAG425":config.videoOutputMode=[{value:"Auto",title:"Auto",translated:!1},{value:"PAL",title:"PAL (576i)",translated:!0},{value:"576p-50",title:"576p-50",translated:!0},{value:"720p-50",title:"720p-50",translated:!0},{value:"1080i-50",title:"1080i-50",translated:!0},{value:"1080p-50",title:"1080p-50",translated:!0},{value:"NTSC",title:"NTSC (480i)",translated:!0},{value:"720p-60",title:"720p-60",translated:!0},{value:"1080i-60",title:"1080i-60",translated:!0},{value:"1080p-60",title:"1080p-60",translated:!0},{value:"3840x2160p50",title:"3840x2160p-50",translated:!0},{value:"3840x2160p60",title:"3840x2160p-60",translated:!0}]}try{control=JSON.parse(gSTB.GetEnv('{"varList":["controlModel"]}')),!control.errMsg&&control.result&&control.result.controlModel&&("SRC4513"===control.result.controlModel?config.newRemoteControl=!0:config.newRemoteControl=!1)}catch(e){echo(e,"controlModel parse")}return config}(),WINDOWS={PORTAL:"portal",HELP:"help",DOWNLOAD_MANAGER:"dlman",PVR:"recordsManager",BROWSER:"ibman",BROWSER_VIEW:"ibmanView",PORTALS_LOADER:"portalsLoader",SYSTEM_SETTINGS:"systemSettings"},KEYS={BACK:8,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,NUM0:48,DELETE:46,CHANNEL_PREV:1009,CHANNEL_NEXT:9,OK:13,EXIT:27,UP:38,DOWN:40,LEFT:37,RIGHT:39,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,VOLUME_UP:107,VOLUME_DOWN:109,F1:112,F2:113,F3:114,F4:115,REFRESH:116,FRAME:117,PHONE:119,EPG:119,SET:120,TV:121,MENU:122,WEB:123,MIC:2032,REWIND:2066,FORWARD:2070,APP:2076,USB_MOUNTED:2080,USB_UNMOUNTED:2081,PLAY_PAUSE:2082,STOP:2083,POWER:2085,RECORD:2087,INFO:2089,MUTE:2192,CLOCK:2032,AUDIO:2071,KEYBOARD:2076},gettext=function(){var module={},data=null;return module.init=function(options,onReady){options.name=options.name||"en",options.ext=options.ext||"js",options.path=options.path||"lang",data=null,"en"!==options.name?loadScript(options.path+"/"+options.name+"."+options.ext,onReady,onReady):"function"==typeof onReady&&onReady()},module.load=function(input){data=input},module.data=function(key){return null===data?key:void 0!==data[key]?data[key]:key},module}(),_=gettext.data;if(void 0===window.echo&&(window.echo=function(data,title){}),ajax.stop=!1,parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},!("classList"in document.documentElement)){var prototype=Array.prototype,indexOf=prototype.indexOf,slice=prototype.slice,push=prototype.push,splice=prototype.splice,join=prototype.join;window.DOMTokenList=function(el){if(this._element=el,el.className!==this._classCache){if(this._classCache=el.className,!this._classCache)return;var i,classes=this._classCache.replace(/^\s+|\s+$/g,"").split(/\s+/);for(i=0;i<classes.length;i++)push.call(this,classes[i])}},window.DOMTokenList.prototype={add:function(token){this.contains(token)||(push.call(this,token),this._element.className=slice.call(this,0).join(" "))},contains:function(token){return-1!==indexOf.call(this,token)},item:function(index){return this[index]||null},remove:function(token){var i=indexOf.call(this,token);-1!==i&&(splice.call(this,i,1),this._element.className=slice.call(this,0).join(" "))},toString:function(){return join.call(this," ")},toggle:function(token){return this.contains(token)?this.remove(token):this.add(token),this.contains(token)}},Object.defineProperty(Element.prototype,"classList",{get:function(){return new window.DOMTokenList(this)}})}var Events={bind:function(event,callback){if(this._events||(this._events={}),"object"==typeof event)for(var name in event)this.bind(name,event[name]);else"string"==typeof event&&"function"==typeof callback&&(void 0===this._events[event]&&(this._events[event]=[]),this._events[event].push(callback))},trigger:function(event,data){var result,results=[],self=this;return void 0!==event&&void 0!==this._events&&void 0!==this._events[event]&&this._events[event].forEach(function(ev){result=ev.call(self,data),void 0!==result&&results.push(result)}),results},unbind:function(event){delete this._events[event]},inject:function(obj){"function"==typeof obj?extend(obj.prototype,this):"object"==typeof obj&&extend(obj,this)}},timeZoneOffsets={A:{index:-1,minutes:60},ACDT:{index:-1,minutes:60},ACST:{index:-1,minutes:570},ACT:{index:1,minutes:300},ACWST:{index:-1,minutes:525},ADT:{index:1,minutes:180},AEDT:{index:-1,minutes:61},AEST:{index:-1,minutes:60},AFT:{index:-1,minutes:270},AKDT:{index:1,minutes:480},AKST:{index:1,minutes:540},ALMT:{index:-1,minutes:360},AMST:{index:1,minutes:180},AMT:{index:1,minutes:240},ANAST:{index:-1,minutes:62},ANAT:{index:-1,minutes:62},AQTT:{index:-1,minutes:300},ART:{index:1,minutes:180},AST:{index:1,minutes:240},AWDT:{index:-1,minutes:540},AWST:{index:-1,minutes:480},AZOST:{index:0,minutes:0},AZOT:{index:1,minutes:60},AZST:{index:-1,minutes:300},AZT:{index:-1,minutes:240},B:{index:-1,minutes:120},BNT:{index:-1,minutes:480},BOT:{index:1,minutes:240},BRST:{index:1,minutes:120},BRT:{index:1,minutes:180},BST:{index:-1,minutes:60},BTT:{index:-1,minutes:360},C:{index:-1,minutes:180},CAST:{index:-1,minutes:480},CAT:{index:-1,minutes:120},CCT:{index:-1,minutes:390},CDT:{index:1,minutes:300},CEST:{index:-1,minutes:120},CET:{index:-1,minutes:60},CHADT:{index:-1,minutes:63},CHAST:{index:-1,minutes:62},CHOT:{index:-1,minutes:480},CHUT:{index:-1,minutes:600},CKT:{index:1,minutes:60},CLST:{index:1,minutes:180},CLT:{index:1,minutes:240},COT:{index:1,minutes:300},CST:{index:1,minutes:360},CVT:{index:1,minutes:60},CXT:{index:-1,minutes:420},ChST:{index:-1,minutes:60},D:{index:-1,minutes:240},DAVT:{index:-1,minutes:420},E:{index:-1,minutes:300},EASST:{index:1,minutes:300},EAST:{index:1,minutes:360},EAT:{index:-1,minutes:180},ECT:{index:1,minutes:300},EDT:{index:-1,minutes:61},EEST:{index:-1,minutes:180},EET:{index:-1,minutes:120},EGST:{index:0,minutes:0},EGT:{index:1,minutes:60},EST:{index:1,minutes:300},ET:{index:1,minutes:300},F:{index:-1,minutes:360},FET:{index:-1,minutes:180},FJST:{index:-1,minutes:63},FJT:{index:-1,minutes:62},FKST:{index:1,minutes:180},FKT:{index:1,minutes:240},FNT:{index:1,minutes:120},G:{index:-1,minutes:420},GALT:{index:1,minutes:360},GAMT:{index:1,minutes:540},GET:{index:-1,minutes:240},GFT:{index:1,minutes:180},GILT:{index:-1,minutes:62},GMT:{index:0,minutes:0},GST:{index:-1,minutes:240},GYT:{index:1,minutes:240},H:{index:-1,minutes:480},HAA:{index:1,minutes:180},HAC:{index:1,minutes:300},HADT:{index:1,minutes:540},HAE:{index:1,minutes:240},HAP:{index:1,minutes:420},HAR:{index:1,minutes:360},HAST:{index:1,minutes:60},HAT:{index:1,minutes:150},HAY:{index:1,minutes:480},HKT:{index:-1,minutes:480},HLV:{index:1,minutes:270},HNA:{index:1,minutes:240},HNC:{index:1,minutes:360},HNE:{index:1,minutes:300},HNP:{index:1,minutes:480},HNR:{index:1,minutes:420},HNT:{index:1,minutes:210},HNY:{index:1,minutes:540},HOVT:{index:-1,minutes:420},I:{index:-1,minutes:540},ICT:{index:-1,minutes:420},IDT:{index:-1,minutes:180},IOT:{index:-1,minutes:360},IRDT:{index:-1,minutes:270},IRKST:{index:-1,minutes:540},IRKT:{index:-1,minutes:540},IRST:{index:-1,minutes:210},IST:{index:-1,minutes:60},JST:{index:-1,minutes:540},K:{index:-1,minutes:60},KGT:{index:-1,minutes:360},KOST:{index:-1,minutes:660},KRAST:{index:-1,minutes:480},KRAT:{index:-1,minutes:480},KST:{index:-1,minutes:540},KUYT:{index:-1,minutes:240},L:{index:-1,minutes:61},LHDT:{index:-1,minutes:61},LHST:{index:-1,minutes:60},LINT:{index:-1,minutes:64},M:{index:-1,minutes:62},MAGST:{index:-1,minutes:62},MAGT:{index:-1,minutes:62},MART:{index:1,minutes:570},MAWT:{index:-1,minutes:300},MDT:{index:1,minutes:360},MESZ:{index:-1,minutes:120},MEZ:{index:-1,minutes:60},MHT:{index:-1,minutes:62},MMT:{index:-1,minutes:390},MSD:{index:-1,minutes:240},MSK:{index:-1,minutes:240},MST:{index:1,minutes:420},MUT:{index:-1,minutes:240},MVT:{index:-1,minutes:300},MYT:{index:-1,minutes:480},N:{index:1,minutes:60},NCT:{index:-1,minutes:61},NDT:{index:1,minutes:150},NFT:{index:-1,minutes:61},NOVST:{index:-1,minutes:420},NOVT:{index:-1,minutes:360},NPT:{index:-1,minutes:345},NRT:{index:-1,minutes:720},NST:{index:1,minutes:210},NUT:{index:1,minutes:61},NZDT:{index:-1,minutes:63},NZST:{index:-1,minutes:62},O:{index:1,minutes:120},OMSST:{index:-1,minutes:420},OMST:{index:-1,minutes:420},ORAT:{index:-1,minutes:300},P:{index:1,minutes:180},PDT:{index:1,minutes:420},PET:{index:1,minutes:300},PETST:{index:-1,minutes:62},PETT:{index:-1,minutes:62},PGT:{index:-1,minutes:60},PHOT:{index:-1,minutes:63},PHT:{index:-1,minutes:480},PKT:{index:-1,minutes:300},PMDT:{index:1,minutes:120},PMST:{index:1,minutes:180},PONT:{index:-1,minutes:61},PST:{index:1,minutes:480},PT:{index:1,minutes:480},PWT:{index:-1,minutes:540},PYST:{index:1,minutes:180},PYT:{index:1,minutes:240},Q:{index:1,minutes:240},QYZT:{index:1,minutes:360},R:{index:1,minutes:300},RET:{index:-1,minutes:240},S:{index:1,minutes:360},SAKT:{index:1,minutes:600},SAMT:{index:-1,minutes:240},SAST:{index:-1,minutes:120},SBT:{index:-1,minutes:61},SCT:{index:-1,minutes:240},SGT:{index:-1,minutes:480},SRET:{index:-1,minutes:660},SRT:{index:1,minutes:180},SST:{index:1,minutes:61},T:{index:1,minutes:420},TAHT:{index:1,minutes:60},TFT:{index:-1,minutes:300},TJT:{index:-1,minutes:300},TKT:{index:-1,minutes:63},TLT:{index:-1,minutes:540},TMT:{index:-1,minutes:300},TOT:{index:-1,minutes:780},TVT:{index:-1,minutes:62},U:{index:1,minutes:480},ULAT:{index:-1,minutes:480},UTC:{index:0,minutes:0},UYST:{index:1,minutes:120},UYT:{index:1,minutes:180},UZT:{index:-1,minutes:300},V:{index:1,minutes:540},VET:{index:1,minutes:270},VLAST:{index:-1,minutes:61},VLAT:{index:-1,minutes:61},VUT:{index:-1,minutes:61},W:{index:1,minutes:60},WARST:{index:1,minutes:180},WAST:{index:-1,minutes:120},WAT:{index:-1,minutes:60},WEST:{index:-1,minutes:60},WESZ:{index:-1,minutes:60},WET:{index:0,minutes:0},WEZ:{index:0,minutes:0},WFT:{index:-1,minutes:62},WGST:{index:1,minutes:120},WGT:{index:1,minutes:180},WIB:{index:-1,minutes:420},WIT:{index:-1,minutes:540},WITA:{index:-1,minutes:480},WST:{index:-1,minutes:63},WT:{index:0,minutes:0},X:{index:1,minutes:61},Y:{index:1,minutes:62},YAKST:{index:-1,minutes:60},YAKT:{index:-1,minutes:60},YAPT:{index:-1,minutes:60},YEKST:{index:-1,minutes:360},YEKT:{index:-1,minutes:360},Z:{index:0,minutes:0},"-12":{index:-1,minutes:720},"-11":{index:-1,minutes:660},"-10":{index:-1,minutes:600},"-09":{index:-1,minutes:540},"-08":{index:-1,minutes:480},"-07":{index:-1,minutes:420},"-06":{index:-1,minutes:360},"-05":{index:-1,minutes:300},"-04":{index:-1,minutes:240},"-03":{index:-1,minutes:180},"-02":{index:-1,minutes:120},"-01":{index:-1,minutes:60},"+01":{index:1,minutes:60},"+02":{index:1,minutes:120},"+03":{index:1,minutes:180},"+04":{index:1,minutes:240},"+05":{index:1,minutes:300},"+06":{index:1,minutes:360},"+07":{index:1,minutes:420},"+08":{index:1,minutes:480},"+09":{index:1,minutes:540},"+10":{index:1,minutes:600},"+11":{index:1,minutes:660},"+12":{index:1,minutes:720}};Array.prototype.shuffle=function(){for(var i,tmp,n=this.length;n--;)i=Math.floor(n*Math.random()),tmp=this[i],this[i]=this[n],this[n]=tmp;return this},CBase.prototype.SetParent=function(parent){parent instanceof CBase&&(this.parent=parent)},CBase.prototype.Init=function(handle){if(handle&&handle.nodeName){this.handle=handle,this.baseClass&&-1===handle.className.indexOf(this.baseClass)?this.handleInner=this.handle.appendChild(element("div",{className:this.baseClass})):this.handleInner=this.handle;var self=this;this.handle.addEventListener("click",function(event){"function"==typeof self.onClick&&self.onClick()===!1&&event.stopPropagation()}),"function"==typeof this.onInit&&this.onInit()}},CBase.prototype.Activate=function(active){this.isActive=active!==!1,this.isActive?("function"==typeof this.onActivate&&this.onActivate(),this.parent&&(this.parent.activeChild&&this.parent.activeChild!==this&&this.parent.activeChild.Activate(!1),this.parent.activeChild=this)):("function"==typeof this.onDeactivate&&this.onDeactivate(),this.parent&&(this.parent.activeChild=null))},CBase.prototype.Show=function(visible,manageFocus){var success=!1;return this.handle&&(this.isVisible=visible!==!1,this.isVisible?this.handle.style.display!==this.showAttr&&(this.prevFocus=document.activeElement,manageFocus!==!1&&document.activeElement&&document.activeElement.blur(),this.handle.style.display=this.showAttr,manageFocus!==!1&&this.handle.focus(),"function"==typeof this.onShow&&this.onShow(),success=!0):"none"!==this.handle.style.display&&(manageFocus!==!1&&document.activeElement&&document.activeElement.blur(),this.handle.style.display="none",manageFocus!==!1&&this.prevFocus&&this.prevFocus.focus(),"function"==typeof this.onHide&&this.onHide(),this.isActive&&this.Activate(!1),success=!0)),success},CBase.prototype.Visible=function(mode){this.handle.style.visibility=Boolean(mode)?"visible":"hidden"},CBase.prototype.EventHandler=null,CBase.prototype.onInit=null,CBase.prototype.onShow=null,CBase.prototype.onHide=null,CBase.prototype.onActivate=null,CBase.prototype.onDeactivate=null,CBase.prototype.onClick=function(){return this.Activate(!0),!0},Update.CrashStatuses=[1,2,3,4,7,17,19,20,22,25,27],Update.OkStatus=21,Update.StatusMessages={1:"Signature init error",2:"Wrong device model",3:"Section size exceeds partition size on FLASH",4:"Required FLASH section not found. Aborting update",5:"Updating kernel",6:"Updating image",7:"Internal error",8:"Inspecting firmware",9:"Updating environment variables",10:"Updating Bootstrap section",11:"Skipping Bootstrap section",12:"Updating User FS section",13:"Skipping User FS section",14:"Updating second boot",15:"Updating logotype",16:"Update finished OK",17:"Wrong signature",18:"Erasing flash section",19:"Flash write error",20:"File write error",21:"Idle",22:"Invalid file header",23:"Inspecting update file",24:"File check finished",25:"File not found",26:"Initialising",27:"Read error"},Update.StartTFTP=function(timeout){var bootstrap_url=parseUri(Update.DefaultUpdateUrls.bootstrap_url),lan_params=["ipaddr","gatewayip","dnsip","netmask","ipaddr_conf"],lan_config=getEnvList(lan_params),type="up_dhcp_tftp",count=0;if(lan_config.ipaddr_conf&&"0.0.0.0"!==lan_params.ipaddr_conf){for(var i=0;i<lan_params.length;i++)lan_config[lan_params[i]]&&count++;if(count!==lan_params.length)return!1;type="up_ip_tftp"}return this.CheckUpdateByTFTP()?(setEnvList({serverip_conf:bootstrap_url.host,tftp_path_conf:bootstrap_url.relative.substr(1)})&&setTimeout(function(){gSTB.ExecAction("UpdateSW "+type)},timeout||0),!0):!1},Update.CheckUpdateByTFTP=function(){var update_url=parseUri(Update.DefaultUpdateUrls.update_url),ip_regexp=/^((?:[0-9]{1,3}\.){3}[0-9]{1,3})$/,bootstrap_regexp=/^(tftp):\/\/((?:[0-9]{1,3}\.){3}[0-9]{1,3})(:[0-9]+)?(\/.+)+$/;return-1===["igmp","tftp","http"].indexOf(update_url.protocol)?!1:"igmp"===update_url.protocol&&""!==update_url.relative?!1:"tftp"!==update_url.protocol&&"igmp"!==update_url.protocol||update_url.host.match(ip_regexp)?"Aura"===gSTB.GetDeviceModelExt().substr(0,4)?!1:!!Update.DefaultUpdateUrls.bootstrap_url.match(bootstrap_regexp):!1},Update.StartMulticast=function(timeout){var bootstrap_url=parseUri(Update.DefaultUpdateUrls.bootstrap_url);return this.CheckUpdateByMulticast&&setEnvList({mcip_conf:bootstrap_url.host,mcport_conf:bootstrap_url.port})?(setTimeout(function(){gSTB.ExecAction("UpdateSW up_mc_url")},timeout||0),!0):!1},Update.CheckUpdateByMulticast=function(){var regexp=/^(igmp):\/\/((?:[0-9]{1,3}\.){3}[0-9]{1,3})(:[0-9]+)?$/;return configuration.allowMulticastUpdate?!!Update.DefaultUpdateUrls.bootstrap_url.match(regexp)&&!!Update.DefaultUpdateUrls.update_url.match(regexp):!1},Update.DefaultUpdateUrls=getEnvList(["update_url","bootstrap_url"]),Update.prototype.Start=function(update_url,force){var realActiveBank,status=stbUpdate.getStatus(),activeBank=stbUpdate.getActiveBank(),modelTemp=gSTB.RDir("Model").toUpperCase();if(echo("Update.Start(update_url="+update_url+", force="+force+");"),status!=Update.OkStatus&&!force||this.update_url!==update_url)echo("Update.Start(); => not ready for update. Status:"+status+", is forced? "+force+", url is wrong? "+(this.update_url!==update_url)),echo("this.update_url ("+this.update_url+") === update_url ("+update_url+")"),this.CheckUpdate(update_url,!0);else{if(echo("Update.Start(); => ready for update. Status:"+status+", by force? "+force),this.trigger("onStart"),echo("Update.Start(); => after onStart"),this.SystemButtons(!1),"MAG250"!==modelTemp&&"MAG270"!==modelTemp&&"MAG275"!==modelTemp&&-1!=activeBank&&2!=stbUpdate.GetFlashBankCount())return echo('Update.Start(); => trigger("onError") : bank error'),void this.trigger("onError",{errorMessage:_("Unable to update active memory bank"),logMessage:"Unable to update active memory bank",status:30});(realActiveBank=stbStorage.getItem("nandEmergencyLoadingLogs"))&&(realActiveBank=(JSON.parse(realActiveBank)||"").bootmedia,"bank0"===realActiveBank&&(activeBank=0),"bank1"===realActiveBank&&(activeBank=1)),echo("Update.Start(); => start stbUpdate.startUpdate for bank "+(0==activeBank?1:0)),0==activeBank?stbUpdate.startUpdate(1,update_url):stbUpdate.startUpdate(0,update_url)}this.CheckProgress()},Update.prototype.CheckProgress=function(){var status=stbUpdate.getStatus(),percent=stbUpdate.getPercents(),self=this;self.CheckError(status)&&(echo("Update.CheckProgress() => auto start if ready? "+this.auto_start),this.auto_start===!0&&status===Update.OkStatus&&(this.auto_start=!1,this.Start(this.update_url)),16===status&&(percent=100),echo("Update.CheckProgress() => set new progress value "+stbUpdate.getPercents()),this.trigger("onProgress",{percent:percent,statusMessage:_(100===percent?Update.StatusMessages[16]:Update.StatusMessages[status]),logMessage:100===percent?Update.StatusMessages[16]:Update.StatusMessages[status],status:100===percent?16:status}),this.progress_timeout=setTimeout(function(){self.CheckProgress()},1e3))},Update.prototype.CheckError=function(status){return echo("Update.CheckError(status); => status code: "+status),-1!==Update.CrashStatuses.indexOf(status)?(echo("Update.CheckError(status); => error status found!: "+status),this.trigger("onError",{errorMessage:_(Update.StatusMessages[status]),logMessage:Update.StatusMessages[status],status:status}),this.SystemButtons(!0),!1):!0},Update.prototype.CheckUpdate=function(update_url,start_on_ready){var status,self;if(echo("Update.CheckUpdate(update_url="+update_url+", start_on_ready="+start_on_ready+");"),"string"==typeof update_url&&stbUpdate.startCheck(this.check_url=update_url),status=stbUpdate.getStatus(),self=this,echo("Update.CheckUpdate(); => stop check if some error or got ready status. Current status: "+status),this.CheckError(status)){if(this.trigger("onCheck",{statusMessage:_(Update.StatusMessages[status]),logMessage:Update.StatusMessages[status],status:status}),status===Update.OkStatus)return this.update_url=this.check_url,this.trigger("onReady"),echo("Update.CheckUpdate(); => check is ok. Start autoupdate? "+start_on_ready),void(start_on_ready===!0&&this.Start(this.update_url));clearTimeout(this.check_update_timeout),this.check_update_timeout=setTimeout(function(){self.CheckUpdate(null,start_on_ready)},100)}},Update.prototype.GetImageInfo=function(){return echo("Update.GetImageInfo(); => is info about new image ready? status:"+stbUpdate.getStatus()),stbUpdate.getStatus()===Update.OkStatus?(echo("Update.GetImageInfo(); => {date:"+parseDate(stbUpdate.getImageDateStr())+", description:"+stbUpdate.getImageDescStr()+", version:"+stbUpdate.getImageVersionStr()+"}"),{date:parseDate(stbUpdate.getImageDateStr()),description:stbUpdate.getImageDescStr(),version:stbUpdate.getImageVersionStr()}):null},Update.prototype.GetCurrentImageInfo=function(){if(void 0===this.curr_info){var info=JSON.parse(gSTB.GetEnv(JSON.stringify({varList:["Image_Desc","Image_Date","Image_Version"]}))).result;this.curr_info={date:parseDate(info.Image_Date),description:info.Image_Desc,version:info.Image_Version}}return this.curr_info},Update.prototype.Clear=function(){clearTimeout(this.check_update_timeout),clearTimeout(this.progress_timeout),this.auto_start=!1,this.update_url=""},Update.prototype.SystemButtons=function(enable){gSTB.EnableServiceButton(enable),gSTB.EnableVKButton(enable),gSTB.EnableAppButton(enable),gSTB.EnableTvButton(enable)},Events.inject(Update);var CProgressBar=function(parent,parentNode){CBase.call(this,parent||null),void 0===parentNode&&(parentNode=element("div")),elchild(parentNode,this.$bar=element("div",{className:"cprogressbar"},element("div",{className:"progressbar_bg"},[this.$line=element("div",{className:"progressbar_line"}),this.$digit=element("div",{className:"progressbar_digit"},"0 %")]))),this.Init(parentNode)};CProgressBar.prototype=Object.create(CBase.prototype),CProgressBar.prototype.constructor=CProgressBar,CProgressBar.prototype.SetProgress=function(percent){this.$line.style.width=percent+"%",this.$digit.innerHTML=percent+"%"},CPage.prototype=Object.create(CBase.prototype),CPage.prototype.constructor=CPage,CPage.prototype.Show=function(visible,previous){visible===!1?(this.activeChild&&this.activeChild.Activate(!1),CBase.prototype.Show.call(this,!1,!0,!0),window.currCPage=this.previous||window.baseCPage,this.previous=null,window.currCPage&&window.currCPage!==this&&CBase.prototype.Show.call(window.currCPage,!0,!0,!0)):(this.previous=previous||null,window.currCPage&&window.currCPage!==this&&(window.currCPage.activeChild&&window.currCPage.activeChild.Activate(!1),CBase.prototype.Show.call(window.currCPage,!1,!0,!0)),CBase.prototype.Show.call(this,!0,!0,!0),window.currCPage=this)},CPage.prototype.onClick=function(){return!1},CPage.prototype.EventHandler=function(){},CScrollList.prototype=Object.create(CBase.prototype),CScrollList.prototype.constructor=CScrollList,CScrollList.prototype.Init=function(handle){CBase.prototype.Init.call(this,handle);var self=this;this.handleInner.onmousewheel=function(event){var direction=event.wheelDeltaY>0,found=self.Next(null,direction);return found&&(self.MoveNext(direction?-1:1),self.Focused(found,!0)),
event.stopPropagation(),!1}},CScrollList.prototype.Add=function(body,attrs){attrs=attrs||{};var item=element("a",this.defaultParams,body);this.renderMode===this.RENDER_MODE_BULK?this.fragment.appendChild(item):this.handleInner.appendChild(item),attrs.hidden&&this.Hidden(item,!0),attrs.marked&&this.Marked(item,!0),attrs.disabled&&this.Disabled(item,!0),attrs.focused&&this.Focused(item,!0,attrs.manageFocus);for(var name in attrs)attrs.hasOwnProperty(name)&&(item[name]=attrs[name]);return item},CScrollList.prototype.Render=function(){this.fragment.childNodes.length>0&&this.handleInner.appendChild(this.fragment)},CScrollList.prototype.Clear=function(){this.handleInner.innerHTML=null,this.activeItem=null,this.states={}},CScrollList.prototype.Reset=function(item){item&&item.nodeName&&(this.Hidden(item,this.defaultParams.hidden),this.Marked(item,this.defaultParams.marked),this.Disabled(item,this.defaultParams.disabled),this.Focused(item,this.defaultParams.focused),item!==this.activeItem||item.focused||(this.activeItem=null))},CScrollList.prototype.DeleteAll=function(items){var self=this,curPos=null;Array.isArray(items)&&items.length>0&&(null!==document.activeElement&&document.activeElement.parentNode===this.handleInner&&document.activeElement.blur(),-1===items.indexOf(this.Current())?curPos=this.Current():(curPos=this.Next({marked:!1,hidden:!1,disabled:!1}),(null===curPos||curPos===this.Current())&&(curPos=this.Next({marked:!1,hidden:!1,disabled:!1},!0))),items.forEach(function(item){self.Delete(item)}),null!==curPos&&(this.Focused(curPos,!0),this.SetPosition(curPos,!0)))},CScrollList.prototype.Delete=function(item){if(item&&item.nodeName&&item.parentNode===this.handleInner){for(var name in this.states)if(this.states.hasOwnProperty(name)){var index=this.states[name].indexOf(item);-1!==index&&this.states[name].splice(index,1)}item===this.activeItem&&(this.activeItem=null),this.handleInner.removeChild(item)}},CScrollList.prototype.Current=function(){return this.activeItem},CScrollList.prototype.Length=function(){return this.handleInner.children.length+this.fragment.childNodes.length},CScrollList.prototype.SetState=function(item,option,state){if(state=Boolean(state),item[option]!==state){this.states[option]||(this.states[option]=[]);var index=this.states[option].indexOf(item);state?-1===index&&this.states[option].push(item):-1!==index&&this.states[option].splice(index,1);var oldVal=item[option];return item[option]=state,state?item.classList.add(option):item.classList.remove(option),"function"==typeof this.onStateChange&&this.onStateChange(item,option,oldVal,state),!0}return!1},CScrollList.prototype.Hidden=function(item,state){if(state=Boolean(state),item&&item.nodeName){var changed=this.SetState(item,"hidden",state);return changed&&state&&(item.focused&&(this.activeItem=null),this.SetState(item,"marked",!1),this.SetState(item,"focused",!1)),changed}return!1},CScrollList.prototype.Marked=function(item,state){var self=this;return state=Boolean(state),item&&item.nodeName&&!item.disabled&&!item.hidden?(this.multipleSelection===!1&&(this.states.marked||[]).forEach(function(marked){self.SetState(marked,"marked",!1)}),this.SetState(item,"marked",state)):!1},CScrollList.prototype.Disabled=function(item,state){if(state=Boolean(state),item&&item.nodeName){var changed=this.SetState(item,"disabled",state);return changed&&state&&(item.focused&&(this.activeItem=null),this.SetState(item,"marked",!1),this.SetState(item,"focused",!1)),changed}return!1},CScrollList.prototype.Focused=function(item,state,manageFocus){var changed=!1,prevent=!1;return state=state!==!1,void 0===manageFocus&&(manageFocus=this.manageFocus),item&&item.nodeName&&!item.disabled&&!item.hidden&&state!==item.focused&&(state?item!==this.activeItem&&("function"==typeof this.onFocus&&(prevent=this.onFocus(item,this.activeItem)),prevent||(changed=this.SetState(item,"focused",state),this.Focused(this.activeItem,!1,manageFocus),this.activeItem=item,manageFocus!==!1&&this.activeItem.focus())):(changed=this.SetState(item,"focused",state),manageFocus!==!1&&this.activeItem.blur(),this.activeItem=null)),changed},CScrollList.prototype.Activate=function(state,manageFocus){if(void 0===manageFocus&&(manageFocus=this.manageFocus),CBase.prototype.Activate.call(this,state),this.isActive){if(this.activeItem=this.activeItem||this.FindOne(),null===this.activeItem)return!1;this.SetState(this.activeItem,"focused",!0),this.SetPosition(this.activeItem),manageFocus!==!1&&this.activeItem.focus()}else this.activeItem&&this.activeItem.blur();return!0},CScrollList.prototype.Each=function(callback){Array.prototype.forEach.call(this.handleInner.children,callback)},CScrollList.prototype.Find=function(filter,limit,reverse){var match,found=[],items=this.handleInner.children,itlen=items.length,citem=null;filter=filter||this.defaultFilter;for(var i=0;itlen>i;i++){citem=items[reverse?itlen-i-1:i],match=!0;for(var attr in filter)filter.hasOwnProperty(attr)&&(match=match&&citem[attr]===filter[attr]);if(match&&(found.push(citem),limit&&found.length>=limit))break}return found},CScrollList.prototype.FindOne=function(filter,reverse){return this.Find(filter,1,reverse).pop()||null},CScrollList.prototype.Next=function(filter,reverse,nskip,toend){var match,suitable=this.activeItem,pointer=this.activeItem,skipcount=0;if(nskip=nskip||0,pointer)for(filter=filter||this.defaultFilter;pointer=reverse?pointer.previousSibling:pointer.nextSibling;){match=!0;for(var attr in filter)filter.hasOwnProperty(attr)&&(match=match&&pointer[attr]===filter[attr]);if(pointer.hidden||skipcount++,match&&(toend!==!1&&(suitable=pointer),0===nskip||nskip>0&&skipcount>=nskip))return pointer}return suitable},CScrollList.prototype.SetPosition=function(item,makeFocused,manageFocus){var index,page;makeFocused&&(void 0===manageFocus&&(manageFocus=this.manageFocus),this.Focused(item||this.FindOne(),!0,manageFocus)),null!==this.activeItem&&(index=this.activeItem.offsetTop/this.itemHeight,page=Math.floor(index/this.itemsPerPage),1===this.scrollMode?this.handleInner.scrollTop=(index-Math.floor((this.itemsPerPage-1)/2))*this.itemHeight:2===this.scrollMode&&(this.handleInner.scrollTop=this.itemsPerPage*this.itemHeight*page))},CScrollList.prototype.EventHandler=function(event,filter,manageFocus){var found=null;if(void 0===manageFocus&&(manageFocus=this.manageFocus),event.stopped!==!0){switch(event.code){case KEYS.PAGE_UP:case KEYS.PAGE_DOWN:found=this.Next(filter,event.code!==KEYS.PAGE_DOWN,this.itemsPerPage),this.handleInner.scrollTop=this.handleInner.scrollTop+(event.code===KEYS.PAGE_UP?-1:1)*this.itemsPerPage*this.itemHeight;break;case KEYS.LEFT:case KEYS.RIGHT:case KEYS.HOME:case KEYS.END:found=this.FindOne(filter,event.code===KEYS.RIGHT||event.code===KEYS.END);break;case KEYS.UP:case KEYS.DOWN:found=this.Next(filter,event.code===KEYS.UP),this.MoveNext(event.code===KEYS.UP?-1:1);break;case KEYS.OK:return this.activeItem&&this.activeItem.onclick(),void event.preventDefault();default:return}event.preventDefault(),this.Focused(found||this.FindOne(filter),!0,manageFocus)}},CScrollList.prototype.MoveNext=function(direction){null!==this.activeItem&&(1===this.scrollMode?this.handleInner.scrollTop=this.activeItem.offsetTop-Math.floor((this.itemsPerPage-1)/2)*this.itemHeight+direction*this.itemHeight:2===this.scrollMode&&(-1===direction?this.activeItem.offsetTop===this.handleInner.scrollTop&&(this.handleInner.scrollTop=this.handleInner.scrollTop-this.itemsPerPage*this.itemHeight):this.activeItem.offsetTop-this.handleInner.scrollTop===(this.itemsPerPage-1)*this.itemHeight&&(this.handleInner.scrollTop=this.handleInner.scrollTop+this.itemsPerPage*this.itemHeight)))},CScrollList.prototype.onFocus=null,CScrollList.prototype.onStateChange=null,Object.defineProperty(CScrollList.prototype,"itemsPerPage",{get:function(){return this._itemsPerPage?this._itemsPerPage:this._itemsPerPage=Math.round(this.handleInner.offsetHeight/this.handleInner.firstChild.offsetHeight)}}),Object.defineProperty(CScrollList.prototype,"itemHeight",{get:function(){return this.handleInner.firstChild?this.handleInner.firstChild.offsetHeight:0}}),CList.prototype=Object.create(CBase.prototype),CList.prototype.constructor=CList,CList.prototype.SetList=function(list){return Array.isArray(list)?(this.list=list,!0):!1},CList.prototype.InsertToList=function(arr,start,deleteCount){var lastIndex=0,activeItem=this.list[this.listIndex];if(Array.isArray(arr)&&0!==this.list.length){lastIndex=(this.pageIndex+1)*this.onPage-1,start||0===start||(start=this.list.length),deleteCount?this.list.splice(start,deleteCount):deleteCount=0;for(var i=0;i<arr.length;i++)this.list.splice(start+i,0,arr[i]);return lastIndex>=start&&(start<=this.listIndex&&(this.listIndex=this.FindByElement(activeItem),this.RefreshPageIndex()),this.FillItems()),!0}return!1},CList.prototype.DeleteFromList=function(arr){var index=-1,listIndex=this.listIndex,activeItem=this.list[this.listIndex];if(Array.isArray(arr)&&0!==this.list.length){for(var i=0;i<arr.length;i++)index=this.list.indexOf(arr[i]),-1!==index&&(this.list.splice(index,1),listIndex>index&&listIndex--);return index=this.list.indexOf(activeItem),-1===index?(this.listIndex=listIndex,this.listIndex>=this.list.length&&(this.listIndex=this.list.length-1)):this.listIndex=index,this.RefreshPageIndex(),this.FillItems(),!0}return!1},CList.prototype.RefreshPageIndex=function(){var pageIndex=this.pageIndex;return this.pageIndex=Math.floor(this.listIndex/this.onPage),this.itemIndex=this.listIndex%this.onPage,pageIndex!==this.pageIndex},CList.prototype.FindByElement=function(obj){return this.list.indexOf(obj)},CList.prototype.FindByFild=function(value,fild){var index=-1,map=[];return void 0!==value&&(fild||(fild=this.fillsName.data),map=this.list.map(function(item){return item[fild]}),index=map.indexOf(value)),index},CList.prototype.Init=function(handle){CBase.prototype.Init.call(this,handle);var self=this,table=null;table=element("table",{className:"maxh maxw"},element("tr",{},[this.itemsHandle=element("td",{className:"list"}),element("td",{className:"scroll"},this.scrollHandle=element("div"))])),elchild(this.scrollHandle,this.scrollThumb=element("div",{className:"thumb"})),elchild(this.handleInner,table),this.handleInner.onmousewheel=function(event){var direction=event.wheelDeltaY>0,found=direction?self.Prev():self.Next();return found&&self.Focused(found,!0),event.stopPropagation(),!1},this.RenderBody()},CList.prototype.onShow=function(){this.setScroll()},CList.prototype.RenderBody=function(){if(0===this.itemsHandle.children.length||0===this.items.length){this.items=[];for(var i=0;i<this.onPage;i++)this.items[i]=this.fragment.appendChild(element("div",this.defaultParams)),elchild(this.items[i],this.RenderItem());this.itemsHandle.appendChild(this.fragment)}},CList.prototype.RenderItem=function(){return null},CList.prototype.setScroll=function(){var margin=0,percent=0;percent=Math.ceil(this.onPage/this.list.length*100),percent>=100&&(percent=0),margin=Math.ceil(this.scrollHandle.offsetHeight/Math.ceil(this.list.length/this.onPage)*this.pageIndex),this.scrollThumb.style.height=percent+"%",this.scrollThumb.style.marginTop=margin+"px"},CList.prototype.FillItems=function(noFocus){for(var startPos=this.onPage*this.pageIndex,listLength=this.list.length,active=null,list=[],i=0;i<this.onPage;i++)listLength>i+startPos?(this.items[i].innerHTML=this.list[i+startPos][this.fillsName.text],list.push(this.list[i+startPos]),this.list[i+startPos][this.fillsName.data]&&(this.items[i].data=this.list[i+startPos][this.fillsName.data]),this.items[i].index=i+startPos,this.Hidden(this.items[i],!1),i+startPos===this.listIndex&&(active=this.items[i])):(this.items[i].index=-1,this.items[i].data=null,this.Hidden(this.items[i],!0));return this.Reset(active),noFocus||this.Focused(active,!0),this.setScroll(),"function"==typeof this.onFillItems&&this.onFillItems(active,list),active},CList.prototype.onFillItems=null,CList.prototype.Clear=function(){this.list=[],this.pageIndex=0,this.itemIndex=0,this.listIndex=0,this.activeItem=null,this.states={},this.FillItems()},CList.prototype.Reset=function(item){item&&item.nodeName&&(this.Hidden(item,this.defaultParams.hidden),this.Marked(item,this.defaultParams.marked),this.Disabled(item,this.defaultParams.disabled),item!==this.activeItem||item.focused||(this.activeItem=null),this.Focused(item,this.defaultParams.focused))},CList.prototype.Length=function(){return this.list.length},CList.prototype.SetState=function(item,option,state){if(state=Boolean(state),item[option]!==state){this.states[option]||(this.states[option]=[]);var index=this.states[option].indexOf(item);state?-1===index&&this.states[option].push(item):-1!==index&&this.states[option].splice(index,1);var oldVal=item[option];return item[option]=state,state?item.classList.add(option):item.classList.remove(option),"function"==typeof this.onStateChange&&this.onStateChange(item,option,oldVal,state),!0}return!1},CList.prototype.Hidden=function(item,state){if(state=Boolean(state),item&&item.nodeName){var changed=this.SetState(item,"hidden",state);return changed&&state&&(item.focused&&(this.activeItem=null),this.SetState(item,"marked",!1),this.SetState(item,"focused",!1)),changed}return!1},CList.prototype.Marked=function(item,state){var self=this;return state=Boolean(state),item&&item.nodeName&&!item.disabled&&!item.hidden?(this.multipleSelection===!1&&(this.states.marked||[]).forEach(function(marked){self.SetState(marked,"marked",!1)}),this.SetState(item,"marked",state)):!1},CList.prototype.Disabled=function(item,state){if(state=Boolean(state),item&&item.nodeName){var changed=this.SetState(item,"disabled",state);return changed&&state&&(item.focused&&(this.activeItem=null),this.SetState(item,"marked",!1),this.SetState(item,"focused",!1)),changed}return!1},CList.prototype.OnMouseover=function(item){return this.listIndex===item.index?!1:(this.listIndex=item.index,this.RefreshPageIndex(),void this.Focused(item,!0))},CList.prototype.Focused=function(item,state,manageFocus){var changed=!1,prevent=!1;return state=state!==!1,void 0===manageFocus&&(manageFocus=this.manageFocus),item&&item.nodeName&&!item.disabled&&!item.hidden&&state!==item.focused&&(state?item!==this.activeItem&&("function"==typeof this.onFocus&&(prevent=this.onFocus(item,this.activeItem)),prevent||(changed=this.SetState(item,"focused",state),this.Focused(this.activeItem,!1,manageFocus),this.activeItem=item,manageFocus!==!1&&this.activeItem.focus())):(changed=this.SetState(item,"focused",state),manageFocus!==!1&&this.activeItem.blur(),this.activeItem=null)),changed},CList.prototype.Activate=function(state,manageFocus){if(void 0===manageFocus&&(manageFocus=this.manageFocus),CBase.prototype.Activate.call(this,state),this.isActive){if(this.activeItem=this.activeItem||this.ActiveItem(),null===this.activeItem)return!1;this.itemIndex=this.activeItem.index,this.RefreshPageIndex()?this.FillItems():this.SetState(this.activeItem,"focused",!0),manageFocus===!0&&this.activeItem.focus()}else this.activeItem&&this.activeItem.blur();return!0},CList.prototype.ActiveItem=function(){return this.items[this.itemIndex]||null},CList.prototype.ActiveItems=function(){var list=[];return this.items.forEach(function(item){item.disabled||item.hidden||list.push(item)}),list},CList.prototype.Next=function(count){var next=null,endList=!1;return count=count&&count>0?count:1,this.itemIndex+=count,this.listIndex+=count,this.listIndex>=this.list.length&&(this.listIndex=this.list.length-1,endList=!0),next=(this.itemIndex>=this.onPage||endList)&&this.RefreshPageIndex()?this.FillItems(!1):this.items[this.itemIndex],this.Focused(next,!0),next},CList.prototype.Prev=function(count){var prev=null;return count=count&&count>0?count:1,this.itemIndex-=count,this.listIndex-=count,this.listIndex<0&&(this.listIndex=0),prev=this.itemIndex<0&&this.RefreshPageIndex()?this.FillItems(!1):this.items[this.itemIndex],this.Focused(prev,!0),prev},CList.prototype.SetPosition=function(item,makeFocused){var index=this.items.indexOf(item);return index=-1===index?this.list.indexOf(item):item.index,-1===index||void 0===index?!1:(this.listIndex=index,this.RefreshPageIndex()?this.FillItems():makeFocused&&this.Focused(this.items[this.itemIndex],!0),!0)},CList.prototype.EventHandler=function(event,filter,manageFocus){var found=null;if(void 0===manageFocus&&(manageFocus=this.manageFocus),event.stopped!==!0){switch(event.code){case KEYS.PAGE_UP:this.Prev(this.onPage);break;case KEYS.PAGE_DOWN:this.Next(this.onPage);break;case KEYS.LEFT:case KEYS.HOME:this.Prev(this.list.length);break;case KEYS.RIGHT:case KEYS.END:this.Next(this.list.length);break;case KEYS.UP:this.Prev();break;case KEYS.DOWN:this.Next();break;case KEYS.OK:return this.pressOK(this.ActiveItem()),void event.preventDefault();default:return}event.preventDefault(),this.Focused(found||this.ActiveItem(),!0,manageFocus)}},CList.prototype.pressOK=function(){},CList.prototype.onFocus=null,CList.prototype.onStateChange=null,VScrollBar.prototype.init=function(config){if(config=config||{},DEBUG){if(1!==arguments.length)throw"wrong arguments number";if("object"!=typeof config)throw"wrong config type"}if(void 0!==config.realSize){if(DEBUG&&Number(config.realSize)!==config.realSize)throw"config.realSize value must be a number";this.realSize=config.realSize}if(void 0!==config.viewSize){if(DEBUG){if(Number(config.viewSize)!==config.viewSize)throw"config.viewSize value must be a number";if(config.viewSize<=0)throw"config.viewSize value must be greater than 0"}this.viewSize=config.viewSize}this.viewSize>=this.realSize?this.$body.classList.add("hidden"):this.$body.classList.remove("hidden"),void 0!==config.value&&this.scrollTo(config.value),this.$body.style.height=this.viewSize/this.realSize*100+"%",this.thumbRect=this.$body.getBoundingClientRect(),this.trackRect=this.$node.getBoundingClientRect()},VScrollBar.prototype.scrollTo=function(value){if(DEBUG){if(1!==arguments.length)throw"wrong arguments number";if(Number(value)!==value)throw"value must be a number";if(this.realSize>this.viewSize&&value>this.realSize-this.viewSize)throw"value is greater than this.realSize-this.viewSize";if(0>value)throw"value is less then 0"}return this.value!==value?((0===this.thumbRect.height||0===this.thumbRect.width)&&(this.trackRect=this.$node.getBoundingClientRect(),this.thumbRect=this.$body.getBoundingClientRect()),this.$body.style.marginTop=(this.trackRect.height-this.thumbRect.height)*value/(this.realSize-this.viewSize)+"px",value>=this.realSize&&(value=this.realSize),this.value=value,!0):!1},VList.prototype=Object.create(CBase.prototype),VList.prototype.constructor=VList,VList.prototype.Length=function(){return this.data.length},VList.prototype.renderItem=function($item,attrs){$item.innerText=attrs.name},VList.prototype.focus=function(){this.$body.focus()},VList.prototype.EventHandler=function(event){switch(event.code){case KEYS.UP:case KEYS.DOWN:case KEYS.RIGHT:case KEYS.LEFT:case KEYS.PAGE_UP:case KEYS.PAGE_DOWN:case KEYS.HOME:case KEYS.END:this.move(event.code);break;case KEYS.OK:this.activeItem.onclick()}event.preventDefault()},VList.prototype.Init=function(config){var item,i,self=this,onClick=!1;for(void 0===config.handle?this.handleInner=this.$body=this.$node=document.createElement("div"):this.handleInner=this.$body=this.$node=config.handle,this.size>0&&(this.$body.innerText=null),void 0!==config.onClick&&(onClick=config.onClick),this.$node.classList.add("vlist-main"),i=0;i<this.size;i++)item=document.createElement("a"),item.index=i,onClick&&(item.onclick=onClick),this.$body.appendChild(item);this.$body.addEventListener("mousewheel",function(event){event.wheelDeltaY&&self.move(event.wheelDeltaY>0?KEYS.UP:KEYS.DOWN)}),config.scrollBar&&null===this.scrollBar&&(this.scrollBar=config.scrollBar,this.scrollBar.init({viewSize:self.size,realSize:self.data.length}))},VList.prototype.renderView=function(index){var $item,i,itemData,currIndex;if(this.indexView!==index){for(this.indexView=currIndex=index,i=0;i<this.size;i++)$item=this.$body.children[i],itemData=this.data[index],void 0!==itemData?($item.data=itemData,$item.index=index,this.renderItem($item,itemData),itemData.markable?$item.classList.add("mark"):$item.classList.remove("mark")):($item.data=$item.index=void 0,$item.ready&&($item.$body.innerText="",$item.$body.style.background="")),index++;return null!==this.scrollBar&&this.scrollBar.scrollTo(this.indexView),!0}return!1},VList.prototype.move=function(direction){direction===KEYS.UP&&(this.activeItem&&this.activeItem.index>0?this.activeItem===this.$body.firstChild?this.renderView(this.indexView-1):this.focusItem(this.activeItem.previousSibling):this.onOverflow&&this.onOverflow({direction:direction})),direction===KEYS.DOWN&&(this.activeItem&&this.activeItem.index<this.data.length-1?this.activeItem===this.$body.lastChild?this.renderView(this.indexView+1):this.focusItem(this.activeItem.nextSibling):this.onOverflow&&this.onOverflow({direction:direction})),direction===KEYS.PAGE_UP&&(this.indexView<this.size?this.renderView(0):this.renderView(this.indexView-this.size+1),this.focusItem(this.$body.firstChild)),direction===KEYS.PAGE_DOWN&&(this.data.length>this.size?(this.indexView>this.data.length-2*this.size?this.renderView(this.data.length-this.size):this.renderView(this.indexView+this.size-1),this.focusItem(this.$body.lastChild)):this.focusItem(this.$body.children[this.data.length-1])),(direction===KEYS.HOME||direction===KEYS.LEFT)&&(this.renderView(0),this.focusItem(this.$body.firstChild)),(direction===KEYS.END||direction===KEYS.RIGHT)&&(this.data.length>this.size?(this.renderView(this.data.length-this.size),this.focusItem(this.$body.lastChild)):this.focusItem(this.$body.children[this.data.length-1]))},VList.prototype.focusItem=function($item){var $prev=this.activeItem;return void 0!==$item&&$prev!==$item?(null!==$prev&&$prev.classList.remove("focused"),this.activeItem=$item,this.activeItem.data=this.data[this.activeItem.index],$item.classList.add("focused"),!0):!1},VList.prototype.Add=function(name,attrs,states){var prop;if(attrs.name=name,states)for(prop in states)attrs.prop=states[prop];this.data.push(attrs)},VList.prototype.Clear=function(){this.data=[]},VList.prototype.SetState=function(item,option,state){if(state=!!state,item[option]!==state){this.states[option]||(this.states[option]=[]);var index=this.states[option].indexOf(item);return state?-1===index&&this.states[option].push(item):-1!==index&&this.states[option].splice(index,1),item[option]=state,!0}return!1},VList.prototype.Render=function(){this.indexView=-1,this.renderView(0),this.focusItem(this.$body.firstChild)},VList.prototype.Next=function(){return this.data[this.activeItem.index+1]},VList.prototype.Current=function(){return this.activeItem},VList.prototype.SetPosition=function(data,manageFocus){var i,viewIndex,index=this.data.indexOf(data);return-1===index||void 0===index?!1:(this.indexView=-1,i=data.index||0,i<this.size?viewIndex=0:i>this.data.length-this.size&&(viewIndex=this.data.length-this.size,i-=viewIndex),this.renderView(viewIndex),manageFocus&&this.focusItem(this.$body.children[i]),!0)},VList.prototype.Each=function(callback){this.data.forEach(callback)},CGroupMenu.prototype=Object.create(CBase.prototype),CGroupMenu.prototype.constructor=CGroupMenu,CGroupMenu.prototype.Init=function(handle){CBase.prototype.Init.call(this,handle),this.handle.onclick=function(event){event.stopPropagation()}},CGroupMenu.prototype.GetGroup=function(gid){for(var i=0,items=this.handleInner.children,length=items.length;length>i;i++)if(items[i].gid===gid)return items[i];return!1},CGroupMenu.prototype.AddGroup=function(gid,title,options){var self=this;if(gid&&!this.GetGroup(gid)){var aleft,aright,hlist=element("div",{className:"cslist-main"}),group=element("table",{gid:gid,slist:new CScrollList,options:options||{}},[element("tr",{className:"title"},[element("td",{className:"side",onclick:function(){self.Switch(self.Next({hidden:!1},!0),!0)}},aleft=element("p")),element("td",null,title),element("td",{className:"side",onclick:function(){self.Switch(self.Next({hidden:!1}),!0)}},aright=element("p"))]),element("tr",{className:"ilist"},element("td",{colSpan:3},hlist))]);return group.options.hidden=group.options.hidden?!0:!1,group.slist.Init(hlist),group.aleft=aleft,group.aright=aright,elchild(this.handleInner,group),group}return!1},CGroupMenu.prototype.Hidden=function(group,state){group&&group.nodeName&&(group.options.hidden=state)},CGroupMenu.prototype.AddItem=function(group,iid,body,options){return options=options||{},options.iid=iid,group.options.onclick&&!options.onclick&&(options.onclick=group.options.onclick),options.icon&&(body=element("div",{className:"short"},body),body.style.backgroundImage='url("'+options.icon+'")',body.style.backgroundPosition="right",body.style.backgroundRepeat="no-repeat"),group.slist.Add(body,options)},CGroupMenu.prototype.ApplyArrows=function(){this.activeGroup.aright.className=this.Next({hidden:!1})?"active":"",this.activeGroup.aleft.className=this.Next({hidden:!1},!0)?"active":""},CGroupMenu.prototype.Switch=function(group,activate){return group&&group.gid&&group.nodeName?(this.activeGroup&&(this.activeGroup.slist.Activate(!1),this.activeGroup.style.display="none"),this.activeGroup=group,this.activeGroup.style.display="table",activate&&(this.activeGroup.slist.Activate(),this.autoFocus&&Array.isArray(this.activeGroup.slist.states.marked)&&this.activeGroup.slist.Focused(this.activeGroup.slist.states.marked[0],!0)),this.ApplyArrows(),!0):!1},CGroupMenu.prototype.Activate=function(active,setFocus){var status=!1;return null!==this.activeGroup&&(status=this.activeGroup.slist.Activate(active,setFocus)),this.autoFocus&&Array.isArray(this.activeGroup.slist.states.marked)&&this.activeGroup.slist.Focused(this.activeGroup.slist.states.marked[0],!0),status},CGroupMenu.prototype.Next=function(filter,reverse){var match,pointer=this.activeGroup;if(pointer)for(;pointer=reverse?pointer.previousSibling:pointer.nextSibling;){match=!0;for(var attr in filter)filter.hasOwnProperty(attr)&&(match=match&&pointer.options[attr]===filter[attr]);if(match)return pointer}return null},CGroupMenu.prototype.EventHandler=function(event){switch(event.code){case KEYS.LEFT:this.Switch(this.Next({hidden:!1},!0),!0);break;case KEYS.RIGHT:this.Switch(this.Next({hidden:!1}),!0);break;default:this.activeGroup.slist.EventHandler(event)}};var CMODAL_IMG_PATH=window.configuration&&configuration.newRemoteControl?PATH_IMG_SYSTEM+"buttons/new/":PATH_IMG_SYSTEM+"buttons/old/";CModal.prototype=Object.create(CPage.prototype),CModal.prototype.constructor=CModal,CModal.prototype.Init=function(body){CPage.prototype.Init.call(this,element("div",{className:this.baseClass},element("div",{className:"cmodal-cell"},body)));var owner=this.parent&&this.parent.handle&&this.parent.handle.nodeName?this.parent.handle:document.body;this.parent instanceof CModal&&this.parent.parent&&(owner=this.parent.parent.handle),owner.appendChild(this.handle)},CModal.prototype.Free=function(){this.handle&&this.handle.parentNode&&this.handle.parentNode.removeChild(this.handle),elclear(this.handle)},CModal.prototype.Show=function(visible,manageFocus){CBase.prototype.Show.call(this,visible,manageFocus!==!1),visible===!1?window.currCPage=this.parent:window.currCPage=this},CModal.prototype.FocusPrev=function(event,manageVK){if(this.focusList.length>0){--this.focusPos<0&&(this.focusPos=this.focusList.length-1);var el=this.focusList[this.focusPos];manageVK!==!1&&gSTB.HideVirtualKeyboard(),el.focus(),event&&"INPUT"===el.tagName&&"text"===el.type&&(event.preventDefault(),manageVK!==!1&&gSTB.ShowVirtualKeyboard())}},CModal.prototype.FocusNext=function(event,manageVK){if(this.focusList.length>0){++this.focusPos>=this.focusList.length&&(this.focusPos=0);var el=this.focusList[this.focusPos];manageVK!==!1&&gSTB.HideVirtualKeyboard(),el.focus(),event&&"INPUT"===el.tagName&&"text"===el.type&&(event.preventDefault(),manageVK!==!1&&gSTB.ShowVirtualKeyboard())}},CModalBox.prototype=Object.create(CModal.prototype),CModalBox.prototype.constructor=CModalBox,CModalBox.prototype.SetData=function(place,data){return elclear(place),data instanceof Node||Array.isArray(data)?elchild(place,data):place.innerHTML=data,data&&data.nodeName&&(data.style.display="block"),place.style.display=data?"block":"none",place},CModalBox.prototype.SetHeader=function(data){return this.SetData(this.header,data||"")},CModalBox.prototype.SetContent=function(data){return this.SetData(this.content,data||"")},CModalBox.prototype.SetFooter=function(data){return this.SetData(this.footer,data||"")},CModalBox.prototype.Init=function(){CModal.prototype.Init.call(this,element("div",{className:"cmodal-body"},[this.header,this.content,this.footer]))},CModalHint.prototype=Object.create(CModalBox.prototype),CModalHint.prototype.constructor=CModalHint,CModalAlert.prototype=Object.create(CModalBox.prototype),CModalAlert.prototype.constructor=CModalAlert,CModalConfirm.prototype=Object.create(CModalAlert.prototype),CModalConfirm.prototype.constructor=CModalConfirm,CButtonPanel.prototype=Object.create(CBase.prototype),CButtonPanel.prototype.constructor=CButtonPanel,CButtonPanel.prototype.Init=function(path,handle){this.path=path,handle&&handle.nodeName?CBase.prototype.Init.call(this,handle):CBase.prototype.Init.call(this,element("div",{className:"cbpanel-main"}))},CButtonPanel.prototype.Add=function(code,icon,text,callback,hidden){var html=null,self=this,func=function(){self.isActive&&"function"==typeof callback&&(gSTB.HideVirtualKeyboard(),callback(code))};text&&(html=element("div",{className:"cbpanel-text",onclick:func}),html.innerHTML=text);var item=element("div",{className:"cbpanel-item",data:{code:code,onclick:func}},[element("img",{className:"cbpanel-icon",onclick:func,src:this.path+"/"+icon}),html]);return item.$name=html,this.Hidden(item,hidden||!1),elchild(this.handleInner,item),item},CButtonPanel.prototype.Hidden=function(item,state){item&&item.nodeName&&item.data.hidden!==state&&(item.data.hidden=state,item.style.display=state?"none":"table-cell")},CButtonPanel.prototype.SetName=function(item,name){var html=null;item&&item.nodeName&&name&&(item.$name?this.Rename(item,name):(html=element("div",{className:"cbpanel-text",onclick:item.data.onclick}),html.innerHTML=name,item.$name=html,item.appendChild(html)))},CButtonPanel.prototype.Rename=function(item,name){item&&item.nodeName&&(item.$name.innerHTML=name)},CButtonPanel.prototype.Activate=function(active){this.isActive=active!==!1},CButtonPanel.prototype.EventHandler=function(event){if(event.stopped!==!0&&this.isActive)for(var data,i=0,items=this.handleInner.children,length=items.length;length>i;i++)if(data=items[i].data,!data.hidden&&data.code===event.code&&"function"==typeof data.onclick)return void(data.onclick()&&event.preventDefault())},CButtonPanel.prototype.onClick=function(){return!1},CBreadCrumb.prototype=Object.create(CBase.prototype),CBreadCrumb.prototype.constructor=CBreadCrumb,CBreadCrumb.prototype.Init=function(path,handle,leftItems,rightItems){this.path=path,CBase.prototype.Init.call(this,handle),this.dom={},elchild(this.handleInner,[this.dom.list=element("div",{className:"cbcrumb-list"}),this.dom.name=element("div",{className:"cbcrumb-name"})]),this.leftItems=leftItems||this.leftItems,this.rightItems=rightItems||this.rightItems},CBreadCrumb.prototype.SetName=function(text){elclear(this.dom.name),elchild(this.dom.name,element("div",{innerHTML:text,className:"cbcrumb-name-text"})),this.DrawName()},CBreadCrumb.prototype.DrawName=function(){this.dom.name.style.display=1===this.dom.list.children.length?"table-cell":"none"},CBreadCrumb.prototype.Push=function(path,icon,text,iid){var last=this.dom.list.lastChild;last&&(last.className="cbcrumb-item");var item=element("div",{className:"cbcrumb-item active",onclick:null,path:path},[icon?element("img",{className:"cbcrumb-icon",onclick:null,src:this.path+icon}):null,text?element("div",{className:"cbcrumb-text",onclick:null},text):null]);return iid&&(item.iid=iid),
this.dom.list.children.length===this.leftItems&&elchild(this.dom.list,element("div",{className:"cbcrumb-item divider"},". . .")),elchild(this.dom.list,item),this.dom.list.children.length>this.leftItems+this.rightItems+1&&(this.dom.list.children[this.leftItems].style.display="table-cell",this.dom.list.children[this.dom.list.children.length-this.rightItems-1].style.display="none"),this.DrawName(),item},CBreadCrumb.prototype.Pop=function(){var item=this.dom.list.lastChild;return item&&(this.dom.list.removeChild(item),this.dom.list.children.length===this.leftItems+1?this.dom.list.removeChild(this.dom.list.lastChild):this.dom.list.children.length>this.leftItems+this.rightItems&&(this.dom.list.children[this.dom.list.children.length-this.rightItems].style.display="table-cell"),this.dom.list.children.length===this.leftItems+this.rightItems+1&&(this.dom.list.children[this.leftItems].style.display="none"),this.dom.list.lastChild&&(this.dom.list.lastChild.className="cbcrumb-item active"),this.DrawName()),item},CBreadCrumb.prototype.Tip=function(){return this.dom.list.lastChild},CBreadCrumb.prototype.Reset=function(){elclear(this.dom.list),this.DrawName()},CBreadCrumb.prototype.onClick=function(){return!1},CSearchBar.prototype=Object.create(CBase.prototype),CSearchBar.prototype.constructor=CSearchBar,CSearchBar.prototype.Init=function(path,handle,hint){this.path=path,this.hint=hint||"";var self=this,func=function(){self.Activate(!self.isActive),event.stopPropagation()};CBase.prototype.Init.call(this,handle),this.items.hint=element("input",{type:"text",className:"hint maxw",value:this.hint}),this.items.text=element("input",{type:"text",className:"text maxw",oninput:function(){self.onChange&&self.onChange(this.value)},onkeydown:function(event){self.EventHandler(event)}}),this.items.span=element("div",{className:"csbar-item span"}),this.items.icon=element("div",{className:"csbar-item icon",onclick:func},element("img",{className:"",src:this.path+this.icoSearch})),this.items.button=element("div",{className:"csbar-item icon",onclick:func},element("img",{className:"",src:this.path+"f2.png"})),this.items.input=element("div",{className:"csbar-item stext"},[this.items.hint,this.items.text]),elchild(this.handleInner,[this.items.input,this.items.span,this.items.icon,this.items.button])},CSearchBar.prototype.ShowInput=function(visible,manageFocus){visible=visible!==!1,visible||(this.items.text.blur(),gSTB.HideVirtualKeyboard(),manageFocus!==!1&&this.prevFocus&&this.prevFocus.focus()),this.items.input.style.display=visible?"table-cell":"none",this.items.span.style.display=visible?"none":"table-cell",visible&&(this.prevFocus=document.activeElement,this.items.text.focus(),gSTB.ShowVirtualKeyboard())},CSearchBar.prototype.Reset=function(){this.Activate(!1),this.items.text.value=this.items.hint.value=this.hint=this.filter="",this.items.icon.lastChild.src=this.path+"/"+this.icoSearch},CSearchBar.prototype.onSearch=null,CSearchBar.prototype.onHint=null,CSearchBar.prototype.onChange=null,CSearchBar.prototype.SetHint=function(hint){hint=hint||this.items.text.value||this.hint,hint&&(this.items.hint.value=hint)},CSearchBar.prototype.SetValue=function(text){this.filter=text,this.items.text.value=this.filter},CSearchBar.prototype.EventHandler=function(event){switch(event.code){case KEYS.LEFT:case KEYS.RIGHT:case KEYS.UP:case KEYS.DOWN:return;case KEYS.EXIT:this.Activate(!1),event.stopPropagation();break;case KEYS.F2:this.Activate(!this.isActive),event.stopPropagation();break;case KEYS.OK:this.Activate(!1),"function"==typeof this.onSearch&&this.onSearch(this.items.text.value),this.items.icon.firstChild.src=this.items.text.value?this.path+"/"+this.icoFilter:this.path+"/"+this.icoSearch,event.stopPropagation();break;default:if(this.items.hint.value=""===this.items.text.value?this.hint:"","function"==typeof this.onHint){this.items.hint.value===this.hint&&this.SetHint(" "),this.timer&&clearTimeout(this.timer);var self=this;this.timer=setTimeout(function(){self.onHint.call(self,self.items.text.value)},300)}}},CSearchBar.prototype.Activate=function(active,manageFocus){active||this.ShowInput(!1,manageFocus),CBase.prototype.Activate.call(this,active),active&&this.ShowInput(!0,manageFocus)};var globalBuffer=function(){var data=[],mode=1,place={};return{MODE_COPY:1,MODE_CUT:2,onPaste:null,add:function(item){return-1===data.indexOf(item)?(data.push(item),!0):!1},paste:function(func){var self=this;data.forEach(function(item){func(item)&&"function"==typeof self.onPaste&&self.onPaste(item)}),this.clear()},mode:function(newMode){return void 0!==newMode&&(mode=newMode),mode},place:function(newPlace){return void 0!==newPlace&&(place=newPlace),place},size:function(){return data.length},remove:function(item){if(void 0!==item){var index=data.indexOf(item);if(-1!==index)return 1===data.splice(index,1).length}return!1},clear:function(){data=[],place={},this.onPaste=null}}}();CCheckBox.prototype=Object.create(CBase.prototype),CCheckBox.prototype.constructor=CCheckBox,CCheckBox.DefaultAttributes={checkbox:{type:"checkbox",className:"ccheck-box-input"},label:{className:"ccheck-box-label"},wrapper:{className:"ccheck-box-wrapper",tabIndex:"1"}},CCheckBox.prototype.onInit=function(){void 0!==this.parameters.element&&"INPUT"===this.parameters.element.nodeName&&"checkbox"===this.parameters.element.type&&(this.parameters.element.parentNode.removeChild(this.parameters.element),this.checkbox=this.parameters.element,elattr(this.checkbox,extend(CCheckBox.DefaultAttributes.checkbox,this.parameters.attributes.checkbox,!0))),void 0===this.checkbox&&(this.checkbox=this.generateCheckbox()),this.wrapper=this.generateWrapper(this.checkbox),this.wrapper.className+=" "+this.style,this.parameters.checked===!0&&this.Check(!0,!0),elchild(this.handleInner,this.wrapper)},CCheckBox.prototype.generateCheckbox=function(){var self=this,attrs=extend(CCheckBox.DefaultAttributes.checkbox,this.parameters.attributes.checkbox,!0);return void 0===attrs.id&&(attrs.id=CCheckBox.GenerateId()),attrs.onchange=function(){self.checked=this.checked,self.trigger("onChange",arguments)},attrs.onclick=function(){self.Check(!self.IsChecked())},element("input",attrs)},CCheckBox.prototype.generateWrapper=function(checkbox,label){var self=this;if(void 0===this.checkbox)throw"Checkbox must be created before label";return this.label=element("label",extend({htmlFor:this.checkbox.id},CCheckBox.DefaultAttributes.label)),this.label.onclick=function(){self.Check(!self.IsChecked())},element("div",CCheckBox.DefaultAttributes.wrapper,[checkbox,label||this.label])},CCheckBox.GenerateId=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},CCheckBox.prototype.Check=function(checked,block_event){this.checked=this.checkbox.checked=checked===!0,block_event!==!0&&this.trigger("onChange")},CCheckBox.prototype.IsChecked=function(){return this.checkbox.checked===!0},CCheckBox.prototype.EventHandler=function(event){switch(event.code){case KEYS.LEFT:case KEYS.RIGHT:this.Check(event.code===KEYS.LEFT),event.stopped=!0}},CCheckBox.prototype.focus=function(){this.wrapper.focus()},Events.inject(CCheckBox);var CINPUT_IMG_PATH=PATH_IMG_PUBLIC;CInput.prototype=Object.create(CBase.prototype),CInput.prototype.constructor=CInput,CInput.prototype.GenerateHandle=function(){var i,icon,attrs,changed,self=this;if(this.row=element("tr"),void 0!==this.parameters.hint&&(this.DefaultHint=this.attributes.hint.value=this.parameters.hint,this.hint=element("input",extend(this.attributes.input,this.attributes.hint,!1))),void 0===this.parameters.input?(void 0!==this.parameters.value&&(this.attributes.input.value=this.parameters.value,this.SetDefault(this.parameters.value)),elchild(this.row,element("td",this.attributes["text-wrapper"],[this.input=element("input",this.attributes.input),this.hint||""]))):(this.input=this.parameters.input,this.input.parentNode.removeChild(this.input),this.input.className+=this.attributes.input.className,elchild(this.row,element("td",{},element("div",this.attributes["text-wrapper"],[this.input,this.hint||""]))),""!==this.input.value&&(this.ShowHint(!1),this.SetDefault(this.input.value))),this.input.oninput=function(e){changed=!1,self.trigger("onChange",e),""!==self.GetValue()?self.ShowHint(!1):(self.SetHint(self.DefaultHint),self.ShowHint(!0))},this.input.onblur=function(){""!==self.GetValue()?self.ShowHint(changed):(self.SetHint(self.DefaultHint),self.ShowHint(!0))},void 0!==this.parameters.icons)for(i=0;i<this.parameters.icons.length;i++)icon=this.parameters.icons[i],attrs=extend({},this.attributes.icon),attrs.className+=" "+(icon.style||""),this.AddIcon(icon,attrs);return element("table",this.attributes.wrapper,this.row)},CInput.prototype.SetAutocomplete=function(autocomplete){this.autocomplete=autocomplete},CInput.prototype.onInit=function(){},CInput.prototype.ShowIcon=function(name,show){void 0!==this.icons[name]&&(this.icons[name].parentNode.style.display=show===!0?"table-cell":"none")},CInput.prototype.ApplyHint=function(){this.SetValue(this.GetHint())},CInput.prototype.AddIcon=function(icon,attrs){var self=this,iconFile=null,attributes=extend(icon.attributes,{}),remoteControlButtonsImagesPath=configuration.newRemoteControl?PATH_IMG_SYSTEM+"buttons/new/":PATH_IMG_SYSTEM+"buttons/old/";iconFile=void 0!==icon.src?icon.src:icon.name?icon.name+".png":null,"f4.png"===iconFile?iconFile&&(attributes.src=(this.parameters.icons_path||remoteControlButtonsImagesPath)+iconFile):iconFile&&(attributes.src=(this.parameters.icons_path||CINPUT_IMG_PATH)+iconFile),element("td",attrs||this.attributes.icon,this.icons[icon.name]=element("img",attributes)),"left"===icon.type?this.row.insertBefore(this.icons[icon.name].parentNode,this.row.firstChild):this.row.appendChild(this.icons[icon.name].parentNode),"function"==typeof icon.click&&(this.icons[icon.name].onclick=function(event){icon.click.call(self,event)})},CInput.prototype.RemoveIcon=function(icon_name){void 0!==this.icons[icon_name]&&this.row.removeChild(this.icons[icon_name].parentNode)},CInput.prototype.SetValue=function(value,siltent){this.input.value=value,this.ShowHint(""===value),siltent!==!0&&(this.trigger("onChange"),this.input.oninput())},CInput.prototype.GetValue=function(){return this.input.value},CInput.prototype.SetHint=function(hint){return void 0!==this.hint?(this.hint.value=hint,this.hint.value):void 0},CInput.prototype.GetHint=function(){return void 0!==this.hint?this.hint.value:void 0},CInput.prototype.ShowHint=function(show){void 0!==this.hint&&(this.hint.style.display=show===!0?"block":"none")},CInput.prototype.Fold=function(fold,manage_focus,stop_event){fold===!0?(-1===this.handle.className.indexOf("folded")&&(this.handle.className+=" "+this.FoldedClass,stop_event!==!0&&this.trigger("onFold"),manage_focus===!0&&this.blur()),gSTB.HideVirtualKeyboard()):(this.handle.className=this.handle.className.replace(this.FoldedClass,""),stop_event!==!0&&this.trigger("onUnfold"),manage_focus===!0&&(this.focus(),gSTB.ShowVirtualKeyboard()))},CInput.prototype.Reset=function(){this.Fold(this.parameters.folded===!0,!0),this.SetValue(this.GetDefault(),!0)},CInput.prototype.focus=function(){this.input.focus()},CInput.prototype.blur=function(){this.input.blur()},CInput.prototype.select=function(){this.input.select()},CInput.prototype.IsFolded=function(){return-1!==this.handle.className.indexOf(this.FoldedClass)},CInput.prototype.IsFocused=function(){return this.input===document.activeElement},CInput.prototype.EventHandler=function(){},Events.inject(CInput),CFilterInput.prototype=Object.create(CInput.prototype),CFilterInput.prototype.constructor=CFilterInput,CFilterInput.prototype.EventHandler=function(event){eventPrepare(event,!0,"CFilterInput");var event_res=!1;if(this.trigger("onEvent",event)[0]===!0)return!0;switch(event.code){case KEYS.F4:this.Fold(!this.IsFolded(),!0),event_res=this.trigger("onKey")[0];break;case KEYS.EXIT:if(!this.IsFolded())return this.Fold(!0,!0),this.trigger("onExit"),!0;break;case KEYS.OK:this.IsFolded()||(event_res=this.trigger("onEnter")[0],echo(event_res,"onEnter"),this.Fold(!0,!0),event.preventDefault());break;case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault()}return this.IsFolded()!==!0||event_res===!0?!0:void 0},CSimpleSelect.prototype=Object.create(CBase.prototype),CSimpleSelect.prototype.constructor=CSimpleSelect,CSimpleSelect.prototype.GenerateHandle=function(){var wrapper,content_wrapper,self=this;return void 0!==this.parameters.content&&"DIV"===this.parameters.content.tagName?(this.content=this.parameters.content,this.content.parentNode.removeChild(this.content),void 0!==this.content.className&&(this.attributes.content.className+=" "+this.content.className),this.content=element("div",this.attributes.content,this.content||"")):(void 0!==this.parameters.content&&"DIV"!==this.parameters.content.tagName&&(this.content=this.parameters.content),this.content=element("div",this.attributes.content,this.content||"")),content_wrapper=element("div",this.attributes.content_wrapper,[this.content,this.hint=element("div",this.attributes.hint)]),this.parameters.leftArrow?(this.leftArrow=this.parameters.leftArrow,this.leftArrow.parentNode.removeChild(this.leftArrow),this.leftArrow=element("div",this.attributes.left_arrow,this.leftArrow)):this.leftArrow=element("div",this.attributes.left_arrow,this.leftArrow||element("p")),this.parameters.rightArrow?(this.rightArrow=this.parameters.rightArrow,this.rightArrow.parentNode.removeChild(this.rightArrow),this.rightArrow=element("div",this.attributes.right_arrow,this.rightArrow)):this.rightArrow=element("div",this.attributes.right_arrow,this.rightArrow||element("p")),wrapper=element("div",this.attributes.wrapper,element("div",{className:"content-wrapper",onfocus:function(){}},[this.leftArrow,content_wrapper,this.rightArrow])),wrapper.className+=" "+this.style,void 0!==this.parameters.width&&(wrapper.style.width=this.parameters.width),this.leftArrow.onclick=function(event){self.disabled||(self.Previous(),event.stopPropagation(),event.preventDefault())},this.rightArrow.onclick=function(event){self.disabled||(self.Next(),event.stopPropagation(),event.preventDefault())},wrapper},CSimpleSelect.prototype.onInit=function(){var self=this;elchild(this.parentNode,this.handle),this.handle.component=this,this.handle.onblur=function(){self.trigger("onBlur")},this.handle.onfocus=function(){self.trigger("onFocus")}},CSimpleSelect.prototype.EventHandler=function(event){if(eventPrepare(event,!0,"CSimpleSelect"),this.disabled!==!0)switch(event.stopped=!0,event.code){case KEYS.LEFT:this.Previous();break;case KEYS.RIGHT:this.Next();break;default:event.stopped=!1}},CSimpleSelect.prototype.SetContent=function(content,placeholder){void 0===content&&placeholder&&(content=placeholder,this.content.classList.add("placeholder")),this.content.innerHTML="",this.content.innerHTML=content},CSimpleSelect.prototype.DisableElement=function(element,disable){disable===!0?-1===element.className.indexOf("disabled")&&(element.className+=" disabled"):element.className=element.className.replace(" disabled","")},CSimpleSelect.prototype.SetHint=function(hint){this.hint.innerHTML=hint},CSimpleSelect.prototype.Next=function(){},CSimpleSelect.prototype.Previous=function(){this.autocomplete=""},CSimpleSelect.prototype.focus=function(){this.handle.focus()},CSimpleSelect.prototype.blur=function(){this.handle.blur()},CSimpleSelect.prototype.IsFocused=function(){return document.activeElement===this.handle},CSimpleSelect.prototype.Disable=function(disable){this.DisableElement(this.handle,this.disabled=disable===!0)},Events.inject(CSimpleSelect),CSelectBox.prototype=Object.create(CSimpleSelect.prototype),CSelectBox.prototype.constructor=CSelectBox,CSelectDropdown.prototype=Object.create(CScrollList.prototype),CSelectDropdown.prototype.constructor=CSelectDropdown,CSelectDropdown.parameters=["scrollMode","select","container"],CSelectDropdown.prototype.Refresh=function(){var el,i,self=this,data=this.select.GetData();for(this.Clear(),i=0;i<data.length,el=data[i];i++)"object"==typeof el&&(el=el[this.select.GetNameField()]),this.Add(element("div",extend(this.attributes.element,{innerHTML:el})),{onclick:function(){self.select.SetIndex(self.activeItem.index),self.Marked(self.activeItem,!0),self.Show(!1,self.manageFocus)},index:i})},CSelectDropdown.prototype.onShow=function(){this.UpdateGeometry();var item=this.handleInner.children[this.select.GetIndex()];this.SetPosition(item,!0,!1),this.Focused(item,!0),this.Marked(item,!0)},CSelectDropdown.prototype.UpdateGeometry=function(){var containerRect,inputRect=this.base.getBoundingClientRect(),top=this.base.offsetTop+inputRect.height,height=WINDOW_HEIGHT;void 0!==this.container&&(containerRect=this.container.getBoundingClientRect(),height=containerRect.top+containerRect.height),inputRect.top+inputRect.height+this.itemHeight*this.itemsPerPage>height&&(top=this.base.offsetTop-this.itemHeight*this.itemsPerPage),1===this.scrollMode&&(top-=this.itemHeight*Math.abs(Math.floor(this.itemsPerPage/2*-1))),this.handle.style.top=top+"px",this.handle.style.left=this.base.offsetLeft+"px",this.handle.style.width=inputRect.width-2*parseInt(document.defaultView.getComputedStyle(this.handle,"")["border-left-width"])+"px"},Events.inject(CSelectDropdown),CIntervalBox.prototype=Object.create(CSimpleSelect.prototype),CIntervalBox.prototype.constructor=CIntervalBox;var CLog=function(parent,options){var self=this;CBase.call(this,parent||null),this.newest=!1,CLog.parameters.forEach(function(option){void 0!==options[option]&&(self[option]=options[option])}),this.bind(options.events||{}),this.Init(element("div",{className:"clog"},this.$log=element("ul",{})))};CLog.parameters=["time","autofocus","parentNode","events","defaultType","newest","isVisible"],CLog.prototype=Object.create(CBase.prototype),CLog.prototype.constructor=CLog,CLog.prototype.onInit=function(){elchild(this.parentNode,this.handle)},CLog.prototype.onShow=function(){this.autofocus===!0&&0!==this.$log.childElementCount&&this.$log.lastElementChild.focus(),this.trigger("onShow")},CLog.prototype.onHide=function(){this.trigger("onHide")},CLog.prototype.Add=function(message,type){if(this.newest===!1||this.newest===!0&&this._lastMessage!==message){this._lastMessage=message;var currTime=new Date,$data=[element("span",{className:"message"},message)];this.time===!0&&$data.push(element("span",{className:"time"},("0"+currTime.getHours()).slice(-2)+":"+("0"+currTime.getMinutes()).slice(-2)+":"+("0"+currTime.getSeconds()).slice(-2))),elchild(this.$log,element("li",{className:type||this.defaultType,tabIndex:"1"},$data)),this.autofocus===!0&&this.$log.lastElementChild.focus(),this.trigger("onAdd")}},Events.inject(CLog);var MODAL_IMG_PATH=configuration.newRemoteControl?PATH_IMG_SYSTEM+"buttons/new/":PATH_IMG_SYSTEM+"buttons/old/",CUpdateModal=function(parent,options){var self=this;CModalBox.call(this,parent||null),this.isVisible=!1,this.name="CUpdateModal",this.baseClass="cmodal-main cupdate-modal",this.$status=element("td",{className:"right"}),this.F1_func=null,this.Info_func=null,this.image_info={},CUpdateModal.parameters.forEach(function(option){void 0!==options[option]&&(self[option]=options[option])}),this.bind(this.events),this.bpanel=new CButtonPanel,this.bpanel.Init(MODAL_IMG_PATH),this.Exit_btn=this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Update.Clear(),self.Show(!1)},this.auto===!0),this.Info_btn=this.bpanel.Add(KEYS.INFO,"info.png",_("Show log"),function(){self.Info_func()},this.log!==!0),this.OK_btn=this.bpanel.Add(KEYS.F1,"f1.png",_("Update"),function(){self.F1_func()},!0),this.ProgressBar=new CProgressBar(this,element("div")),this.SetHeader(this.header_text),this.SetFooter(this.bpanel.handle),this.EventHandler=function(event){eventPrepare(event),void 0!==self.select&&"function"==typeof self.select.EventHandler&&self.select.EventHandler(event),self.bpanel.EventHandler(event)},this.Init()};CUpdateModal.parameters=["update_url","check","auto","images","log","select","header_text","info","events","warning"],CUpdateModal.prototype=Object.create(CModalBox.prototype),CUpdateModal.prototype.constructor=CUpdateModal,CUpdateModal.prototype.onHide=function(){this.trigger("onHide")},CUpdateModal.prototype.onShow=function(){this.trigger("onShow")},CUpdateModal.prototype.onInit=function(){var self=this;this.Update=new Update({onReady:function(){echo("CUpdateModal.Update: onReady listener"),self.image_info=self.Update.GetImageInfo(),self.image_description=self.image_info.description,self.image_date=self.image_info.date,self.auto===!0?self.UpdateStart():self.ImageSelect(),self.trigger("onReady")},onCheck:function(data){echo("CUpdateModal.Update: onCheck listener"),self._addLogMessage(data.logMessage),self.$status.innerHTML=data.statusMessage,self.$status.className="right",self.trigger("onCheck",data),self.bpanel.Rename(self.OK_btn,_("Update"))},onError:function(data){echo("CUpdateModal.Update: onError listener"),self._addLogMessage(data.logMessage,"error"),self.bpanel.Hidden(self.OK_btn,!1),self.bpanel.Hidden(self.Exit_btn,!1),self.bpanel.Rename(self.OK_btn,_("Retry")),self.bpanel.Rename(self.Exit_btn,_("Exit")),self.$status.innerHTML=data.errorMessage,self.$status.classList.add("error"),self.trigger("onError",data)},onProgress:function(data){echo("CUpdateModal.Update: onProgress listener"),self._addLogMessage(data.logMessage),self.$status.innerHTML=data.statusMessage,self.ProgressBar.SetProgress(data.percent),self.trigger("onProgress",data)},onStart:function(){echo("CUpdateModal.Update: onStart listener"),self.UpdateStart(),CModalBox.prototype.Show.call(self,!0)}}),this.log===!0&&(this.log=new CLog(document.body,{autofocus:!0,time:!0,newest:!0,defaultType:"success",isVisible:!1,events:{onShow:function(){self.$status.parentNode.style.display="none"},onHide:function(){self.$status.parentNode.style.display=""}}})),this.curr_info=this.Update.GetCurrentImageInfo(),"string"==typeof this.update_url?this.check=!0:Array.isArray(this.images)&&(this.check=!1,this.image_description=cutTextWithEllipsis(this.images[0].descr,200),this.image_date=new Date(this.images[0].date),this.select===!0&&this.images.length>1?(this.select=new CSelectBox(this,{parent:this.new_version=element("div"),data:this.images,nameField:"title",idField:"url",events:{onChange:function(){self.$curr_update_descr.innerHTML=cutTextWithEllipsis(this.GetSelected().descr,200),self.update_url=this.GetValue(),self.$curr_update_date.innerHTML=new Date(this.GetSelected().date).toDateString()+" "+new Date(this.GetSelected().date).toLocaleTimeString()}}}),this.update_url=this.select.GetValue()):(this.new_version=this.images[0].title,this.new_version_date=new Date(this.images[0].date),this.update_url=this.images[0].url))},CUpdateModal.prototype._addLogMessage=function(message,type){void 0!==this.log&&this.log.Add(message,type)},CUpdateModal.prototype._addLog=function(elements){var self=this;"undefined"!=typeof this.log&&(elements.push(element("tr",{className:"row"},[element("td",{className:"log",colSpan:2},this.log.handle)])),this.Info_func=function(){self.log.Show(!self.log.isVisible),this.bpanel.Rename(this.Info_btn,_(self.log.isVisible?"Hide log":"Show log")),self.content.querySelector("table").classList.toggle("hidden")},this.bpanel.Rename(this.Info_btn,_(self.log.isVisible?"Hide log":"Show log")),this.bpanel.Hidden(this.Info_btn,!1))},CUpdateModal.prototype.Show=function(show){if(echo("CUpdateModal.prototype.Show:show? "+show+", auto? "+this.auto+", check? "+this.check),show!==!1){if(this.auto===!0)return void this.Update.Start(this.update_url);this.check===!0?this.CheckStatus():this.ImageSelect(),this.log&&this.log.isVisible&&this.log.Show(!1)}CModalBox.prototype.Show.call(this,show)},CUpdateModal.prototype.CheckStatus=function(){echo("CUpdateModal.CheckStatus"),this.layer=this.CheckStatus;var self=this,elements=[element("tr",{className:"row"},[element("td",{className:"left"},_("Status")+":"),this.$status=element("td",{className:"right"})])];this._addLog(elements),this.SetHeader(_("Check image")),this.SetContent(element("table",{className:"cmodal-update status"},elements)),this.F1_func=function(){self.$status.innerHtml=status,self.$status.className="right",self.bpanel.Hidden(this.OK_btn,!0),self.bpanel.Rename(this.Exit_btn,_("Cancel")),self.Update.CheckUpdate(self.update_url),self.trigger("onCheckStatus")},self.Update.CheckUpdate(self.update_url)},CUpdateModal.prototype.ImageSelect=function(){this.layer=this.ImageSelect;var $new_version,self=this,elements=[element("tr",{className:"row info"},[element("td",{className:"left"},_("Current version")+":"),element("td",{className:"right",innerHTML:this.curr_info.version})]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Description")+":"),element("td",{className:"right"},element("div",{className:"ellipsis",innerHTML:this.curr_info.description||""}))]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Date")+":"),element("td",{className:"right",innerHTML:isNaN(this.curr_info.date)?"n/a":this.curr_info.date.toDateString()+" "+this.curr_info.date.toLocaleTimeString()})]),element("tr",{className:"row padding info"},[element("td",{className:"left"},_("New version")+":"),element("td",{className:"right"},$new_version=element("div"))]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Description")+":"),element("td",{className:"right"},self.$curr_update_descr=element("div",{className:"ellipsis",innerHTML:this.image_description||""}))]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Date")+":"),self.$curr_update_date=element("td",{className:"right",innerHTML:this.image_date.toDateString()+" "+this.image_date.toLocaleTimeString()})])];this.warning!==!1&&elements.unshift(element("tr",{className:"row info"},[element("td",{className:"center",colSpan:2,innerHTML:_('<span class="alert">Warning!</span> Device will be rebooted after update')})])),this.bpanel.Hidden(this.Info_btn,this.info!==!0),this._addLog(elements),this.SetContent(element("table",{className:"cmodal-update"},elements)),void 0!==this.new_version?"string"==typeof this.new_version?($new_version.innerHTML=this.new_version,self.$curr_update_date.innerHTML=this.new_version_date.toDateString()+" "+this.new_version_date.toLocaleTimeString()):elchild($new_version,this.new_version):($new_version.innerHTML=this.image_info.version,self.$curr_update_date.innerHTML=this.image_info.date.toDateString()+" "+this.image_info.date.toLocaleTimeString()),this.SetHeader(this.header_text||""),this.info===!0&&(this.Info_func=function(){self.ShowInfoWindow()},this.bpanel.Rename(this.Info_btn,_("Change log"))),this.F1_func=function(){self.Update.Start(this.update_url)},this.bpanel.Hidden(this.OK_btn,!1),this.bpanel.Hidden(this.Exit_btn,!1),this._binded!==!0&&(this.bind("onShow",function(){this.layer===this.ImageSelect&&this.select&&this.select.focus&&this.select.focus()}),this._binded=!0)},CUpdateModal.prototype.UpdateStart=function(){this.layer=this.UpdateStart;var self=this,elements=[element("tr",{className:"row info"},[element("td",{className:"center",colSpan:2,innerHTML:_('<span class="alert">Warning!</span> Device will be rebooted after update')})]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Current version")+":"),element("td",{className:"right",innerHTML:this.curr_info.version})]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Description")+":"),element("td",{className:"right"},element("div",{className:"ellipsis",innerHTML:this.curr_info.description||""}))]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Date")+":"),element("td",{className:"right",innerHTML:isNaN(this.curr_info.date)?"n/a":this.curr_info.date.toDateString()+" "+this.curr_info.date.toLocaleTimeString()})]),element("tr",{className:"row info padding"},[element("td",{className:"left"},_("New version")+":"),element("td",{className:"right",innerHTML:this.image_info.version})]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Description")+":"),element("td",{className:"right"},self.$curr_update_descr=element("div",{className:"ellipsis",innerHTML:this.image_description||""}))]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Date")+":"),element("td",{className:"right",innerHTML:this.image_info.date.toDateString()+" "+this.image_info.date.toLocaleTimeString()})]),element("tr",{className:"row padding"},[element("td",{className:"left"},_("Update status")+":"),this.$status])];this.bpanel.Hidden(this.Info_btn,!0),this.bpanel.Hidden(self.Exit_btn,!0),this._addLog(elements),elements.push(element("tr",{className:"row"},[element("td",{className:"center",colSpan:2},this.ProgressBar.handle)])),this.SetContent(element("table",{className:"cmodal-update"},elements)),this.bpanel.Hidden(this.OK_btn,!0),this.bpanel.Hidden(this.Exit_btn,!0),self.log.isVisible?self.content.querySelector("table").classList.add("hidden"):self.content.querySelector("table").classList.remove("hidden"),this.trigger("onShowUpdateStart"),this.F1_func=function(){self.Update.Start(self.update_url,self.$status.classList.contains("error")),self.$status.innerHtml="",self.$status.classList.remove("error"),self.bpanel.Hidden(this.OK_btn,!0),self.bpanel.Hidden(this.Exit_btn,!0)}},CUpdateModal.prototype.ShowInfoWindow=function(){var $content,modal=new CModalBox(this),self=this;if(modal.SetHeader(_("Change log")),modal.baseClass="cmodal-main image-info-modal",modal.name="CModalImageInfo",modal.bpanel=new CButtonPanel,modal.bpanel.Init(MODAL_IMG_PATH),modal.bpanel.Add(KEYS.EXIT,"exit.png",_("Close"),function(){modal.Show(!1),modal.Free()}),modal.EventHandler=function(event){switch(event.code){case KEYS.UP:$content.parentNode.scrollByLines(-2);break;case KEYS.DOWN:$content.parentNode.scrollByLines(2);break;case KEYS.PAGE_DOWN:$content.parentNode.scrollByPages(1);break;case KEYS.PAGE_UP:$content.parentNode.scrollByPages(-1)}modal.bpanel.EventHandler(event)},modal.SetFooter(modal.bpanel.handle),modal.SetContent(element("div",{className:"image-info-content"},$content=element("div",{className:"info"},_("Information not found")))),modal.Init(),void 0===this.image_info[this.update_url]&&this.update_url){var name=this.update_url.split("/").pop();return void ajax("GET",this.update_url.replace(name,"")+"info/pub/get.php?name="+name+"&lang="+getCurrentLanguage(),function(text,status){200===status?self.image_info[self.update_url]=text:self.image_info[self.update_url]=_("Information not found"),$content.innerHTML=self.image_info[self.update_url],modal.Show(!0),$content.focus()})}$content.innerHTML=self.image_info[self.update_url],modal.Show(!0),$content.focus()},Events.inject(CUpdateModal),CMap.prototype=Object.create(CBase.prototype),CMap.prototype.constructor=CMap,CMap.prototype.LoadGoogleMapsApiScript=function(objTitle,language){loadScript("https://maps.googleapis.com/maps/api/js?callback="+objTitle+".GoogleMapsApiScriptCallback&language="+language)},CMap.prototype.GoogleMapsApiScriptCallback=function(){window.googleMapsApiScriptLoaded=!0,this.trigger("onGoogleMapsApiScriptCallback")},CMap.prototype.BuildMap=function(mapOptions,useMarker,showMapIfExists){var self=this;this.map?(this.map.setOptions(mapOptions),showMapIfExists&&this.Visible(!0)):this.map=new google.maps.Map(this.container,mapOptions),useMarker?(this.marker?this.marker.setPosition(mapOptions.center):this.marker=new google.maps.Marker({position:mapOptions.center,map:this.map}),this.marker.setVisible(!0)):this.marker&&this.marker.setVisible(!1),google.maps.event.addListenerOnce(this.map,"tilesloaded",function(){self.trigger("onGoogleMapReady")})},CMap.prototype.Visible=function(mode){this.container.style.visibility=Boolean(mode)?"visible":"hidden"},Events.inject(CMap);var TIME_ZONES=[{id:"Africa/Accra",offset:"+00:00"},{id:"Africa/Addis_Ababa",offset:"+03:00",name:"Africa/Addis Ababa"},{id:"Africa/Algiers",offset:"+01:00"},{id:"Africa/Asmera",
offset:"+03:00"},{id:"Africa/Bamako",offset:"+00:00"},{id:"Africa/Bangui",offset:"+01:00"},{id:"Africa/Banjul",offset:"+00:00"},{id:"Africa/Bissau",offset:"+00:00"},{id:"Africa/Blantyre",offset:"+02:00"},{id:"Africa/Brazzaville",offset:"+01:00"},{id:"Africa/Bujumbura",offset:"+02:00"},{id:"Africa/Cairo",offset:"+02:00"},{id:"Africa/Casablanca",offset:"+00:00"},{id:"Africa/Ceuta",offset:"+01:00"},{id:"Africa/Conakry",offset:"+00:00"},{id:"Africa/Dakar",offset:"+00:00"},{id:"Africa/Dar_es_Salaam",offset:"+03:00",name:"Africa/Dar es Salaam"},{id:"Africa/Djibouti",offset:"+03:00"},{id:"Africa/Douala",offset:"+01:00"},{id:"Africa/El_Aaiun",offset:"+00:00",name:"Africa/El Aaiun"},{id:"Africa/Freetown",offset:"+00:00"},{id:"Africa/Gaborone",offset:"+02:00"},{id:"Africa/Harare",offset:"+02:00"},{id:"Africa/Johannesburg",offset:"+02:00"},{id:"Africa/Kampala",offset:"+03:00"},{id:"Africa/Khartoum",offset:"+03:00"},{id:"Africa/Kigali",offset:"+02:00"},{id:"Africa/Kinshasa",offset:"+01:00"},{id:"Africa/Lagos",offset:"+01:00"},{id:"Africa/Libreville",offset:"+01:00"},{id:"Africa/Lome",offset:"+00:00"},{id:"Africa/Luanda",offset:"+01:00"},{id:"Africa/Lubumbashi",offset:"+02:00"},{id:"Africa/Lusaka",offset:"+02:00"},{id:"Africa/Malabo",offset:"+01:00"},{id:"Africa/Maputo",offset:"+02:00"},{id:"Africa/Maseru",offset:"+02:00"},{id:"Africa/Mbabane",offset:"+02:00"},{id:"Africa/Mogadishu",offset:"+03:00"},{id:"Africa/Monrovia",offset:"+00:00"},{id:"Africa/Nairobi",offset:"+03:00"},{id:"Africa/Ndjamena",offset:"+01:00"},{id:"Africa/Niamey",offset:"+01:00"},{id:"Africa/Nouakchott",offset:"+00:00"},{id:"Africa/Ouagadougou",offset:"+00:00"},{id:"Africa/Porto-Novo",offset:"+01:00"},{id:"Africa/Sao_Tome",offset:"+00:00",name:"Africa/Sao Tome"},{id:"Africa/Tripoli",offset:"+02:00"},{id:"Africa/Tunis",offset:"+01:00"},{id:"Africa/Windhoek",offset:"+01:00"},{id:"America/Adak",offset:"-10:00"},{id:"America/Anchorage",offset:"-09:00"},{id:"America/Anguilla",offset:"-04:00"},{id:"America/Antigua",offset:"-04:00"},{id:"America/Araguaina",offset:"-03:00"},{id:"America/Argentina/Buenos_Aires",offset:"-03:00",name:"America/Argentina/Buenos Aires"},{id:"America/Argentina/Catamarca",offset:"-03:00"},{id:"America/Argentina/Cordoba",offset:"-03:00"},{id:"America/Argentina/Jujuy",offset:"-03:00"},{id:"America/Argentina/La_Rioja",offset:"-03:00",name:"America/Argentina/La Rioja"},{id:"America/Argentina/Mendoza",offset:"-03:00"},{id:"America/Argentina/Rio_Gallegos",offset:"-03:00",name:"America/Argentina/Rio Gallegos"},{id:"America/Argentina/San_Juan",offset:"-03:00",name:"America/Argentina/San Juan"},{id:"America/Argentina/Tucuman",offset:"-03:00"},{id:"America/Argentina/Ushuaia",offset:"-03:00"},{id:"America/Aruba",offset:"-04:00"},{id:"America/Asuncion",offset:"-04:00"},{id:"America/Bahia",offset:"-03:00"},{id:"America/Barbados",offset:"-04:00"},{id:"America/Belem",offset:"-03:00"},{id:"America/Belize",offset:"-06:00"},{id:"America/Boa_Vista",offset:"-04:00",name:"America/Boa Vista"},{id:"America/Bogota",offset:"-05:00"},{id:"America/Boise",offset:"-07:00"},{id:"America/Cambridge_Bay",offset:"-07:00",name:"America/Cambridge Bay"},{id:"America/Campo_Grande",offset:"-04:00",name:"America/Campo Grande"},{id:"America/Cancun",offset:"-06:00"},{id:"America/Caracas",offset:"-04:30"},{id:"America/Cayenne",offset:"-03:00"},{id:"America/Cayman",offset:"-05:00"},{id:"America/Chicago",offset:"-06:00"},{id:"America/Chihuahua",offset:"-07:00"},{id:"America/Coral_Harbour",offset:"-05:00",name:"America/Coral Harbour"},{id:"America/Costa_Rica",offset:"-06:00",name:"America/Costa Rica"},{id:"America/Cuiaba",offset:"-04:00"},{id:"America/Curacao",offset:"-04:00"},{id:"America/Danmarkshavn",offset:"+00:00"},{id:"America/Dawson",offset:"-08:00"},{id:"America/Dawson_Creek",offset:"-07:00",name:"America/Dawson Creek"},{id:"America/Denver",offset:"-07:00"},{id:"America/Detroit",offset:"-05:00"},{id:"America/Dominica",offset:"-04:00"},{id:"America/Edmonton",offset:"-07:00"},{id:"America/Eirunepe",offset:"-04:00"},{id:"America/El_Salvador",offset:"-06:00",name:"America/El Salvador"},{id:"America/Fortaleza",offset:"-03:00"},{id:"America/Glace_Bay",offset:"-04:00",name:"America/Glace Bay"},{id:"America/Godthab",offset:"-03:00"},{id:"America/Goose_Bay",offset:"-04:00",name:"America/Goose Bay"},{id:"America/Grand_Turk",offset:"-05:00",name:"America/Grand Turk"},{id:"America/Grenada",offset:"-04:00"},{id:"America/Guadeloupe",offset:"-04:00"},{id:"America/Guatemala",offset:"-06:00"},{id:"America/Guayaquil",offset:"-05:00"},{id:"America/Guyana",offset:"-04:00"},{id:"America/Halifax",offset:"-04:00"},{id:"America/Havana",offset:"-05:00"},{id:"America/Hermosillo",offset:"-07:00"},{id:"America/Indiana/Indianapolis",offset:"-05:00"},{id:"America/Indiana/Knox",offset:"-06:00"},{id:"America/Indiana/Marengo",offset:"-05:00"},{id:"America/Indiana/Petersburg",offset:"-05:00"},{id:"America/Indiana/Vevay",offset:"-05:00"},{id:"America/Indiana/Vincennes",offset:"-05:00"},{id:"America/Inuvik",offset:"-07:00"},{id:"America/Iqaluit",offset:"-05:00"},{id:"America/Juneau",offset:"-09:00"},{id:"America/Kentucky/Louisville",offset:"-05:00"},{id:"America/Kentucky/Monticello",offset:"-05:00"},{id:"America/La_Paz",offset:"-04:00",name:"America/La Paz"},{id:"America/Lima",offset:"-05:00"},{id:"America/Los_Angeles",offset:"-08:00",name:"America/Los Angeles"},{id:"America/Maceio",offset:"-03:00"},{id:"America/Managua",offset:"-06:00"},{id:"America/Manaus",offset:"-04:00"},{id:"America/Martinique",offset:"-04:00"},{id:"America/Mazatlan",offset:"-07:00"},{id:"America/Menominee",offset:"-06:00"},{id:"America/Merida",offset:"-06:00"},{id:"America/Mexico_City",offset:"-06:00",name:"America/Mexico City"},{id:"America/Miquelon",offset:"-03:00"},{id:"America/Moncton",offset:"-04:00"},{id:"America/Monterrey",offset:"-06:00"},{id:"America/Montevideo",offset:"-03:00"},{id:"America/Montreal",offset:"-05:00"},{id:"America/Montserrat",offset:"-04:00"},{id:"America/Nassau",offset:"-05:00"},{id:"America/New_York",offset:"-05:00",name:"America/New York"},{id:"America/Nipigon",offset:"-05:00"},{id:"America/Nome",offset:"-09:00"},{id:"America/Noronha",offset:"-02:00"},{id:"America/North_Dakota/Center",offset:"-06:00",name:"America/North Dakota/Center"},{id:"America/Panama",offset:"-05:00"},{id:"America/Pangnirtung",offset:"-05:00"},{id:"America/Paramaribo",offset:"-03:00"},{id:"America/Phoenix",offset:"-07:00"},{id:"America/Port-au-Prince",offset:"-05:00"},{id:"America/Port_of_Spain",offset:"-04:00",name:"America/Port of Spain"},{id:"America/Porto_Velho",offset:"-04:00",name:"America/Porto Velho"},{id:"America/Puerto_Rico",offset:"-04:00",name:"America/Puerto Rico"},{id:"America/Rainy_River",offset:"-06:00",name:"America/Rainy River"},{id:"America/Rankin_Inlet",offset:"-06:00",name:"America/Rankin Inlet"},{id:"America/Recife",offset:"-03:00"},{id:"America/Regina",offset:"-06:00"},{id:"America/Rio_Branco",offset:"-05:00",name:"America/Rio Branco"},{id:"America/Santiago",offset:"-04:00"},{id:"America/Santo_Domingo",offset:"-04:00",name:"America/Santo Domingo"},{id:"America/Sao_Paulo",offset:"-03:00",name:"America/Sao Paulo"},{id:"America/Scoresbysund",offset:"-01:00"},{id:"America/Shiprock",offset:"-07:00"},{id:"America/Swift_Current",offset:"-06:00",name:"America/Swift Current"},{id:"America/Tegucigalpa",offset:"-06:00"},{id:"America/Thule",offset:"-04:00"},{id:"America/Thunder_Bay",offset:"-05:00",name:"America/Thunder Bay"},{id:"America/Tijuana",offset:"-08:00"},{id:"America/Toronto",offset:"-05:00"},{id:"America/Tortola",offset:"-04:00"},{id:"America/Vancouver",offset:"-08:00"},{id:"America/Whitehorse",offset:"-08:00"},{id:"America/Winnipeg",offset:"-06:00"},{id:"America/Yakutat",offset:"-09:00"},{id:"America/Yellowknife",offset:"-07:00"},{id:"Antarctica/Casey",offset:"+11:00"},{id:"Antarctica/Davis",offset:"+07:00"},{id:"Antarctica/DumontDUrville",offset:"+10:00"},{id:"Antarctica/Mawson",offset:"+05:00"},{id:"Antarctica/McMurdo",offset:"+12:00"},{id:"Antarctica/Palmer",offset:"-04:00"},{id:"Antarctica/Rothera",offset:"-03:00"},{id:"Antarctica/South_Pole",offset:"+12:00",name:"Antarctica/South Pole"},{id:"Antarctica/Syowa",offset:"+03:00"},{id:"Antarctica/Vostok",offset:"+06:00"},{id:"Arctic/Longyearbyen",offset:"+01:00"},{id:"Asia/Aden",offset:"+03:00"},{id:"Asia/Almaty",offset:"+06:00"},{id:"Asia/Amman",offset:"+02:00"},{id:"Asia/Anadyr",offset:"+12:00"},{id:"Asia/Aqtau",offset:"+05:00"},{id:"Asia/Aqtobe",offset:"+05:00"},{id:"Asia/Ashgabat",offset:"+05:00"},{id:"Asia/Ashkhabad",offset:"+05:00"},{id:"Asia/Baghdad",offset:"+03:00"},{id:"Asia/Bahrain",offset:"+03:00"},{id:"Asia/Baku",offset:"+04:00"},{id:"Asia/Bangkok",offset:"+07:00"},{id:"Asia/Beirut",offset:"+02:00"},{id:"Asia/Bishkek",offset:"+06:00"},{id:"Asia/Brunei",offset:"+08:00"},{id:"Asia/Calcutta",offset:"+05:30"},{id:"Asia/Choibalsan",offset:"+08:00"},{id:"Asia/Chongqing",offset:"+08:00"},{id:"Asia/Colombo",offset:"+05:30"},{id:"Asia/Damascus",offset:"+02:00"},{id:"Asia/Dhaka",offset:"+06:00"},{id:"Asia/Dili",offset:"+09:00"},{id:"Asia/Dubai",offset:"+04:00"},{id:"Asia/Dushanbe",offset:"+05:00"},{id:"Asia/Gaza",offset:"+02:00"},{id:"Asia/Harbin",offset:"+08:00"},{id:"Asia/Ho_Chi_Minh",offset:"+07:00",name:"Asia/Ho Chi Minh"},{id:"Asia/Hong_Kong",offset:"+08:00",name:"Asia/Hong Kong"},{id:"Asia/Hovd",offset:"+07:00"},{id:"Asia/Irkutsk",offset:"+09:00"},{id:"Asia/Istanbul",offset:"+02:00"},{id:"Asia/Jakarta",offset:"+07:00"},{id:"Asia/Jayapura",offset:"+09:00"},{id:"Asia/Jerusalem",offset:"+02:00"},{id:"Asia/Kabul",offset:"+04:30"},{id:"Asia/Kamchatka",offset:"+12:00"},{id:"Asia/Karachi",offset:"+05:00"},{id:"Asia/Kashgar",offset:"+08:00"},{id:"Asia/Katmandu",offset:"+05:45"},{id:"Asia/Krasnoyarsk",offset:"+08:00"},{id:"Asia/Kuala_Lumpur",offset:"+08:00",name:"Asia/Kuala Lumpur"},{id:"Asia/Kuching",offset:"+08:00"},{id:"Asia/Kuwait",offset:"+03:00"},{id:"Asia/Macau",offset:"+08:00"},{id:"Asia/Magadan",offset:"+12:00"},{id:"Asia/Makassar",offset:"+08:00"},{id:"Asia/Manila",offset:"+08:00"},{id:"Asia/Muscat",offset:"+04:00"},{id:"Asia/Nicosia",offset:"+02:00"},{id:"Asia/Novokuznetsk",offset:"+07:00"},{id:"Asia/Novosibirsk",offset:"+07:00"},{id:"Asia/Omsk",offset:"+07:00"},{id:"Asia/Oral",offset:"+05:00"},{id:"Asia/Phnom_Penh",offset:"+07:00",name:"Asia/Phnom Penh"},{id:"Asia/Pontianak",offset:"+07:00"},{id:"Asia/Pyongyang",offset:"+09:00"},{id:"Asia/Qatar",offset:"+03:00"},{id:"Asia/Qyzylorda",offset:"+06:00"},{id:"Asia/Rangoon",offset:"+06:30"},{id:"Asia/Riyadh",offset:"+03:00"},{id:"Asia/Saigon",offset:"+07:00"},{id:"Asia/Sakhalin",offset:"+11:00"},{id:"Asia/Samarkand",offset:"+05:00"},{id:"Asia/Seoul",offset:"+09:00"},{id:"Asia/Shanghai",offset:"+08:00"},{id:"Asia/Taipei",offset:"+08:00"},{id:"Asia/Tashkent",offset:"+05:00"},{id:"Asia/Tbilisi",offset:"+04:00"},{id:"Asia/Tehran",offset:"+03:30"},{id:"Asia/Thimphu",offset:"+06:00"},{id:"Asia/Tokyo",offset:"+09:00"},{id:"Asia/Ulaanbaatar",offset:"+08:00"},{id:"Asia/Urumqi",offset:"+08:00"},{id:"Asia/Vientiane",offset:"+07:00"},{id:"Asia/Vladivostok",offset:"+11:00"},{id:"Asia/Yakutsk",offset:"+10:00"},{id:"Asia/Yekaterinburg",offset:"+06:00"},{id:"Asia/Yerevan",offset:"+04:00"},{id:"Atlantic/Azores",offset:"-01:00"},{id:"Atlantic/Bermuda",offset:"-04:00"},{id:"Atlantic/Canary",offset:"+00:00"},{id:"Atlantic/Cape_Verde",offset:"-01:00",name:"Atlantic/Cape Verde"},{id:"Atlantic/Faeroe",offset:"+00:00"},{id:"Atlantic/Jan_Mayen",offset:"+01:00",name:"Atlantic/Jan Mayen"},{id:"Atlantic/Madeira",offset:"+00:00"},{id:"Atlantic/Reykjavik",offset:"+00:00"},{id:"Atlantic/South_Georgia",offset:"-02:00",name:"Atlantic/South Georgia"},{id:"Atlantic/Stanley",offset:"-03:00"},{id:"Australia/Adelaide",offset:"+09:30"},{id:"Australia/Brisbane",offset:"+10:00"},{id:"Australia/Broken_Hill",offset:"+09:30",name:"Australia/Broken Hill"},{id:"Australia/Currie",offset:"+10:00"},{id:"Australia/Darwin",offset:"+09:30"},{id:"Australia/Hobart",offset:"+10:00"},{id:"Australia/Lindeman",offset:"+10:00"},{id:"Australia/Lord_Howe",offset:"+10:30",name:"Australia/Lord Howe"},{id:"Australia/Melbourne",offset:"+10:00"},{id:"Australia/Perth",offset:"+08:00"},{id:"Australia/Sydney",offset:"+10:00"},{id:"Europe/Amsterdam",offset:"+01:00"},{id:"Europe/Andorra",offset:"+01:00"},{id:"Europe/Athens",offset:"+02:00"},{id:"Europe/Belfast",offset:"+00:00"},{id:"Europe/Belgrade",offset:"+01:00"},{id:"Europe/Berlin",offset:"+01:00"},{id:"Europe/Bratislava",offset:"+01:00"},{id:"Europe/Brussels",offset:"+01:00"},{id:"Europe/Bucharest",offset:"+02:00"},{id:"Europe/Budapest",offset:"+01:00"},{id:"Europe/Chisinau",offset:"+02:00"},{id:"Europe/Copenhagen",offset:"+01:00"},{id:"Europe/Dublin",offset:"+00:00"},{id:"Europe/Gibraltar",offset:"+01:00"},{id:"Europe/Guernsey",offset:"+00:00"},{id:"Europe/Helsinki",offset:"+02:00"},{id:"Europe/Isle_of_Man",offset:"+00:00",name:"Europe/Isle of Man"},{id:"Europe/Istanbul",offset:"+02:00"},{id:"Europe/Jersey",offset:"+00:00"},{id:"Europe/Kaliningrad",offset:"+03:00"},{id:"Europe/Kiev",offset:"+02:00"},{id:"Europe/Lisbon",offset:"+00:00"},{id:"Europe/Ljubljana",offset:"+01:00"},{id:"Europe/London",offset:"+00:00"},{id:"Europe/Luxembourg",offset:"+01:00"},{id:"Europe/Madrid",offset:"+01:00"},{id:"Europe/Malta",offset:"+01:00"},{id:"Europe/Mariehamn",offset:"+02:00"},{id:"Europe/Minsk",offset:"+03:00"},{id:"Europe/Monaco",offset:"+01:00"},{id:"Europe/Moscow",offset:"+03:00"},{id:"Europe/Nicosia",offset:"+02:00"},{id:"Europe/Oslo",offset:"+01:00"},{id:"Europe/Paris",offset:"+01:00"},{id:"Europe/Podgorica",offset:"+01:00"},{id:"Europe/Prague",offset:"+01:00"},{id:"Europe/Riga",offset:"+02:00"},{id:"Europe/Rome",offset:"+01:00"},{id:"Europe/Samara",offset:"+04:00"},{id:"Europe/San_Marino",offset:"+01:00",name:"Europe/San Marino"},{id:"Europe/Sarajevo",offset:"+01:00"},{id:"Europe/Simferopol",offset:"+02:00"},{id:"Europe/Skopje",offset:"+01:00"},{id:"Europe/Sofia",offset:"+02:00"},{id:"Europe/Stockholm",offset:"+01:00"},{id:"Europe/Tallinn",offset:"+02:00"},{id:"Europe/Tirane",offset:"+01:00"},{id:"Europe/Tiraspol",offset:"+02:00"},{id:"Europe/Uzhgorod",offset:"+02:00"},{id:"Europe/Vaduz",offset:"+01:00"},{id:"Europe/Vatican",offset:"+01:00"},{id:"Europe/Vienna",offset:"+01:00"},{id:"Europe/Vilnius",offset:"+02:00"},{id:"Europe/Volgograd",offset:"+04:00"},{id:"Europe/Warsaw",offset:"+01:00"},{id:"Europe/Zagreb",offset:"+01:00"},{id:"Europe/Zaporozhye",offset:"+02:00"},{id:"Europe/Zurich",offset:"+01:00"},{id:"Indian/Antananarivo",offset:"+03:00"},{id:"Indian/Chagos",offset:"+06:00"},{id:"Indian/Christmas",offset:"+07:00"},{id:"Indian/Cocos",offset:"+06:30"},{id:"Indian/Comoro",offset:"+03:00"},{id:"Indian/Kerguelen",offset:"+05:00"},{id:"Indian/Mahe",offset:"+04:00"},{id:"Indian/Maldives",offset:"+05:00"},{id:"Indian/Mauritius",offset:"+04:00"},{id:"Indian/Mayotte",offset:"+03:00"},{id:"Indian/Reunion",offset:"+04:00"},{id:"Pacific/Apia",offset:"+13:00"},{id:"Pacific/Auckland",offset:"+12:00"},{id:"Pacific/Chatham",offset:"+12:45"},{id:"Pacific/Easter",offset:"-06:00"},{id:"Pacific/Efate",offset:"+11:00"},{id:"Pacific/Enderbury",offset:"+13:00"},{id:"Pacific/Fakaofo",offset:"+13:00"},{id:"Pacific/Fiji",offset:"+12:00"},{id:"Pacific/Funafuti",offset:"+12:00"},{id:"Pacific/Galapagos",offset:"-06:00"},{id:"Pacific/Gambier",offset:"-09:00"},{id:"Pacific/Guadalcanal",offset:"+11:00"},{id:"Pacific/Guam",offset:"+10:00"},{id:"Pacific/Honolulu",offset:"-10:00"},{id:"Pacific/Johnston",offset:"-10:00"},{id:"Pacific/Kiritimati",offset:"+14:00"},{id:"Pacific/Kosrae",offset:"+11:00"},{id:"Pacific/Kwajalein",offset:"+12:00"},{id:"Pacific/Majuro",offset:"+12:00"},{id:"Pacific/Marquesas",offset:"-09:30"},{id:"Pacific/Midway",offset:"-11:00"},{id:"Pacific/Nauru",offset:"+12:00"},{id:"Pacific/Niue",offset:"-11:00"},{id:"Pacific/Norfolk",offset:"+11:30"},{id:"Pacific/Noumea",offset:"+11:00"},{id:"Pacific/Pago_Pago",offset:"-11:00",name:"Pacific/Pago Pago"},{id:"Pacific/Palau",offset:"+09:00"},{id:"Pacific/Pitcairn",offset:"-08:00"},{id:"Pacific/Ponape",offset:"+11:00"},{id:"Pacific/Port_Moresby",offset:"+10:00",name:"Pacific/Port Moresby"},{id:"Pacific/Rarotonga",offset:"-10:00"},{id:"Pacific/Saipan",offset:"+10:00"},{id:"Pacific/Tahiti",offset:"-10:00"},{id:"Pacific/Tarawa",offset:"+12:00"},{id:"Pacific/Tongatapu",offset:"+13:00"},{id:"Pacific/Truk",offset:"+10:00"},{id:"Pacific/Wake",offset:"+12:00"},{id:"Pacific/Wallis",offset:"+12:00"}],keyboards={ru:[["ru","en"],["en","ru"]],uk:[["uk","en"],["en","uk"]],en:[["en","en"]],de:[["de","en"],["en","de"]],tr:[["tr","en"],["en","tr"]],ar:[["ar","en"],["en","ar"]],codes:["ru","uk","en","de","tr","ar"],index:0},accessControl=function(){function CModalAccessControl(ok,exit,noExit){var self=this,html=element("table",{className:"main maxw"},[element("tr",{},[element("td",{className:"name"},_("Password")),element("td",{className:"data"},this.pass=element("input",{type:"password"}))])]);this.pass.onkeydown=function(event){if(eventPrepare(event,!1,"CModalAccessControl"))switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;case KEYS.UP:case KEYS.DOWN:break;case KEYS.OK:}},this.onShow=function(){setTimeout(function(){self.pass.focus()},5)},CModalAlert.call(this,accessControl.parent||currCPage,_("Unlock"),html,_("Cancel"),exit),this.focusList.push(this.pass),this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free(),gSTB.EnableAppButton(!0)},this.name="CModalAccessControl",this.bpanel.Add(KEYS.OK,"ok.png",_("Ok"),function(){accessControl.login(self.pass.value)&&(self.Show(!1),gSTB.EnableAppButton(!0),"function"==typeof ok&&ok())}),noExit&&this.bpanel.Hidden(this.bpanel.btnExit,!0)}function CModalAccessControlLogOut(portals){var text,self=this;text=_(portals?"Lock device or exit portal?":"Lock device?"),CModalAlert.call(this,accessControl.parent||currCPage,_("Confirm"),text,_("Cancel")),this.focusList.push(this.pass),this.name="CModalAccessControlLogOut",this.bpanel.Add(KEYS.OK,"ok.png",_("Lock"),function(){accessControl.logout(),self.Show(!1),accessControl.showLoginForm(null,null,accessControl.data.events.portalOpen)}),portals&&this.bpanel.Add(KEYS.BACK,"back.png",_("Exit portal"),function(){accessControl.logout(),window.location=PATH_SYSTEM+"pages/loader/index.html"})}var env;return CModalAccessControl.prototype=Object.create(CModalAlert.prototype),CModalAccessControl.prototype.constructor=CModalAccessControl,CModalAccessControlLogOut.prototype=Object.create(CModalAlert.prototype),CModalAccessControlLogOut.prototype.constructor=CModalAccessControlLogOut,{state:!1,password:null,loginForm:null,data:{pages:{},events:{}},login:function(password,noEvent){return password!==this.password?!1:(this.state=!1,stbStorage.setItem("accessControl",this.state),noEvent||stbWebWindow.messageBroadcast("accessControl",this.state),!0)},logout:function(){this.password=env.acPassword,env.accessControl?this.state=!0:this.state=!1,stbWebWindow.messageBroadcast("accessControl",this.state),stbStorage.setItem("accessControl",this.state)},showLoginForm:function(ok,exit,noExit){return gSTB.EnableAppButton(!1),this.loginForm=new CModalAccessControl(ok,exit,noExit),this.loginForm},showLogoutForm:function(portals){return new CModalAccessControlLogOut(portals)},init:function(parent){var text,stb,self=this;if(window.environment)env=environment;else try{env=JSON.parse(gSTB.GetEnv(JSON.stringify({varList:["acPassword","accessControl"]}))).result,env.accessControl="true"===env.accessControl?!0:!1}catch(e){echo(e,"Environment load"),env={}}stbEvent.bind("broadcast.accessControl",function(data){echo(data.data,"broadcast.accessControl"),self.loginForm&&self.loginForm.Show(!1),self.state="true"===data.data}),this.parent=parent;try{text=gSTB.LoadUserData("access.control.json"),""!==text&&(this.data=JSON.parse(text))}catch(e){echo(e,"AccessControl parse")}stbStorage.getItem("accessControl")&&(stb="false"===stbStorage.getItem("accessControl")),env.acPassword=env.acPassword||"",env.accessControl&&(this.state=stb?!1:!0,this.password=env.acPassword),stbStorage.setItem("accessControl",this.state)},save:function(){gSTB.SaveUserData("access.control.json",JSON.stringify(this.data))}}}();Emitter.prototype={addListener:function(name,callback){this.events[name]=this.events[name]||[],this.events[name].push(callback)},once:function(name,callback){var self=this;this.events[name]=this.events[name]||[],this.events[name].push(function onceWrapper(){callback.apply(this,arguments),self.removeListener(name,onceWrapper)})},addListeners:function(callbacks){var name;for(name in callbacks)callbacks.hasOwnProperty(name)&&this.addListener(name,callbacks[name])},removeListener:function(name,callback){this.events[name]&&(this.events[name]=this.events[name].filter(function(fn){return fn!==callback}),0===this.events[name].length&&(this.events[name]=void 0))},removeAllListeners:function(name){0===arguments.length?this.events={}:name&&(this.events[name]=void 0)},emit:function(name){var i,event=this.events[name];if(event)for(i=0;i<event.length;i++)event[i].apply(this,Array.prototype.slice.call(arguments,1))}},Emitter.prototype.constructor=Emitter;var messageId=0,callbacks={};Wamp.prototype=Object.create(Emitter.prototype),Wamp.prototype.constructor=Wamp,Wamp.prototype.router=function(message){var self=this;console.log("router"),console.log(message);try{message=JSON.parse(message)}catch(e){return void this.socket.send(JSON.stringify({jsonrpc:"2.0",error:{code:-32700,message:"Parse error"},id:null}))}"id"in message&&!("method"in message)?message.id in callbacks&&(callbacks[message.id](message.error,message.result),delete callbacks[message.id]):!("id"in message)&&"method"in message?this.events[message.method]&&this.emit(message.method,message.params):"id"in message&&"method"in message?this.events[message.method]?this.emit(message.method,message.params,function(error,result){self.socket.send(JSON.stringify({jsonrpc:"2.0",error:error,result:result,id:message.id}))}):this.socket.send(JSON.stringify({jsonrpc:"2.0",error:{code:-32601,message:"Method not found"},id:message.id})):this.socket.send(JSON.stringify({jsonrpc:"2.0",error:{code:-32600,message:"Invalid Request"},id:null}))},Wamp.prototype.call=function(method,params,callback){var message={jsonrpc:"2.0",method:method};params&&(message.params=params),"function"==typeof callback&&(message.id=++messageId,callbacks[messageId]=callback),console.log(JSON.stringify(message)),this.socket.send(JSON.stringify(message))};var MEDIA_TYPE_NONE=0,MEDIA_TYPE_STORAGE_SATA=1,MEDIA_TYPE_STORAGE_USB=2,MEDIA_TYPE_STORAGE_SD=3,MEDIA_TYPE_STORAGE_MMC=4,MEDIA_TYPE_SAMBA_ROOT=10,MEDIA_TYPE_SAMBA_GROUP=11,MEDIA_TYPE_SAMBA_HOST=12,MEDIA_TYPE_SAMBA_SHARE=13,MEDIA_TYPE_UPNP=20,MEDIA_TYPE_UPNP_ROOT=21,MEDIA_TYPE_UPNP_HOST=22,MEDIA_TYPE_UPNP_FOLDER=23,MEDIA_TYPE_NFS_ROOT=30,MEDIA_TYPE_NFS_HOST=31,MEDIA_TYPE_NFS_SHARE=32,MEDIA_TYPE_RECORDS_ROOT=50,MEDIA_TYPE_RECORDS_CHAN=51,MEDIA_TYPE_RECORDS_DATE=52,MEDIA_TYPE_RECORDS_ITEM=53,MEDIA_TYPE_BACK=60,MEDIA_TYPE_FOLDER=61,MEDIA_TYPE_VIDEO=62,MEDIA_TYPE_AUDIO=63,MEDIA_TYPE_IMAGE=64,MEDIA_TYPE_TEXT=65,MEDIA_TYPE_ISO=66,MEDIA_TYPE_PLAYLIST=67,MEDIA_TYPE_CUE=68,MEDIA_TYPE_CUE_ITEM=69,MEDIA_TYPE_URL=70,MEDIA_TYPE_GROUP=80,MEDIA_TYPE_STREAM=81,MEDIA_TYPE_STREAM_TS=82,MEDIA_TYPE_DVB=83,MEDIA_TYPE_FAVORITES=84,MEDIA_TYPE_PVR_ROOT=90,MEDIA_TYPE_PVR_SHED=91,MEDIA_TYPE_PVR_REC=92,MEDIA_TYPE_PVR_ERR=93,MEDIA_TYPE_PVR_DONE=94,MEDIA_TYPE_DVB_ROOT=100,MEDIA_TYPE_IB_ROOT=101,MEDIA_TYPE_MB_ROOT=102,MEDIA_TYPE_TV_ROOT=103,MEDIA_TYPE_EPG_ROOT=105,MEDIA_TYPE_HELP_ROOT=200,MEDIA_TYPE_HELP_FOLDER=201,MEDIA_TYPE_HELP_ARTICLE=202,MEDIA_TYPE_HELP_BACK=203,MEDIA_ACTION_OPEN=1,MEDIA_ACTION_OPEN_SELECTED=2,MEDIA_ACTION_ITEM_MOUNT=3,MEDIA_ACTION_ITEM_UNMOUNT=4,MEDIA_ACTION_MOUNT_EDIT=5,MEDIA_ACTION_SELECT_ONE=6,MEDIA_ACTION_SELECT_ALL=7,MEDIA_ACTION_DESELECT=8,MEDIA_ACTION_INVERT=9,MEDIA_ACTION_CUT=10,MEDIA_ACTION_COPY=11,MEDIA_ACTION_PASTE=12,MEDIA_ACTION_DELETE=13,MEDIA_ACTION_EDIT=14,MEDIA_ACTION_SAVE=15,MEDIA_ACTION_CREATE_GROUP=16,MEDIA_ACTION_SORT_NONE=17,MEDIA_ACTION_SORT_TYPE=18,MEDIA_ACTION_SORT_EXT=19,MEDIA_ACTION_SORT_NAME=20,MEDIA_ACTION_SORT_SIZE=21,MEDIA_ACTION_SORT_TIME=22,MEDIA_ACTION_NEW_GROUP=23,MEDIA_ACTION_TOOLS_MOUNT=24,MEDIA_ACTION_TOOLS_UNMOUNT=25,MEDIA_ACTION_TOOLS_FORMAT=26,MEDIA_ACTION_TSEND_CICLICK=27,MEDIA_ACTION_TSEND_STOP=28,MEDIA_ACTION_TS_ON=29,MEDIA_ACTION_TS_OFF=30,MEDIA_ACTION_SUBTITLE_MOUNT=31,MEDIA_ACTION_CREATE_RECORD=32,MEDIA_ACTION_ADD_ITEM=33,MEDIA_ACTION_ADD_OPER_TVLIST=34,MEDIA_ACTION_ADD_TVLIST=35,MEDIA_ACTION_ADD_TVCHANNEL=36,MEDIA_ACTION_ADD_FOLDER=37,MEDIA_ACTION_AUTO_SCAN_DVB=38,MEDIA_ACTION_MANUAL_SCAN_DVB=39,MEDIA_ACTION_DVB_EPG=40,MEDIA_ACTION_CLEAR_DVB=41,MEDIA_ACTION_STOP_RECORD=43,MEDIA_ACTION_ADD_FAV=44,MEDIA_ACTION_REMOVE_FAV=45,MEDIA_ACTION_EXPAND_ALL=46,MEDIA_ACTION_COLLAPSE_ALL=47,MEDIA_ACTION_DVB_EPG_GRID=48,MEDIA_ACTION_EXPORT_CHANNEL=49,MEDIA_ACTION_PLAY=50,MEDIA_EXTENSION={},MEDIA_TYPES=[MEDIA_TYPE_VIDEO,MEDIA_TYPE_AUDIO,MEDIA_TYPE_IMAGE,MEDIA_TYPE_TEXT,MEDIA_TYPE_ISO,MEDIA_TYPE_PLAYLIST,MEDIA_TYPE_CUE,MEDIA_TYPE_RECORDS_ITEM];MEDIA_EXTENSION[MEDIA_TYPE_VIDEO]=["mpg","mpeg","mov","mp4","avi","mkv","3gp","ts","vob","wmv","mts","m2t","m2v","divx","m2ts","m2p","tp","flv","mod","tod","asf","tts","m4v","trp","wtv"],MEDIA_EXTENSION[MEDIA_TYPE_AUDIO]=["mp3","wav","ac3","ogg","oga","aiff","wv","tta","wma","aac","dts","flac","ape","m4a"],MEDIA_EXTENSION[MEDIA_TYPE_IMAGE]=["jpg","jpeg","png","bmp","tif","tiff","raw","gif","cr2","nef","orf","iiq","ico","psd","webp","tif","tiff"],MEDIA_EXTENSION[MEDIA_TYPE_TEXT]=["txt","srt","sub","ass"],MEDIA_EXTENSION[MEDIA_TYPE_ISO]=["iso"],MEDIA_EXTENSION[MEDIA_TYPE_PLAYLIST]=["m3u","m3u8"],MEDIA_EXTENSION[MEDIA_TYPE_CUE]=["cue"],MEDIA_EXTENSION[MEDIA_TYPE_RECORDS_ITEM]=["tspinf"];var MODEL_TYPE=gSTB.GetDeviceModelExt(),environment={},STORAGE_INFO=[],HDD_INFO=[],SMB_ARRAY=[],SMB_DATA=null,SMB_MOUNTED=!1,SMB_AUTH={},SMB_SRV_AUTH={},SMB_PATH="/ram/mnt/smb",NFS_ARRAY=[],NFS_DATA=null,NFS_MOUNTED=!1,NFS_PATH="/ram/mnt/nfs",FAVORITES={},FAVORITES_NEW={},FAVORITES_CHANGED=!1,CURRENT_NETWORK_STATE=!1,CURRENT_WIFI_STATE=!1,CURRENT_INTERNET_STATE=!1,currCPage=null,baseCPage=null,PLSCFG={},OPERATORS_PLS_AUTOREFRESH=0,OPERATORS_PLS_GROUP_NAME="",OPERATORS_PLS_URL="http://192.168.1.60:8000/list.m3u",IPTV_PLAYBACK_ON_START=!1,VIDEO_MODE="576i",controlModel="SRC4807",ts_time=3600,ts_endType=1,ts_exitType=1,ts_lag=0,ts_sol={720:[290,12],1280:[650,14],1920:[975,21]},dvbTypes=[],remoteControlButtonsImagesPath=configuration.newRemoteControl?PATH_IMG_SYSTEM+"buttons/new/":PATH_IMG_SYSTEM+"buttons/old/",stbEvent={onEvent:function(){},onNetworkStateChange:function(state){echo(state,"stbEvent.onNetworkStateChange")},onInternetStateChange:function(state){echo(state,"stbEvent.onInternetStateChange")},onMessage:function(from,message,data){switch(echo(message,"Portal.onMessage"),message){case"player.timeshift.status":stbWebWindow.messageSend(from,message,MediaPlayer.ts_inProgress)}this.trigger(message,{from:from,data:data})},onBroadcastMessage:function(from,message,data){echo(message,"Portal.onBroadcastMessage"),this.trigger("broadcast."+message,{from:from,data:data})},onInputLanguageChange:function(){echo("stbEvent.onInputLanguageChange");var nextInputLanguage,i,currentInputLanguage=gSTB.GetInputLang();for(i=0;i<keyboards[environment.language].length;i++)currentInputLanguage===keyboards[environment.language][i][0]&&(keyboards.index=i);for(nextInputLanguage=keyboards[environment.language][keyboards.index][1],i=0;i<keyboards[environment.language].length;i++)if(nextInputLanguage===keyboards[environment.language][i][0]){keyboards.index!==i&&(keyboards.index=i,gSTB.SetInputLang(nextInputLanguage));break}}};Events.inject(stbEvent),stbStorage.setItem(getWindowKey(WINDOWS.PORTAL),stbWebWindow.windowId()),window.moveTo(0,0),window.resizeTo(EMULATION?window.outerWidth:screen.width,EMULATION?window.outerHeight:screen.height),window.oncontextmenu=EMULATION?null:function(){return!1};var imageList=["type_1.png","type_2.png","type_3.png","type_4.png","type_10.png","type_11.png","type_12.png","type_13.png","type_20.png","type_21.png","type_22.png","type_23.png","type_32.png","type_50.png","type_51.png","type_52.png","type_53.png","type_60.png","type_61.png","type_62.png","type_63.png","type_64.png","type_65.png","type_66.png","type_67.png","type_68.png","type_69.png","type_70.png","type_80.png","type_81.png","type_90.png","type_91.png","type_92.png","type_93.png","type_94.png","type_100.png","type_101.png","type_102.png","type_103.png","type_200.png","type_201.png","type_202.png","ico_sub.png"].map(function(image){return PATH_IMG_PUBLIC+"media/"+image});imageList=imageList.concat(["aspect.png"].map(function(image){return PATH_ROOT+"public/img/"+image})),imageLoader(imageList);var ServiceMenu=new CPage;ServiceMenu.name="ServiceMenu",ServiceMenu.needToCheckUpdate=!1,baseCPage=ServiceMenu,ServiceMenu.EventHandler=function(event){switch(as.layer){case as.layers.SL:break;case as.layers.WS:break;case as.layers.BASE:switch(event.code){case KEYS.RIGHT:case KEYS.LEFT:case KEYS.DOWN:case KEYS.UP:app.move(event.code);break;case KEYS.OK:app.PressOK();break;case KEYS.INFO:var id=as.position.current.x+as.position.current.y*configuration.desktop.x,item=configuration.menu[configuration.desktop.number][id];openWindowHelp(item.help);break;case KEYS.EXIT:app.pressExit()}}},window.onload=function(){echo("******** STB STARTED ********"),checkEnvVars();try{environment=loadEnvironmentVars(null),gSTB.SetSettingsInitAttr(JSON.stringify({url:PATH_SYSTEM+"settings/index.html",backgroundColor:"#000"})),stbWindowMgr.setVirtualKeyboardInitAttr(JSON.stringify({url:PATH_SYSTEM+"keyboard/index.html?nodebug=true"})),setTimeout(function(){sendVisitData(),environment.ssaverName||(environment.ssaverName="clock",gSTB.SetEnv(JSON.stringify({ssaverName:environment.ssaverName}))),gSTB.SetScreenSaverInitAttr(JSON.stringify({url:configuration.screensaversPath+"/"+environment.ssaverName+"/index.html?nodebug=true",backgroundColor:"#000"})),gSTB.SetScreenSaverTime(10*environment.ssaverDelay),"function"==typeof gSTB.SetAutoPowerDownInitAttr&&(gSTB.SetAutoPowerDownInitAttr(JSON.stringify({url:PATH_SYSTEM+"pages/standby/index.html",backgroundColor:"transparent"})),gSTB.SetAutoPowerDownTime(environment.autoPowerDownTime))},2e4),gettext.init({name:environment.language,path:"public/portal/lang"},function(){loadScript("public/portal/lang.js",function(){echo(WINDOW_WIDTH+"x"+WINDOW_HEIGHT,"screen resolution"),echo(environment.language,"current language");try{gSTB.ShowVirtualKeyboard(!0),gSTB.EnableServiceButton(!0),gSTB.EnableAppButton(!0),gSTB.EnableTvButton(!1),fillPage(),init2(),startPortal(),getStorageInfo(),MediaBrowser.Init(document.getElementById("pageMediaBrowser")),MediaPlayer.Init(document.getElementById("pageMediaPlayer")),WeatherPage.Init(document.getElementById("weatherSettings")),IPTVChannels.Init(document.getElementById("pageTVChannels")),configuration.mayDVB&&DVBChannels.Init(document.getElementById("pageDVBChannels")),(configuration.mayDVB||configuration.mayEPG)&&DVBEpg.Init(document.getElementById("pageDVBEpg")),importStbParams(),MediaBrowser.UnmountSMB(!0),MediaBrowser.UnmountNFS(!0);var imageList=["back.png","chnl_minus.png","chnl_plus.png","exit.png","f1.png","f2.png","f3.png","f4.png","frame.png","info.png","menu.png","next.png","ok.png","pgdown.png","pgup.png","playpause.png","prev.png","refresh.png","stop.png"].map(function(image){return remoteControlButtonsImagesPath+image});imageList=imageList.concat(["cinema.png","def.png","dm.png","favs.png","iserv.png","manual.png","master.png","mb.png","nettv.png","pvr.png","radio.png","settings.png","tv.png","weather.png","web.png"].map(function(image){return PATH_IMG_PUBLIC+"menu/icons/"+image})),imageList=imageList.concat(["topmenu_bg.png","bottommenu_bg.png","select_list_bg.png","player_menu_bg.png"].map(function(image){return PATH_IMG_PUBLIC+"backgrounds/"+image})),imageList=imageList.concat(["update.png","timeshift.png","speedtest.png","settings.png","master.png","settings_blue.png","subtitles.png","screenmenu.png","dvb.png","access.png"].map(function(image){
return PATH_IMG_PUBLIC+"settings/"+image})),imageList=imageList.concat(["indicator_lan.png","indicator_net.png","indicator_wifi.png"].map(function(image){return PATH_IMG_PUBLIC+"indicator/"+image})),imageList=imageList.concat(["ico_water.png","ico_moon.png","ico_wind.png","ico_sun.png","ico_filter.png","ico_search.png","ico_search2.png"].map(function(image){return PATH_IMG_PUBLIC+image})),imageList=imageList.concat(["volume_bar.png","volume_bg.png","volume_left.png","volume_off.png"].map(function(image){return PATH_IMG_PUBLIC+"volume/"+image})),imageList=imageList.concat(["0.png","1.png","2.png","3.png","4.png","5.png","6.png","7.png","8.png"].map(function(image){return PATH_IMG_PUBLIC+"codec/"+image})),imageList=imageList.concat(["glass.png"].map(function(image){return PATH_IMG_PUBLIC+"menu/"+image})),getNetState(!0),imageLoader(imageList,synchronizeOperatorChannels(function(){var map=[],i=0,index=-1;if(document.getElementById("loading").style.display="none",document.addEventListener("keydown",mainEventListener),accessControl.init(),environment.startPage&&(configuration.startPage=environment.startPage),configuration.startPage&&"null"!==configuration.startPage){for(i=0;i<configuration.menu.length&&(map=configuration.menu[i].map(function(item){return item.name}),index=map.indexOf(configuration.startPage),-1===index);i++);-1!==index&&configuration.menu[i][index].script?(currCPage=ServiceMenu,configuration.desktop.number=i,app.moveit(0,index),accessControl.state&&(accessControl.data.events.portalOpen||accessControl.data.pages[configuration.menu[i][index].name])?(ServiceMenu.Show(),accessControl.showLoginForm(configuration.menu[i][index].script,null,!0)):configuration.menu[i][index].script()):(ServiceMenu.Show(),accessControl.state&&accessControl.data.events.portalOpen&&accessControl.showLoginForm(null,null,!0))}else ServiceMenu.Show(),accessControl.state&&accessControl.data.events.portalOpen&&accessControl.showLoginForm(null,null,!0);if(document.getElementById("volumeLeft").src=PATH_IMG_PUBLIC+"volume/volume_left.png",environment.audio_initial_volume||0===environment.audio_initial_volume?volumeSetVolume(environment.audio_initial_volume):gSTB.SetVolume(environment.audio_initial_volume=configuration.volume.def),!EMULATION&&DEBUG&&DEBUG_NAME&&DEBUG_SERVER&&window.ProxyServer){var proxy=new ProxyServer;proxy.init({name:DEBUG_NAME,host:DEBUG_SERVER})}stbEvent.bind("window.reload",function(){document.body.style.display="none",stbStorage.removeItem(getWindowKey(WINDOWS.PORTAL)),window.location=PATH_SYSTEM+"pages/loader/index.html"}),stbEvent.bind("video.mode.reload",function(data){var newVideoMode;data=data&&data.data?JSON.parse(data.data):{};try{newVideoMode=gSTB.RDir("vmode")}catch(e){echo(e,"vmode rdir error")}newVideoMode!==VIDEO_MODE&&(echo("VIDEO_MODE was:"+VIDEO_MODE+" now:"+newVideoMode),VIDEO_MODE=newVideoMode,MediaBrowser.refreshPreviewViewport(),MediaPlayer.fullScreen=!MediaPlayer.fullScreen,MediaPlayer.changeScreenMode(),data.manual&&MediaPlayer.standByOff(!0))}),stbEvent.bind("portal.standbyMode",function(message){var standByStatus=!gSTB.GetStandByStatus(),isHdmiEvent="hdmiEvent"===message.data;return gSTB.StandByMode!==Number(environment.standByMode)&&(gSTB.StandByMode=Number(environment.standByMode)),3===Number(environment.standByMode)?(MediaPlayer.standByOn(isHdmiEvent)||(gSTB.SetLedIndicatorMode(2),gSTB.StandBy(standByStatus)),gSTB.SetLedIndicatorMode(1),void MediaPlayer.standByOff()):(echo("isHdmiEvent = "+isHdmiEvent),echo("standByStatus="+standByStatus),void(standByStatus?MediaPlayer.standByOn(isHdmiEvent)||(gSTB.StandBy(standByStatus),gSTB.SetLedIndicatorMode(2)):(gSTB.StandBy(standByStatus),gSTB.SetLedIndicatorMode(1),MediaPlayer.standByOff())))}),stbEvent.bind("broadcast.storage.mount",function(){echo("broadcast.storage.mount in portal"),setTimeout(function(){new CModalHint(currCPage,_("USB storage is connected"),3e3)},0),currCPage&&"function"==typeof currCPage.onMountAction?currCPage.onMountAction(!0):(echo("default portal USB MOUNTED action"),getStorageInfo(),MediaBrowser.isVisible&&MediaBrowser.FileList.mode===MEDIA_TYPE_MB_ROOT&&(MediaBrowser.FileList.Refresh(),MediaBrowser.Preview.SetItemsCount()))}),stbEvent.bind("broadcast.storage.unmount",function(){echo("broadcast.storage.unmount in portal"),currCPage&&"function"==typeof currCPage.onMountAction?currCPage.onMountAction(!1):(echo("default portal USB UNMOUNTED action"),getStorageInfo(),MediaBrowser.isVisible&&MediaBrowser.FileList.mode===MEDIA_TYPE_MB_ROOT?(MediaBrowser.FileList.Refresh(),MediaBrowser.FileList.Activate(!0),MediaBrowser.Preview.Info(MediaBrowser.FileList.activeItem?MediaBrowser.FileList.activeItem.data:null),MediaBrowser.Preview.SetItemsCount()):(MediaBrowser.FileList.mode===MEDIA_TYPE_STORAGE_SATA||MediaBrowser.FileList.mode===MEDIA_TYPE_STORAGE_USB)&&(gSTB.IsFolderExist(MediaBrowser.FileList.parentItem.url)||MediaBrowser.Reset()))}),stbEvent.bind("environment.reload",function(){environment=loadEnvironmentVars(environment.audio_initial_volume)}),gSTB.SetLedIndicatorLevels(parseInt(environment.defaultLedLevel),parseInt(environment.standbyLedLevel)),ServiceMenu.needToCheckUpdate&&SettingsPage.loadUpdateList(!0),echo("done")}))}catch(err){echo(err)}})})}catch(err){echo(err)}},sendPingRequest.errorCount=0,sendPingRequest.linkIndex=0,CURRENT_WIFI_STATE=gSTB.GetWifiLinkStatus(),stbEvent.onWifiStateChange=function(state){state=!!state,CURRENT_WIFI_STATE!==state&&(CURRENT_WIFI_STATE=state,document.getElementById("wifi_status").className=state?"active":"",getNetworkState()&&sendPingRequest())};var getNetStateTimer=null,SettingsPage=new CPage;SettingsPage.name="SettingsPage",SettingsPage.onInit=function(){var self=this,map=[];settingsClockControl(),settingsFrontPanelControl(),this.FileList=new CScrollList(this),this.FileList.Init(this.handle.querySelector(".body .content .cslist-main")),this.FileList.Add=generate,this.FileList.AddElement=generate_elements,this.FileList.AddTable=generate_table,this.update_list=[],this.FileList.EventHandler=function(event){var element=SettingsPage.FileList.elements[SettingsPage.FileList.activeItem.number];if("function"==typeof element.EventHandler)element.EventHandler(event);else switch(event.code){case KEYS.LEFT:case KEYS.RIGHT:event.stopped=!0}CScrollList.prototype.EventHandler.call(this,event)},this.BCrumb=new CBreadCrumb,this.BCrumb.Init(PATH_IMG_PUBLIC+"settings/",this.handle.querySelector(".body .header .cbcrumb")),this.BCrumb.SetName(_("Settings")),this.BCrumb.Push("/","settings_blue.png",""),this.pressExit=sett_pressExit,this.save=settingsSave,this.loadUpdateList=loadUpdateList,this.advanced=function(){},this.changes={},this.main=[],this.FileList.initPages={Playback:sett_Playback_init,Interface:sett_Interface_init,AutoUpdate:sett_AutoUbdate_init,TS:sett_TS_init,SpeedTest:sett_speed_test_init,Traceroute:sett_traceroute_init,Setup:sett_setup_init,MasterSettingsStart:sett_master_settings_init,DVB:sett_DVB_init,accessControl:settAccessControl,Main:function(){SettingsPage.BPanel.Hidden(SettingsPage.buttons.F1,!0),SettingsPage.BPanel.Hidden(SettingsPage.buttons.F2,!0),SettingsPage.BPanel.Hidden(SettingsPage.buttons.OK,!0),SettingsPage.FileList.layer=SettingsPage.FileList.layers.mainPage,SettingsPage.FileList.Add(SettingsPage.main)},Teletext:sett_Teletext_init},function(){var item,tmpList=[],dict={playback:{name:_("Playback"),rId:"Playback",className:"subtitles",func:self.FileList.initPages.Playback},"interface":{name:_("Interface"),rId:"Interface",className:"screenmenu",func:self.FileList.initPages.Interface},update:{name:_("Software autoupdate"),rId:"SoftwareAutoUpdate",className:"update",func:self.FileList.initPages.AutoUpdate},timeShift:{name:_("TimeShift"),rId:"TimeShift",className:"timeshift",func:self.FileList.initPages.TS},settings:{name:_("System settings"),rId:"SystemSettings",className:"settings",func:self.FileList.initPages.Setup},masterSettings:{name:_("Setup Wizard"),rId:"SetupWizard",className:"masterSettings",func:self.FileList.initPages.MasterSettingsStart},DVB:{name:_("DVB"),rId:"DVB",className:"dvb",func:self.FileList.initPages.DVB},accessControl:{name:_("Access control"),rId:"accessControl",className:"accessControl",func:self.FileList.initPages.accessControl},teletext:{name:_("Teletext"),rId:"teletext",className:"teletext",func:self.FileList.initPages.Teletext}};-1!==configuration.setting.settingsList.indexOf("traceroute")&&RULES.Traceroute&&-1!==configuration.setting.settingsList.indexOf("speedTest")&&RULES.SpeedTest?(dict.speedTest={name:_("Network Diagnostics"),rId:"SpeedTest",className:"speedtest",func:self.FileList.initPages.SpeedTest},dict.traceroute={rId:!1}):-1!==configuration.setting.settingsList.indexOf("speedTest")&&RULES.SpeedTest?(dict.speedTest={name:_("Speed test"),rId:"SpeedTest",className:"speedtest",func:self.FileList.initPages.SpeedTest},dict.traceroute={rId:!1}):-1!==configuration.setting.settingsList.indexOf("traceroute")&&RULES.Traceroute?(dict.traceroute={name:_("Network Diagnostics"),rId:"Traceroute",className:"traceroute",func:self.FileList.initPages.Traceroute},dict.speedTest={rId:!1}):(dict.speedTest={rId:!1},dict.traceroute={rId:!1});for(var i=0;i<configuration.setting.settingsList.length;i++)item=dict[configuration.setting.settingsList[i]],tmpList.push(item),echo(item,i),RULES[item.rId]&&(map.push(configuration.setting.settingsList[i]),self.main.push(item));-1!==configuration.setting.settingsList.indexOf("traceroute")&&RULES.Traceroute&&-1!==configuration.setting.settingsList.indexOf("speedTest")&&RULES.SpeedTest&&map.push("traceroute")}(),this.FileList.layers={mainPage:0,playback:map.indexOf("playback")+1,Interface:map.indexOf("interface")+1,AutoUpdate:map.indexOf("update")+1,TS:map.indexOf("timeShift")+1,SpeedTest:map.indexOf("speedTest")+1,Setup:map.indexOf("settings")+1,MasterSettingsStart:map.indexOf("masterSettings")+1,DVB:map.indexOf("DVB")+1,accessControl:map.indexOf("accessControl")+1,Traceroute:map.indexOf("traceroute")+1,teletext:map.indexOf("teletext")+1},this.ExitBPanel=new CButtonPanel(this),this.ExitBPanel.Init(remoteControlButtonsImagesPath,this.handle.querySelector(".body .footer .exit div.cbpanel-main")),this.ExitBPanel.btnExit=this.ExitBPanel.Add(KEYS.EXIT,"exit.png",configuration.newRemoteControl?_("Exit"):"",function(){SettingsPage.pressExit()}),this.BPanel=new CButtonPanel(this),this.BPanel.Init(remoteControlButtonsImagesPath,this.handle.querySelector(".body .footer .main div.cbpanel-main")),this.buttons={},this.buttons.F1=this.BPanel.Add(KEYS.F1,"f1.png",_("Advanced"),function(){SettingsPage.advanced()},!0),this.buttons.F2=this.BPanel.Add(KEYS.F2,"f2.png",_("Update manually"),function(){UpdatePage.Show(!1,!1)},!0),this.buttons.OK=this.BPanel.Add(KEYS.OK,"ok.png",_("Save"),this.save,!0),this.BPanelTraceroute=new CButtonPanel(this),this.BPanelTraceroute.listButtons=[],this.BPanelTraceroute.activeItemIndex=0,this.BPanelTraceroute.EventHandler=function(event){return event.code===KEYS.OK?(echo(this.listButtons[this.activeItemIndex].data.onclick),void this.listButtons[this.activeItemIndex].data.onclick()):(this.listButtons[this.activeItemIndex].classList.remove("focused"),event.code===KEYS.LEFT?(--this.activeItemIndex,this.activeItemIndex<0&&(this.activeItemIndex=this.listButtons.length-1)):event.code===KEYS.RIGHT&&(++this.activeItemIndex,this.activeItemIndex===this.listButtons.length&&(this.activeItemIndex=0)),void this.listButtons[this.activeItemIndex].classList.add("focused"))},this.mouse_over=function(e){SettingsPage.FileList.Focused(e.currentTarget,!0,!0)},this.mouse_over_element=function(e){SettingsPage.FileList.Focused(e.currentTarget,!0,!0)}},SettingsPage.onShow=function(){this.loadUpdateList(),SettingsPage.FileList.layer!==SettingsPage.FileList.layers.MasterSettingsStart&&(this.FileList.back_element=[0,0,0,0,0,0,0,0]),this.FileList.initPages.Main()},SettingsPage.onMountAction=function(){if(echo("onMountAction in timeshift settings"),getStorageInfo(),SettingsPage.FileList.layer===SettingsPage.FileList.layers.TS){var name,value,path_list=[],no_path=!0;if(STORAGE_INFO.length>0){for(var i=0;i<STORAGE_INFO.length;i++)name=STORAGE_INFO[i].label,value=STORAGE_INFO[i].mountPath,path_list[i]={title:name,value:value},environment.ts_path===value&&(no_path=!1);no_path&&path_list.splice(0,0,{title:_("None"),value:""})}else path_list.splice(0,0,{title:_("None"),value:""});SettingsPage.FileList.elements[2].SetData(path_list),SettingsPage.FileList.elements[2].SelectById(environment.ts_path,!1)}},SettingsPage.EventHandler=function(e){switch(SettingsPage.FileList.layer){case SettingsPage.FileList.layers.mainPage:var found;switch(e.code){case KEYS.EXIT:SettingsPage.pressExit();break;case KEYS.DOWN:found=this.FileList.Next(null,!1,2,!1);break;case KEYS.UP:found=this.FileList.Next(null,!0,2,!1);break;case KEYS.LEFT:found=this.FileList.Next(null,!0);break;case KEYS.RIGHT:found=this.FileList.Next(null,!1);break;case KEYS.OK:SettingsPage.FileList.back_element[SettingsPage.FileList.layer]=SettingsPage.FileList.activeItem.number,SettingsPage.FileList.elements[SettingsPage.FileList.activeItem.number].onclick()}this.FileList.Focused(found,!0),e.preventDefault();break;case SettingsPage.FileList.layers.AutoUpdate:if(e.code===KEYS.F2){SettingsPage.loadUpdateList(!1,!0);break}case SettingsPage.FileList.layers.playback:case SettingsPage.FileList.layers.Interface:case SettingsPage.FileList.layers.TS:case SettingsPage.FileList.layers.DVB:case SettingsPage.FileList.layers.teletext:case SettingsPage.FileList.layers.accessControl:if(this.FileList.EventHandler(e),e.stopped===!0)break;switch(e.code){case KEYS.EXIT:SettingsPage.pressExit(),e.preventDefault();break;case KEYS.OK:case KEYS.F1:SettingsPage.BPanel.EventHandler(e)}break;case SettingsPage.FileList.layers.SpeedTest:switch(e.code){case KEYS.EXIT:SettingsPage.pressExit(),e.preventDefault();break;default:-1!==configuration.setting.settingsList.indexOf("traceroute")&&RULES.Traceroute&&this.BPanelTraceroute.EventHandler(e)}break;case SettingsPage.FileList.layers.Traceroute:switch(e.code){case KEYS.EXIT:SettingsPage.pressExit(),e.preventDefault()}}};var UpdatePage={Show:function(auto,manual){var header,cur_ImageDate,image,versions=[];environment.Image_Date?cur_ImageDate=parseDate(environment.Image_Date):(cur_ImageDate=new Date,cur_ImageDate.setFullYear(1990)),this.auto=auto,this.manual=manual;for(var i=SettingsPage.update_list.length-1;i>-1;i--)image=SettingsPage.update_list[i],(Date.parse(image.date)>cur_ImageDate.getTime()||isNaN(cur_ImageDate.getTime())||!auto)&&("release"===image.type||environment.betaupdate_cond&&!/alpha/gim.test(image.type)||!auto)&&(image.title=image.name+' <span class="grey">('+new Date(image.date).toDateString()+") </span>",versions.push(image));return 0===versions.length?(echo("Got images list from server. No need for update."),void(auto||new CModalHint(SettingsPage,_("Sorry, no firmware image at the moment")))):(header=_(auto?"Software autoupdate":"Software update"),this.UpdateModal=new CUpdateModal(currCPage,{images:versions,auto:auto&&!manual,select:!0,header_text:header,info:!0,log:!0,events:{onStart:function(){if(echo("services.js->UpdateModal.onStart(); autoupdate_cond: "+environment.autoupdate_cond),0===environment.autoupdate_cond&&void 0!==this.images){var image;image="object"==typeof this.select?this.select.GetSelected():this.images[0],Date.parse(image.date)<cur_ImageDate.getTime()&&gSTB.SetEnv(JSON.stringify({autoupdate_cond:1}))}},onError:function(){echo("services.js->UpdateModal; error happened. Prevent cyclic autoupdate. Set autoupdate_cond to:"+environment.autoupdate_cond),gSTB.SetEnv(JSON.stringify({autoupdate_cond:environment.autoupdate_cond})),this.auto=!1}}}),void this.UpdateModal.Show(!0))}},clockTimer=null;Speedtest.prototype.start=function(){echo("Speedtest.start");var result=this._result=this._getResult();result&&result.hasOwnProperty("id")&&this.stop(result.id),parent.stbDownloadManager.AddMeasureJob(this._url),this.startChecking()},Speedtest.prototype.stop=function(id){echo("Speedtest.stop",id),id=id||this._result.id,echo("id",id),window.clearInterval(this._static._interval),parent.stbDownloadManager.DeleteJob(id,!1)},Speedtest.prototype.startChecking=function(){echo("Speedtest.t_check"),window.clearInterval(this._static._interval);var self=this;self.check(),this._static._interval=window.setInterval(function(){self.check()},1e3*this._interval_time)},Speedtest.prototype.setIntervalTime=function(value){echo("Speedtest.setIntervalTime",value),this._interval_time=value},Speedtest.prototype.onSuccess=function(callback){echo("Speedtest.onSuccess"),this._callback=callback},Speedtest.prototype.onCheck=function(callback){echo("Speedtest.onCheck"),this._check_callback=callback},Speedtest.prototype._getResult=function(){var result=parent.stbDownloadManager.GetMeasureInfo();return echo("GetMeasureInfo",result),result=JSON.parse(result),result=result[0]},Speedtest.prototype.check=function(){echo("Speedtest.check");var result=this._result=this._getResult();echo("this._static._interval",this._static._interval),100==result.progressPct?(this._callback&&this._callback(this.getHumanReadableSpeed(result)),this.stop(result.id)):this._check_callback&&this._check_callback(result)},Speedtest.prototype.getSpeed=function(result){return echo("Speedtest.getSpeed"),1e3*result.sizeDone/result.timeWasted},Speedtest.prototype.getHumanReadableSpeed=function(result){echo("Speedtest.getHumanReadableSpeed");var postfix,divider,speed=8*this.getSpeed(result);return speed>=1048576?(postfix="Mbps",divider=1048576):speed>=1024?(postfix="Kbps",divider=1024):(postfix="bps",divider=1),(speed/divider).toFixed(2)+" "+postfix};var as={main_lang:"ru",default_lang:"ru",image_dir:"576",sizes:{480:{cell:{w:125,h:96}},576:{cell:{w:125,h:105}},720:{cell:{w:220,h:150}},1080:{cell:{w:330,h:220}}},position:{old:{x:0,y:0},current:{x:0,y:0}},gWeatherUrlPost:"&v=2",itemIcoPre:PATH_IMG_PUBLIC+"menu",layer:0,layers:{BASE:0,WS:1,SL:2},activeSuggest:-1,start_weather_place:"",ss:["","","","",""],moveSuggests:!1},app={start:function(){this.fill(),window.weather_location=new CFilterInput(this,{input:document.getElementById("place"),hint:_("Enter your location..."),folded:!0,events:{onEvent:function(event){switch(event.code){case KEYS.DOWN:event.preventDefault(),window.weather_location.GetValue().trim()&&weather.suggestsSelect("down");break;case KEYS.UP:event.preventDefault(),window.weather_location.GetValue().trim()&&weather.suggestsSelect("up");break;case KEYS.OK:weather.pressOK()}},onChange:function(){weather.getSuggestsList(this.GetValue()),weather.confirButtonActive=!1,WeatherPage.BPanel.Hidden(WeatherPage.BPanel.confirmButton,!weather.confirButtonActive)},onUnfold:function(){weather.moveSuggests=!0,weather.searchBarExit=!1,WeatherPage.BCrumb.Show(!1),weather.newLocation()},onFold:function(){WeatherPage.BCrumb.Show(!0),window.weather_location.blur(),document.getElementById("suggests").style.display="none",weather.confirButtonActive=!1,WeatherPage.BPanel.Hidden(WeatherPage.BPanel.confirmButton,!weather.confirButtonActive)},onKey:function(){document.getElementById("suggests").style.display="none"},onExit:function(){weather.searchBarExit=!0,weather.noSettings&&(gSTB.HideVirtualKeyboard(),weather.weatherSettingsExit())}}}),window.weather_location.blur()},pressExit:function(){echo("pressExitFromPortal()");var data,portals,multiFlag=!1;try{data=gSTB.LoadUserData("portals.json"),multiFlag=JSON.parse(data).enable}catch(err){echo('JSON.parse(LoadUserData("portals.json")).enable; -> ERROR ->'+err),multiFlag=!1}try{data=JSON.parse(gSTB.GetEnv(JSON.stringify({varList:["portal1","portal2","use_portal_dhcp","portal_dhcp"]}))).result}catch(err){echo("JSON.parse(gSTB.GetEnv(JSON.stringify({ varList : [portal1,portal2]}))).result; -> ERROR ->"+err),data={portal1:"",portal2:"",use_portal_dhcp:"",portal_dhcp:""}}echo("Multiportal? = "+multiFlag+" || ("+Boolean(data.portal1)+"&&"+Boolean(data.portal2)+")"),portals=multiFlag||data.portal1||data.portal2||data.use_portal_dhcp&&data.portal_dhcp,!accessControl.state&&environment.accessControl?accessControl.showLogoutForm(portals):portals&&new CModalConfirm(currCPage,_("Confirm"),_("Are you sure you want to exit portal?"),_("Cancel"),function(){},_("Exit"),function(){window.location=PATH_SYSTEM+"pages/loader/index.html"})},doit:function(i,j){configuration.menu[j].script?configuration.menu[j].script():configuration.menu[j].url&&(window.location=configuration.menu[j].url)},moveit:function(i,j){echo("moveit "+i+" "+j),as.position.old.y=as.position.current.y,as.position.old.x=as.position.current.x,as.position.current.x=j%configuration.desktop.x,as.position.current.y=j/configuration.desktop.x-j/configuration.desktop.x%1,document.getElementById("cursor").style.marginLeft=as.position.current.x*as.sizes[WINDOW_HEIGHT].cell.w+"px",document.getElementById("cursor").style.marginTop=as.position.current.y*as.sizes[WINDOW_HEIGHT].cell.h+"px"},fillOne:function(ico,name,x,y){var obj={tag:"div",attrs:{"class":"box",onclick:"app.PressOK("+y+")",onmouseover:"app.moveit("+x+","+y+")"},child:[{tag:"div",attrs:{"class":"icon"},child:[{tag:"img",attrs:{alt:"",src:ico}}]},{tag:"div",attrs:{"class":"label"},child:[{tag:"span",attrs:{html:name}}]}]};return createHTMLTree(obj)},fill:function(){var i,j,doc;for(i=0;i<configuration.menu.length;i++)for(document.getElementById("ground").appendChild(createHTMLTree({tag:"div",attrs:{id:"ground"+i,"class":"ground"+i}})),doc=document.getElementById("ground"+i),j=0;j<configuration.menu[i].length;j++)doc.appendChild(this.fillOne(as.itemIcoPre+configuration.menu[i][j].ico,lang[configuration.menu[i][j].name]||configuration.menu[i][j].name,i,j));configuration.menu.length<2&&(document.getElementById("switch_desktop").style.display="none")},switch_page:function(){echo("switch_page"),0===configuration.desktop.number?(document.getElementById("ground0").className="ground-1",document.getElementById("ground1").className="ground0",configuration.desktop.number=1,configuration.menu[configuration.desktop.number].length-1<as.position.current.y*configuration.desktop.x+as.position.current.x&&(as.position.current.x=0,as.position.current.y=0),fade({show:"arrow_left",hide:"arrow_right"})):(document.getElementById("ground0").className="ground0",document.getElementById("ground1").className="ground1",configuration.desktop.number=0,fade({show:"arrow_right",hide:"arrow_left"}));var class_num=as.position.current.y*configuration.desktop.x+as.position.current.x;if(class_num<document.getElementById("ground"+as.cur_desktop).getElementsByClassName("box").length){var num_before=document.getElementById("ground").getElementsByClassName("box")[as.position.old.y*configuration.desktop.x+as.position.old.x].getElementsByClassName("icon")[0].getElementsByTagName("img")[0];num_before.className="",document.getElementById("cursor").style.marginLeft=as.position.current.x*as.sizes[WINDOW_HEIGHT].cell.w+"px",document.getElementById("cursor").style.marginTop=as.position.current.y*as.sizes[WINDOW_HEIGHT].cell.h+"px",this.tt=setTimeout(function(){num_before.className="",document.getElementById("ground").getElementsByClassName("box")[class_num].getElementsByClassName("icon")[0].getElementsByTagName("img")[0].className="active"},200)}else as.position.current.y=as.position.old.y,as.position.current.x=as.position.old.x},move:function(button){var class_num=as.position.current.y*configuration.desktop.x+as.position.current.x;switch(button){case KEYS.RIGHT:(class_num+1)%configuration.desktop.x===0&&configuration.menu.length>configuration.desktop.number+1?(document.getElementById("ground0").className="ground-1",document.getElementById("ground1").className="ground0",configuration.desktop.number++,as.position.current.x=0,(configuration.menu[configuration.desktop.number].length<6&&as.position.current.y>0||configuration.menu[configuration.desktop.number].length<11&&as.position.current.y>1)&&(as.position.current.y=0),fade({show:"arrow_left",hide:"arrow_right"})):(as.position.old.y=as.position.current.y,as.position.old.x=as.position.current.x,as.position.current.x+1<=configuration.desktop.x-1?as.position.current.x++:as.position.current.x=configuration.desktop.x-1);break;case KEYS.LEFT:configuration.desktop.number>0&&class_num%configuration.desktop.x===0?(document.getElementById("ground0").className="ground0",document.getElementById("ground1").className="ground1",configuration.desktop.number--,as.position.current.x=configuration.desktop.x-1,fade({show:"arrow_right",hide:"arrow_left"})):(as.position.old.y=as.position.current.y,as.position.old.x=as.position.current.x,as.position.current.x-1>=0?as.position.current.x--:as.position.current.x=0);break;case KEYS.DOWN:if(configuration.desktop.y<=as.position.current.y+1)break;as.position.old.y=as.position.current.y,as.position.old.x=as.position.current.x,as.position.current.y+1<=configuration.desktop.y-1?as.position.current.y++:as.position.current.y=configuration.desktop.y-1;break;case KEYS.UP:as.position.old.y=as.position.current.y,as.position.old.x=as.position.current.x,as.position.current.y-1>=0?as.position.current.y--:as.position.current.y=0}if(class_num=as.position.current.y*configuration.desktop.x+as.position.current.x,class_num<document.getElementById("ground"+configuration.desktop.number).getElementsByClassName("box").length){var num_before=document.getElementById("ground").getElementsByClassName("box")[as.position.old.y*configuration.desktop.x+as.position.old.x].getElementsByClassName("icon")[0].getElementsByTagName("img")[0];num_before.className="",document.getElementById("cursor").style.marginLeft=as.position.current.x*as.sizes[WINDOW_HEIGHT].cell.w+"px",document.getElementById("cursor").style.marginTop=as.position.current.y*as.sizes[WINDOW_HEIGHT].cell.h+"px",this.tt=setTimeout(function(){num_before.className="",document.getElementById("ground").getElementsByClassName("box")[class_num].getElementsByClassName("icon")[0].getElementsByTagName("img")[0].className="active"},200)}else as.position.current.y=as.position.old.y,as.position.current.x=as.position.old.x},press:function(event){switch(event.code){case KEYS.RIGHT:case KEYS.LEFT:case KEYS.DOWN:case KEYS.UP:app.move(event.code);break;case KEYS.OK:app.PressOK()}},test_timer:0,test_request:function(url,name){if(/http\:/.test(url)){var xhReq=new XMLHttpRequest;xhReq.open("HEAD",url,!0);var self=this;xhReq.onreadystatechange=function(){4===xhReq.readyState&&200===xhReq.status&&(url=-1===url.indexOf("?")?url+"?referrer="+encodeURIComponent(PATH_ROOT+"services.html"):url+"&referrer="+encodeURIComponent(PATH_ROOT+"services.html"),window.location=url),4===xhReq.readyState&&404===xhReq.status&&(echo("request status 404: page not found"),clearTimeout(self.test_timer),new CModalHint(currCPage,lang.servicesUnavailable,3e3))},xhReq.send(null),this.test_timer=setTimeout(function(){new CModalHint(currCPage,lang.servicesUnavailable,2e3)},3e3)}else url=-1===url.indexOf("?")?url+"?referrer="+encodeURIComponent(PATH_ROOT+"services.html"):url+"&referrer="+encodeURIComponent(PATH_ROOT+"services.html"),window.location=url},PressOK:function(id){var item,name,data,file;if(id=id||as.position.current.x+as.position.current.y*configuration.desktop.x,item=configuration.menu[configuration.desktop.number][id],accessControl.state&&accessControl.data.pages[item.name])return accessControl.showLoginForm(this.PressOK),!1;if(name=item.stat_name,data={},file=gSTB.LoadUserData("visit_data"),echo(item,"menu item"),file)try{data=JSON.parse(file)}catch(e){echo(e,"PressOK"),data={}}data[name]=void 0!==data[name]?1+data[name]:1,gSTB.SaveUserData("visit_data",JSON.stringify(data)),"function"==typeof item.script?item.script():item.url&&this.test_request(item.url,item.name)}},WeatherPage=new CPage;WeatherPage.onInit=function(){var remoteControlButtonsImagesPath=configuration.newRemoteControl?PATH_IMG_SYSTEM+"buttons/new/":PATH_IMG_SYSTEM+"buttons/old/";this.onShow=weather.weatherSettings,this.$bcrumb=this.handle.querySelector(".body .header .cbcrumb"),this.BCrumb=new CBreadCrumb,this.BCrumb.Init(PATH_IMG_PUBLIC,this.$bcrumb),this.BCrumb.SetName(_("Weather")),this.BCrumb.Push("/","ico_weather.png",""),this.ExitBPanel=new CButtonPanel(this),this.ExitBPanel.Init(remoteControlButtonsImagesPath,this.handle.querySelector(".body .footer .exit div.cbpanel-main")),this.ExitBPanel.btnExit=this.ExitBPanel.Add(KEYS.EXIT,"exit.png",configuration.newRemoteControl?_("Exit"):"",function(){weather.weatherSettingsExit()}),this.contentNode=WeatherPage.handle.querySelector(".content"),this.BPanel=new CButtonPanel(this),this.BPanel.Init(remoteControlButtonsImagesPath,this.handle.querySelector(".body .footer .main div.cbpanel-main")),this.BPanel.confirmButton=this.BPanel.Add(KEYS.OK,"ok.png",_("Confirm"),function(){weather.pressOK()},!0)},WeatherPage.onHide=function(){stbWindowMgr.SetVirtualKeyboardCoord("none")},WeatherPage.EventHandler=function(e){if(!window.weather_location.EventHandler(e))switch(e.code){case KEYS.F1:WeatherPage.BPanel.EventHandler(e);break;case KEYS.EXIT:weather.weatherSettingsExit()}};var weather={url:"http://weather.infomir.com.ua/",hash:"",langv:{en:1,ru:25},set:{location:"",id:"",lat:null,lon:null},data:{},state:0,toSave:!1,toSaveData:!1,tempData:{set:{location:"",lat:null,lon:null},data:{}},timer:{run:!1,start:function(){this.run&&this.stop(),this.run=!0,this.id=setTimeout(function(){weather.timer.run=!1,weather.getHash(weather.getData,0)},3601e3+random(0,3e5))},id:{},stop:function(){this.run=!1,clearTimeout(this.id)}},confirButtonActive:!1,showConfirmButton:!1,googleMapTempData:{set:{location:"",lat:null,lon:null},data:{}},searchBarExit:!1,noSettings:!1,interval:[15e3,6e4,12e4,6e5,12e5,36e5],load:function(){if(this.set.location=environment.weather_place?base64Decode(environment.weather_place):"",""!==this.set.location)return weather.toSave=!0,void this.refreshSet(!1,!1,null);var file=gSTB.LoadUserData("weatherSet");if(""!==file){if(this.set=JSON.parse(file),""!==this.set.location)return void this.refreshSet(!1,!1,null);if(this.set.lat&&this.set.lon)return void setTimeout(function(){weather.getHash(weather.getData,0,!1)},random(0,3e4))}},refreshSet:function(type,buildGoogleMap,locality){if(""!==weather.set.location||""!==weather.googleMapTempData.set.location||weather.noSettings)try{var request=new XMLHttpRequest;locality?request.open("GET","http://nominatim.openstreetmap.org/search?format=json&addressdetails=1&limit=5&q="+(type?locality:weather.set.location)+"&accept-language="+environment.language,!0):request.open("GET","http://nominatim.openstreetmap.org/search?format=json&addressdetails=1&limit=5&q="+(type?weather.googleMapTempData.set.location:weather.set.location)+"&accept-language="+environment.language,!0),request.onload=function(){var data,name;try{data=JSON.parse(request.responseText)}catch(error){echo(error)}if(data&&data.length>0){if(data[0].address?(name=data[0].address.city?data[0].address.city:data[0].address.town?data[0].address.town:data[0].address.village?data[0].address.village:data[0].display_name.split(",")[0],data[0].address.county&&(name+=", "+data[0].address.county),data[0].address.state&&(name+=", "+data[0].address.state),data[0].address.country&&(name+=", "+data[0].address.country+" ")):name=data[0].display_name,buildGoogleMap&&(weather.confirButtonActive=!0,weather.showConfirmButton=!1,WeatherPage.BPanel.Hidden(WeatherPage.BPanel.confirmButton,!weather.confirButtonActive),WeatherPage.BCrumb.SetName(name),WeatherPage.contentNode.style.visibility="hidden",-1!==as.activeSuggest&&(WeatherPage.BPanel.Hidden(WeatherPage.BPanel.confirmButton,!0),setTimeout(function(){as.activeSuggest=-1,weather.pressOK(),setTimeout(function(){weather.setDataMainPage()},500)},500))),type){if(weather.googleMapTempData.set.location=name,weather.googleMapTempData.set.lat=Math.floor(100*data[0].lat)/100,weather.googleMapTempData.set.lon=Math.floor(100*data[0].lon)/100,weather.toSaveData=!0,echo(weather.toSave,"weather.toSave"),weather.toSave){weather.toSave=!1,weather.set=weather.googleMapTempData.set;
var write=JSON.stringify(weather.set);gSTB.SaveUserData("weatherSet",write),gSTB.SetEnv(JSON.stringify({weather_place:""})),weather.toSaveData=!1,type=!1,weather.googleMapTempData.set={}}}else weather.set.location=name,weather.set.lat=Math.round(100*data[0].lat)/100,weather.set.lon=Math.round(100*data[0].lon)/100;weather.getHash(weather.getData,0,type)}},request.onerror=function(){weather.timer.stop(),setTimeout(function(){weather.refreshSet(type,buildGoogleMap,locality)},random(1e4,25e3))},request.send(null)}catch(e){echo(e)}else weather.set.id=-2},getHash:function(callback,a,type){ajax("get",weather.url+"getCheck.php?id="+environment.Image_Desc+"&mac="+gSTB.GetDeviceMacAddress()+"&sn="+gSTB.GetDeviceSerialNumber(),function(data,status){200===status&&data&&0===data.code?(weather.hash=data.data,callback(a,type)):(weather.timer.stop(),setTimeout(function(){weather.getHash(callback,a,type)},random(1e4,25e3)))},null,"json")},getData:function(a,type){var ask="lat="+(type?weather.googleMapTempData.set.lat:weather.set.lat)+"&lon="+(type?weather.googleMapTempData.set.lon:weather.set.lon),hash=gSTB.GetHashVersion1((type?weather.googleMapTempData.set.lat:weather.set.lat)+","+(type?weather.googleMapTempData.set.lon:weather.set.lon),weather.hash);if("false"===hash)return weather.timer.stop(),void setTimeout(function(){weather.getHash(weather.getData,a,type)},1e4);var url=weather.url+"getData.php?"+ask+"&langid="+weather.langv[environment.language]+"&fcode="+a+"&hk="+hash;ajax("get",url,function(data,status){if(200===status)switch(weather.toSave&&(type=!1),echo(data.code,"data.code"),data.code){case 0:type?(weather.googleMapTempData.data=data.data,weather.googleMapTempData.data.current.wd=weather.degrToStr(weather.googleMapTempData.data.current.wd),weather.googleMapTempData.data.current.wsk=Math.round(weather.googleMapTempData.data.current.wsk/3.6*100)/100):(weather.data=data.data,weather.data.current.wd=weather.degrToStr(weather.data.current.wd),weather.data.current.wsk=Math.round(weather.data.current.wsk/3.6*100)/100,weather.timer.run||weather.timer.start(),weather.setDataMainPage()),!window.currCPage||currCPage!==WeatherPage&&currCPage.parent!==WeatherPage||weather.moveSuggests&&!type||(WeatherPage.loadingAlert?(WeatherPage.loadingAlert.Show(!1),document.getElementById("wsbody_today").parentNode.style.display="",document.getElementById("wsbody_wlist").parentNode.style.display="",document.getElementById("wsbody_today").style.display="",document.getElementById("wsbody_wlist").style.display="",WeatherPage.loadingAlert=null,weather.initWeatherPage(!0)):"hidden"===WeatherPage.contentNode.style.visibility&&(WeatherPage.contentNode.style.visibility=""),weather.moveSuggests||weather.searchBarExit||weather.initWeatherPage(type));break;case 1:a<weather.interval.length-1&&!type||2>a&&type?(weather.timer.run&&!type&&weather.timer.stop(),setTimeout(function(){a++,weather.getHash(weather.getData,a,type)},parseInt(weather.interval[a],10)+random(-5e3,1e4))):weather.timer.run||type||weather.timer.start();break;case 2:type?(weather.googleMapTempData.data=data.data,weather.googleMapTempData.data.current.wd=weather.degrToStr(weather.googleMapTempData.data.current.wd),weather.googleMapTempData.data.current.ws=Math.round(weather.googleMapTempData.data.current.ws/3.6*100)/100):(weather.data=data.data,weather.data.current.wd=weather.degrToStr(weather.data.current.wd),weather.data.current.wsk=Math.round(weather.data.current.wsk/3.6*100)/100,weather.timer.run&&weather.timer.stop(),weather.setDataMainPage()),!(currCPage===WeatherPage||currCPage&&currCPage.parent===WeatherPage)||weather.moveSuggests&&!type||weather.moveSuggests||weather.searchBarExit||weather.initWeatherPage(type),setTimeout(function(){a++,weather.getHash(weather.getData,a,type)},parseInt(weather.interval[a],10));break;case 5:weather.getHash(weather.getData,a,type)}else a<weather.interval.length-1&&!type||2>a&&type?(weather.timer.run&&!type&&weather.timer.stop(),setTimeout(function(){a++,weather.getHash(weather.getData,a,type)},parseInt(weather.interval[a],10)+random(-5e3,1e4))):weather.timer.run||type||weather.timer.start()},null,"json")},degrToStr:function(a){return 22.5>a?lang.n+", ":67.5>a?lang.ne+", ":112.5>a?lang.e+", ":157.5>a?lang.se+", ":202.5>a?lang.s+", ":247.5>a?lang.sw+", ":292.5>a?lang.w+", ":337.5>a?lang.nw+", ":lang.n+", "},setDataMainPage:function(){if("object"==typeof weather.data&&weather.data.current){var d=document.getElementById("weather_condition");d.className="id_"+(1===weather.data.current.day?weather.data.current.id+"_day":weather.data.current.id+"_night");var deg="englishSys"===environment.weather_conf?(weather.data.current.tcf>0?"+"+weather.data.current.tcf:weather.data.current.tcf)+"&deg;F":(weather.data.current.tcc>0?"+"+weather.data.current.tcc:weather.data.current.tcc)+"&deg;C",text='<span class="text28">'+deg+"</span><br />";text+='<span class="text20">'+lang.humidity+": "+weather.data.current.h+"%</span><br />";var wind="englishSys"===environment.weather_conf?weather.data.current.wsm+" "+lang.milesH:weather.data.current.wsk+" "+lang.ms;text+='<span class="text20">'+lang.wind+": "+weather.data.current.wd+wind+"</span>",d.innerHTML=text,d.style.display="block"}},weatherSettings:function(){stbWindowMgr.SetVirtualKeyboardCoord("bottom"),""!==weather.set.location?(weather.noSettings=!1,WeatherPage.BCrumb.Show(!0),WeatherPage.BCrumb.SetName(""),document.getElementById("suggests").style.display="none",weather.initWeatherPage(!1)):(weather.noSettings=!0,window.weather_location.Fold(!1),weather.getLocation(weather.refreshSet))},initWeatherPage:function(type){if(type||weather.googleMapTempData.set.location!==weather.set.location&&weather.googleMapTempData.set.location&&weather.set.location||(weather.googleMapTempData.set=weather.set,weather.googleMapTempData.data=weather.data,weather.tempData.set=weather.set,weather.tempData.data=weather.data),type&&(weather.tempData.set=weather.googleMapTempData.set,weather.tempData.data=weather.googleMapTempData.data),WeatherPage.BCrumb.SetName(weather.tempData.set.location),weather.tempData.data.current){var wind,i,arr,date,day,from,deg,to,data,imgList=[],time="day";for(WeatherPage.contentNode.style.visibility="",window.weather_location.Fold(!0),WeatherPage.BCrumb.Show(!0),document.getElementById("suggests").style.display="none",wind="englishSys"===environment.weather_conf?weather.tempData.data.current.wsm.toFixed(1)+" "+lang.milesH:weather.tempData.data.current.wsk.toFixed(1)+" "+lang.ms,document.getElementById("forecast_day_0_wind").innerHTML=weather.tempData.data.current.wd+wind,document.getElementById("forecast_day_0_hum").innerHTML=weather.tempData.data.current.h+" %",i=0;3>=i&&i<weather.tempData.data.days.length;i++)data=weather.tempData.data.days[i],"englishSys"===environment.weather_conf?(from=data.tlf,deg="F",to=data.thf):(deg="C",from=data.tlc,to=data.thc),from=from>0?"+"+from:+from,to=to>0?"+"+to:to,arr=data.d.split("-"),date=new Date(arr[0],arr[1]-1,arr[2]),day=date.getDay(),document.getElementById("forecast_day_"+i+"_day").innerHTML=fullDaysOfWeek[day],document.getElementById("forecast_day_"+i+"_date").innerHTML=arr[2]+" "+fullMonthNames[arr[1]-1],document.getElementById("forecast_day_"+i+"_from").innerHTML=from+"&deg;"+deg,document.getElementById("forecast_day_"+i+"_to").innerHTML=to+"&deg;"+deg,document.getElementById("forecast_day_"+i+"_cond").innerHTML=weatherTextById[data.id],0===i&&0===weather.tempData.data.current.day&&(time="night"),document.getElementById("forecast_day_"+i+"_img").className="id_"+data.id+"_"+time,imgList.push("public/img/weather/"+time+"/"+data.id+".png");imageLoader(imgList,function(){echo("ready","weathrImageLoader"),document.getElementById("wsbody_today").parentNode.style.display="table-cell",document.getElementById("wsbody_wlist").parentNode.style.display="table-cell",document.getElementById("wsbody_today").style.display="table",document.getElementById("wsbody_wlist").style.display="table"}),WeatherPage.handle.classList.add("initiated")}else-2===weather.tempData.set.id?currCPage===WeatherPage&&setTimeout(function(){new CModalAlert(WeatherPage,_("Error"),lang.errorPlaceText,_("Close"))},50):(WeatherPage.BCrumb.SetName(weather.tempData.set.location),window.weather_location.Fold(!0,currCPage===WeatherPage),document.getElementById("wsbody_today").parentNode.style.display="none",document.getElementById("wsbody_wlist").parentNode.style.display="none",document.getElementById("wsbody_today").style.display="none",document.getElementById("wsbody_wlist").style.display="none",currCPage===WeatherPage&&setTimeout(function(){WeatherPage.loadingAlert=new CModalAlert(WeatherPage,"",lang.inProgress,_("Close"))},50))},weatherSettingsExit:function(){return window.weather_location.IsFolded()?(as.activeSuggest=-1,window.weather_location.Fold(!0,!0),document.getElementById("wsbody_today").parentNode.style.display="none",document.getElementById("wsbody_wlist").parentNode.style.display="none",document.getElementById("wsbody_today").style.display="none",document.getElementById("wsbody_wlist").style.display="none",gSTB.HideVirtualKeyboard(),weather.confirButtonActive&&(weather.showConfirmButton=weather.confirButtonActive=weather.moveSuggests=!1,WeatherPage.BPanel.Hidden(WeatherPage.BPanel.confirmButton,!weather.confirButtonActive)),void(weather.tempData.set.location!==weather.set.location?new CModalConfirm(WeatherPage,"",lang.saveLocationText,lang.saveLocationNoText,function(){setTimeout(weather.weatherSettingsExitNo,100)},lang.saveLocationYesText,function(){setTimeout(weather.weatherSettingsExitYes,100)}):this.weatherSettingsExitNo())):void window.weather_location.Fold(!0,!0)},weatherSettingsExitYes:function(){var write;weather.toSave=!0,weather.tempData.data.current?(weather.data=weather.tempData.data,weather.timer.stop(),weather.timer.start(),weather.setDataMainPage(),weather.toSaveData&&(weather.set=weather.tempData.set,write=JSON.stringify(weather.tempData.set),gSTB.SetEnv(JSON.stringify({weather_place:""})),gSTB.SaveUserData("weatherSet",write))):(weather.set=weather.tempData.set,write=JSON.stringify(weather.tempData.set),gSTB.SetEnv(JSON.stringify({weather_place:""})),gSTB.SaveUserData("weatherSet",write),weather.timer.stop()),document.getElementById("suggests").style.display="none",window.weather_location.blur(),WeatherPage.Show(!1),weather.noSettings=!1},weatherSettingsExitNo:function(){weather.toSave=!1,weather.tempData.set.location=weather.set.location,weather.timer.run||weather.timer.start(),document.getElementById("suggests").style.display="none",window.weather_location.blur(),WeatherPage.Show(!1)},newLocation:function(){weather.toSaveData=!1,weather.toSave=!1,-2===this.set.id&&""!==this.set.location&&new CModalAlert(WeatherPage,_("Error"),lang.errorPlaceText,_("Close")),document.getElementById("suggests").style.display="none",as.activeSuggest=-1;for(var i=0;5>i;i++)document.getElementById("s"+i).className="",document.getElementById("s"+i).innerHTML="";window.weather_location.SetValue(""),window.weather_location.focus(),gSTB.ShowVirtualKeyboard()},getSuggestsList:function(query){if(weather.moveSuggests===!0&&query.length>0)try{var request=new XMLHttpRequest;request.open("GET","http://nominatim.openstreetmap.org/search?format=json&addressdetails=1&limit=5&accept-language="+environment.language+"&city="+query,!0);var self=weather;request.onreadystatechange=function(){if(4===request.readyState&&200===request.status)try{self.setSuggests(JSON.parse(request.responseText),query)}catch(e){echo(e,"weather response is not valid json")}},request.send(null)}catch(e){echo(e)}},geo_types:[17,37,545,33],setSuggests:function(obj,query){var i,$line,sugg,geo_type,onMouseOver=function(){-1!==as.activeSuggest&&document.getElementById("s"+as.activeSuggest).classList.toggle("active"),as.activeSuggest=this.activeSuggest,document.getElementById("s"+as.activeSuggest).classList.toggle("active")},onClick=function(){weather.pressOK()};if(query.length>0){if(obj&&obj.length>0)for(i=0;5>i;i++)sugg=obj[i],$line=document.getElementById("s"+i),$line.activeSuggest=i,$line.onmouseover=onMouseOver,$line.onclick=onClick,elclear($line),void 0!==sugg?(geo_type=null,$line.style.opacity=1,sugg.address?(sugg.address.city?as.ss[i]=sugg.address.city:sugg.address.town?as.ss[i]=sugg.address.town:sugg.address.village?as.ss[i]=sugg.address.village:as.ss[i]="",sugg.address.state&&(as.ss[i]+=", "+sugg.address.state),sugg.address.country&&(as.ss[i]+=", "+sugg.address.country+" "),echo(as.ss[i])):as.ss[i]=sugg.display_name,elchild($line,[element("img",{src:PATH_IMG_PUBLIC+"geo/abstract.png"}),element("div",{},as.ss[i])])):($line.style.opacity=0,as.ss[i]="");document.getElementById("suggests").style.display="block"}else for(document.getElementById("suggests").style.display="none",i=0;5>i;i++)document.getElementById("s"+i).innerHTML="",as.ss[i]=""},suggestsSelect:function(direction){if(weather.moveSuggests===!0){switch(direction){case"down":switch(as.activeSuggest){case-1:as.activeSuggest=0;break;case 0:as.activeSuggest=1;break;case 1:as.activeSuggest=2;break;case 2:as.activeSuggest=3;break;case 3:as.activeSuggest=4}break;case"up":switch(as.activeSuggest){case 0:as.activeSuggest=-1;break;case 1:as.activeSuggest=0;break;case 2:as.activeSuggest=1;break;case 3:as.activeSuggest=2;break;case 4:as.activeSuggest=3}}this.suggestsАill()}else document.getElementById("suggests").style.display="none"},"suggestsАill":function(){for(var i=0;5>i;i++)as.activeSuggest===i?document.getElementById("s"+i).style.opacity>0?document.getElementById("s"+i).className="active":(document.getElementById("s"+i).className="",as.activeSuggest--,document.getElementById("s"+as.activeSuggest).className="active"):document.getElementById("s"+i).className=""},pressOK:function(){if(weather.confirButtonActive&&(weather.confirButtonActive=!1,WeatherPage.BPanel.Hidden(WeatherPage.BPanel.confirmButton,!weather.confirButtonActive),weather.initWeatherPage(!0)),-1!==as.activeSuggest&&weather.moveSuggests===!0){var value=document.getElementById("s"+as.activeSuggest).lastElementChild.innerHTML;window.weather_location.SetValue(value,!0),document.getElementById("suggests").style.display="none",weather.googleMapTempData.set.location!==value&&(weather.googleMapTempData.set={},weather.googleMapTempData.data={},weather.googleMapTempData.set.location=value,weather.googleMapTempData.set.id=-1,weather.refreshSet(!0,!0,null))}},getLocation:function(callback){ajax("GET","http://weather.infomir.com.ua/getGeo.php",function(coordinates,status){200===status&&weather.getLocality(coordinates,callback)},null,"json")},getLocality:function(coordinates,callback){var locality=null,language=getCurrentLanguage();ajax("GET","http://nominatim.openstreetmap.org/reverse?format=json&lat="+coordinates.data.lat+"&zoom=18&addressdetails=1&lon="+coordinates.data.lon+"&accept-language="+language,function(location,status){200===status&&location.address&&(location.address.city?(locality=location.address.city,location.address.state&&(locality+=", "+location.address.state),location.address.country&&(locality+=", "+location.address.country+" ")):locality=locality.display_name),null!==locality&&(window.weather_location.SetValue(locality,!0),window.weather_location.select()),callback(!0,!0,locality)},null,"json")}};configuration=function(configuration){var menu={mediaBrowser:{ico:"/icons/mb.png",name:"mediaBrowser",script:function(){MediaBrowser.Reset(),MediaBrowser.Show(!0)},help:"menu/home_media",stat_name:"mediabrowser"},tvChannels:{ico:"/icons/tv.png",name:"tvChannels",help:"menu/iptv_channels",script:function(){IPTVChannels.Show(!0),IPTVChannels.Reset()},stat_name:"tvchannels"},wildWeb:{ico:"/icons/web.png",name:"wildWeb",help:"menu/internet_browser",script:function(){setTimeout(function(){openWindow(WINDOWS.BROWSER,PATH_ROOT+"public/app/ibman/index.html?mode=2")},0)},stat_name:"wildweb"},weatherSettings:{ico:"/icons/weather.png",name:"weatherSettings",help:"menu/weather",script:function(){WeatherPage.Show()},stat_name:"weather"},dlman:{ico:"/icons/dm.png",name:"dlman",help:"menu/download_manager",script:function(){openWindow(WINDOWS.DOWNLOAD_MANAGER,PATH_ROOT+"public/app/dlman/index.html")},stat_name:"downloadmanager"},pvr:{ico:"/icons/pvr.png",name:"pvr",help:"menu/pvr_manager",script:function(){openWindow(WINDOWS.PVR,PATH_ROOT+"public/app/pvr/index.html")},stat_name:"recordmanager"},wildWebBookmarks:{ico:"/icons/favs.png",name:"wildWebBookmarks",help:"menu/internet_bookmarks",script:function(){setTimeout(function(){openWindow(WINDOWS.BROWSER,PATH_ROOT+"public/app/ibman/index.html?mode=1")},0)},stat_name:"wildweb"},settings:{ico:"/icons/settings.png",name:"settings",help:"menu/settings",script:function(){SettingsPage.Show()},stat_name:"settings"},manual:{ico:"/icons/manual.png",name:"Manual",help:"root",script:function(){openWindowHelp("root")},stat_name:"manual"},apps:{ico:"/icons/apps.png",name:"apps",help:"menu/applications",url:"http://apps.infomir.com.ua/?language="+getCurrentLanguage(),stat_name:"apps"},dvbChannels:{ico:"/icons/dvb.png",name:"dvbChannels",script:function(){DVBChannels.Show(!0),DVBChannels.Reset()},stat_name:"tvchannels"},masterSettings:{ico:"/icons/master.png",name:"masterSettings",script:function(){var currentPage=currCPage;loadMasterSettings(function(){MasterSettings.origin=currentPage})},stat_name:"mastersettings"},magicCast:{ico:"/icons/magicCast.png",name:"MAGic Cast",help:"menu/internet_services",url:"http://magiccast.magapps.net/index.html",stat_name:"magic_cast"}},defaultSpeedTest={baseURL:".leaseweb.net/speedtest/10mb.bin",dataCenters:[{name:"San Jose",lat:37.33939,"long":-121.89496,code:"us"},{name:"Washington D.C",lat:38.89511,"long":-77.03637,code:"us"},{name:"Amsterdam",lat:52.37403,"long":4.88969,code:"nl"},{name:"Frankfurt",lat:50.11667,"long":8.68333,code:"de"}]},defaultTraceroute={domains:["echo-01.infomir.com","echo-03.infomir.com"],time:210},config=extend({screensaversPath:PATH_SYSTEM+"pages/screensaver",url:{ping:["http://echo-01.infomir.com/","http://echo-02.infomir.com/","http://echo-03.infomir.com/","http://echo-04.infomir.com/"].shuffle(),pingAttempts:3,updateList:"",operatorsTVList:"http://playlist.iptv.infomir.com.ua/api/"},speedTest:defaultSpeedTest,traceroute:defaultTraceroute,frontPanelIndicator:0,desktop:{x:5,y:3,count:0,number:0},mayTimeShift:!0,mayDVB:!1,mayEPG:!0,mayPVR:!0,maySecureM3u:!1,volume:{def:100,mute:0,step:5,timer:null,hideTimeOut:3e3},defaultAudioLang:null,defaultSubtitleLang:null,fileSystemTypes:["<unknown>","fat16","fat32","ext2","ext3","ntfs","ext4"],registersTypes:["mpg","mpeg","mkv","avi","3gp","ts","tspinf","m4a","mp3","mp4","ac3","mov","vob","wav","ape","mts","m2t","m2v","ogg","oga","divx","aiff","m2ts","wv","m2p","tp","flv","tta","mod","tod","asf","wma","wmv","flac","ape","cue","m3u","m3u8","jpg","jpeg","png","bmp","tif","tiff","iso","aac","txt","srt","sub","ass","m4v","trp","tts","wtv"],menu:[menu.mediaBrowser,menu.tvChannels,menu.magicCast,menu.pvr,menu.dlman,menu.wildWeb,menu.weatherSettings,menu.manual,menu.settings],masterSettingOnStart:!1,setting:{settingsList:["playback","interface","update","timeShift","speedTest","settings","accessControl","teletext"]},startPage:null},configuration,!1),models={};return models.IP_STB_HD={},models.MAG245={url:{updateList:"http://update.infomir.com/mag/245/update_list.txt"}},models.MAG245D=extend(models.MAG245,{url:{updateList:"http://update.infomir.com/mag/245d/update_list.txt"}},!1),models.MAG250={url:{updateList:"http://update.infomir.com/mag/250/update_list.txt"}},models.MAG254={url:{updateList:"http://update.infomir.com/mag/254/update_list.txt"}},models.MAG255={url:{updateList:"http://update.infomir.com/mag/255/update_list.txt"},maySecureM3u:!0},models.MAG256=extend(models.MAG254,{url:{updateList:"http://update.infomir.com/mag/256/r/update_list.txt"},mayTimeShift:!0,mayPVR:!0,menu:[menu.mediaBrowser,menu.tvChannels,menu.magicCast,menu.dlman,menu.wildWeb,menu.weatherSettings,menu.manual,menu.settings,menu.pvr],setting:{settingsList:["playback","interface","update","timeShift","speedTest","settings","accessControl","teletext"]},logoImagePath:PATH_IMG_PUBLIC+"menu/logo/mag256.png",registersTypes:["mpg","mpeg","mkv","avi","3gp","ts","tspinf","m4a","mp3","mp4","ac3","mov","vob","wav","ape","mts","m2t","m2v","ogg","oga","divx","aiff","m2ts","wv","m2p","tp","flv","tta","mod","tod","asf","wma","wmv","flac","ape","cue","m3u","m3u8","jpg","jpeg","png","bmp","tif","tiff","iso","aac","txt","srt","sub","ass","m4v","trp","tts","raw","gif","cr2","nef","orf","iiq","ico","psd","webp","tif","tiff","wtv"]},!1),models.MAG257=extend(models.MAG256,{url:{updateList:"http://update.infomir.com/mag/257/update_list.txt"},logoImagePath:PATH_IMG_PUBLIC+"menu/logo/mag257.png",maySecureM3u:!0},!1),models.MAG257G=extend(models.MAG256,{url:{updateList:"http://update.infomir.com/mag/257G/update_list.txt"},logoImagePath:PATH_IMG_PUBLIC+"menu/logo/mag257.png"},!1),models.MAG277=extend(models.MAG256,{url:{updateList:"http://update.infomir.com/mag/277/update_list.txt"}},!1),models.MAG270={menu:[menu.mediaBrowser,menu.dvbChannels,menu.tvChannels,menu.magicCast,menu.pvr,menu.dlman,menu.wildWeb,menu.weatherSettings,menu.manual,menu.settings],mayDVB:!0,url:{updateList:"http://update.infomir.com/mag/270/update_list.txt",speedTest:"",traceroute:!1},setting:{settingsList:["playback","interface","update","timeShift","speedTest","DVB","settings","accessControl","teletext"]}},models.MAG275=extend(models.MAG270,{url:{updateList:"http://update.infomir.com/mag/275/update_list.txt"}},!1),models.MAG276=extend(models.MAG275,{url:{updateList:"http://update.infomir.com/mag/276/update_list.txt"}},!1),models.MAG322=extend(models.MAG254,{logoImagePath:PATH_IMG_PUBLIC+"menu/logo/mag322.png",url:{updateList:"http://update.infomir.com/mag/322/update_list.txt"},registersTypes:["mpg","mpeg","mkv","avi","3gp","ts","tspinf","m4a","mp3","mp4","ac3","mov","vob","wav","ape","mts","m2t","m2v","ogg","oga","divx","aiff","m2ts","wv","m2p","tp","flv","tta","mod","tod","asf","wma","wmv","flac","ape","cue","m3u","m3u8","jpg","jpeg","png","bmp","tif","tiff","iso","aac","txt","srt","sub","ass","m4v","trp","tts","gif","cr2","nef","orf","iiq","ico","webp","tif","wtv"]},!1),models.MAG323=extend(models.MAG322,{logoImagePath:PATH_IMG_PUBLIC+"menu/logo/mag323.png",url:{updateList:"http://update.infomir.com/mag/323/update_list.txt"}},!1),models.MAG324=extend(models.MAG254,{logoImagePath:PATH_IMG_PUBLIC+"menu/logo/mag324.png",url:{updateList:"http://update.infomir.com/mag/324/update_list.txt"},registersTypes:["mpg","mpeg","mkv","avi","3gp","ts","tspinf","m4a","mp3","mp4","ac3","mov","vob","wav","ape","mts","m2t","m2v","ogg","oga","divx","aiff","m2ts","wv","m2p","tp","flv","tta","mod","tod","asf","wma","wmv","flac","ape","cue","m3u","m3u8","jpg","jpeg","png","bmp","tif","tiff","iso","aac","txt","srt","sub","ass","m4v","trp","tts","raw","gif","cr2","nef","orf","iiq","ico","psd","webp","tif","tiff","wtv"]},!1),models.MAG324C=extend(models.MAG275,{logoImagePath:PATH_IMG_PUBLIC+"menu/logo/mag324c.png",url:{updateList:"http://update.infomir.com/mag/324c/update_list.txt"},registersTypes:["mpg","mpeg","mkv","avi","3gp","ts","tspinf","m4a","mp3","mp4","ac3","mov","vob","wav","ape","mts","m2t","m2v","ogg","oga","divx","aiff","m2ts","wv","m2p","tp","flv","tta","mod","tod","asf","wma","wmv","flac","ape","cue","m3u","m3u8","jpg","jpeg","png","bmp","tif","tiff","iso","aac","txt","srt","sub","ass","m4v","trp","tts","raw","gif","cr2","nef","orf","iiq","ico","psd","webp","tif","tiff","wtv"]},!1),models.MAG325=extend(models.MAG324,{logoImagePath:PATH_IMG_PUBLIC+"menu/logo/mag325.png",url:{updateList:"http://update.infomir.com/mag/325/update_list.txt"}},!1),models.MAG330=extend(models.MAG254,{url:{updateList:"http://update.infomir.com/mag/330/update_list.txt"}},!1),models.MAG350={logoImagePath:PATH_IMG_PUBLIC+"menu/logo/mag350.png",url:{updateList:"http://update.infomir.com/mag/350/update_list.txt"},menu:[menu.mediaBrowser,menu.tvChannels,menu.magicCast,menu.dlman,menu.wildWeb,menu.weatherSettings,menu.manual,menu.settings,menu.pvr],setting:{settingsList:["playback","interface","update","timeShift","speedTest","settings","accessControl","teletext"]},registersTypes:["mpg","mpeg","mkv","avi","3gp","ts","tspinf","m4a","mp3","mp4","ac3","mov","vob","wav","ape","mts","m2t","m2v","ogg","oga","divx","aiff","m2ts","wv","m2p","tp","flv","tta","mod","tod","asf","wma","wmv","flac","ape","cue","m3u","m3u8","jpg","jpeg","png","bmp","tif","tiff","iso","aac","txt","srt","sub","ass","m4v","trp","tts","raw","gif","cr2","nef","orf","iiq","ico","psd","webp","tif","tiff","wtv"],mayTimeShift:!0,mayPVR:!0,maySecureM3u:!0,speedTest:defaultSpeedTest,traceroute:!1},models.MAG349=extend(models.MAG350,{logoImagePath:PATH_IMG_PUBLIC+"menu/logo/mag349.png",url:{updateList:"http://update.infomir.com/mag/349/update_list.txt"},maySecureM3u:!1},!1),models.MAG352=extend(models.MAG350,{logoImagePath:PATH_IMG_PUBLIC+"menu/logo/mag352.png",url:{updateList:"http://update.infomir.com/mag/352/update_list.txt"}},!1),models.MAG351=extend(models.MAG352,{logoImagePath:PATH_IMG_PUBLIC+"menu/logo/mag351.png",url:{updateList:"http://update.infomir.com/mag/351/r/update_list.txt"},maySecureM3u:!1},!1),models.MAG356=extend(models.MAG270,{url:{updateList:"http://update.infomir.com/mag/356/update_list.txt"}},!1),models.WR320=extend(models.MAG254,{url:{updateList:"http://support.wrtech.ru/update/WR-320/update_list.txt"}},!1),models.MAG424=extend(models.MAG351,{logoImagePath:PATH_IMG_PUBLIC+"menu/logo/mag424.png",url:{updateList:"http://update.infomir.com/mag/424/update_list.txt"}},!1),models.MAG420=extend(models.MAG424,{logoImagePath:PATH_IMG_PUBLIC+"menu/logo/mag420.png",url:{updateList:"http://update.infomir.com/mag/420/update_list.txt"}},!1),models.MAG422=extend(models.MAG424,{logoImagePath:PATH_IMG_PUBLIC+"menu/logo/mag422.png",url:{updateList:"http://update.infomir.com/mag/422/update_list.txt"}},!1),models.MAG425=extend(models.MAG351,{logoImagePath:PATH_IMG_PUBLIC+"menu/logo/mag425.png",url:{updateList:"http://update.infomir.com/mag/425/update_list.txt"}},!1),models.AuraHD0={menu:[menu.apps,menu.mediaBrowser,menu.tvChannels,menu.magicCast,menu.dlman,menu.pvr,menu.wildWeb,menu.wildWebBookmarks,menu.weatherSettings,menu.manual,menu.settings],masterSettingOnStart:!0,url:{updateList:"http://update.infomir.com/aurahd/hd0-9/update_list.txt"},blockAdditionalUpdate:!0,setting:{settingsList:["playback","interface","update","timeShift","speedTest","settings","masterSettings","traceroute","accessControl","teletext"]},logoImagePath:PATH_IMG_PUBLIC+"menu/logo/aurahd0.png",speedTest:defaultSpeedTest,traceroute:defaultTraceroute},models.AuraHD1=extend(models.AuraHD0,{},!1),models.AuraHD2=extend(models.AuraHD0,{url:{updateList:"http://update.infomir.com/aurahd/hd2/update_list.txt"},logoImagePath:PATH_IMG_PUBLIC+"menu/logo/aurahd2.png",maySecureM3u:!0},!1),models.AuraHD3=extend(models.AuraHD2,{menu:[menu.apps,menu.mediaBrowser,menu.dvbChannels,menu.tvChannels,menu.magicCast,menu.dlman,menu.pvr,menu.wildWeb,menu.wildWebBookmarks,menu.weatherSettings,menu.manual,menu.settings],mayDVB:!0,maySecureM3u:!1,url:{updateList:"http://update.infomir.com/aurahd/hd3/update_list.txt"},setting:{settingsList:["playback","interface","update","timeShift","speedTest","DVB","settings","masterSettings","traceroute","accessControl","teletext"]},logoImagePath:PATH_IMG_PUBLIC+"menu/logo/aurahd3.png"},!1),models.AuraHD4=extend(models.MAG322,{menu:[menu.apps,menu.mediaBrowser,menu.tvChannels,menu.magicCast,menu.dlman,menu.pvr,menu.wildWeb,menu.wildWebBookmarks,menu.weatherSettings,menu.manual,menu.settings],url:{updateList:"http://update.infomir.com/aurahd/hd4/update_list.txt"},masterSettingOnStart:!0,setting:{settingsList:["playback","interface","update","timeShift","speedTest","settings","masterSettings","traceroute","accessControl","teletext"]},logoImagePath:PATH_IMG_PUBLIC+"menu/logo/aurahd4.png"},!1),models.AuraHD8=extend(models.AuraHD0,{url:{updateList:"http://update.infomir.com/aurahd/hd8/update_list.txt"},logoImagePath:PATH_IMG_PUBLIC+"menu/logo/aurahd8.png"},!1),models.AuraHD9=extend(models.AuraHD0,{logoImagePath:PATH_IMG_PUBLIC+"menu/logo/aurahd9.png"},!1),models.IM2100=extend(models.MAG322,{logoImagePath:PATH_IMG_PUBLIC+"menu/logo/im2100.png",url:{updateList:"http://update.infomir.com/im/2100/update_list.txt"}},!1),models.IM2100V=extend(models.IM2100,{url:{updateList:"http://update.infomir.com/im/2100v/update_list.txt"},maySecureM3u:!0},!1),models.IM2100VI=extend(models.IM2100V,{url:{updateList:"http://update.infomir.com/im/2100vi/update_list.txt"}},!1),models.IM2101=extend(models.MAG324,{logoImagePath:PATH_IMG_PUBLIC+"menu/logo/im2101.png",url:{updateList:"http://update.infomir.com/im/2101/update_list.txt"}},!1),models.IM2102=extend(models.MAG324C,{logoImagePath:PATH_IMG_PUBLIC+"menu/logo/im2102.png",url:{updateList:"http://update.infomir.com/im/2102/update_list.txt"},setting:{settingsList:["playback","interface","update","timeShift","speedTest","settings","accessControl","teletext"]}},!1),config=extend(config,models[gSTB.GetDeviceModelExt()]),function(){var i,deskCount,index,menu=[];if(config.desktop.count=config.desktop.x*config.desktop.y,!Array.isArray(config.menu[0])){for(deskCount=Math.ceil(config.menu.length/config.desktop.count),i=0;deskCount>i;i++)menu[i]=config.menu.slice(i*config.desktop.count,(i+1)*config.desktop.count);config.menu=menu}config.speedTest||(index=config.setting.settingsList.indexOf("speedTest"),-1!==index&&config.setting.settingsList.splice(index,1)),config.traceroute||(index=config.setting.settingsList.indexOf("traceroute"),-1!==index&&config.setting.settingsList.splice(index,1))}(),config}(configuration),function(){function pushContent(attrs){var textOk,typeOk;(!textFilter&&typeFilter===MEDIA_TYPE_NONE||(textOk=attrs.name&&-1!==attrs.name.toLowerCase().indexOf(textFilter.toLowerCase()),typeOk=attrs.type===typeFilter||typeFilter===MEDIA_TYPE_NONE,textOk&&typeOk))&&(-1!==listLink.parent.playable.indexOf(attrs.type)?(listLink.playList.push(attrs),listLink.playListSet=!1):attrs.type===MEDIA_TYPE_TEXT&&(listLink.subList.push(attrs),listLink.playListSet=!1),-1===listLink.mtypes.indexOf(attrs.type)&&listLink.mtypes.push(attrs.type),content.push(attrs))}function openError(){new CModalAlert(listLink.parent,_("Error"),_("Unknown type of selected item"),_("Close"))}function fileSort(list,sortType){return list=list||[],Array.isArray(list)&&list.length>0&&(list.sort(function(a,b){return a.name.toLowerCase().localeCompare(b.name.toLowerCase())}),sortType===MEDIA_ACTION_SORT_TYPE&&void 0!==list[0].type?list.sort(function(a,b){return a.type-b.type}):sortType===MEDIA_ACTION_SORT_EXT&&void 0!==list[0].ext?list.sort(function(a,b){return a.ext.toLowerCase().localeCompare(b.ext.toLowerCase())}):sortType===MEDIA_ACTION_SORT_SIZE&&void 0!==list[0].size&&list.sort(function(a,b){return a.size-b.size})),list}function listDir(path){var dirs=[],files=[],data={dirs:[],files:[],url:path},result;if(console.log("listDir: "+path),void 0!==path&&""!==path){result=gSTB.ListDir(path,!1),MediaBrowser.isStrictMode&&(result=result.replace("var dirs = [","dirs = [").replace("var files = [","files = ["));try{eval(result)}catch(e){echo(e),dirs=[],files=[]}Array.isArray(dirs)&&dirs.length>0&&(dirs=dirs.filter(function(dir){return""!==dir}),dirs.forEach(function(dir){dir=dir.slice(0,-1),dir&&data.dirs.push({name:dir,type:MEDIA_TYPE_FOLDER})})),Array.isArray(files)&&files.length>0&&(files=files.filter(function(file){return void 0!==file.name}),files.forEach(function(file){file.ext=file.name.split(".").pop(),file.type=listLink.ext2type[file.ext.toLowerCase()]}),data.files=files)}return data}function openRoot(data,level){var i,len,isRecords=!1;for(textFilter&&content.push({name:"..",type:MEDIA_TYPE_BACK}),CURRENT_NETWORK_STATE&&(pushContent({name:_("Network"),markable:!1,readOnly:!0,type:MEDIA_TYPE_SAMBA_ROOT}),""!==environment.upnp_conf&&"off"!==environment.upnp_conf&&(window.stbUPnP&&window.stbUPnP.getServerListSync?(window.UPnPBrowser.ready||window.UPnPBrowser.init(listLink),
pushContent({name:"UPnP",markable:!1,readOnly:!0,url:"/UPnP",type:MEDIA_TYPE_UPNP_ROOT})):pushContent({name:"UPnP",markable:!1,readOnly:!0,url:PATH_MEDIA+"UPnP",type:MEDIA_TYPE_UPNP}))),STORAGE_INFO.forEach(function(item){gSTB.IsFolderExist(item.mountPath+"/records")&&(isRecords=!0)}),isRecords&&pushContent({name:_("Records"),markable:!1,readOnly:!0,type:MEDIA_TYPE_RECORDS_ROOT}),pushContent({name:_("Favorites"),markable:!1,readOnly:!0,type:MEDIA_TYPE_FAVORITES}),i=0,len=STORAGE_INFO.length;len>i;++i)pushContent({name:STORAGE_INFO[i].label,markable:!1,readOnly:Boolean(STORAGE_INFO[i].isReadOnly),url:STORAGE_INFO[i].mountPath,size:STORAGE_INFO[i].size,free:STORAGE_INFO[i].freeSize,type:STORAGE_INFO[i].mediaType,fsType:STORAGE_INFO[i].fsType});if(CURRENT_NETWORK_STATE){for(i=0,len=SMB_ARRAY.length;len>i;++i)pushContent({name:SMB_ARRAY[i].local,markable:!1,readOnly:!0,url:SMB_PATH,address:"//"+SMB_ARRAY[i].url+"/"+SMB_ARRAY[i].folder,link:SMB_ARRAY[i],type:MEDIA_TYPE_SAMBA_SHARE});for(i=0,len=NFS_ARRAY.length;len>i;++i)pushContent({name:NFS_ARRAY[i].local,markable:!1,readOnly:!0,url:NFS_PATH,address:NFS_ARRAY[i].url+":"+NFS_ARRAY[i].folder,link:NFS_ARRAY[i],type:MEDIA_TYPE_NFS_SHARE})}listLink.total=content.length,listLink.onLevelChange(data,content,level)}function openBack(){if(echo("openBack"),listLink.path.length>1){if(listLink.mode===MEDIA_TYPE_FAVORITES&&FAVORITES_CHANGED)return void new CModalConfirm(listLink.parent,_("The list of favourite records has changed"),_("Save updated list of favourite records?"),_("Exit without saving"),function(){listLink.parent.FavRestore(),listLink.Open({type:MEDIA_TYPE_BACK})},_("Save"),function(){listLink.parent.FavSave(),listLink.Open({type:MEDIA_TYPE_BACK})});listLink.bcrumb&&listLink.bcrumb.Pop(),listLink.path.pop(),textFilter=listLink.path[listLink.path.length-1].filterText?listLink.path[listLink.path.length-1].filterText:"",typeFilter=MEDIA_TYPE_NONE,FileBrowser.open(listLink.path[listLink.path.length-1],listLink.LEVEL_CHANGE_UP)}}function openSambaRoot(data,level){var groups=null;try{groups=JSON.parse(gSTB.GetSmbGroups()),echo(groups,"gSTB.GetSmbGroups")}catch(e){echo(e)}groups&&Array.isArray(groups.result)&&groups.result.length>0?(content.push({name:"..",type:MEDIA_TYPE_BACK}),groups.result.forEach(function(group){group&&pushContent({markable:!1,readOnly:data.readOnly,name:group,url:group,type:MEDIA_TYPE_SAMBA_GROUP})}),listLink.total=content.length,listLink.onLevelChange(data,content,level)):new CModalAlert(listLink.parent,_("Error"),_("Unable to get working group list")+".",_("Close"),function(){setTimeout(function(){listLink.Activate(!0)},5)})}function openSambaGroup(data,level){var servers=null;try{servers=JSON.parse(gSTB.GetSmbServers(JSON.stringify({group:data.name}))),echo(servers,"gSTB.GetSmbServers")}catch(e){echo(e)}servers&&Array.isArray(servers.result)&&servers.result.length>0?(content.push({name:"..",type:MEDIA_TYPE_BACK}),servers.result.forEach(function(server){server&&pushContent({markable:!1,readOnly:data.readOnly,name:server,url:data.url+"/"+server,type:MEDIA_TYPE_SAMBA_HOST})}),listLink.total=content.length,listLink.onLevelChange(data,content,level)):new CModalAlert(listLink.parent,_("Error"),_("Unable to get working group servers")+".",_("Close"),function(){setTimeout(function(){listLink.Activate(!0)},5)})}function openSambaHost(data,level){function parseSambaHost(shares){shares&&shares.result&&Array.isArray(shares.result.shares)?(content.push({name:"..",type:MEDIA_TYPE_BACK}),shares.result.shares.forEach(function(share){share&&pushContent({name:share,markable:!1,readOnly:data.readOnly,url:SMB_PATH,address:"//"+shares.result.serverIP+"/"+share,addresses:[shares.result.serverIP].concat(shares.result.additionalIPs||[]),folder:share,type:MEDIA_TYPE_SAMBA_SHARE})}),listLink.total=content.length,listLink.onLevelChange(data,content,level)):new CModalAlert(listLink.parent,_("Error"),_("Unable to get server shares")+".",_("Close"),function(){setTimeout(function(){listLink.Activate(!0)},5)})}var modalAuth,currFocus,shares=null,smbStoreAuth=SMB_SRV_AUTH[data.url];try{shares=smbStoreAuth?JSON.parse(gSTB.GetSmbShares(JSON.stringify({server:data.name,login:smbStoreAuth.login,password:smbStoreAuth.password}))):JSON.parse(gSTB.GetSmbShares(JSON.stringify({server:data.name}))),echo(shares,"gSTB.GetSmbShares"),0===shares.errCode?parseSambaHost(shares):+gSTB.Version().split(";")[0].split(":")[1].trim()<343?parseSambaHost():(currFocus=document.activeElement,new CModalConfirm(listLink.parent,_("Network connection"),_("Unable to open the server.<br>Authorization may be necessary.<br>Specify login and password?"),_("Cancel"),function(){currFocus.focus()},_("Yes"),function(){modalAuth=new CModalAuth(listLink.parent,_("Authorization"),_("Login:"),_("Password")+":",_("Cancel"),function(){listLink.prevFocus=currFocus},_("Connection"),function(login,pass){return shares=JSON.parse(gSTB.GetSmbShares(JSON.stringify({server:data.name,login:login,password:pass}))),0===shares.errCode?(SMB_SRV_AUTH[data.url]={login:login,password:pass},parseSambaHost(shares),listLink.prevFocus=currFocus,!0):(echo(modalAuth.name),new CModalHint(modalAuth,_("Unable to connect to the resource<br>with the given parameters"),4e3),!1)})}))}catch(e){echo(e)}}function openFolder(data,level){var result=listDir(data.url),isISO=!1;content.push({name:"..",type:MEDIA_TYPE_BACK}),listLink.playList=[],listLink.subList=[],fileSort(result.dirs,MEDIA_ACTION_SORT_NAME).concat(fileSort(result.files,listLink.sortType)).forEach(function(item){item.url=data.url+"/"+item.name,item.markable=!0,item.readOnly=content.readOnly,void 0!==content.fsType&&"records"===item.name&&(item.readOnly=!0,item.markable=!1),-1!==["VIDEO_TS","BDMV","video_ts","bdmv","video_ts.ifo","VIDEO_TS.IFO"].indexOf(item.name)&&(isISO=!0),item.stared=item.markable&&FAVORITES_NEW[item.url]?!0:!1,echo(item.type,"item.type"),pushContent(item)}),isISO&&setTimeout(function(){new CModalConfirm(listLink.parent,_("Multimedia content"),_("The directory contains DVD or Blu-ray structure.<br>Begin playing?"),_("Cancel"),function(){},_("Yes"),function(){MediaPlayer.preparePlayer({name:data.name,url:data.url,type:MEDIA_TYPE_ISO},listLink.parent,!0,!0,!listLink.parent.BPanel.btnF3add.data.hidden||!listLink.parent.BPanel.btnF3del.data.hidden,!1)})},5),result.dirs.length+result.files.length>0&&(listLink.hideF3add=!1,listLink.hideF2=!1),listLink.total=content.length,listLink.onLevelChange(data,content,level)}function openSambaShare(data,level){var modalAuth,currFocus;listLink.parent.UnmountSMB(),listLink.parent.MountSMB(data)?openFolder({name:data.name,url:SMB_PATH,type:MEDIA_TYPE_FOLDER,index:data.index},level):(currFocus=document.activeElement,new CModalConfirm(listLink.parent,_("Network connection"),_("Unable to mount the folder.<br>Authorization may be necessary.<br>Specify login and password?"),_("Cancel"),function(){currFocus.focus()},_("Yes"),function(){modalAuth=new CModalAuth(listLink.parent,_("Authorization"),_("Login:"),_("Password")+":",_("Cancel"),function(){listLink.prevFocus=currFocus},_("Connection"),function(login,pass){return data.login=login,data.pass=pass,listLink.parent.MountSMB(data)?(listLink.prevFocus=currFocus,setTimeout(function(){listLink.Open(data)},5),!0):(echo(modalAuth.name),new CModalHint(modalAuth,_("Unable to connect to the resource<br>with the given parameters"),4e3),!1)})}))}function openNfsShare(data,level){var modalAuth,currFocus;listLink.parent.UnmountNFS(),listLink.parent.MountNFS(data)?openFolder({name:data.name,url:NFS_PATH,type:MEDIA_TYPE_FOLDER,index:data.index},level):(currFocus=document.activeElement,new CModalConfirm(listLink.parent,_("Network connection"),_("Unable to mount the folder.<br>Authorization may be necessary.<br>Specify login and password?"),_("Cancel"),function(){currFocus.focus()},_("Yes"),function(){modalAuth=new CModalAuth(listLink.parent,_("Authorization"),_("Login:"),_("Password")+":",_("Cancel"),function(){listLink.prevFocus=currFocus},_("Connection"),function(login,pass){return SMB_AUTH[data.address]={login:login,pass:pass},listLink.parent.MountSMB(data)?(listLink.prevFocus=currFocus,setTimeout(function(){listLink.Open(data)},5),!0):(echo(modalAuth.name),new CModalHint(modalAuth,_("Unable to connect to the resource<br>with the given parameters"),4e3),!1)})}))}function openFavorites(data,level){var path;content.push({name:"..",type:MEDIA_TYPE_BACK});for(path in FAVORITES_NEW)FAVORITES_NEW.hasOwnProperty(path)&&(FAVORITES_NEW[path].markable=!0,FAVORITES_NEW[path].stared=!1,pushContent(FAVORITES_NEW[path]));content.length>1&&(listLink.hideF2=listLink.hideF3del=!1),listLink.total=content.length,listLink.onLevelChange(data,content,level)}function openRecordsFolder(paths){var dHash={},dList=[];paths.forEach(function(path){var structure=listDir(path);structure.dirs.forEach(function(dir){echo(dir,"dir"),dHash[dir.name]=dHash[dir.name]||[],dHash[dir.name].push(path+"/"+dir.name)}),structure.files.forEach(function(file){echo(file,"file"),file.url=path+"/"+file.name,dList.push(file)})});for(var name in dHash)dHash.hasOwnProperty(name)&&dList.push({name:name,url:name,paths:dHash[name]});return fileSort(dList,MEDIA_ACTION_SORT_NAME)}function openRecordsRoot(data,level){var path,paths=[];content.push({name:"..",type:MEDIA_TYPE_BACK}),STORAGE_INFO.forEach(function(item){path=item.mountPath+"/records",gSTB.IsFolderExist(path)&&paths.push(path)}),openRecordsFolder(paths).forEach(function(item){item.type=MEDIA_TYPE_RECORDS_CHAN,pushContent(item)}),listLink.total=content.length,listLink.onLevelChange(data,content,level)}function openRecordsChan(data,level){content.push({name:"..",type:MEDIA_TYPE_BACK}),openRecordsFolder(data.paths).forEach(function(item){item.type=item.type||MEDIA_TYPE_RECORDS_CHAN,pushContent(item)}),listLink.total=content.length,listLink.onLevelChange(data,content,level)}function openRecordsDate(data,level){var list=[];content.push({name:"..",type:MEDIA_TYPE_BACK}),data.paths.forEach(function(path){listDir(path).files.forEach(function(item){item.url=path+"/"+item.name,list.push(item)})}),list=fileSort(list,listLink.sortType),list.forEach(function(item){item.markable=!0,item.name=item.name.split("-").join(":"),item.stared=FAVORITES_NEW[item.url]?!0:!1,pushContent(item)}),list.length>0&&(listLink.hideF2=listLink.listLink=!1),listLink.total=content.length,listLink.onLevelChange(data,content,level)}function openFile(data,level,options){listLink.timer&&clearTimeout(listLink.timer),listLink.playListSet||(MediaPlayer.prepareList(listLink.playList,listLink.playList.indexOf(data)),MediaPlayer.setSubList(listLink.subList),listLink.playListSet=!0),MediaPlayer.playNow||null!==MediaPlayer.obj?(MediaPlayer.Show(!0,listLink.parent),setTimeout(function(){MediaPlayer.changeScreenMode(!0)},0)):(data.options=options||{},MediaPlayer.preparePlayer(data,listLink.parent,!0,!0,!listLink.parent.BPanel.btnF3add.data.hidden||!listLink.parent.BPanel.btnF3del.data.hidden,!1,options))}function openText(data){gSTB.IsFileUTF8Encoded(data.url)?(MediaPlayer.setForcedSubtitles(data,"utf-8"),new CModalHint(currCPage,_("Selected subtitle will appear<br>during next player launch"),3e3)):new CModalSubtitleOpen(listLink.parent,{data:data,onadd:function(options,encoding){MediaPlayer.setForcedSubtitles(options.data,encoding),new CModalHint(currCPage,_("Selected subtitle will appear<br>during next player launch"),3e3)}})}function openCue(data,level){var folder,filename;return void 0===data.cue&&(folder=data.url.split("/"),filename=folder.pop(),folder=listDir(folder.join("/")),folder.files.forEach(function(file){return file.name===filename&&0===file.size?void new CModalAlert(listLink.parent,_("Error"),_("No records in this playlist"),_("Close")):void 0}),data.cue=listLink.parent.ParseCue(listLink.parent.ReadFile(encodeURI(data.url),data.encoding))),0===data.cue.files.length?void new CModalAlert(listLink.parent,_("Error"),_("Cyrillic symbols in path or file name are not allowed"),_("Close")):(echo(data,"openCue"),content.push({name:"..",type:MEDIA_TYPE_BACK}),data.cue.files.forEach(function(file){file.tracks.forEach(function(track){var info={name:track.number+". "+track.title,type:MEDIA_TYPE_CUE_ITEM,time:track.index[track.index.length-1]||0,url:listLink.parentItem.url+"/"+file.name};data.cue.files.length>1&&(info.file=file.name),track.performer!==data.cue.performer&&void 0!==track.performer&&(info.performer=track.performer),pushContent(info)})}),listLink.total=content.length,void listLink.onLevelChange(data,content,level))}function openPlaylist(data,level){var folder,filename,code=data.code;if(data.readOnly=!0,data.filterText&&(code=KEYS.F1),!code)return void setTimeout(function(){new CModalPlayListOpen(listLink.parent)},5);folder=data.url.split("/"),filename=folder.pop(),folder=listDir(folder.join("/")),folder.files.forEach(function(file){return file.name===filename&&0===file.size?void new CModalAlert(listLink.parent,_("Error"),_("No records in this playlist"),_("Close")):void 0});var m3uData=listLink.parent.ParseM3u(listLink.parent.ReadFile(encodeURI(data.url),data.encoding)),plsData=m3uData.items,hasNew=!1;if(configuration.maySecureM3u&&("SYSLOG_SRV"in m3uData.config&&environment.syslog_srv!==m3uData.config.SYSLOG_SRV&&(echo("new syslog"),environment.syslog_srv=m3uData.config.SYSLOG_SRV,gSTB.SetEnv(JSON.stringify({syslog_srv:environment.syslog_srv})),hasNew=!0),delete m3uData.config.SYSLOG_SRV,m3uData.config&&JSON.stringify(m3uData.config)!==JSON.stringify(PLSCFG)&&(echo("new IPTV/OTT"),gSTB.SaveUserData("plscfg.json",JSON.stringify(m3uData.config)),0===Object.keys(PLSCFG).length?(echo("apply IPTV/OTT"),MediaPlayer.applyCAS(m3uData.config)):hasNew=!0,PLSCFG=m3uData.config),hasNew&&new CModalAlert(listLink.parent,_("New settings"),_("New settings were found. Please reboot the device for activation."),_("Close"),function(){setTimeout(function(){listLink.Activate(!0)},5)})),0===plsData.length)return void new CModalAlert(listLink.parent,_("Error"),_("Cyrillic symbols in path or file name are not allowed"),_("Close"));switch(data.code=null,code){case KEYS.F1:case KEYS.F2:content.push({name:"..",type:MEDIA_TYPE_BACK}),plsData.forEach(function(item){item.markable=!0,item.stared=FAVORITES_NEW[item.url]?!0:!1,pushContent(item)}),plsData.length>0&&(listLink.hideF2=listLink.hideF3add=!1),code===KEYS.F2&&(setTimeout(function(){listLink.Reposition(plsData[0]),listLink.onFocus(listLink.Current())},0),MediaPlayer.prepareList(plsData),listLink.playListSet=!0,MediaPlayer.preparePlayer(plsData[0]||{},listLink.parent,!0,!0,!0,!0)),listLink.total=content.length,listLink.onLevelChange(data,content,level);break;case KEYS.F3:setTimeout(function(){var result=IPTVChannels.addChannels(plsData,!0);if(result===!1)new CModalAlert(listLink.parent,_("Add to IPTV channels"),_("Unable to add the selected records"),_("Close"));else if(0===result)new CModalAlert(listLink.parent,_("Add to IPTV channels"),_("No new channels for selected records"),_("Close"));else{var conf=new CModalAlert(listLink.parent,_("Add to IPTV channels"),_("Channels added successfully:")+" "+result,_("Close"));conf.bpanel.Add(KEYS.TV,"tv.png",_("Go to IPTV channels"),function(){return conf.Show(!1),MediaBrowser.Reset(),MediaBrowser.Show(!1),IPTVChannels.Reset(),IPTVChannels.Show(!0),!0})}},5)}}function route(data,level,options){content=[],listLink.Clear(),level=level||listLink.LEVEL_CHANGE_DOWN,data&&routes[data.type]?(listLink.fileBrowser=FileBrowser,routes[data.type]!==openFile&&(MediaBrowser.FileList.states.marked=[],MediaBrowser.Preview.valSel.innerText=0),routes[data.type](data,level,options)):(MediaBrowser.FileList.states.marked=[],MediaBrowser.Preview.valSel.innerText=0,openError(data,level))}var routes={},textFilter="",typeFilter=MEDIA_TYPE_NONE,listLink,content;window.FileBrowser={init:function(list){listLink=list,routes[MEDIA_TYPE_MB_ROOT]=openRoot,routes[MEDIA_TYPE_BACK]=openBack,routes[MEDIA_TYPE_SAMBA_ROOT]=openSambaRoot,routes[MEDIA_TYPE_SAMBA_GROUP]=openSambaGroup,routes[MEDIA_TYPE_SAMBA_HOST]=openSambaHost,routes[MEDIA_TYPE_SAMBA_SHARE]=openSambaShare,routes[MEDIA_TYPE_NFS_SHARE]=openNfsShare,routes[MEDIA_TYPE_FOLDER]=openFolder,routes[MEDIA_TYPE_STORAGE_USB]=openFolder,routes[MEDIA_TYPE_STORAGE_SATA]=openFolder,routes[MEDIA_TYPE_STORAGE_SD]=openFolder,routes[MEDIA_TYPE_STORAGE_MMC]=openFolder,routes[MEDIA_TYPE_UPNP]=openFolder,routes[MEDIA_TYPE_FAVORITES]=openFavorites,routes[MEDIA_TYPE_RECORDS_ROOT]=openRecordsRoot,routes[MEDIA_TYPE_RECORDS_CHAN]=openRecordsChan,routes[MEDIA_TYPE_RECORDS_DATE]=openRecordsDate,routes[MEDIA_TYPE_RECORDS_ITEM]=openFile,routes[MEDIA_TYPE_VIDEO]=openFile,routes[MEDIA_TYPE_AUDIO]=openFile,routes[MEDIA_TYPE_IMAGE]=openFile,routes[MEDIA_TYPE_ISO]=openFile,routes[MEDIA_TYPE_STREAM]=openFile,routes[MEDIA_TYPE_DVB]=openFile,routes[MEDIA_TYPE_CUE]=openCue,routes[MEDIA_TYPE_CUE_ITEM]=openFile,routes[MEDIA_TYPE_TEXT]=openText,routes[MEDIA_TYPE_PLAYLIST]=openPlaylist,routes[MEDIA_TYPE_UPNP_ROOT]=function(data,level){UPnPBrowser&&UPnPBrowser.open(data,level)},window.FileBrowser={open:route,filterText:function(text){var clone={},last=listLink.path[listLink.path.length-1];textFilter=text;for(var attr in last)clone[attr]=last[attr];clone.filterText=text,listLink.Open(clone)},filterType:function(type){var typeOk,textOk,data;typeFilter=type,data=content.filter(function(item){return textOk=item.type===MEDIA_TYPE_BACK||item.name&&-1!==item.name.toLowerCase().indexOf(textFilter),typeOk=item.type===typeFilter||typeFilter===MEDIA_TYPE_NONE||item.type===MEDIA_TYPE_BACK,textOk&&typeOk}),listLink.data=data,listLink.indexView=-1,listLink.total=data.length,listLink.renderView(0),listLink.activeItem.data||listLink.focusItem(listLink.$body.firstChild)}}}}}(),function(){function openError(data){echo(data,"openError"),new CModalAlert(listLink.parent,_("Error"),_("Unknown type of selected item"),_("Close"))}function prepareContent(list){for(var item,result=[];item=list.shift();){switch(item.ContentType){case stbUPnP.TYPE_FOLDER:item.type=MEDIA_TYPE_UPNP_FOLDER,item.url=item.ID;break;case stbUPnP.TYPE_AUDIO:item.type=MEDIA_TYPE_AUDIO;break;case stbUPnP.TYPE_VIDEO:item.type=MEDIA_TYPE_VIDEO;break;case stbUPnP.TYPE_IMAGE:item.type=MEDIA_TYPE_IMAGE;break;default:item.type=MEDIA_TYPE_TEXT}item.markable=!1,item.type!==stbUPnP.TYPE_FOLDER&&item.Resources&&item.Resources.length&&(item.url=item.Resources[0].Value,item.size=item.Resources[0].Size),item.Resources=null,item.readOnly=!0,item.name=item.Title,-1!==listLink.parent.playable.indexOf(item.type)&&listLink.playList.push(item),result.push(item),++itr}return listLink.mtypes.push(MEDIA_TYPE_UPNP_FOLDER),listLink.mtypes.push(MEDIA_TYPE_AUDIO),listLink.mtypes.push(MEDIA_TYPE_VIDEO),listLink.mtypes.push(MEDIA_TYPE_IMAGE),echo(result.length,"prepareContent"),result}function onOpenContext(data,error){var content=[];return error?(echo(error,"onOpenContext.error"),loadingHint.Show(!1),new CModalHint(listLink.parent,_("Unable to connect to the resource<br>with the given parameters"),4e3),void openBack()):(echo(data,"onOpenContext"),prevPage=0,content.push({type:MEDIA_TYPE_BACK,name:".."}),listLink.total=stbUPnP.pagesCount*stbUPnP.pageSize,data&&Array.isArray(data)&&content.length>0&&(content=content.concat(prepareContent(data)),topEl=content.length>stbUPnP.pageSize?content.pop():!1),loadingHint.Show(!1),void listLink.onLevelChange(context,content,levelChange))}function onOpenPage(data,error){var page=stbUPnP.pageNumber;return error?(echo(error,"onOpenPage.error"),void loadingHint.Show(!1)):(echo(page,"onOpenPage"),void(0===page?(data=prepareContent(data),data.unshift({type:MEDIA_TYPE_BACK,name:".."}),topEl=data.length>stbUPnP.pageSize?data.pop():!1,listLink.data=data,prevPage>page?(listLink.indexView=data.length,listLink.renderView(data.length-listLink.size),listLink.focusItem(listLink.$body.lastChild)):(listLink.indexView=-1,listLink.renderView(0),listLink.focusItem(listLink.$body.firstChild)),listLink.total=stbUPnP.pagesCount*stbUPnP.pageSize):data&&Array.isArray(data)&&data.length>0&&(data=prepareContent(data),prevPage>page?(listLink.data=data,listLink.indexView=data.length,listLink.renderView(data.length-listLink.size),listLink.focusItem(listLink.$body.lastChild)):stbUPnP.pagesCount-1===page?(echo(topEl,"DADAADADAD"),topEl&&data.push(topEl),listLink.data=data,listLink.indexView=-1,listLink.renderView(0),listLink.focusItem(listLink.$body.firstChild)):(listLink.data=data,listLink.indexView=-1,listLink.renderView(0),listLink.focusItem(listLink.$body.firstChild)),prevPage=page)))}function openUPnPRoot(data,level){var servers=stbUPnP.getServerListSync(),content=[];content.push({name:"..",type:MEDIA_TYPE_BACK}),console.log("openUPnPRoot"),servers&&Array.isArray(servers)&&servers.length>0?(servers.forEach(function(server){content.push({markable:!1,readOnly:!0,name:server.FriendlyName,url:server.UDN,type:MEDIA_TYPE_UPNP_HOST})}),inServer=!1,levelChange=level,listLink.total=content.length,listLink.onLevelChange(context,content,level)):new CModalAlert(listLink.parent,_("Error"),_("Unable to get dlna group servers")+".",_("Close"),function(){setTimeout(function(){listLink.Activate(!0)},5)})}function openUPnPHost(data,level){inServer=!0,loadingHint?(loadingHint.Free(),loadingHint=new CModalHint(listLink.parent,_("Loading..."),!1,!0)):loadingHint=new CModalHint(listLink.parent,_("Loading..."),!1,!0),levelChange=level,stbUPnP.openServer(data.url)}function openUPnPFolder(data,level){loadingHint?(loadingHint.Free(),loadingHint=new CModalHint(listLink.parent,_("Loading..."),!1,!0)):loadingHint=new CModalHint(listLink.parent,_("Loading..."),!1,!0),listLink.path[listLink.path.length-1].pId=data.ID,levelChange=level,level===listLink.LEVEL_CHANGE_UP?(echo(data.pId,"data.pId"),stbUPnP.openContext(data.pId)):stbUPnP.openContext(data.ID)}function openBack(){listLink.path.pop(),listLink.bcrumb&&listLink.bcrumb.Pop(),stbUPnP.setFilterName(listLink.path[listLink.path.length-1].filterText?listLink.path[listLink.path.length-1].filterText:""),stbUPnP.setFilterType(MEDIA_TYPE_NONE),UPnPBrowser.open(listLink.path[listLink.path.length-1],listLink.LEVEL_CHANGE_UP)}function openFile(data){listLink.timer&&clearTimeout(listLink.timer),listLink.playListSet||(MediaPlayer.prepareList(listLink.playList),MediaPlayer.setSubList(listLink.subList),listLink.playListSet=!0),MediaPlayer.playNow||null!==MediaPlayer.obj?(MediaPlayer.Show(!0,listLink.parent),setTimeout(function(){MediaPlayer.changeScreenMode(!0)},0)):MediaPlayer.preparePlayer(data,listLink.parent,!0,!0,!listLink.parent.BPanel.btnF3add.data.hidden||!listLink.parent.BPanel.btnF3del.data.hidden,!1)}function route(data,level){var isLevel=void 0!==level;level=level||listLink.LEVEL_CHANGE_DOWN,context=data,listLink.Clear(),data?routes[data.type]?(listLink.fileBrowser=UPnPBrowser,routes[data.type](data,level)):isLevel?openError(data,level):routes[MEDIA_TYPE_MB_ROOT](data,level):openError(data,level)}function onRenderView(){listLink.scrollBar.scrollTo(stbUPnP.pageNumber*stbUPnP.pageSize)}function onOverflow(event){inServer&&1!==stbUPnP.pagesCount&&(event.direction!==KEYS.DOWN||stbUPnP.pagesCount!==stbUPnP.pageNumber-1)&&(event.direction!==KEYS.UP||0!==stbUPnP.pageNumber)&&(event.direction===KEYS.DOWN?(pageDirection=!0,stbUPnP.openPage(stbUPnP.pageNumber+1)):event.direction===KEYS.UP&&(pageDirection=!1,stbUPnP.openPage(stbUPnP.pageNumber-1)))}var topEl,loadingHint,listLink,levelChange,pageDirection,context,routes={},inServer=!1,prevPage=0,itr=0;window.UPnPBrowser={init:function(list){listLink=list,stbUPnP.init(),stbUPnP.onOpenContext=onOpenContext,stbUPnP.onOpenServer=onOpenContext,stbUPnP.onOpenPage=onOpenPage,stbUPnP.pageSize=list.size,routes[MEDIA_TYPE_UPNP_ROOT]=openUPnPRoot,routes[MEDIA_TYPE_UPNP_HOST]=openUPnPHost,routes[MEDIA_TYPE_UPNP_FOLDER]=openUPnPFolder,routes[MEDIA_TYPE_BACK]=openBack,routes[MEDIA_TYPE_RECORDS_ITEM]=openFile,routes[MEDIA_TYPE_VIDEO]=openFile,routes[MEDIA_TYPE_AUDIO]=openFile,routes[MEDIA_TYPE_IMAGE]=openFile,routes[MEDIA_TYPE_ISO]=openFile,routes[MEDIA_TYPE_STREAM]=openFile,routes[MEDIA_TYPE_DVB]=openFile,routes[MEDIA_TYPE_CUE_ITEM]=openFile,routes[MEDIA_TYPE_MB_ROOT]=function(data,level){FileBrowser&&FileBrowser.open(data,level)},window.UPnPBrowser={ready:!0,open:route,filterText:function(text){stbUPnP.setFilterName(text),prevPage=-1,stbUPnP.openPage(0)},filterType:function(type){stbUPnP.setFilterType(type),prevPage=-1,stbUPnP.openPage(0)},onRenderView:onRenderView,onOverflow:onOverflow}}}}(),CFileList.prototype=Object.create(VList.prototype),CFileList.prototype.constructor=CFileList,CFileList.prototype.SetBreadCrumb=function(component){this.bcrumb=component},CFileList.prototype.SetSearchBar=function(component){this.sbar=component},CFileList.prototype.Open=function(data,level){echo(data.type,"CFileList.Open"),this.fileBrowser.open(data,level)},CFileList.prototype.SetFilterText=function(text){this.filterText=text,this.fileBrowser.filterText(this.filterText)},CFileList.prototype.SetFilterType=function(type){this.filterType=type,this.fileBrowser.filterType(this.filterType)},CFileList.prototype.GetPlaylist=function(){var self=this,list=[];return this.states.marked.forEach(function(item){-1!==self.parent.playable.indexOf(item.type)&&list.push(item)}),list},CFileList.prototype.Clear=function(){this.sbar&&this.sbar.Reset(),this.filterType=MEDIA_TYPE_NONE,this.mtypes=[],this.playListSet=!1},CFileList.prototype.Reposition=function(data,manageFocus){var index,viewIndex=this.indexView||0;return echo(data,"Reposition"),data?(index=data.index||0,index>=viewIndex+this.size?(echo("INDEX GREAT"),index=index<this.data.length-1?index:this.data.length-1,echo("MOVE DOWN"),this.indexView=-1,this.renderView(index-this.size+1),manageFocus&&(echo("lastChild","focusItem"),this.focusItem(this.$body.lastChild))):index<this.data.length?(index=index>0?index:0,echo({indexView:this.indexView,"data.length":this.data.length,size:this.size,index:index}),this.data.length<this.size?(this.indexView=-1,this.renderView(0)):(this.activeItem.data.index===index?(index=this.data.indexOf(this.activeItem),-1===index&&(index=this.activeItem.data.index),viewIndex=this.indexView,index=viewIndex-index):this.data.length-this.size>index?(viewIndex=index,index=0):(viewIndex=this.data.length-this.size,index-=this.data.length-this.size),this.indexView=-1,this.renderView(viewIndex)),manageFocus&&(echo(index,"focusItem"),this.focusItem(this.$body.children[index]))):(viewIndex=this.indexView,this.indexView=-1,this.renderView(viewIndex),manageFocus&&(echo(index-this.indexView,"Focus item"),this.focusItem(this.$body.children[index-this.indexView]))),!0):!1},CFileList.prototype.focusItem=function(item){var self=this,$prev=this.activeItem;return void 0!==item&&$prev!==item&&item.data?(null!==$prev&&$prev.classList.remove("focused"),this.activeItem=item,this.activeItem.data=this.data[this.activeItem.index],item.classList.add("focused"),this.mode!==MEDIA_TYPE_FAVORITES?this.canFav&&item.data.type!==MEDIA_TYPE_FOLDER&&item.data.type!==MEDIA_TYPE_BACK?(this.parent.BPanel.Hidden(this.parent.BPanel.btnF3add,item.data.stared),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,!item.data.stared)):(this.parent.BPanel.Hidden(this.parent.BPanel.btnF3add,!0),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,!0)):this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,item.data.type===MEDIA_TYPE_BACK),item.data.markable?this.parent.BPanel.Hidden(this.parent.BPanel.btnF2,item.data.type===MEDIA_TYPE_BACK):this.parent.BPanel.Hidden(this.parent.BPanel.btnF2,!0),this.timer&&clearTimeout(this.timer),echo(self.parent.Preview.isVisible&&self.parent.isVisible,"self.parent.Preview.isVisible && self.parent.isVisible"),self.parent.Preview.isVisible&&self.parent.isVisible&&(MediaPlayer.end(!0),this.timer=setTimeout(function(){self.parent.Preview.Info(item.data)},400)),!0):!1},CFileList.prototype.onLevelChange=function(context,data,level){this.data=data,this.filterText=context.filterText?context.filterText:"",echo(level,"onLevelChange"),level===this.LEVEL_CHANGE_DOWN?(this.indexView=-1,this.renderView(0),this.focusItem(this.$body.firstChild),this.filterText?this.bcrumb&&this.bcrumb.Push("/","media/ico_filter.png",this.filterText):this.bcrumb&&this.bcrumb.Push("/","media/type_"+context.type+".png",context.name?context.name:""),this.path.push(context),this.Activate(!0)):this.Reposition(this.parentItem,!0)||this.Activate(!0),this.parent.Tray.iconFilter.parentNode===this.parent.Tray.handleInner&&this.parent.Tray.handleInner.removeChild(this.parent.Tray.iconFilter),this.parent.Tray.Show(globalBuffer.size()>0,!1),this.mode=void 0!==this.path[1]?this.path[1].type:MEDIA_TYPE_MB_ROOT,this.canFav=this.mode===MEDIA_TYPE_STORAGE_SATA||this.mode===MEDIA_TYPE_STORAGE_USB||this.mode===MEDIA_TYPE_FAVORITES||context.type===MEDIA_TYPE_PLAYLIST,this.parentItem=this.path[this.path.length-1],this.parent.BPanel.Hidden(this.parent.BPanel.btnF2,!0),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3add,!0),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,!0),this.parent.Preview.SetItemsCount()},CFileList.prototype.ActiveItems=function(){var items=this.data.filter(function(item){return item.marked});return 0===items.length&&this.activeItem&&this.activeItem.data.markable&&items.push(this.activeItem.data),items},CFileList.prototype.DeleteAll=function(items){var self=this,focusIndex=null;if(Array.isArray(items)&&items.length>0){if(-1===items.indexOf(this.activeItem.data))focusIndex=this.activeItem.index;else{for(focusIndex=this.activeItem.index,echo(this.activeItem,"!!!!!!!!!!!!!!!!!!!!!!!");this.data[focusIndex]&&this.data[focusIndex].marked;)++focusIndex;focusIndex===this.data.length&&(focusIndex=0)}items.forEach(function(item){self.Delete(item)}),self.data.forEach(function(item,index){item.index=index}),echo(focusIndex,"!!!!!!!!!!!!!!!!!!!!!!!"),this.data.length===focusIndex&&(--focusIndex,this.activeItem.data.index=focusIndex,--this.indexView),this.Focused(focusIndex,!0)}},CFileList.prototype.Delete=function(item){var index;item&&(this.SetState(item,"marked",!1),index=this.data.indexOf(item),this.data.splice(index,1),--this.total)},CFileList.prototype.SetStar=function(item,state){var indexView=this.indexView,result=this.SetState(item,"stared",state);return result?(this.activeItem.data===item?state?(this.activeItem.classList.add("stared"),this.activeItem.star.style.background='url("'+PATH_IMG_PUBLIC+'ico_fav.png") no-repeat right'):(this.activeItem.classList.remove("stared"),this.activeItem.star.style.background="none"):(this.indexView=-1,this.renderView(indexView)),result):!1},CFileList.prototype.Marked=function(item,state){var result,indexView=this.indexView;return item&&item.markable&&(result=this.SetState(item,"marked",state))?(item===this.activeItem.data?state?this.activeItem.classList.add("marked"):this.activeItem.classList.remove("marked"):(this.indexView=-1,this.renderView(indexView)),result):!1},CFileList.prototype.FirstMatch=function(value){var item,i,len=this.data.length;if(""===value)return-1;for(i=0;len>i;i++)if(item=this.data[i],item.type!==MEDIA_TYPE_BACK&&item.name&&-1!==item.name.toLowerCase().indexOf(value.toLowerCase()))return i},CFileList.prototype.Focused=function(index,focus){index>=this.data.length&&(index=this.data.length-1),index>=0&&(this.data[index].index=index,this.Reposition(this.data[index],focus))},CFileList.prototype.renderItem=function($item,attrs){$item.ready?($item.$body.innerText=attrs.name,$item.$body.style.background='url("'+PATH_IMG_PUBLIC+"media/type_"+attrs.type+'.png") no-repeat left'):($item.innerHTML="",$item.$body=element("div",{className:"data"},attrs.name),$item.star=element("div",{className:"star"}),$item.$body.style.background='url("'+PATH_IMG_PUBLIC+"media/type_"+attrs.type+'.png") no-repeat left',$item.appendChild($item.star),$item.appendChild($item.$body),$item.ready=!0)},CFileList.prototype.renderView=function(index){var $item,i,itemData,prevIndex,self=this;if(echo(index,"renderView"),this.data.length>this.size&&index>this.data.length-this.size)return!1;
if(index!==Number(index)&&(index=0),0>index&&(index=0),this.indexView!==index){for(prevIndex=this.indexView,this.indexView=index,i=0;i<this.size;i++)$item=this.$body.children[i],itemData=this.data[index],itemData?(itemData.index=index,$item.data=itemData,$item.index=index,this.renderItem($item,itemData),itemData.marked?$item.classList.add("marked"):$item.classList.remove("marked"),itemData.stared?($item.classList.add("stared"),$item.star.style.background='url("'+PATH_IMG_PUBLIC+'ico_fav.png") no-repeat right'):($item.classList.remove("stared"),$item.star.style.background="none")):($item.data=$item.index=void 0,$item.ready&&($item.$body.innerText="",$item.$body.style.background="",$item.star.style.background="none",$item.classList.remove("marked"))),index++;return echo(this.total,"this.total"),this.scrollBar.realSize!==this.total&&this.scrollBar.init({realSize:this.total}),this.scrollBar.scrollTo(this.indexView),this.fileBrowser.onRenderView&&this.fileBrowser.onRenderView(this.indexView,this.indexView>prevIndex),this.timer&&clearTimeout(this.timer),self.parent.Preview.isVisible&&self.parent.isVisible&&(MediaPlayer.end(!0),this.timer=setTimeout(function(){self.parent.Preview.Info(self.activeItem.data)},400)),!0}return!1},CFileList.prototype.onFocus=function(item){var self=this;item&&(this.states.marked&&0!==this.states.marked.length||(this.mode!==MEDIA_TYPE_FAVORITES?self.canFav&&item.data.type!==MEDIA_TYPE_FOLDER&&item.data.type!==MEDIA_TYPE_BACK?(this.parent.BPanel.Hidden(this.parent.BPanel.btnF3add,item.data.stared),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,!item.data.stared)):(this.parent.BPanel.Hidden(this.parent.BPanel.btnF3add,!0),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,!0)):this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,item.data.type===MEDIA_TYPE_BACK)),item.data.markable?this.parent.BPanel.Hidden(this.parent.BPanel.btnF2,item.data.type===MEDIA_TYPE_BACK):this.parent.BPanel.Hidden(this.parent.BPanel.btnF2,!0))},CFileList.prototype.Init=function(config){var self=this;config.onClick=function(){void 0!==this.data&&(self.focusItem(this),self.fileBrowser.open(this.data))},VList.prototype.Init.call(this,config)},CFileList.prototype.onOverflow=function(event){this.fileBrowser.onOverflow&&this.fileBrowser.onOverflow(event)},CFileList.prototype.Refresh=function(refocus){var data=null;null!==this.parentItem&&(refocus!==!1&&this.activeItem&&(data=this.activeItem.data),MediaBrowser.FileList.bcrumb.Pop(),MediaBrowser.FileList.path.pop(),this.fileBrowser.open(this.parentItem),this.Reposition(data,!0))},TVList.prototype=Object.create(CScrollList.prototype),TVList.prototype.constructor=TVList,TVList.prototype.SetBreadCrumb=function(component){this.bcrumb=component},TVList.prototype.SetSearchBar=function(component){this.sbar=component},TVList.prototype.Filter=function(){var self=this;this.Each(function(item){var text_ok=item.data.type===MEDIA_TYPE_BACK||item.data.name&&-1!==item.data.name.toLowerCase().indexOf(self.filterText),type_ok=item.data.type===self.filterType||self.filterType===MEDIA_TYPE_NONE||item.data.type===MEDIA_TYPE_BACK;self.Hidden(item,!(text_ok&&type_ok))})},TVList.prototype.FirstMatch=function(value){var items;if(""===value)return null;items=this.handleInner.children;for(var i=0;i<items.length;i++){var item=items[i];if(item.data.type!==MEDIA_TYPE_BACK&&item.data.name&&-1!==item.data.name.toLowerCase().indexOf(value.toLowerCase()))return item}return null},TVList.prototype.Add=function(obj,attrs,states){var number,self=this;if(this.filterText){var text_ok=attrs.type===MEDIA_TYPE_BACK||obj.name&&-1!==obj.name.toLowerCase().indexOf(this.filterText.toLowerCase()),type_ok=attrs.type===this.filterType||this.filterType===MEDIA_TYPE_NONE||attrs.type===MEDIA_TYPE_BACK;if(!text_ok||!type_ok)return null}-1===this.mtypes.indexOf(attrs.type)&&this.mtypes.push(attrs.type);var body=element("div",{className:"data"},obj.name),star=element("div",{className:"star"});obj.number?number=element("div",{className:"number"},obj.number):(number=element("div",{className:"number"}),number.style.background='url("'+PATH_IMG_PUBLIC+"media/type_"+attrs.type+'.png") no-repeat center');var timeshift=element("div",{className:obj.tsOn?"timeshift tsOn":"timeshift"});attrs.name||(attrs.name=obj.name);var item=CScrollList.prototype.Add.call(this,[number,body,timeshift,star],{star:star,data:attrs,onclick:function(){return this.self.Open(this.data),!1},oncontextmenu:EMULATION?null:function(){return self.parent.actionF2(!1),!1}});return obj.number&&(item.domNumber=number),states&&states.stared&&item.self.SetStar(item,!0),item},TVList.prototype.SetStar=function(item,state){item.stared!==state&&(this.SetState(item,"stared",state),state!==!1?item.star.style.background='url("'+PATH_IMG_PUBLIC+'ico_fav_s.png") no-repeat right':item.star.style.background="none",this.parent.BPanel.Hidden(this.parent.BPanel.btnF3add,state!==!1?!0:!1),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,state!==!1?!1:!0))},TVList.prototype.onFocus=function(item){var self=this;return MediaPlayer.ts_inProgress&&MediaPlayer.tsExitCheck("focus",item)?!0:(clearTimeout(this.timer.OnFocusPlay),item.data.markable?this.parent.BPanel.Hidden(this.parent.BPanel.btnF2,!1):this.parent.BPanel.Hidden(this.parent.BPanel.btnF2,!0),item.data.type===MEDIA_TYPE_STREAM?this.states.marked&&0!==this.states.marked.length?echo(this.states.marked[0].data,"this.states.marked"):(this.parent.BPanel.Hidden(this.parent.BPanel.btnF3add,item.stared),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,!item.stared)):(this.parent.BPanel.Hidden(this.parent.BPanel.btnF3add,!0),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,!0)),self.parent.clearEPG(),this.timer.OnFocusPlay=setTimeout(function(){item.data.type===MEDIA_TYPE_BACK?self.filterText?self.parent.domInfoTitle.innerHTML=_("Contains the list of items corresponding to the given filter request"):self.parent.domInfoTitle.innerHTML=self.parentItem.name?self.parentItem.name:"":(self.parent.initEPGNow(),self.parent.domInfoTitle.innerHTML=item.data.name?item.data.name:""),item.data.type===MEDIA_TYPE_STREAM?(self.prevChannel=self.lastChannel,self.lastChannel=self.parentItem.data[item.data.index],self.parent.domURL.innerHTML=(self.parentItem.data[item.data.index].sol&&""!==self.parentItem.data[item.data.index].sol?self.parentItem.data[item.data.index].sol+" ":"")+self.parentItem.data[item.data.index].url,MediaPlayer.obj!==self.parentItem.data[item.data.index]&&MediaPlayer.preparePlayer(self.parentItem.data[item.data.index],self.parent,!0,!1,!0),self.parent.pvr.arr.length&&self.parent.pvr.check(!0)):(self.lastChannel=null,self.parent.domURL.innerHTML="",MediaPlayer.end())},500),!1)},TVList.prototype.Clear=function(){CScrollList.prototype.Clear.call(this),this.parent.domURL.innerHTML="",this.parent.domInfoTitle.innerHTML="",this.filterType=MEDIA_TYPE_NONE,this.mtypes=[]},TVList.prototype.Back=function(){var self=this;return this.path.length>1?(this.path.pop(),self.lastChannel=null,this.bcrumb&&this.bcrumb.Pop(),this.Build(this.path[this.path.length-1]),setTimeout(function(){self.onFocus(self.Current())},0),this.LEVEL_CHANGE_UP):this.LEVEL_CHANGE_NONE},TVList.prototype.goToChannel=function(number){this.handle.children.length>number&&number>this.channelStart&&(this.Focused(this.handle.children[number+(this.handle.children[0].data.type===MEDIA_TYPE_BACK?1:0)],!0),this.SetPosition(this.activeItem))},TVList.prototype.Open=function(data,noPlay){echo(data,"data Open");var levelChange=this.Build(data,noPlay);return levelChange!==this.LEVEL_CHANGE_NONE&&(this.parent.Tray.iconFilter.parentNode===this.parent.Tray.handleInner&&this.parent.Tray.handleInner.removeChild(this.parent.Tray.iconFilter),this.parent.Tray.Show(globalBuffer.size()>0,!1),levelChange===this.LEVEL_CHANGE_DOWN?(this.filterText?this.bcrumb&&this.bcrumb.Push("/","media/ico_filter.png",this.filterText):this.bcrumb&&this.bcrumb.Push("/","media/type_"+data.type+".png",data.name?data.name:""),this.path.push(data),this.Activate(!0),data.data&&data.data.length&&this.onFocus(this.activeItem)):this.Reposition(this.parentItem)||this.Activate(!0),this.parentItem=this.path[this.path.length-1]),levelChange},TVList.prototype.Reset=function(){this.parentItem=null,this.path=[],this.Clear(),this.bcrumb&&this.bcrumb.Reset(),this.sbar&&this.sbar.Reset()},TVList.prototype.Build=function(data,noPlay){var levelChange=this.LEVEL_CHANGE_NONE;return this.filterText=data.filterText?data.filterText:"",data&&data.type&&"function"==typeof this.openAction[data.type]?levelChange=this.openAction[data.type].call(this,data,noPlay):new CModalAlert(this.parent,_("Error"),_("Unknown type of selected item"),_("Close")),levelChange},TVList.prototype.Refresh=function(refocus){var data={data:null};null!==this.parentItem&&(this.Build(this.parentItem),refocus!==!1&&(data=this.activeItem?this.activeItem:this.FirstMatch(this.filterText)),data&&data.data?this.Reposition(data.data):this.Reposition(data))},TVList.prototype.RefreshIndex=function(){this.channelStart=this.parentItem.type===MEDIA_TYPE_GROUP?0:-1;var i=0,j=1,items=this.handleInner.children,delta=0;if(null!==this.parentItem&&items.length)for(delta=items[0].data.type===MEDIA_TYPE_BACK?1:0,i=delta;i<items.length;i++)items[i].data.index=i-delta,items[i].data.type===MEDIA_TYPE_GROUP?this.channelStart=i:(items[i].data.number=j,items[i].domNumber.innerHTML=j,j++);else this.Refresh(!0)},TVList.prototype.Reposition=function(data){var change=!1;if(data)for(var item,i=0,l=this.Length();l>i;i++)if(item=this.handleInner.children[i],data.index===item.data.index||data.data&&!data.index&&data.data.index===item.data.index)return change=this.Focused(item,!0),this.SetPosition(this.activeItem),change||this.onFocus(item),change;return!1},TVList.prototype.Marked=function(item,state){return item&&item.data&&item.data.markable?CScrollList.prototype.Marked.call(this,item,state):!1},TVList.prototype.SetFilterText=function(text){echo("enter to SetFilterText : "+this.filterText),this.filterText=text.toLowerCase(),this.Filter()},TVList.prototype.Filter=function(){var self=this;this.Each(function(item){var text_ok=item.data.type===MEDIA_TYPE_BACK||item.data.name&&-1!==item.data.name.toLowerCase().indexOf(self.filterText);self.Hidden(item,!text_ok)})},TVList.prototype.ActiveItems=function(){var items=this.states.marked?this.states.marked.slice():[];return 0===items.length&&this.activeItem&&this.activeItem.data.markable&&items.push(this.activeItem),items},TVList.prototype.createGroup=function(name,data,toDelete,deleteList){var obj={},dataMap=[],map=this.parentItem.data.map(function(item){return item.type===MEDIA_TYPE_GROUP?item.name:null}),toAdd=map.indexOf(name);if(echo(toDelete,"toDelete"),-1===toAdd)obj.name=name,obj.type=MEDIA_TYPE_GROUP,obj.data=[],this.parentItem.data.splice(this.channelStart+1,0,obj);else{dataMap=data.map(function(item){return item.type===MEDIA_TYPE_GROUP?item.name:void 0});for(var i=0;i<dataMap.length;i++)if(-1!==map.indexOf(dataMap[i]))return new CModalAlert(currCPage,_("Error"),_("Copying error")),!1;obj=this.parentItem.data[toAdd]}var ansvCode=this.addChannelsToList(obj.data,JSON.parse(JSON.stringify(data)),!1,!0);return 0!==ansvCode&&this.parent.actionFileDelete(toDelete,deleteList),this.Refresh(!1),-1===toAdd?this.Focused(this.handle.children[this.channelStart+(this.handle.children[0].data.type===MEDIA_TYPE_BACK?1:0)],!0):this.Focused(this.handle.children[toAdd+(this.handle.children[0].data.type===MEDIA_TYPE_BACK?1:0)],!0),this.isActive&&this.Activate(),!0},TVList.prototype.addChannelsToList=function(list,data,refocus,noRefresh){echo(list,"ADD TO LIST"),echo(data,"ADD DATA");var needCheck=!1,tempList=[],channelStart=-1,map=this.path.map(function(item){return item.data}),mapList=list.map(function(item){return item.type});if(channelStart=mapList.lastIndexOf(MEDIA_TYPE_GROUP),data){for(var i=0;i<data.length;i++)if(data[i].type===MEDIA_TYPE_GROUP&&-1!==map.indexOf(data[i].data))return new CModalAlert(this.parent,_("Error"),_("Copying error")),0;for(i=0;i<data.length;i++){for(var needAdd=!0,j=0;j<list.length;j++)if(list[j].name===data[i].name&&list[j].type===data[i].type&&(list[j].url===data[i].url||list[j].sol+" "+list[j].url===data[i].url||list[j].url===data[i].sol+" "+data[i].url)){needAdd=!1;break}needAdd&&(data[i].type===MEDIA_TYPE_GROUP?(channelStart++,list.splice(channelStart,0,data[i])):list.push(data[i]),needCheck=!0)}}return needCheck&&(tempList=list.slice(),tempList=IPTVChannels.checkTS_data(tempList,!0),list=tempList.a),this.parent.needSave=!0,noRefresh||this.Refresh(refocus),needCheck},DVBList.prototype=Object.create(CList.prototype),DVBList.prototype.constructor=DVBList,DVBList.prototype.EventHandler=function(event,manageFocus){var found=null;if(void 0===manageFocus&&(manageFocus=this.manageFocus),event.stopped!==!0){switch(event.preventDefault(),event.code){case KEYS.PAGE_UP:found=this.Prev(this.onPage);break;case KEYS.PAGE_DOWN:found=this.Next(this.onPage);break;case KEYS.LEFT:case KEYS.HOME:found=this.Prev(this.count-1);break;case KEYS.RIGHT:case KEYS.END:found=this.Next(this.count-1);break;case KEYS.UP:found=this.Prev();break;case KEYS.DOWN:found=this.Next();break;case KEYS.OK:return void this.pressOK(this.ActiveItem());default:return}this.Focused(found||this.ActiveItem(),!0,manageFocus)}},DVBList.prototype.Next=function(count){var next=null,endList=!1;if(count=count&&count>0?count:1,this.itemIndex+=count,this.listIndex+=count,this.listIndex>=this.count&&(this.listIndex=0,endList=!0),this.itemIndex>=this.onPage||endList){if(this.RefreshPageIndex())return next=this.loadChannels(!1);next=this.items[this.itemIndex]}else next=this.items[this.itemIndex];return this.Focused(next,!0),next},DVBList.prototype.Prev=function(count){var prev=null,endList=!1;if(count=count&&count>0?count:1,this.itemIndex-=count,this.listIndex-=count,this.listIndex<0&&(this.listIndex=this.count-1,endList=!0),this.itemIndex<0||endList){if(this.RefreshPageIndex())return prev=this.loadChannels(!1);prev=this.items[this.itemIndex]}else prev=this.items[this.itemIndex];return this.Focused(prev,!0),prev},CList.prototype.RefreshPageIndex=function(){var start,delta,pageIndex=this.pageIndex;return this.pageIndex=Math.floor(this.listIndex/this.onPage),this.itemIndex=this.listIndex%this.onPage,start=this.onPage*this.pageIndex,start>0&&start+this.onPage>this.count&&(delta=start-this.count+this.onPage,this.itemIndex+=delta),pageIndex!==this.pageIndex},DVBList.prototype.createList=function(){this.filters.length?(this.nativList=stbDvbManager.createChannelList(this.filters,this.nativList||stbDvbManager.channelList),this.count=this.nativList.size+1):(this.nativList=stbDvbManager.channelList,this.count=this.nativList.size)},DVBList.prototype.loadChannels=function(noFocus,noFill){var start,data,i,arr=[],back=0,delta=0;for(start=this.onPage*this.pageIndex,this.filterText&&(start>0?start--:(arr.push({type:MEDIA_TYPE_BACK,name:"..",data:null}),back=1)),start>0&&start+this.onPage>this.count?(delta=start-this.count+this.onPage,start=this.count-this.onPage):this.itemIndex<0&&(delta=-this.count%this.onPage),data=this.nativList.slice(start,this.onPage-back),i=0;i<data.length;i++)arr.push({type:MEDIA_TYPE_DVB,name:data[i].name||data[i].id,data:data[i]});return this.SetList(arr),data=noFill?null:this.FillItems(noFocus,delta)},DVBList.prototype.setScroll=function(){var margin,percent;percent=Math.ceil(this.onPage/this.count*100),percent>=100&&(percent=0),margin=Math.ceil(this.scrollHandle.offsetHeight/Math.ceil(this.count/this.onPage)*this.pageIndex),this.scrollThumb.style.height=percent+"%",this.scrollThumb.style.marginTop=margin+"px"},DVBList.prototype.RenderItem=function(){var i=this.items.length-1;return[this.items[i].number=element("div",{className:"number"}),this.items[i].channel=element("div",{className:"data"}),this.items[i].scrambled=element("div",{className:"scrambled"}),this.items[i].star=element("div",{className:"star"})]},DVBList.prototype.FillItems=function(noFocus,delta){var startPos=this.onPage*this.pageIndex,active=null,item=null,list=[];delta||(delta=0),startPos-=delta,this.Focused(this.activeItem,!1);for(var i=0;i<this.onPage;i++)if(item=this.items[i],this.list.length>i){switch(this.list[i].type){case MEDIA_TYPE_DVB:item.number.innerHTML=this.list[i].data.channelNumber,item.channel.innerHTML=this.list[i].name,item.name=this.list[i].name,item.scrambled.className=this.list[i].data.scrambled===!0?"scrambled on":"scrambled",item.data=this.list[i].data,item.markable=!0,item.type=this.list[i].type,item.listIndex=i+startPos,this.SetStar(item,FAVORITES_NEW[item.data.uri]||FAVORITES[item.data.uri]?!0:!1),item.number.style.background="";break;case MEDIA_TYPE_BACK:item.number.innerHTML="",item.number.style.background='url("'+PATH_IMG_PUBLIC+"media/type_"+MEDIA_TYPE_BACK+'.png") no-repeat center',item.channel.innerHTML=this.list[i].name,item.data=null,item.type=this.list[i].type,item.markable=!1,this.SetStar(item,!1)}this.Hidden(item,!1),i+startPos===this.listIndex&&(active=this.items[i],this.itemIndex=i),list.push(item.data)}else item.index=-1,item.data=null,this.Hidden(item,!0);return noFocus||this.Focused(active,!0),this.setScroll(),"function"==typeof this.onFillItems&&this.onFillItems(active,list),active},DVBList.prototype.onFillItems=function(active,list){},DVBList.prototype.SetBreadCrumb=function(component){this.bcrumb=component},DVBList.prototype.SetSearchBar=function(component){this.sbar=component},DVBList.prototype.SetStar=function(item,state){item.stared!==state&&(this.SetState(item,"stared",state),state!==!1?item.star.style.background='url("'+PATH_IMG_PUBLIC+'ico_fav_s.png") no-repeat right':item.star.style.background="none")},DVBList.prototype.onFocus=function(item){var self=this;return MediaPlayer.ts_inProgress&&MediaPlayer.tsExitCheck("focus",item)?!0:(clearTimeout(this.timer.OnFocusPlay),item.type===MEDIA_TYPE_DVB?(this.parent.BPanel.Hidden(this.parent.BPanel.btnF3,!1),this.states.marked&&0!==this.states.marked.length||(this.parent.BPanel.Hidden(this.parent.BPanel.btnF3add,item.stared),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,!item.stared))):(this.parent.BPanel.Hidden(this.parent.BPanel.btnF3add,!0),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,!0)),this.timer.OnFocusPlay=setTimeout(function(){item.type===MEDIA_TYPE_BACK?(self.filterText?self.parent.domInfoTitle.innerHTML=_("Contains the list of items which are corresponding to the given filter request"):self.parent.domInfoTitle.innerHTML=self.parentItem.name?self.parentItem.name:"",self.lastChannel=null,MediaPlayer.end()):(self.parent.domInfoTitle.innerHTML=item.name+"<br />"+_("Frequency")+": "+item.data.frequency,self.parent.initEPGNow(),MediaPlayer.preparePlayer({id:item.data.id,name:item.name,url:item.data.uri,type:item.type,sol:"dvb"},self.parent,!0,!1,!0),self.prevChannel=self.lastChannel,self.lastChannel=item.data)},500),!1)},DVBList.prototype.Clear=function(){this.count=0,this.mtypes=[],CList.prototype.Clear.call(this)},DVBList.prototype.Back=function(){var data,active;return this.path.length>1?(this.path.pop(),data=this.path[this.path.length-1],this.lastChannel=null,this.bcrumb&&this.bcrumb.Pop(),active=this.activeItem.data,this.filterText=data.filterText,this.filters=data.filters||[],this.createList(),this.loadChannels(),active&&this.SetPositionByIndex(this.nativList.indexOf(active.id)),this.Build(data),this.LEVEL_CHANGE_UP):this.LEVEL_CHANGE_NONE},DVBList.prototype.goToChannel=function(number){var tempList,ch,index;tempList=stbDvbManager.createChannelList(["eq","channelNumber",number],this.nativList),tempList.size>0&&(ch=tempList.slice(0,1),index=this.nativList.indexOf(ch[0].id),index>=0&&this.SetPositionByIndex(index,!0))},DVBList.prototype.SetPositionByIndex=function(index,makeFocused){return index>=this.count&&(index=this.count-1),0>index&&(index=0),this.listIndex=index,this.RefreshPageIndex()?this.loadChannels(!makeFocused):makeFocused&&this.Focused(this.items[this.itemIndex],!0),!0},DVBList.prototype.Open=function(data,noPlay){echo(data,"DVB OPEN");var levelChange=this.Build(data,noPlay);return levelChange!==this.LEVEL_CHANGE_NONE&&(this.parent.Tray.iconFilter.parentNode===this.parent.Tray.handleInner&&this.parent.Tray.handleInner.removeChild(this.parent.Tray.iconFilter),this.parent.Tray.Show(globalBuffer.size()>0,!1),levelChange===this.LEVEL_CHANGE_DOWN?(this.filterText?this.bcrumb&&this.bcrumb.Push("/","media/ico_filter.png",this.filterText):this.bcrumb&&this.bcrumb.Push("/","media/type_"+data.type+".png",data.name?data.name:""),this.path.push(data),this.Activate(!0)):this.Activate(!0),this.parentItem=this.path[this.path.length-1]),levelChange},DVBList.prototype.Reset=function(){this.parentItem=null,this.path=[],this.Clear(),this.bcrumb&&this.bcrumb.Reset(),this.sbar&&this.sbar.Reset()},DVBList.prototype.Build=function(data,noPlay){var levelChange=this.LEVEL_CHANGE_NONE;return this.filterText=data.filterText?data.filterText:"",this.filters=data.filters||[],data&&data.type&&"function"==typeof this.openAction[data.type]?levelChange=this.openAction[data.type].call(this,data,noPlay):new CModalAlert(this.parent,_("Error"),_("Unknown type of selected item"),_("Close")),levelChange},DVBList.prototype.Refresh=function(){this.loadChannels(),this.filters.length?this.count=this.nativList.size+1:this.count=this.nativList.size,this.SetPositionByIndex(this.listIndex,!0)},DVBList.prototype.Marked=function(item,state){return item&&item.data&&item.data.markable?CList.prototype.Marked.call(this,item,state):!1},DVBList.prototype.SetFilterText=function(text){echo("enter to SetFilterText : "+this.filterText),this.filterText=text.toLowerCase(),this.Filter()},DVBList.prototype.Filter=function(){var self=this;this.Each(function(item){var text_ok=item.data.type===MEDIA_TYPE_BACK||item.data.name&&-1!==item.data.name.toLowerCase().indexOf(self.filterText);echo("item.data.name : "+item.data.name+" "+text_ok),self.Hidden(item,!text_ok)})},DVBList.prototype.ActiveItems=function(){var items=this.states.marked?this.states.marked.slice():[];return 0===items.length&&this.activeItem&&this.activeItem.markable&&items.push(this.activeItem),items},EpgGrid.prototype=Object.create(CList.prototype),EpgGrid.prototype.constructor=EpgGrid,EpgGrid.prototype.EventHandler=function(event){switch(event.code){case KEYS.PAGE_UP:case KEYS.PAGE_DOWN:case KEYS.UP:case KEYS.DOWN:case KEYS.HOME:case KEYS.END:case KEYS.OK:CList.prototype.EventHandler.call(this,event);break;case KEYS.LEFT:this.SubPrev();break;case KEYS.RIGHT:this.SubNext();break;default:event.preventDefault()}},EpgGrid.prototype.Init=function(handle){CList.prototype.Init.call(this,handle);for(var i=0;i<this.onPage;i++)this.items[i].domElements={channelNumber:this.items[i].querySelector(".channel_number"),channelName:this.items[i].querySelector(".channel_name"),epgList:this.items[i].querySelector(".schedule_line")},this.items[i].epgActive=0,this.items[i].number=-1,this.items[i].day=0,this.items[i].epgData=null,this.items[i].subNavigElements=[];this.timeLine=this.parent.handle.querySelector(".content .timeline")},EpgGrid.prototype.Exit=function(){var i;for(i in this.timer)clearTimeout(this.timer[i]);for(i in this.internal)clearInterval(this.internal[i]);return this.time=null,this.SetList([]),!0},EpgGrid.prototype.RenderItem=function(){var item=[element("div",{className:"channel_block"},[element("div",{className:"channel_number"}),element("div",{className:"channel_name"})]),element("div",{className:"schedule_line"})];return item},EpgGrid.prototype.FillItems=function(noFocus){for(var startPos=this.onPage*this.pageIndex,listLength=this.list.length,active=null,list=[],i=0;i<this.onPage;i++)this.items[i].epgActive=0,this.items[i].epgData=null,this.items[i].subNavigElements=[],elclear(this.items[i].domElements.epgList),listLength>i+startPos?(this.items[i].domElements.channelNumber.innerHTML=this.list[i+startPos].channel_number,this.items[i].domElements.channelName.innerHTML=this.list[i+startPos].name,this.items[i].data=this.list[i+startPos],this.items[i].index=i+startPos,this.items[i].number=this.list[i+startPos].channel_number,list.push(this.items[i]),this.Hidden(this.items[i],!1),i+startPos===this.listIndex&&(active=this.items[i]),this.items[i].day=this.day):(this.items[i].domElements.channelNumber.innerHTML="",this.items[i].domElements.channelName.innerHTML="",this.items[i].data=null,this.items[i].index=-1,this.items[i].number=-1,this.items[i].day=0,this.Hidden(this.items[i],!0));return this.Reset(active),noFocus||this.Focused(active,!0),this.setScroll(),"function"==typeof this.onFillItems&&this.onFillItems(active,list),active},EpgGrid.prototype.onFillItems=function(active,list){if("function"==typeof this.GetEpg)for(var i=0;i<list.length;i++)this.InitEPG(list[i],this.GetEpg(list[i].data))},EpgGrid.prototype.onFocus=function(item){elclear(this.domProgramBlock),this.CheckEPGActive(item),this.SubFocused(item.subNavigElements[item.epgActive],!0)},EpgGrid.prototype.SetCurrentProgram=function(data){var startTime=null,endTime=null,min=null,h=null,time="";elclear(this.domProgramBlock),data&&(startTime=new Date(1e3*data.start),endTime=new Date(1e3*(data.start+data.duration)),min=startTime.getMinutes(),h=startTime.getHours(),min=min>9?min:"0"+min,h=h>9?h:"0"+h,time+=h+":"+min+" - ",min=endTime.getMinutes(),h=endTime.getHours(),min=min>9?min:"0"+min,h=h>9?h:"0"+h,time+=h+":"+min,elchild(this.domProgramBlock,time+" "+(data.info?data.info:data.name)))},EpgGrid.prototype.goToChannel=function(number){var index=this.FindByFild(number,"channel_number");return-1!==index&&(this.listIndex=index,this.RefreshPageIndex()?this.FillItems():this.Focused(this.items[this.itemIndex])),index},EpgGrid.prototype.ReposTimeLine=function(){var newTime=new Date,left=0,time=newTime.getTime()/1e3;time>this.time&&this.time+this.timeStep>time?(left=Math.ceil((time-this.time)/this.timeStep*this.sheduleWidth),left+=this.timeLineMargin,this.timeLine.style.display="block",this.timeLine.style.left=left+"px"):this.timeLine.style.display="none"},EpgGrid.prototype.CheckingTime=function(){var self=this;this.internal.checkingTime&&clearInterval(this.internal.checkingTime),this.ReposTimeLine(),this.internal.checkingTime=window.setInterval(function(){var newTime=self.GetStartTime(),index=0;self.epgMode||(self.activeItem&&self.activeItem.subNavigElements.length&&(index=self.activeItem.epgActive,self.CheckEPGActive(self.activeItem),self.activeItem.epgActive!==index&&self.SubFocused(self.activeItem.subNavigElements[self.activeItem.epgActive],!0)),self.time!==newTime&&(self.time=newTime,self.InitTimeBlock(),self.RefreshEPG())),self.ReposTimeLine()},6e4)},EpgGrid.prototype.RefreshEPG=function(focusOnLast){for(var items=this.ActiveItems(),i=0;i<items.length;i++)this.InitEPG(items[i],this.GetEpg(items[i].data),focusOnLast)},EpgGrid.prototype.CheckEPGData=function(){var items=this.ActiveItems(),newData=null;if("function"!=typeof this.GetEpg)return!1;for(var i=0;i<items.length;i++)newData=this.GetEpg(items[i].data),newData&&newData.length&&(items[i].epgData&&0!==items[i].epgData.length&&newData[0].start===items[i].epgData[0].start||this.InitEPG(items[i],newData));return!0},EpgGrid.prototype.InitTimeBlock=function(){null===this.time&&(this.time=this.GetStartTime());var time=new Date(1e3*this.time),step=this.timeStep/this.countOfSteps,dayName=fullDaysOfWeek[time.getDay()],min=time.getMinutes(),hour=time.getHours(),month=time.getMonth()+1,day=time.getDate(),year=time.getFullYear(),dateText=dayName+" "+(10>day?"0"+day:day)+"."+(10>month?"0"+month:month)+"."+year,elements=element("div",{className:"mainblock"},[element("span",{},dateText),(10>hour?"0"+hour:hour)+":"+(10>min?"0"+min:min)]);elclear(this.domTimeblocks),elchild(this.domTimeblocks,elements);for(var i=1;i<=this.countOfSteps;i++)time.setTime(1e3*(this.time+i*step)),min=time.getMinutes(),hour=time.getHours(),elchild(this.domTimeblocks,element("div",{className:"block"},(10>hour?"0"+hour:hour)+":"+(10>min?"0"+min:min)))},EpgGrid.prototype.GetStartTime=function(){var date=new Date,time=0,step=this.timeStep/this.countOfSteps;return time=60*date.getMinutes(),time%step===0?Math.ceil(date.getTime()/1e3)-step:step>time?Math.ceil(date.getTime()/1e3)-time:Math.ceil(date.getTime()/1e3)-time+step},EpgGrid.prototype.InitEPG=function(item,list,focusOnLast){var i,epgItems=[],before=this.time;if(Array.isArray(list))item.epgData!==list&&(item.epgData=list);else if(!Array.isArray(item.epgData)||!item.epgData.length)return this.ClearEPGList(item),!1;for(echo(item.epgData,"item.epgData"),i=0;i<item.epgData.length&&!(item.epgData[i].start>=this.time+this.timeStep-60);i++)if(item.epgData[i].start+item.epgData[i].duration>this.time){if(item.epgData[i].start<=before){before=item.epgData[i].start+item.epgData[i].duration,epgItems.push(item.epgData[i]);continue}epgItems.push({start:before,duration:item.epgData[i].start-before,name:"",info:"",details:"",hidden:!0}),before=item.epgData[i].start,i--}return echo(epgItems,"epgItems"),this.RenderEPG(item,epgItems,focusOnLast),!0},EpgGrid.prototype.ClearEPGList=function(item){elclear(item.domElements.epgList),item.focused&&(item.subNavigElements=[],this.domEpgItemFocus=null,this.SetCurrentProgram()),elchild(item.domElements.epgList,element("div",{className:"empty"},_("EPG is missing")))},EpgGrid.prototype.RenderEPG=function(item,list,focusOnLast){var i,itemsList=[],finalList=[],width=0;if(elclear(item.domElements.epgList),!Array.isArray(list)||0===list.length)return void this.ClearEPGList(item);for(i=0;i<list.length;i++)itemsList[i]=element("div",{className:"block"+(list[i].hidden?" hidden":"")},list[i].name),itemsList[i].data=list[i],width=list[i].start<this.time?this.sheduleBlock*(list[i].duration-(this.time-list[i].start)):this.sheduleBlock*list[i].duration,width=Math.floor(width),itemsList[i].style.width=width+"px",itemsList[i].data=list[i];for(i=0;i<itemsList.length;i++)itemsList[i].data.hidden||finalList.push(itemsList[i]);item.subNavigElements=finalList,item.focused&&(focusOnLast?item.epgActive=item.subNavigElements.length?item.subNavigElements.length-1:0:this.CheckEPGActive(item),this.SubFocused(item.subNavigElements[item.epgActive],!0)),elchild(item.domElements.epgList,itemsList)},EpgGrid.prototype.CheckEPGActive=function(item){var index=0,time=new Date;if(0===this.epgMode)time=time.getTime()/1e3;else if(this.activeItem){if(!this.activeItem.subNavigElements.length)return void(item.epgActive=index);time=this.activeItem.subNavigElements[this.activeItem.epgActive].data.start}for(var i=0;i<item.subNavigElements.length;i++)if(item.subNavigElements[i].data.start<=time&&item.subNavigElements[i].data.start+item.subNavigElements[i].data.duration>=time){index=i;break}item.epgActive=index},EpgGrid.prototype.SubFocused=function(subitem,state){var changed=!1;return state=state!==!1,subitem&&subitem.nodeName?state!==subitem.focused&&(state?subitem!==this.domEpgItemFocus&&(this.domEpgItemFocus&&(this.domEpgItemFocus.focused=!1,this.domEpgItemFocus.classList.remove("focus")),this.domEpgItemFocus=subitem,subitem.focused=state,subitem.classList.add("focus"),this.onSubFocus(subitem)):(subitem.classList.remove("focus"),subitem===this.domEpgItemFocus&&(this.domEpgItemFocus=null)),changed=!0):this.domEpgItemFocus&&(this.domEpgItemFocus.focused=!1,this.domEpgItemFocus.classList.remove("focus"),changed=!0),changed},EpgGrid.prototype.onSubFocus=function(subitem){this.SetCurrentProgram(subitem.data)},EpgGrid.prototype.SubNext=function(){var item=this.activeItem;this.epgMode=1,item.subNavigElements.length>item.epgActive+1?(item.epgActive++,this.SubFocused(item.subNavigElements[item.epgActive])):(item.epgActive=0,this.time+=this.timeStep,this.InitTimeBlock(),this.RefreshEPG(),this.ReposTimeLine())},EpgGrid.prototype.SubPrev=function(){var item=this.activeItem,focusLast=!0,time=this.GetStartTime();this.epgMode=1,item.epgActive>0?(item.epgActive--,this.SubFocused(item.subNavigElements[item.epgActive])):Math.round(this.time/100)!==Math.round(time/100)&&(this.time-=this.timeStep,
this.time<time&&(this.time=time),this.InitTimeBlock(),this.RefreshEPG(focusLast),this.ReposTimeLine())},EpgGrid.prototype.GoToRealTime=function(){var item=this.activeItem,time=this.GetStartTime();this.epgMode&&(this.epgMode=0,this.day=0,this.time!==time?(this.time=time,this.InitTimeBlock(),this.RefreshEPG(),this.ReposTimeLine()):(this.CheckEPGActive(item),this.SubFocused(item.subNavigElements[item.epgActive])))};var remoteControlButtonsImagesPath=configuration.newRemoteControl?PATH_IMG_SYSTEM+"buttons/new/":PATH_IMG_SYSTEM+"buttons/old/",DVBEpg=new CPage;DVBEpg.name="CPageDVBEpg",DVBEpg.onInit=function(){var self=this;this.timer={},this.goToChFlag=!1,this.TVnumber="",this.domChannelNumber=this.handle.querySelector(".channelNumber"),this.BCrumb=new CBreadCrumb(this),this.BCrumb.rightItems=720===WINDOW_WIDTH?1:2,this.BCrumb.Init(PATH_IMG_PUBLIC,this.handle.querySelector(".body .header .cbcrumb")),this.BCrumb.Show(!0),this.ExitBPanel=new CButtonPanel(this),this.ExitBPanel.Init(remoteControlButtonsImagesPath,this.handle.querySelector(".body .footer .exit div.cbpanel-main")),this.ExitBPanel.btnExit=this.ExitBPanel.Add(KEYS.EXIT,"exit.png",configuration.newRemoteControl?_("Exit"):"",function(){self.actionExit()}),this.BPanel=new CButtonPanel(this),this.BPanel.Init(remoteControlButtonsImagesPath,this.handle.querySelector(".body .footer .main div.cbpanel-main")),configuration.mayPVR&&(this.BPanel.btnF1=this.BPanel.Add(KEYS.F1,"f1.png",_("Record"),function(){self.actionF1()})),this.BPanel.btnF3=this.BPanel.Add(KEYS.F3,"f3.png",_("Now"),function(){self.actionF3()}),this.EPGList=new EpgGrid(this),this.EPGList.Init(this.handle.querySelector(".body .content .clist-main")),this.EPGList.onFocus=function(item){switch(EpgGrid.prototype.onFocus.call(this,item),self.previous===MediaPlayer?self.previous.parent:self.previous){case DVBChannels:DVBChannels.DVBList.goToChannel(item.number);break;case IPTVChannels:IPTVChannels.TVList.goToChannel(item.number+IPTVChannels.TVList.channelStart)}},this.EPGList.GetEpg=this.GetEpg},DVBEpg.onShow=function(){switch(this.previous===MediaPlayer?this.previous.parent:this.previous){case DVBChannels:this.BPanel.Hidden(this.BPanel.btnF1,!0),this.BCrumb.Push("/","media/type_"+MEDIA_TYPE_DVB_ROOT+".png",_("DVB channels"));break;case IPTVChannels:this.BPanel.Hidden(this.BPanel.btnF1,!1),this.BCrumb.Push("/","media/type_"+MEDIA_TYPE_TV_ROOT+".png",_("IPTV channels"))}this.EPGList.InitTimeBlock(),this.EPGList.FillItems(),this.EPGList.CheckingTime()},DVBEpg.Reset=function(){this.EPGList.Clear()},DVBEpg.EventHandler=function(event){switch(event.code){case KEYS.OK:if(DVBEpg.goToChFlag){clearTimeout(DVBEpg.timer.goToChannel),DVBEpg.EPGList.goToChannel(parseInt(DVBEpg.TVnumber,10)),DVBEpg.TVnumber="",DVBEpg.goToChFlag=!1,DVBEpg.domChannelNumber.style.display="none",event.preventDefault();break}case KEYS.PAGE_UP:case KEYS.PAGE_DOWN:case KEYS.UP:case KEYS.DOWN:case KEYS.LEFT:case KEYS.RIGHT:case KEYS.HOME:case KEYS.END:DVBEpg.EPGList.EventHandler(event);break;case KEYS.EXIT:DVBEpg.actionExit();break;case KEYS.F1:case KEYS.F3:DVBEpg.BPanel.EventHandler(event);break;case KEYS.NUM0:case KEYS.NUM1:case KEYS.NUM2:case KEYS.NUM3:case KEYS.NUM4:case KEYS.NUM5:case KEYS.NUM6:case KEYS.NUM7:case KEYS.NUM8:case KEYS.NUM9:DVBEpg.goToChannel(event.code-KEYS.NUM0);break;default:event.preventDefault()}},DVBEpg.actionExit=function(){for(var i in this.timer)clearTimeout(this.timer[i]);this.BCrumb.Reset(),this.EPGList.Exit(),DVBEpg.Show(!1)},DVBEpg.actionF1=function(){var item=this.EPGList.ActiveItem(),epgData=item.subNavigElements[item.epgActive],data={};return configuration.mayPVR?!1:(epgData&&epgData.data&&(data.time=1e3*epgData.data.start,data.duration=1e3*epgData.data.duration,data.name=epgData.data.name),void new CModalAddRecord(this,_("Recording channel"),data))},DVBEpg.actionF3=function(){this.EPGList.GoToRealTime()},DVBEpg.actionBack=function(){var self=this;this.goToChFlag&&(clearTimeout(this.timer.goToChannel),this.TVnumber.length>0&&(this.TVnumber=this.TVnumber.slice(0,this.TVnumber.length-1),this.domChannelNumber.innerHTML=this.TVnumber,MediaPlayer.domChannelNumber.innerHTML=this.TVnumber,this.TVnumber.length>0?this.timer.goToChannel=setTimeout(function(){self.DVBList.goToChannel(parseInt(self.TVnumber,10)),self.TVnumber="",self.goToChFlag=!1,self.domChannelNumber.style.display="none",MediaPlayer.domChannelNumber.style.display="none"},2e3):(this.domChannelNumber.style.display="none",MediaPlayer.domChannelNumber.style.display="none")))},DVBEpg.goToChannel=function(number){var self=this;clearTimeout(this.timer.goToChannel),this.goToChFlag=!0,this.TVnumber+=number,this.domChannelNumber.innerHTML=this.TVnumber,this.domChannelNumber.style.display="block",this.timer.goToChannel=setTimeout(function(){self.EPGList.goToChannel(parseInt(self.TVnumber,10)),self.TVnumber="",self.goToChFlag=!1,self.domChannelNumber.style.display="none"},2e3)},DVBEpg.GetEpg=function(obj,start,end){var data;if(!obj)return null;start||(null===this.time&&(this.time=this.GetStartTime()),start=this.time),end||(end=start+this.timeStep);try{if(data=dvbManager.GetEPGScheduleByRange(obj.id,start,end),""===data||"{}"===data)return null;data=JSON.parse(data)}catch(e){return echo(e,"EPG parse error"),null}return echo(data,"GetEpg"),data.events};var remoteControlButtonsImagesPath=configuration.newRemoteControl?PATH_IMG_SYSTEM+"buttons/new/":PATH_IMG_SYSTEM+"buttons/old/",MediaBrowser=new CPage;MediaBrowser.name="CPageMediaBrowser",MediaBrowser.Preview=new CBase(MediaBrowser),MediaBrowser.menuId="mediaBrowser",MediaBrowser.onInit=function(){var self=this;this.isStrictMode=function(){return!this}(),this.playable=[MEDIA_TYPE_VIDEO,MEDIA_TYPE_AUDIO,MEDIA_TYPE_IMAGE,MEDIA_TYPE_ISO,MEDIA_TYPE_RECORDS_ITEM,MEDIA_TYPE_STREAM,MEDIA_TYPE_DVB,MEDIA_TYPE_CUE_ITEM],gSTB.SetListFilesExt("."+configuration.registersTypes.join(" .")),this.subscribeEvents={},this.subscribeEvents[MediaPlayer.EVENT_START]=function(){var file=self.FileList.activeItem.data;if(self.Preview.isVisible&&(self.Preview.player.className=file.type===MEDIA_TYPE_AUDIO?"player audio":"player play",self.Preview.body.info&&void 0===self.Preview.body.info.time&&MediaPlayer.totalTime>0)){var time=MediaPlayer.parseTime(MediaPlayer.totalTime);self.Preview.body.info.time=element("div",{className:"lbl"},[_("Duration:"),element("span",{className:"txt"},time.hour+":"+time.min+":"+time.sec)]),elchild(self.Preview.body.info,self.Preview.body.info.time)}},this.subscribeEvents[MediaPlayer.EVENT_STOP]=function(){var fileIndex=self.FileList.data.indexOf(MediaPlayer.list[MediaPlayer.PlayList.playIndex]);self.Preview.isVisible&&self.Preview.player&&(self.Preview.player.className="player stop",self.Preview.SetProgress(0)),-1!==fileIndex&&(self.FileList.data[fileIndex].index=fileIndex,self.FileList.Focused(fileIndex,!0))},this.subscribeEvents[MediaPlayer.EVENT_PAUSE]=function(state){var file=self.FileList.activeItem.data;this.Preview.isVisible&&(state?this.Preview.player.className="player stop":this.Preview.player.className=file.type===MEDIA_TYPE_AUDIO?"player audio":"player play")},this.subscribeEvents[MediaPlayer.EVENT_PROGRESS]=function(position){this.Preview.isVisible&&this.Preview.SetProgress(position)},this.subscribeEvents[MediaPlayer.EVENT_ERROR]=function(){this.Preview.isVisible&&this.Preview.player&&(this.Preview.player.className="player stop",this.Preview.SetProgress(0))},this.subscribeEvents[MediaPlayer.EVENT_OK]=function(){echo("MediaPlayer.EVENT_OK");var file,fileIndex=self.FileList.data.indexOf(MediaPlayer.list[MediaPlayer.PlayList.playIndex]);-1!==fileIndex&&self.FileList.activeItem.index!==fileIndex&&(self.FileList.data[fileIndex].index=fileIndex,self.FileList.Focused(fileIndex,!0)),file=self.FileList.activeItem.data,-1!==this.playable.indexOf(file.type)&&(this.actionFrame(!0),this.Preview.player&&(self.Preview.Info(self.FileList.activeItem.data),this.Preview.player.className=file.type===MEDIA_TYPE_AUDIO?"player audio":"player play",gSTB.IsPlaying()&&MediaPlayer.runner.start(),MediaPlayer.Show(!1,!1),MediaPlayer.changeScreenMode(!1)))},this.subscribeEvents[MediaPlayer.EVENT_EXIT]=function(){var self=this;this.Preview.SetProgress(0),this.Preview.isVisible&&(this.FileList.timer&&clearTimeout(this.FileList.timer),this.FileList.timer=setTimeout(function(){self.Preview.Info(self.FileList.activeItem.data)},400))},this.ModalMenu=new CModal(this),this.ModalMenu.onShow=function(){var readOnly,self=this;this.Menu.gview.slist.Each(function(item){self.Menu.gview.slist.Hidden(item,item.iid!==MEDIA_TYPE_NONE&&-1===self.parent.FileList.mtypes.indexOf(item.iid))}),this.Menu.Hidden(this.Menu.gview,this.Menu.gview.slist.Length()-(self.Menu.gview.slist.states.hidden||[]).length===1);var currentItem=this.parent.FileList.activeItem,activeItems=this.parent.FileList.ActiveItems(),lastPathItemType=this.parent.FileList.path[this.parent.FileList.path.length-1].type;this.parent.FileList.path.length>1&&this.parent.FileList.path[1].type===MEDIA_TYPE_STORAGE_USB&&(readOnly=this.parent.FileList.path[1].readOnly),this.Menu.gedit.slist.Hidden(this.Menu.gedit.iopen,currentItem.data.type===MEDIA_TYPE_BACK||currentItem.data.type===MEDIA_TYPE_TEXT),this.Menu.gedit.slist.Hidden(this.Menu.gedit.ismount,currentItem.data.type!==MEDIA_TYPE_TEXT),this.Menu.gedit.slist.Hidden(this.Menu.gedit.iopensl,void 0===this.parent.FileList.states.marked||0===this.parent.FileList.states.marked.length),this.Menu.gedit.slist.Hidden(this.Menu.gedit.iselone,this.parent.BPanel.btnF2.data.hidden),this.Menu.gedit.slist.Hidden(this.Menu.gedit.iselall,this.parent.BPanel.btnF2.data.hidden),this.Menu.gedit.slist.Hidden(this.Menu.gedit.imount,!(void 0===currentItem.data.link&&(currentItem.data.type===MEDIA_TYPE_SAMBA_SHARE||currentItem.data.type===MEDIA_TYPE_NFS_SHARE))),this.Menu.gedit.slist.Hidden(this.Menu.gedit.iunmount,!(void 0!==currentItem.data.link&&(currentItem.data.type===MEDIA_TYPE_SAMBA_SHARE||currentItem.data.type===MEDIA_TYPE_NFS_SHARE))),this.Menu.gedit.slist.Hidden(this.Menu.gedit.iedit,readOnly||!(void 0!==currentItem.data.link&&(currentItem.data.type===MEDIA_TYPE_SAMBA_SHARE||currentItem.data.type===MEDIA_TYPE_NFS_SHARE))),this.Menu.gedit.slist.Hidden(this.Menu.gedit.ideselect,this.parent.BPanel.btnF2.data.hidden||void 0===this.parent.FileList.states.marked||0===this.parent.FileList.states.marked.length),this.Menu.gedit.slist.Hidden(this.Menu.gedit.iinvert,this.Menu.gedit.ideselect.hidden),this.Menu.gedit.slist.Hidden(this.Menu.gedit.icut,0===activeItems.length||this.parent.FileList.parentItem.type!==MEDIA_TYPE_FAVORITES),this.Menu.gedit.slist.Hidden(this.Menu.gedit.icopy,0===activeItems.length||this.parent.FileList.parentItem.type!==MEDIA_TYPE_FAVORITES&&this.parent.FileList.parentItem.type!==MEDIA_TYPE_PLAYLIST),this.Menu.gedit.slist.Hidden(this.Menu.gedit.ipaste,readOnly||0===globalBuffer.size()||this.parent.FileList.parentItem.type!==MEDIA_TYPE_FAVORITES||globalBuffer.place().url===this.parent.FileList.parentItem.url&&globalBuffer.place().type===this.parent.FileList.parentItem.type),this.Menu.gedit.slist.Hidden(this.Menu.gedit.idelete,readOnly||this.parent.BPanel.btnF2.data.hidden||0===activeItems.length||lastPathItemType===MEDIA_TYPE_PLAYLIST||this.parent.FileList.mode===MEDIA_TYPE_RECORDS_ROOT||this.parent.FileList.mode===MEDIA_TYPE_FAVORITES),this.Menu.gedit.slist.Hidden(this.Menu.gedit.iaddfav,this.parent.BPanel.btnF3add.data.hidden),this.Menu.gedit.slist.Hidden(this.Menu.gedit.iremfav,this.parent.BPanel.btnF3del.data.hidden),this.Menu.Hidden(this.Menu.gedit,this.Menu.gedit.slist.Length()-(self.Menu.gedit.slist.states.hidden||[]).length===0),this.Menu.gtools.slist.Disabled(this.Menu.gtools.imount,!CURRENT_NETWORK_STATE),this.Menu.gtools.slist.Disabled(this.Menu.gtools.iunmount,!CURRENT_NETWORK_STATE||0===SMB_ARRAY.length&&0===NFS_ARRAY.length),(this.Menu.gsort.slist.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),this.parent.FileList.mode!==MEDIA_TYPE_FAVORITES&&this.Menu.gsort.slist.Marked(this.Menu.gsort.slist.FindOne({iid:this.parent.FileList.sortType}),!0),this.Menu.Hidden(this.Menu.goptions,currentItem.data.type!==MEDIA_TYPE_VIDEO),this.Menu.Hidden(this.Menu.gsort,this.parent.BPanel.btnF2.data.hidden&&this.parent.FileList.mode!==MEDIA_TYPE_FAVORITES);for(var i=0;i<MediaBrowser.ModalMenu.Menu.handleInner.children.length;i++){var group=MediaBrowser.ModalMenu.Menu.handleInner.children[i];if(group.options.hidden===!1)return this.Menu.Switch(group),void this.Menu.Activate()}},this.ModalMenu.Menu=new CGroupMenu(this.ModalMenu),this.ModalMenu.Menu.Init(this.handle.querySelector("div.cgmenu-main")),this.ModalMenu.Init(element("div",{className:"cmodal-menu"},this.ModalMenu.Menu.handle)),this.ModalMenu.handle.onclick=function(){self.ModalMenu.Show(!1)},this.ModalMenu.EventHandler=function(event){switch(event.code){case KEYS.EXIT:case KEYS.MENU:self.ModalMenu.Show(!1);break;case KEYS.TV:self.ModalMenu.Show(!1),self.Show(!1);break;default:self.ModalMenu.Menu.EventHandler(event)}},this.ModalMenu.Menu.gedit=this.ModalMenu.Menu.AddGroup("gedit",_("Operations"),{onclick:function(){var iid=this.iid;switch(self.ModalMenu.Show(!1),iid){case MEDIA_ACTION_OPEN:self.FileList.activeItem.onclick();break;case MEDIA_ACTION_OPEN_SELECTED:var list=self.FileList.GetPlaylist();list.length>0&&(MediaPlayer.prepareList(list),MediaPlayer.preparePlayer(list[0],self,!0,!0,!self.BPanel.btnF3add.data.hidden||!self.BPanel.btnF3del.data.hidden,!0),self.FileList.playListSet=!1);break;case MEDIA_ACTION_SUBTITLE_MOUNT:self.FileList.activeItem.onclick();break;case MEDIA_ACTION_ITEM_MOUNT:new CModalMount(self);break;case MEDIA_ACTION_ITEM_UNMOUNT:new CModalUnmount(self,self.FileList.activeItem.data.link);break;case MEDIA_ACTION_MOUNT_EDIT:new CModalMount(self,self.FileList.activeItem.data.link,self.FileList.activeItem.data.type);break;case MEDIA_ACTION_SELECT_ONE:self.FileList.Marked(self.FileList.activeItem.data,!0),self.Preview.valSel.innerText=self.FileList.states.marked.length;break;case MEDIA_ACTION_SELECT_ALL:self.FileList.data.forEach(function(item){self.FileList.Marked(item,!0)}),self.Preview.valSel.innerText=self.FileList.states.marked.length;break;case MEDIA_ACTION_DESELECT:self.FileList.Each(function(item){self.FileList.Marked(item,!1)});break;case MEDIA_ACTION_INVERT:self.FileList.data.forEach(function(item){self.FileList.Marked(item,!item.marked)});break;case MEDIA_ACTION_CUT:case MEDIA_ACTION_COPY:case MEDIA_ACTION_DELETE:var items=self.FileList.ActiveItems();switch(iid){case MEDIA_ACTION_CUT:echo("MEDIA_ACTION_CUT"),globalBuffer.clear(),globalBuffer.mode(globalBuffer.MODE_CUT),globalBuffer.place(self.FileList.parentItem),self.FileList.mode===MEDIA_TYPE_FAVORITES&&(globalBuffer.onPaste=function(item){self.FavRemove(item.url)}),items.forEach(function(item){globalBuffer.add(item)}),self.Tray.iconBuffer.src=PATH_IMG_PUBLIC+"ico_cut.png",self.Tray.handleInner.appendChild(self.Tray.iconBuffer),self.Tray.Show(!0,!1);break;case MEDIA_ACTION_COPY:echo("MEDIA_ACTION_COPY"),globalBuffer.clear(),globalBuffer.mode(globalBuffer.MODE_COPY),globalBuffer.place(self.FileList.parentItem),items.forEach(function(item){globalBuffer.add(item)}),self.Tray.iconBuffer.src=PATH_IMG_PUBLIC+"ico_copy.png",self.Tray.handleInner.appendChild(self.Tray.iconBuffer),self.Tray.Show(!0,!1);break;case MEDIA_ACTION_DELETE:echo("MEDIA_ACTION_DELETE"),self.actionDelete()}break;case MEDIA_ACTION_PASTE:self.FileList.mode===MEDIA_TYPE_FAVORITES&&(globalBuffer.paste(function(item){self.FavAdd(item.url,item)}),self.FileList.Refresh(),self.Preview.SetItemsCount(),self.Tray.iconBuffer.parentNode===self.Tray.handleInner&&self.Tray.handleInner.removeChild(self.Tray.iconBuffer),self.Tray.Show(0!==self.Tray.handleInner.children.length,!1));break;case MEDIA_ACTION_ADD_FAV:self.actionF3add();break;case MEDIA_ACTION_REMOVE_FAV:self.actionF3del()}return!1}}),this.ModalMenu.Menu.gedit.iopen=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_OPEN,_("Open"),{icon:remoteControlButtonsImagesPath+"ok.png"}),this.ModalMenu.Menu.gedit.iopensl=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_OPEN_SELECTED,_("Open selected")),this.ModalMenu.Menu.gedit.ismount=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_SUBTITLE_MOUNT,_("Mount")),this.ModalMenu.Menu.gedit.imount=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_ITEM_MOUNT,_("Mount share")),this.ModalMenu.Menu.gedit.iunmount=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_ITEM_UNMOUNT,_("Unmount share")),this.ModalMenu.Menu.gedit.iedit=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_MOUNT_EDIT,_("Edit share")),this.ModalMenu.Menu.gedit.iselone=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_SELECT_ONE,_("Select"),{icon:remoteControlButtonsImagesPath+"f2.png"}),this.ModalMenu.Menu.gedit.iselall=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_SELECT_ALL,_("Select all")),720!==WINDOW_WIDTH&&(this.ModalMenu.Menu.gedit.iaddfav=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_ADD_FAV,_("Add to favorites"),{icon:remoteControlButtonsImagesPath+"f3.png"}),this.ModalMenu.Menu.gedit.iremfav=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_REMOVE_FAV,_("Remove from favorites"),{icon:remoteControlButtonsImagesPath+"f3.png"})),this.ModalMenu.Menu.gedit.ideselect=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_DESELECT,_("Deselect all")),this.ModalMenu.Menu.gedit.iinvert=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_INVERT,_("Invert selection")),this.ModalMenu.Menu.gedit.icut=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_CUT,_("Cut")),this.ModalMenu.Menu.gedit.icopy=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_COPY,_("Copy")),this.ModalMenu.Menu.gedit.ipaste=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_PASTE,_("Paste")),this.ModalMenu.Menu.gedit.idelete=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_DELETE,_("Delete"),{icon:remoteControlButtonsImagesPath+"back.png"}),this.ModalMenu.Menu.gview=this.ModalMenu.Menu.AddGroup("gview",_("View"),{onclick:function(){return this.self.Marked(this.self.FindOne({marked:!0}),!1),this.self.Marked(this,!0),this.self.Focused(this,!0),self.ModalMenu.Show(!1),self.FileList.SetFilterType(this.iid),this.iid!==MEDIA_TYPE_NONE||globalBuffer.size()>0?(elclear(self.Tray.handleInner),this.iid!==MEDIA_TYPE_NONE&&(self.Tray.iconFilter.src=PATH_IMG_PUBLIC+"media/type_"+this.iid+".png",self.Tray.handleInner.appendChild(self.Tray.iconFilter)),globalBuffer.size()>0&&(self.Tray.iconBuffer.src=PATH_IMG_PUBLIC+(globalBuffer.mode()===globalBuffer.MODE_COPY?"ico_copy.png":"ico_cut.png"),self.Tray.handleInner.appendChild(self.Tray.iconBuffer)),self.Tray.Show(!0,!1)):self.Tray.Show(!1,!1),!1}}),this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gview,MEDIA_TYPE_NONE,_("All"),{marked:!0,focused:!0}),this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gview,MEDIA_TYPE_FOLDER,_("Folders")),this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gview,MEDIA_TYPE_AUDIO,_("Audio")),this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gview,MEDIA_TYPE_VIDEO,_("Video")),this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gview,MEDIA_TYPE_IMAGE,_("Images")),this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gview,MEDIA_TYPE_PLAYLIST,_("Playlists")),this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gview,MEDIA_TYPE_ISO,_("ISO")),this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gview,MEDIA_TYPE_TEXT,_("Subtitles")),this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gview,MEDIA_TYPE_STREAM,_("Streams")),this.ModalMenu.Menu.gsort=this.ModalMenu.Menu.AddGroup("gsort",_("Sort"),{onclick:function(){return self.ModalMenu.Show(!1),self.FileList.mode===MEDIA_TYPE_FAVORITES?self.FavSort(this.iid):self.FileList.sortType!==this.iid&&(self.FileList.sortType=this.iid),self.FileList.Refresh(),!1}}),this.ModalMenu.Menu.gsort.iname=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gsort,MEDIA_ACTION_SORT_NAME,_("By name"),{focused:!0}),this.ModalMenu.Menu.gsort.isize=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gsort,MEDIA_ACTION_SORT_SIZE,_("By size")),this.ModalMenu.Menu.gsort.itype=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gsort,MEDIA_ACTION_SORT_TYPE,_("By type")),this.ModalMenu.Menu.gsort.iext=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gsort,MEDIA_ACTION_SORT_EXT,_("By extension")),this.ModalMenu.Menu.gtools=this.ModalMenu.Menu.AddGroup("gtools",_("Tools"),{onclick:function(){switch(self.ModalMenu.Show(!1),this.iid){case MEDIA_ACTION_TOOLS_MOUNT:new CModalMount(self);break;case MEDIA_ACTION_TOOLS_UNMOUNT:new CModalUnmount(self,self.FileList.activeItem.data.link);break;case MEDIA_ACTION_TOOLS_FORMAT:new CModalFormat(self)}return!1}}),this.ModalMenu.Menu.gtools.imount=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gtools,MEDIA_ACTION_TOOLS_MOUNT,_("Connect NFS/SMB")),this.ModalMenu.Menu.gtools.iunmount=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gtools,MEDIA_ACTION_TOOLS_UNMOUNT,_("Disconnect NFS/SMB"),{disabled:!0}),this.ModalMenu.Menu.gtools.iformat=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gtools,MEDIA_ACTION_TOOLS_FORMAT,_("Disk formatting"),{hidden:0===HDD_INFO.length}),this.ModalMenu.Menu.goptions=this.ModalMenu.Menu.AddGroup("goptions",_("Options"),{onclick:function(){switch(self.ModalMenu.Show(!1),this.iid){case MEDIA_ACTION_PLAY:new CModalStartPlay(self)}return!1}}),this.ModalMenu.Menu.goptions.playProgramm=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.goptions,MEDIA_ACTION_PLAY,_("Play program")),this.ModalMenu.Menu.Switch(this.ModalMenu.Menu.gedit),this.BCrumb=new CBreadCrumb(this),this.BCrumb.showAttr="table-cell",this.BCrumb.rightItems=720===WINDOW_WIDTH?1:2,this.BCrumb.Init(PATH_IMG_PUBLIC,this.handle.querySelector(".body .header .cbcrumb")),this.BCrumb.SetName(_("Home Media")),this.SearchBar=new CFilterInput(this,{parent:this.handle.querySelector(".body .header .csbar"),hint:_("Enter path or file name..."),folded:!0,events:{onEnter:function(){return echo(this.GetValue(),"this.GetValue()"),self.FileList.path[self.FileList.path.length-1].filterText&&(self.FileList.path.pop(),self.BCrumb.Pop()),this.GetValue()?self.FileList.SetFilterText(this.GetValue()):(self.FileList.path[self.FileList.path.length-1].filterText=self.FileList.filterText=self.FileList.parentItem.filterText="",self.FileList.Refresh()),self.BCrumb.Show(!0),self.FileList.onFocus(self.FileList.activeItem),!0},onChange:function(){self.SearchBar.timer&&clearTimeout(self.SearchBar.timer),self.SearchBar.timer=setTimeout(function(){var index=self.FileList.FirstMatch(self.SearchBar.GetValue());"undefined"!=typeof index&&-1!==index&&(self.FileList.Focused(index,!0),self.SearchBar.focus())},400)},onUnfold:function(){self.BCrumb.Show(!1)},onFold:function(){self.BCrumb.Show(!0)},onKey:function(){this.SetValue(self.FileList.path[self.FileList.path.length-1].filterText||"")}}}),this.SearchBar.timer=0,this.ExitBPanel=new CButtonPanel(this),this.ExitBPanel.Init(remoteControlButtonsImagesPath,this.handle.querySelector(".body .footer .exit div.cbpanel-main")),this.ExitBPanel.btnExit=this.ExitBPanel.Add(KEYS.EXIT,"exit.png",configuration.newRemoteControl?_("Exit"):"",function(){MediaBrowser.actionBack()}),this.BPanel=new CButtonPanel(this),this.BPanel.Init(remoteControlButtonsImagesPath,this.handle.querySelector(".body .footer .main div.cbpanel-main")),this.BPanel.btnMenu=this.BPanel.Add(KEYS.MENU,"menu.png",configuration.newRemoteControl?_("Menu"):"",function(){self.actionMenu()}),this.BPanel.btnFrame=this.BPanel.Add(KEYS.INFO,"info.png",_("Show<br>info panel"),function(){self.actionFrame()}),this.BPanel.btnF2=this.BPanel.Add(KEYS.F2,"f2.png",_("Select"),function(){self.actionF2()}),this.BPanel.btnF3add=this.BPanel.Add(KEYS.F3,"f3.png",_("Add to<br>favorites"),function(){self.actionF3add()}),this.BPanel.btnF3del=this.BPanel.Add(KEYS.F3,"f3.png",_("Remove from<br>favorites"),function(){self.actionF3del()},!0),this.FileList=new CFileList(this),this.FileList.Init({handle:this.handle.querySelector(".body .content .vlist-main"),scrollBar:new VScrollBar({$node:this.handle.querySelector(".body .content .vscroll")})}),this.FileList.SetBreadCrumb(this.BCrumb),this.FileList.SetSearchBar(this.SearchBar),this.Preview.Init(this.handle.querySelector(".content .sbar")),this.Preview.Show(!1,!1),this.Preview.body=this.Preview.handle.querySelector("td.view"),this.Preview.blkAll=this.Preview.handle.querySelector("div.block.all"),this.Preview.blkSel=this.Preview.handle.querySelector("div.block.sel"),this.Preview.valAll=this.Preview.blkAll.querySelector("span.value"),this.Preview.valSel=this.Preview.blkSel.querySelector("span.value"),this.Preview.blkAll.querySelector("span.title").innerHTML=_("Items:"),this.Preview.blkSel.querySelector("span.title").innerHTML=_("Selected:"),this.Preview.showAttr="table-cell",this.Preview.infoIcon=element("img",{align:"left",src:PATH_IMG_PUBLIC+"media/ico_info.png"}),this.Preview.actionInfo={},this.Preview.actionInfo[MEDIA_TYPE_BACK]=this.Preview.InfoBack,this.Preview.actionInfo[MEDIA_TYPE_SAMBA_ROOT]=this.Preview.InfoSambaRoot,this.Preview.actionInfo[MEDIA_TYPE_SAMBA_GROUP]=this.Preview.InfoSambaGroup,this.Preview.actionInfo[MEDIA_TYPE_SAMBA_HOST]=this.Preview.InfoSambaHost,this.Preview.actionInfo[MEDIA_TYPE_SAMBA_SHARE]=this.Preview.InfoSambaShare,this.Preview.actionInfo[MEDIA_TYPE_NFS_SHARE]=this.Preview.InfoNfsShare,this.Preview.actionInfo[MEDIA_TYPE_UPNP]=this.Preview.InfoUpnp,this.Preview.actionInfo[MEDIA_TYPE_RECORDS_ROOT]=this.Preview.InfoRecordsRoot,this.Preview.actionInfo[MEDIA_TYPE_RECORDS_CHAN]=this.Preview.InfoRecordsChan,this.Preview.actionInfo[MEDIA_TYPE_RECORDS_DATE]=this.Preview.InfoRecordsDate,this.Preview.actionInfo[MEDIA_TYPE_STORAGE_SATA]=this.Preview.InfoStorage,this.Preview.actionInfo[MEDIA_TYPE_STORAGE_USB]=this.Preview.InfoStorage,this.Preview.actionInfo[MEDIA_TYPE_STORAGE_SD]=this.Preview.InfoStorage,this.Preview.actionInfo[MEDIA_TYPE_STORAGE_MMC]=this.Preview.InfoStorage,this.Preview.actionInfo[MEDIA_TYPE_FAVORITES]=this.Preview.InfoFavorites,this.Preview.actionInfo[MEDIA_TYPE_FOLDER]=this.Preview.InfoFolder,this.Preview.actionInfo[MEDIA_TYPE_VIDEO]=this.Preview.InfoFile,this.Preview.actionInfo[MEDIA_TYPE_AUDIO]=this.Preview.InfoFile,this.Preview.actionInfo[MEDIA_TYPE_IMAGE]=this.Preview.InfoFile,this.Preview.actionInfo[MEDIA_TYPE_ISO]=this.Preview.InfoFile,this.Preview.actionInfo[MEDIA_TYPE_RECORDS_ITEM]=this.Preview.InfoFile,this.Preview.actionInfo[MEDIA_TYPE_PLAYLIST]=this.Preview.InfoPlaylist,this.Preview.actionInfo[MEDIA_TYPE_STREAM]=this.Preview.InfoStream,this.Preview.actionInfo[MEDIA_TYPE_TEXT]=this.Preview.InfoText,this.Preview.actionInfo[MEDIA_TYPE_CUE]=this.Preview.InfoCue,this.Preview.actionInfo[MEDIA_TYPE_CUE_ITEM]=this.Preview.InfoFile,this.Preview.onShow=function(){self.FileList.activeItem&&this.Info(self.FileList.activeItem.data)},this.Preview.SetProgress=function(value){this.isVisible&&this.pgval&&(value>=100&&(value=100),0>value&&(value=0),this.pgval.style.width=value+"%")},this.Preview.SetItemsCount=function(){this.valAll.innerHTML=this.parent.FileList.path.length>1?this.parent.FileList.Length()-1:this.parent.FileList.Length()},this.Preview.Rewind=function(){this.isVisible&&this.player&&gSTB.IsPlaying()&&MediaPlayer.setPos(-1)},this.Preview.Forward=function(){this.isVisible&&this.player&&gSTB.IsPlaying()&&MediaPlayer.setPos(1)},this.Preview.PlayPause=function(){if(echo("Preview.PlayPause"),this.parent.actionFrame(!0),MediaPlayer.playNow||null!==MediaPlayer.obj)echo("MediaPlayer.playPause()"),MediaPlayer.playPause();else{echo(this.parent.FileList.playListSet,"this.parent.FileList.playListSet "),this.parent.FileList.playListSet||(MediaPlayer.prepareList(this.parent.FileList.playList),MediaPlayer.setSubList(this.parent.FileList.subList),this.parent.FileList.playListSet=!0);var file=this.parent.FileList.activeItem.data;-1!==this.parent.playable.indexOf(file.type)&&(this.player.className="player load",MediaPlayer.preparePlayer(file,this.parent,!1,!1,!this.parent.BPanel.btnF3add.data.hidden||!this.parent.BPanel.btnF3del.data.hidden,!1),file.type===MEDIA_TYPE_IMAGE&&(this.player.className="player play"))}},this.Preview.GetRect=function(){switch(VIDEO_MODE){case"480i":case"480p":switch(window.screen.width){case 720:return{x:458,y:94,a:228,b:151};case 1280:return{x:476,y:100,a:220,b:180};case 1920:return{x:480,y:100,a:220,b:180}}break;case"576i":case"576p":switch(window.screen.width){case 720:return{x:463,y:110,a:228,b:151};case 1280:return{x:476,y:100,a:220,b:180};case 1920:return{x:480,y:100,a:220,b:180}}break;case"720p":case"720p60":switch(window.screen.width){case 720:return{x:822,y:134,a:407,b:190};case 1280:return{x:846,y:130,a:394,b:220};case 1920:return{x:850,y:133,a:400,b:220}}break;case"1080i":case"1080i60":case"1080p":case"1080p60":switch(window.screen.width){case 720:return{x:1232,y:201,a:613,b:288};case 1280:return{x:1266,y:194,a:590,b:328};case 1920:return{x:1278,y:196,a:592,b:327}}break;case"3840x2160p30":case"3840x2160p25":case"3840x2160p50":case"3840x2160p60":switch(window.screen.width){case 720:return{x:2464,y:402,a:1216,b:576};case 1280:return{x:2532,y:388,a:1180,b:656};case 1920:return{x:2556,y:392,a:1184,b:654}}}return{x:0,y:0,a:0,b:0}},this.Preview.playerRect=this.Preview.GetRect(),this.Tray=new CBase(this),this.Tray.Init(this.handle.querySelector(".header .tray")),this.Tray.Show(!1,!1),this.Tray.showAttr="table-cell",this.Tray.iconFilter=element("img"),this.Tray.iconBuffer=element("img",{className:"copy"})},MediaBrowser.onShow=function(){this.FileList.Activate(),MediaPlayer.setCoord(this.Preview.playerRect.x,this.Preview.playerRect.y,this.Preview.playerRect.a,this.Preview.playerRect.b),MediaPlayer.playNow||MediaPlayer.startingPlay||(MediaPlayer.Subscribe(this,MediaPlayer.EVENT_START),MediaPlayer.Subscribe(this,MediaPlayer.EVENT_STOP),MediaPlayer.Subscribe(this,MediaPlayer.EVENT_PAUSE),MediaPlayer.Subscribe(this,MediaPlayer.EVENT_PROGRESS),MediaPlayer.Subscribe(this,MediaPlayer.EVENT_ERROR),MediaPlayer.Subscribe(this,MediaPlayer.EVENT_OK),MediaPlayer.Subscribe(this,MediaPlayer.EVENT_EXIT),getStorageInfo())},MediaBrowser.EventHandler=function(event){if(this.SearchBar.EventHandler(event)!==!0)switch(event.code){case KEYS.OK:case KEYS.PAGE_UP:case KEYS.PAGE_DOWN:case KEYS.UP:case KEYS.DOWN:case KEYS.LEFT:case KEYS.RIGHT:case KEYS.HOME:case KEYS.END:this.FileList.EventHandler(event);break;case 32:this.actionF2(),event.preventDefault();break;case KEYS.EXIT:this.actionBack();break;case KEYS.BACK:this.actionDelete();break;case KEYS.MENU:case KEYS.INFO:case KEYS.F2:case KEYS.F3:this.BPanel.EventHandler(event);break;case KEYS.PLAY_PAUSE:this.Preview.PlayPause();break;case KEYS.REWIND:this.Preview.Rewind();break;case KEYS.FORWARD:this.Preview.Forward();break;case KEYS.STOP:MediaPlayer.end();break;case 49:case 50:case 51:case 52:this.ModalMenu.Show(!0);var tabs={49:"gedit",50:"gview",51:"gsort",52:"gtools"};this.ModalMenu.Menu.Switch(this.ModalMenu.Menu[tabs[event.code]])}},MediaBrowser.Reset=function(unmount,unbind){unmount!==!1&&(this.UnmountSMB(),this.UnmountNFS()),this.FileList.path=[],this.BCrumb.Reset(),this.FileList.Open({type:MEDIA_TYPE_MB_ROOT}),this.actionFrame(!1),elclear(this.Preview.body),unbind!==!1&&(MediaPlayer.Unsubscribe(this,MediaPlayer.EVENT_START),MediaPlayer.Unsubscribe(this,MediaPlayer.EVENT_STOP),MediaPlayer.Unsubscribe(this,MediaPlayer.EVENT_PAUSE),MediaPlayer.Unsubscribe(this,MediaPlayer.EVENT_PROGRESS),MediaPlayer.Unsubscribe(this,MediaPlayer.EVENT_ERROR),MediaPlayer.Unsubscribe(this,MediaPlayer.EVENT_OK),MediaPlayer.Unsubscribe(this,MediaPlayer.EVENT_EXIT)),MediaPlayer.end()},MediaBrowser.actionExit=function(){var self=this;return this.Reset(),FAVORITES_CHANGED?(new CModalConfirm(this,_("The list of favourite records has changed"),_("Save updated list of favourite records?"),_("Exit without saving"),function(){setTimeout(function(){
self.FavRestore(),self.actionExit()},5)},_("Save"),function(){setTimeout(function(){self.FavSave(),self.actionExit()},5)}),!1):(this.Show(!1),!0)},MediaBrowser.actionBack=function(){MediaPlayer.end(),MediaBrowser.FileList.parentItem.type!==MEDIA_TYPE_MB_ROOT||MediaBrowser.FileList.parentItem.filterText?this.FileList.Open({type:MEDIA_TYPE_BACK}):this.actionExit()},MediaBrowser.actionMenu=function(){this.ModalMenu.Show(!0)},MediaBrowser.actionF2=function(move){if(!this.BPanel.btnF2.data.hidden){var infav=this.FileList.mode===MEDIA_TYPE_FAVORITES,canAdd=!1,item=this.FileList.activeItem;item.data.markable&&this.FileList.Marked(item.data,!item.data.marked)&&(move!==!1&&this.FileList.move(KEYS.DOWN),this.Preview.valSel.innerText=this.FileList.states.marked.length,!infav&&item.data.marked&&(this.FileList.states.marked.forEach(function(item){item.type!==MEDIA_TYPE_FOLDER&&(canAdd=!0)}),this.FileList.canFav&&canAdd&&(this.BPanel.Hidden(this.BPanel.btnF3add,!1),this.BPanel.Hidden(this.BPanel.btnF3del,!0))))}},MediaBrowser.actionF3add=function(){var self=this;if(!this.BPanel.btnF3add.data.hidden){var items=this.FileList.ActiveItems();if(items.length>0){var count=0;items.forEach(function(item){item.type!==MEDIA_TYPE_FOLDER&&(self.FileList.SetStar(item,!0),self.FavAdd(item.url,item),count++)}),count>0&&(this.BPanel.Hidden(this.BPanel.btnF3add,!0),this.BPanel.Hidden(this.BPanel.btnF3del,!1))}}},MediaBrowser.actionF3del=function(){var self=this,curPos=null;if(!this.BPanel.btnF3del.data.hidden){var infav=this.FileList.parentItem.type===MEDIA_TYPE_FAVORITES,items=this.FileList.ActiveItems();items.length>0&&(items.forEach(function(item){self.FavRemove(item.url),infav||self.FileList.SetStar(item,!1)}),infav?(this.FileList.DeleteAll(items),0===this.FileList.Length()?(this.BPanel.Hidden(this.BPanel.btnF2,!0),this.BPanel.Hidden(this.BPanel.btnF3del,!0)):null!==curPos&&self.FileList.Focused(curPos,!0),this.FileList.Activate()):(this.BPanel.Hidden(this.BPanel.btnF3add,!1),this.BPanel.Hidden(this.BPanel.btnF3del,!0)))}},MediaBrowser.actionFrame=function(state){state=void 0!==state?state:!this.Preview.isVisible,this.Preview.Show(state,!1),this.BPanel.Rename(this.BPanel.btnFrame,_(this.Preview.isVisible?"Hide<br>info panel":"Show<br>info panel")),this.Preview.handle.parentNode.className=state?"preview":"",this.Preview.isVisible||MediaPlayer.end()},MediaBrowser.refreshPreviewViewport=function(){this.Preview.playerRect=MediaBrowser.Preview.GetRect(),MediaBrowser.isVisible&&MediaPlayer.setCoord(this.Preview.playerRect.x,this.Preview.playerRect.y,this.Preview.playerRect.a,this.Preview.playerRect.b)},MediaBrowser.actionDelete=function(){var self=this,items=this.FileList.ActiveItems();if(0!==items.length){var status=!0;this.FileList.mode===MEDIA_TYPE_FAVORITES?this.actionF3del():-1!==[MEDIA_TYPE_STORAGE_SATA,MEDIA_TYPE_STORAGE_USB,MEDIA_TYPE_STORAGE_SD,MEDIA_TYPE_STORAGE_MMC].indexOf(this.FileList.mode)&&("true"===environment.mount_media_ro?new CModalAlert(this,_("Warning!"),_('"Storage read only access mode" is enabled in System Settings'),_("Close")):new CModalConfirm(this,_("Confirm deletion"),_("Are you sure you want to delete")+"<br>"+_(items.length>1?"all entries selected?":"current entry?"),_("Cancel"),function(){},_("Yes"),function(){setTimeout(function(){var itemList=[];items.forEach(function(item){self.actionFileDelete(item)?(globalBuffer.remove(item),item.stared&&self.FavRemove(item.url),itemList.push(item)):status=!1}),self.FileList.DeleteAll(itemList),getStorageInfo(),0===globalBuffer.size()&&(self.Tray.iconBuffer.parentNode===self.Tray.handleInner&&self.Tray.handleInner.removeChild(self.Tray.iconBuffer),self.Tray.Show(0!==self.Tray.handleInner.children.length,!1)),self.FileList.Activate(!0),echo(status,"status"),status||new CModalAlert(self,_("Deletion error"),_("Unable to remove all selected items"),_("Close"),function(){setTimeout(function(){self.FileList.Activate(!0)},5)}),self.FileList.playList=[],self.FileList.Each(function(item){-1!==self.playable.indexOf(item.type)&&self.FileList.playList.push(item)}),MediaPlayer.prepareList(self.FileList.playList),self.FileList.playListSet=!0},5)}))}},MediaBrowser.actionFileDelete=function(data){var status,command;return command=data.type===MEDIA_TYPE_FOLDER?'RemoveDirFull "'+("/"===data.url.charAt(data.url.length-1)?data.url.substr(0,data.url.length-1):data.url)+'"':'RemoveFile "'+data.url+'"',echo(command,"actionFileDelete command"),status="Ok"===gSTB.RDir(command)},MediaBrowser.FavAdd=function(name,data){if(name&&data&&data.type!==MEDIA_TYPE_FOLDER&&data.type!==MEDIA_TYPE_GROUP){if(this.FileList.mode===MEDIA_TYPE_RECORDS_ROOT){var path=this.FileList.path;data.name=path[path.length-2].name+" / "+path[path.length-1].name+" / "+data.name}echo("MediaBrowser.FavAdd"),FAVORITES_NEW[name]=data,FAVORITES_CHANGED=!0}},MediaBrowser.FavRemove=function(name){return FAVORITES_NEW[name]?(delete FAVORITES_NEW[name],FAVORITES_CHANGED=!0):FAVORITES_CHANGED=!1,echo(FAVORITES_CHANGED,"MediaBrowser.FavRemove"),FAVORITES_CHANGED},MediaBrowser.FavSave=function(data){echo("MediaBrowser.FavSave"),void 0!==data&&data instanceof Object&&(FAVORITES_NEW=data),FAVORITES={};for(var name in FAVORITES_NEW)FAVORITES[name]=FAVORITES_NEW[name];gSTB.SaveUserData("favorites.json",JSON.stringify(FAVORITES)),FAVORITES_CHANGED=!1},MediaBrowser.FavRestore=function(){echo("MediaBrowser.FavRestore"),FAVORITES_NEW={};for(var name in FAVORITES)FAVORITES_NEW[name]=FAVORITES[name];FAVORITES_CHANGED=!1},MediaBrowser.FavSort=function(sortType){echo("MediaBrowser.FavSort");var list=[];for(var name in FAVORITES_NEW)list.push(FAVORITES_NEW[name]);list.sort(function(a,b){return a.name.toLowerCase().localeCompare(b.name.toLowerCase())}),sortType===MEDIA_ACTION_SORT_TYPE?list.sort(function(a,b){return a.type-b.type}):sortType===MEDIA_ACTION_SORT_EXT?list.sort(function(a,b){return a.ext.toLowerCase().localeCompare(b.ext.toLowerCase())}):sortType===MEDIA_ACTION_SORT_SIZE&&list.sort(function(a,b){return a.size-b.size}),echo(list,"FavSort list"),FAVORITES_NEW={},list.forEach(function(item){FAVORITES_NEW[item.url]=item}),echo(FAVORITES_NEW,"FAVORITES_NEW"),FAVORITES_CHANGED=!0},MediaBrowser.UnmountSMB=function(force){(SMB_MOUNTED||force===!0)&&(gSTB.ExecAction("umount_dir "+SMB_PATH),SMB_MOUNTED=!1,SMB_DATA=null,echo("umount "+SMB_PATH))},MediaBrowser.UnmountNFS=function(force){(NFS_MOUNTED||force===!0)&&(gSTB.ExecAction("umount_dir "+NFS_PATH),NFS_MOUNTED=!1,NFS_DATA=null,echo("umount "+NFS_PATH))},MediaBrowser.MountSMB=function(data){var login,pass,command,status,idx;if(SMB_MOUNTED)return!0;if(data.addresses||data.link&&data.link.addresses||(data.addresses=data.address?[data.address.match(/(\d+\.){3}\d+/)[0]]:[]),data&&(data.addresses||data.link.addresses))for(idx=0;idx<(data.addresses||data.link.addresses).length;idx+=1)if(data.address="//"+(data.addresses||data.link.addresses)[idx]+"/"+(data.link?data.link.folder:data.name),data.login&&(SMB_AUTH[data.address]={login:data.login,pass:data.pass}),data.address="/"===data.address.charAt(data.address.length-1)?data.address.substr(0,data.address.length-1):data.address,login=data.login||(SMB_AUTH[data.address]&&SMB_AUTH[data.address].login?SMB_AUTH[data.address].login:"guest"),pass=data.pass||(SMB_AUTH[data.address]&&SMB_AUTH[data.address].pass?SMB_AUTH[data.address].pass:""),command='mount cifs "'+data.address+'" "'+SMB_PATH+'" username='+login+",password="+pass+",iocharset=utf8",status=gSTB.RDir(command).trim(),echo(status,command),SMB_MOUNTED="Ok"===status)return SMB_AUTH[data.address]||(SMB_AUTH[data.address]={}),SMB_AUTH[data.address].login=login,SMB_AUTH[data.address].pass=pass,SMB_DATA=data.link,SMB_MOUNTED;return!1},MediaBrowser.MountNFS=function(data){if(NFS_MOUNTED)return!0;if(data&&data.address){data.address="/"===data.address.charAt(data.address.length-1)?data.address.substr(0,data.address.length-1):data.address;var command='mount nfs "'+data.address+'" "'+NFS_PATH+'" nolock,ro,rsize=4096,wsize=4096,udp',status=gSTB.RDir(command);return echo(status,command),NFS_MOUNTED="Ok"===status,NFS_MOUNTED&&(NFS_DATA=data.link),NFS_MOUNTED}return!1},MediaBrowser.bytesToSize=function(bytes,precision){var kilobyte=1024,megabyte=1024*kilobyte,gigabyte=1024*megabyte,terabyte=1024*gigabyte;return bytes>=0&&kilobyte>bytes?bytes+" B":bytes>=kilobyte&&megabyte>bytes?(bytes/kilobyte).toFixed(precision)+" KB":bytes>=megabyte&&gigabyte>bytes?(bytes/megabyte).toFixed(precision)+" MB":bytes>=gigabyte&&terabyte>bytes?(bytes/gigabyte).toFixed(precision)+" GB":bytes>=terabyte?(bytes/terabyte).toFixed(precision)+" TB":bytes+" B"},MediaBrowser.Preview.InfoBack=function(){this.parent.FileList.filterText?elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("Contains a list of items corresponding to the given filter request"))])):elchild(elclear(this.body),this.Info(this.parent.FileList.parentItem))},MediaBrowser.Preview.InfoSambaRoot=function(){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("LAN supports SMB/CIFS protocol, contains available working groups"))]))},MediaBrowser.Preview.InfoSambaGroup=function(){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("List of working group computers"))]))},MediaBrowser.Preview.InfoSambaHost=function(){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("List of available folders for every computer"))]))},MediaBrowser.Preview.InfoSambaShare=function(data){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("Access to folders and files of selected network folder")),element("br"),element("div",{className:"lbl"},[_("Folder:"),element("span",{className:"txt"},data.name)]),element("div",{className:"lbl"},[_("Address:"),element("span",{className:"txt"},data.address)]),element("div",{className:"lbl"},[_("Type:"),element("span",{className:"txt"},"SMB/CIFS")])]))},MediaBrowser.Preview.InfoNfsShare=function(data){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("Access to folders and files of selected network folder")),element("br"),element("div",{className:"lbl"},[_("Folder:"),element("span",{className:"txt"},data.name)]),element("div",{className:"lbl"},[_("Address:"),element("span",{className:"txt"},data.address)]),element("div",{className:"lbl"},[_("Type:"),element("span",{className:"txt"},"NFS")])]))},MediaBrowser.Preview.InfoUpnp=function(){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("Plug&Play, a set of protocols for seamless connection of network devices, home and corporate. Easy and user-friendly access to media files in LAN."))]))},MediaBrowser.Preview.InfoRecordsRoot=function(){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("Access to list of Timeshift and PVR records collected from all available at the moment storages. All records are grouped by the channel names."))]))},MediaBrowser.Preview.InfoRecordsChan=function(){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("Opens a list of Timeshift and PVR records sorted by record date"))]))},MediaBrowser.Preview.InfoRecordsDate=function(){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("Access to list of Timeshift and PVR records sorted by record time"))]))},MediaBrowser.Preview.InfoFavorites=function(){var name,total=0;for(name in FAVORITES)total++;elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("Opens a full editable list of favourite records")),element("br"),element("div",{className:"lbl"},[_("Saved items:"),element("span",{className:"txt"},String(total))]),element("div",{className:"lbl"},[_("Unsaved changes:"),element("span",{className:"txt"},_(FAVORITES_CHANGED?"yes":"no"))])]))},MediaBrowser.Preview.InfoFolder=function(){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("Access to folders and files"))]))},MediaBrowser.Preview.InfoFile=function(data){var self=this,size=120,name=data.name.substr(0,size-1)+(data.name.length>size?"...":""),info=[element("div",{className:"file"},[this.player=element("div",{className:"player stop",onclick:function(){self.PlayPause(),setTimeout(function(){self.parent.FileList.Activate(!0)},5)}}),this.pgbar=element("div",{className:"pgbar"}),this.pgval=element("div",{className:"pgval"})]),element("br"),element("div",{className:"lbl"},[_("Name:"),element("span",{className:"txt"},name)])];void 0!==data.size&&info.push(element("div",{className:"lbl"},[_("Size:"),element("span",{className:"txt"},this.parent.bytesToSize(data.size,1))])),void 0!==data.performer&&info.push(element("div",{className:"lbl"},[_("Performer:"),element("span",{className:"txt"},data.performer)])),void 0!==data.file&&info.push(element("div",{className:"lbl"},[_("File:"),element("span",{className:"txt"},data.file)])),elchild(elclear(this.body),this.body.info=element("div",{},info)),data.type===MEDIA_TYPE_IMAGE&&(echo("data.type === MEDIA_TYPE_IMAGE"),this.parent.Preview.PlayPause())},MediaBrowser.Preview.InfoPlaylist=function(data){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("List of files or network streams to play")),element("br"),element("div",{className:"lbl"},[_("Size:"),element("span",{className:"txt"},this.parent.bytesToSize(data.size,1))])]))},MediaBrowser.Preview.InfoText=function(data){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("Text file with media subtitles or other data")),element("br"),element("div",{className:"lbl"},[_("Size:"),element("span",{className:"txt"},this.parent.bytesToSize(data.size,1))])]))},MediaBrowser.Preview.InfoStream=function(data){var urlParts,self=this,size=100,name=data.name.substr(0,size/2-1)+(data.name.length>size/2?"...":""),url=data.url.substr(0,size-1)+(data.url.length>size?"...":"");urlParts=url.trim().split(" "),1===urlParts.length&&data.sol&&(data.url=data.sol+" "+data.url,url=data.url.substr(0,size-1)+(data.url.length>size?"...":"")),elchild(elclear(this.body),element("div",{},[element("div",{className:"file"},[this.player=element("div",{className:"player stop",onclick:function(){self.PlayPause()}}),this.pgbar=element("div",{className:"pgbar"}),this.pgval=element("div",{className:"pgval"})]),element("br"),element("div",{className:"lbl"},[_("Name:"),element("span",{className:"txt"},name)]),element("div",{className:"lbl"},[_("Address:"),element("span",{className:"txt"},url)])]))},MediaBrowser.Preview.InfoCue=function(data){void 0===data.cue&&(data.cue=this.parent.ParseCue(gSTB.RDir('GetFile "'+data.url+'"')));var info=[this.infoIcon,element("div",{className:"text"},_("List of album files with additional info")),element("br")];void 0!==data.cue.title&&info.push(element("div",{className:"lbl"},[_("Name:"),element("span",{className:"txt"},data.cue.title)])),void 0!==data.cue.performer&&info.push(element("div",{className:"lbl"},[_("Performer:"),element("span",{className:"txt"},data.cue.performer)])),void 0!==data.cue.songwriter&&info.push(element("div",{className:"lbl"},[_("Song by:"),element("span",{className:"txt"},data.cue.songwriter)])),void 0!==data.cue.genre&&info.push(element("div",{className:"lbl"},[_("Genre:"),element("span",{className:"txt"},data.cue.genre)])),void 0!==data.cue.date&&info.push(element("div",{className:"lbl"},[_("Date:"),element("span",{className:"txt"},data.cue.date)])),void 0!==data.cue.place&&info.push(element("div",{className:"lbl"},[_("Place:"),element("span",{className:"txt"},data.cue.place)])),void 0!==data.cue.comment&&info.push(element("div",{className:"lbl"},[_("Comment:"),element("span",{className:"txt"},data.cue.comment)])),1===data.cue.files.length?info.push(element("div",{className:"lbl"},[_("File:"),element("span",{className:"txt"},data.cue.files[0].name)])):info.push(element("div",{className:"lbl"},[_("Files:"),element("span",{className:"txt"},data.cue.files.length)])),elchild(elclear(this.body),element("div",{},info))},MediaBrowser.Preview.InfoStorage=function(data){var canvas=element("canvas"),ctx=canvas.getContext("2d");elchild(elclear(this.body),element("div",{},[element("div",{className:"draw"},canvas),element("div",{className:"hint"},_("Available")+" "+this.parent.bytesToSize(data.free,1)+" "+_("from")+" "+this.parent.bytesToSize(data.size,1)),element("div",{className:"lbl"},[_("Read only:"),element("span",{className:"txt"},_(data.readOnly?"yes":"no"))]),element("div",{className:"lbl"},[_("Type:"),element("span",{className:"txt"},configuration.fileSystemTypes[data.fsType]||"(n/a)")])]));for(var lastend=0,vals=[data.size-data.free,data.free],myTotal=0,myColor=["#ffc20e","#2a2c2f"],e=0;e<vals.length;e++)myTotal+=vals[e];canvas.width=canvas.height=MediaBrowser.Preview.handleInner.scrollHeight/4;for(var i=0;i<vals.length;i++)ctx.fillStyle=myColor[i],ctx.beginPath(),ctx.moveTo(canvas.width/2,canvas.height/2),ctx.arc(canvas.width/2,canvas.height/2,canvas.height/2,lastend,lastend+2*Math.PI*(vals[i]/myTotal),!1),ctx.lineTo(canvas.width/2,canvas.height/2),ctx.fill(),lastend+=2*Math.PI*(vals[i]/myTotal)},MediaBrowser.Preview.Info=function(data){data&&data.type&&"function"==typeof this.actionInfo[data.type]&&this.actionInfo[data.type].call(this,data),elchild(this.body,element("div",{className:"fade"}))},MediaBrowser.ReadFile=function(fileName,encoding){encoding=encoding||"utf-8";var result,xmlhttp=new XMLHttpRequest;try{xmlhttp.overrideMimeType("text/html; charset="+encoding),xmlhttp.open("GET","file://"+fileName,!1),xmlhttp.send(null),result=xmlhttp.responseText}catch(e){echo(e,"some xmlhttp error"),result=""}return echo(result,"file "+fileName),result},MediaBrowser.ParseCue=function(text){var currFile=null,currTrack=null,data={files:[]};return text.split("\n").forEach(function(line){line=line.trim();var lineParts=line.split(" "),lineCmd=lineParts.shift().toLowerCase(),value=line.slice(lineCmd.length).trim();switch(lineCmd){case"title":case"performer":case"songwriter":'"'===value.charAt(0)&&'"'===value.charAt(value.length-1)&&(value=value.slice(1,value.length-1)),null!==currTrack?currTrack[lineCmd]=value:data[lineCmd]=value;break;case"file":currFile={tracks:[]};var parts=value.split(" ");parts.length>1&&'"'!==value.charAt(value.length-1)&&(currFile.type=parts.pop(),value=value.slice(0,-currFile.type.length).trim()),'"'===value.charAt(0)&&'"'===value.charAt(value.length-1)&&(value=value.slice(1,value.length-1)),currFile.name=value,data.files.push(currFile);break;case"track":currTrack={number:lineParts[0],type:lineParts[1],index:[]},currFile.tracks.push(currTrack);break;case"rem":if(-1!==["GENRE","DATE","COMMENT","PLACE"].indexOf(lineParts[0])){value=value.slice(lineParts[0].length).trim();var field=lineParts[0].toLowerCase();'"'===value.charAt(0)&&'"'===value.charAt(value.length-1)&&(value=value.slice(1,value.length-1)),null!==currTrack?currTrack[field]=value:data[field]=value}break;case"index":if(null!==currTrack){var time=(lineParts[1]||"00:00:00").split(":");currTrack.index.push(60*parseInt(time[0],10)+parseInt(time[1],10))}}}),data},MediaBrowser.ParseM3u=function(text){var lines=text.trim().split("\n"),currItem={},data={strict:!1,config:{},items:[]};return lines=lines.map(Function.prototype.call,String.prototype.trim),lines=lines.filter(Boolean),lines.length>0&&("#EXTM3U"===lines[0]&&(data.strict=!0,lines.shift()),lines.forEach(function(line){var comment,divPos,optKey,optVal;if("#"===line.charAt(0))switch(line.substr(1,6).toUpperCase()){case"EXTCFG":comment=line.substr(7).trim(),divPos=comment.indexOf("="),divPos>0&&(optKey=comment.substr(0,divPos).trim(),optVal=comment.substr(divPos+1).trim(),optKey&&optVal&&(optKey=optKey.split("."),1===optKey.length?data.config[optKey[0]]=optVal:("object"!=typeof data.config[optKey[0]]&&(data.config[optKey[0]]={}),data.config[optKey[0]][optKey[1]]=optVal)));break;case"EXTINF":comment=line.substr(8).trim(),divPos=comment.indexOf(","),divPos>0&&(currItem.time=comment.substr(0,divPos).trim(),currItem.name=comment.substr(divPos+1).trim())}else-1===line.indexOf("://")?(line=line.replace(/\\/g,"/"),line=MediaBrowser.FileList.path[MediaBrowser.FileList.path.length-1].url+"/"+line,echo(line.split(".")),currItem.ext=line.split(".").pop().toLowerCase(),currItem.type=MediaBrowser.FileList.ext2type[currItem.ext]):currItem.type=MEDIA_TYPE_STREAM,currItem.url=line,currItem.name=currItem.name||currItem.url,data.items.push(currItem),currItem={}}),data.config&&["VM_IPTV_ENABLED","VM_OTT_ENABLED","VM_OTT_LOG_ENABLED"].forEach(function(name){data.config[name]&&(data.config[name]=-1!==["true","yes","1"].indexOf(data.config[name].toLowerCase()))})),echo(data,"parsed m3u"),data},MediaBrowser.ParsePlaylist=function(ext,text){var type,extension,data=[],tmp=[],m3uData=text.trim();if(m3uData=m3uData.replace(/^\ufeff/,""),["m3u","m3u8"].indexOf(ext.toLowerCase())>=0){tmp=this.ParseM3u(m3uData).items;for(var i=0;i<tmp.length;i++)extension=tmp[i].url.split(".").pop().toLowerCase(),type=this.FileList.ext2type[extension],tmp[i].type="undefined"==typeof type||-1!==["m3u","m3u8"].indexOf(extension)?tmp[i].type:type,tmp[i].ext=extension,tmp[i].url=tmp[i].url.replace(/\\/g,"/"),data.push(tmp[i])}return data};var remoteControlButtonsImagesPath=configuration.newRemoteControl?PATH_IMG_SYSTEM+"buttons/new/":PATH_IMG_SYSTEM+"buttons/old/",IPTVChannels=new CPage;IPTVChannels.name="CPageIPTVChannels",IPTVChannels.menuId="tvChannels",IPTVChannels.onInit=function(){var self=this;this.needSave=!1,this.goToChFlag=!1,this.TVnumber="",this.timer={},this.epgNow={id:null,now:[]},pvrManager.SetMaxRecordingCnt(5),this.domChannelNumber=this.handle.querySelector(".channelNumber"),this.domURL=this.handle.querySelector(".URL"),this.domPVR=this.handle.querySelector(".pvrStatus"),this.domPVRText=this.domPVR.querySelector(".pvrText"),this.domPVRDone=this.domPVR.querySelector(".done"),this.domPVRWait=this.domPVR.querySelector(".wait"),this.domPVRError=this.domPVR.querySelector(".error"),this.domPVRWrite=this.domPVR.querySelector(".write"),this.domPVRText.innerHTML=_("Record status")+":",this.domEpgNow=this.handle.querySelector(".epgNow"),this.domEpgNext=this.handle.querySelector(".epgNext"),this.domInfoTitle=this.handle.querySelector(".infoTitle"),this.lastChannel=null,this.ModalMenu=new CModal(this),this.ModalMenu.Menu=new CGroupMenu(this.ModalMenu),this.ModalMenu.Menu.Init(this.handle.querySelector("div.cgmenu-main")),this.ModalMenu.onShow=function(){var currentItem=this.parent.TVList.Current(),activeItems=this.parent.TVList.ActiveItems();this.Menu.gedit.slist.Hidden(this.Menu.gedit.iedit,!currentItem||currentItem.data.type===MEDIA_TYPE_BACK),this.Menu.gedit.slist.Hidden(this.Menu.gedit.iopen,!currentItem),this.Menu.gedit.slist.Hidden(this.Menu.gedit.igroup,!currentItem),this.Menu.gedit.slist.Hidden(this.Menu.gedit.isave,!(self.needSave||FAVORITES_CHANGED)),this.Menu.gedit.slist.Hidden(this.Menu.gedit.iselone,this.parent.BPanel.btnF2.data.hidden),this.Menu.gedit.slist.Hidden(this.Menu.gedit.iselect,this.parent.BPanel.btnF2.data.hidden),this.Menu.gedit.slist.Hidden(this.Menu.gedit.ideselect,this.parent.BPanel.btnF2.data.hidden||void 0===this.parent.TVList.states.marked||0===this.parent.TVList.states.marked.length),this.Menu.gedit.slist.Hidden(this.Menu.gedit.iinvert,this.Menu.gedit.ideselect.hidden),this.Menu.gedit.slist.Hidden(this.Menu.gedit.icut,0===activeItems.length),this.Menu.gedit.slist.Hidden(this.Menu.gedit.icopy,0===activeItems.length),this.Menu.gedit.slist.Hidden(this.Menu.gedit.ipaste,0===globalBuffer.size()||self.TVList.parentItem===globalBuffer.place()),this.Menu.gedit.slist.Hidden(this.Menu.gedit.idelete,this.parent.BPanel.btnF2.data.hidden||0===activeItems.length),this.Menu.Activate()},this.ModalMenu.Init(element("div",{className:"cmodal-menu"},this.ModalMenu.Menu.handle)),this.ModalMenu.handle.onclick=function(){self.ModalMenu.Show(!1)},this.ModalMenu.EventHandler=function(event){switch(event.code){case KEYS.EXIT:case KEYS.MENU:self.ModalMenu.Show(!1);break;default:self.ModalMenu.Menu.EventHandler(event)}},this.ModalMenu.Menu.gedit=this.ModalMenu.Menu.AddGroup("gedit",_("Operations"),{onclick:function(){var items,list;switch(self.ModalMenu.Show(!1),this.iid){case MEDIA_ACTION_OPEN:self.TVList.Current().onclick();break;case MEDIA_ACTION_SELECT_ONE:self.actionF2();break;case MEDIA_ACTION_SELECT_ALL:self.TVList.Each(function(item){item.self.Marked(item,!0)});break;case MEDIA_ACTION_DESELECT:self.TVList.Each(function(item){item.self.Marked(item,!1)});break;case MEDIA_ACTION_INVERT:self.TVList.Each(function(item){item.self.Marked(item,!item.marked)});break;case MEDIA_ACTION_DELETE:items=self.TVList.ActiveItems(),self.domURL.innerHTML="",self.domInfoTitle.innerHTML="",new CModalConfirm(self,_("Confirm deletion"),_("Are you sure you want to delete")+"<br>"+_(items.length>1?"all entries selected?":"current entry?"),_("Cancel"),function(){},_("Yes"),function(){setTimeout(function(){var arr=[],active=self.TVList.activeItem;items.forEach(function(item){arr.push(self.TVList.parentItem.data[item.data.index])}),self.TVList.DeleteAll(items),self.actionFileDelete(arr,self.TVList.parentItem.data),self.TVList.Activate(!0),items.some(function(item){return item===active?(clearTimeout(self.TVList.timer.OnFocusPlay),!0):void 0})},5)});break;case MEDIA_ACTION_CUT:globalBuffer.clear(),globalBuffer.mode(globalBuffer.MODE_CUT),list=globalBuffer.place(self.TVList.parentItem),globalBuffer.onPaste=function(item){self.actionFileDelete([item],list.data)},items=self.TVList.ActiveItems(),items.forEach(function(item){globalBuffer.add(self.TVList.parentItem.data[item.data.index])}),self.Tray.iconBuffer.src=PATH_IMG_PUBLIC+"ico_cut.png",self.Tray.handleInner.appendChild(self.Tray.iconBuffer),self.Tray.Show(!0,!1);break;case MEDIA_ACTION_COPY:items=self.TVList.ActiveItems(),globalBuffer.clear(),globalBuffer.place(self.TVList.parentItem),globalBuffer.mode(globalBuffer.MODE_COPY),list=globalBuffer.place(self.TVList.parentItem),items.forEach(function(item){globalBuffer.add(self.TVList.parentItem.data[item.data.index])}),self.Tray.iconBuffer.src=PATH_IMG_PUBLIC+"ico_copy.png",self.Tray.handleInner.appendChild(self.Tray.iconBuffer),self.Tray.Show(!0,!1);break;case MEDIA_ACTION_PASTE:globalBuffer.paste(function(item){var obj=item;return self.TVList.addChannelsToList(self.TVList.parentItem.data,[obj],!1),self.TVList.activeItem=item,!0}),self.TVList.Refresh(!0),self.Tray.iconBuffer.parentNode===self.Tray.handleInner&&self.Tray.handleInner.removeChild(self.Tray.iconBuffer),self.Tray.Show(0!==self.Tray.handleInner.children.length,!1),self.TVList.Activate(!0);break;case MEDIA_ACTION_CREATE_GROUP:if(items=self.TVList.ActiveItems(),items.length>0){var data=[],arr=[];items.forEach(function(item){arr.push(self.TVList.parentItem.data[item.data.index]),data.push(self.TVList.parentItem.data[item.data.index])}),new CModalCreateGroup(self,_("Make group"),data,arr)}break;case MEDIA_ACTION_NEW_GROUP:new CModalCreateGroup(self,_("Create group"),[],[],!0);break;case MEDIA_ACTION_EDIT:new CModalChannelEdit(self,self.TVList.activeItem,self.TVList.parentItem.data[self.TVList.activeItem.data.index]);break;case MEDIA_ACTION_SAVE:self.needSave&&self.saveChanels(self.TVList.data),FAVORITES_CHANGED&&MediaBrowser.FavSave();break;case MEDIA_ACTION_ADD_OPER_TVLIST:new CModalImportTVChannels(self);break;case MEDIA_ACTION_ADD_TVLIST:new CModalChannelsAdd(self,!0);break;case MEDIA_ACTION_ADD_TVCHANNEL:new CModalChannelsAdd(self);break;case MEDIA_ACTION_EXPORT_CHANNEL:new CModalChannelExport(self,self.TVList.parentItem.data)}return!1}}),this.ModalMenu.Menu.gedit.iopen=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_OPEN,_("Open"),{icon:remoteControlButtonsImagesPath+"ok.png"}),this.ModalMenu.Menu.gedit.iselone=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_SELECT_ONE,_("Select"),{icon:remoteControlButtonsImagesPath+"f2.png"}),this.ModalMenu.Menu.gedit.iselect=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_SELECT_ALL,_("Select all")),this.ModalMenu.Menu.gedit.ideselect=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_DESELECT,_("Deselect all")),this.ModalMenu.Menu.gedit.iinvert=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_INVERT,_("Invert selection")),this.ModalMenu.Menu.gedit.icut=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_CUT,_("Cut")),this.ModalMenu.Menu.gedit.icopy=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_COPY,_("Copy")),this.ModalMenu.Menu.gedit.ipaste=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_PASTE,_("Paste")),this.ModalMenu.Menu.gedit.idelete=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_DELETE,_("Delete"),{icon:remoteControlButtonsImagesPath+"back.png"}),this.ModalMenu.Menu.gedit.iedit=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_EDIT,_("Edit")),this.ModalMenu.Menu.gedit.isave=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_SAVE,_("Save changes")),this.ModalMenu.Menu.gedit.igroup=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_CREATE_GROUP,_("Add to group")),this.ModalMenu.Menu.gedit.inewgroup=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_NEW_GROUP,_("Create group")),this.ModalMenu.Menu.gedit.ioperlist=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_ADD_OPER_TVLIST,_("Add operator's IPTV list")),this.ModalMenu.Menu.gedit.iaddlist=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_ADD_TVLIST,_("Add IPTV list")),this.ModalMenu.Menu.gedit.iaddchannel=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_ADD_TVCHANNEL,_("Add IPTV channel")),this.ModalMenu.Menu.gedit.iexport=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_EXPORT_CHANNEL,_("Export channels")),this.ModalMenu.Menu.Switch(this.ModalMenu.Menu.gedit),configuration.mayEPG&&(this.ModalMenu.Menu.gepg=this.ModalMenu.Menu.AddGroup("gepg",_("EPG"),{onclick:function(){switch(self.ModalMenu.Show(!1),this.iid){case MEDIA_ACTION_DVB_EPG:self.actionInfo();break;case MEDIA_ACTION_DVB_EPG_GRID:self.loadEPGGrid()}return!1}}),this.ModalMenu.Menu.gepg.gepg=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gepg,MEDIA_ACTION_DVB_EPG,_("EPG"),{icon:remoteControlButtonsImagesPath+"info.png"}),this.ModalMenu.Menu.gepg.gepggrid=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gepg,MEDIA_ACTION_DVB_EPG_GRID,_("EPG grid "))),this.ModalMenu.Menu.Switch(this.ModalMenu.Menu.gedit),this.BCrumb=new CBreadCrumb(this),this.BCrumb.rightItems=720===WINDOW_WIDTH?1:2,this.BCrumb.Init(PATH_IMG_PUBLIC,this.handle.querySelector(".body .header .cbcrumb")),this.BCrumb.SetName(_("IPTV channels")),this.SearchBar=new CFilterInput(this,{parent:this.handle.querySelector(".body .header .csbar"),hint:_("Enter channel or group name..."),folded:!0,events:{onEnter:function(){self.TVList.path[self.TVList.path.length-1].filterText&&(self.TVList.path.pop(),self.BCrumb.Pop());var filter=this.GetValue();if(""!==filter){var clone={},last=self.TVList.path[self.TVList.path.length-1];for(var attr in last)clone[attr]=last[attr];clone.filterText=filter,echo(clone,"clone Open"),self.TVList.Open(clone)}else self.TVList.path[self.TVList.path.length-1].filterText=self.TVList.filterText=self.TVList.parentItem.filterText="",self.TVList.Refresh();return self.BCrumb.Show(!0),this.Fold(!0),self.TVList.onFocus(self.TVList.Current()),!0},onChange:function(){self.SearchBar.timer&&clearTimeout(self.SearchBar.timer),self.SearchBar.timer=setTimeout(function(){var item=self.TVList.FirstMatch(self.SearchBar.GetValue());item&&(self.TVList.Focused(item,!0),self.SearchBar.focus())},400)},onUnfold:function(){self.BCrumb.Show(!1)},onFold:function(){self.BCrumb.Show(!0);
},onKey:function(){this.SetValue(self.TVList.path[self.TVList.path.length-1].filterText||"")}}}),this.SearchBar.timer=0,this.ExitBPanel=new CButtonPanel(this),this.ExitBPanel.Init(remoteControlButtonsImagesPath,this.handle.querySelector(".body .footer .exit div.cbpanel-main")),this.ExitBPanel.btnExit=this.ExitBPanel.Add(KEYS.EXIT,"exit.png",configuration.newRemoteControl?_("Exit"):"",function(){IPTVChannels.actionExit()}),this.BPanel=new CButtonPanel(this),this.BPanel.Init(remoteControlButtonsImagesPath,this.handle.querySelector(".body .footer .main div.cbpanel-main")),this.BPanel.btnMenu=this.BPanel.Add(KEYS.MENU,"menu.png",configuration.newRemoteControl?_("Menu"):"",function(){self.actionMenu()}),configuration.mayPVR&&(this.BPanel.btnF1=this.BPanel.Add(KEYS.F1,"f1.png",_("Record"),function(){"true"===environment.mount_media_ro?new CModalAlert(IPTVChannels,_("Warning!"),_('"Storage read only access mode" is enabled in System Settings'),_("Close")):self.actionF1()})),this.BPanel.btnF2=this.BPanel.Add(KEYS.F2,"f2.png",_("Select"),function(){self.actionF2()}),this.BPanel.btnF3add=this.BPanel.Add(KEYS.F3,"f3.png",_("Add to<br>favorites"),function(){self.actionF3add()}),this.BPanel.btnF3del=this.BPanel.Add(KEYS.F3,"f3.png",_("Remove from<br>favorites"),function(){self.actionF3del()},!0),this.TVList=new TVList(this),this.TVList.Init(this.handle.querySelector(".body .content .cslist-main")),this.TVList.SetBreadCrumb(this.BCrumb),this.TVList.SetSearchBar(this.SearchBar),this.Tray=new CBase(this),this.Tray.Init(this.handle.querySelector(".header .tray")),this.Tray.Show(!1,!1),this.Tray.showAttr="table-cell",this.Tray.iconFilter=element("img"),this.Tray.iconBuffer=element("img",{className:"copy",src:PATH_IMG_PUBLIC+"ico_copy.png"}),this.loadChanels()},IPTVChannels.initEPGNow=function(index){try{if(configuration.mayEPG){index||0===index||(index=this.TVList.activeItem.data.index);var data=dvbManager.GetEPGBrief(this.TVList.parentItem.data[index].url);echo(data,"EPG");var init=!1;if(""===data||"{}"===data)return void this.clearEPG();try{data=JSON.parse(data)}catch(e){echo(e,"EPG parse error")}if(!data.events||0===data.events.length)return void this.clearEPG();if(this.epgNow.id!==this.TVList.parentItem.data[index].url?(this.epgNow.id=this.TVList.parentItem.data[index].url,this.epgNow.now=data.events,init=!0):this.epgNow.now[0].start!==data.events[0].start&&(init=!0),init){var date=new Date(1e3*data.events[0].start),sH=date.getHours();sH=sH>9?sH:"0"+sH;var sM=date.getMinutes();sM=sM>9?sM:"0"+sM,date.setTime(1e3*(data.events[0].start+data.events[0].duration));var eH=date.getHours();eH=eH>9?eH:"0"+eH;var eM=date.getMinutes();eM=eM>9?eM:"0"+eM,this.domEpgNow.innerHTML="<b>"+sH+":"+sM+"-"+eH+":"+eM+"</b> "+data.events[0].name,date.setTime(1e3*data.events[1].start),sH=date.getHours(),sH=sH>9?sH:"0"+sH,sM=date.getMinutes(),sM=sM>9?sM:"0"+sM,date.setTime(1e3*(data.events[1].start+data.events[1].duration)),eH=date.getHours(),eH=eH>9?eH:"0"+eH,eM=date.getMinutes(),eM=eM>9?eM:"0"+eM,this.domEpgNext.innerHTML="<b>"+sH+":"+sM+"-"+eH+":"+eM+"</b> "+data.events[1].name}}}catch(e){echo(e)}},IPTVChannels.initEPG=function(index){configuration.mayEPG&&this.TVList.activeItem.data.type===MEDIA_TYPE_STREAM&&(currCPage===this||currCPage.parent===this)&&(index||0===index||(index=this.TVList.activeItem.data.index),new CModalInitEPGInfo(currCPage===MediaPlayer?MediaPlayer:this,this.TVList.parentItem.data[index].url))},IPTVChannels.loadEPGGrid=function(parent){var i;if(configuration.mayEPG){var active,items=this.TVList.handleInner.children,list=[];for(i=0;i<items.length;i++)items[i].data&&items[i].data.type!==MEDIA_TYPE_BACK&&items[i].data.type!==MEDIA_TYPE_GROUP&&!items[i].hidden&&(list.push({id:this.TVList.parentItem.data[items[i].data.index].url,name:items[i].data.name,channel_number:items[i].data.number}),this.TVList.activeItem===items[i]&&(active=list.length-1));list.length&&(DVBEpg.EPGList.SetList(list),this.TVList.activeItem&&this.TVList.activeItem.data&&DVBEpg.EPGList.SetPosition(list[active]),DVBEpg.Show(!0,parent?parent:this))}},IPTVChannels.getListBlock=function(start,amount){var data=[];start+=(this.TVList.channelStart>0?this.TVList.channelStart:0)+(this.TVList.handle.children[0].data.type===MEDIA_TYPE_BACK?1:0);for(var i=start;i<this.TVList.handle.children.length&&(echo(this.TVList.handle.children[i].data,i),data.push({name:this.TVList.handle.children[i].data.name,id:this.TVList.parentItem.data[this.TVList.handle.children[i].data.index].url,channelNumber:this.TVList.handle.children[i].data.number}),!(data.length>=amount));i++);return data},IPTVChannels.clearEPG=function(){this.epgNow={id:null,now:[]},this.domEpgNow.innerHTML="",this.domEpgNext.innerHTML=""},IPTVChannels.onShow=function(){var arr;MediaPlayer.changeScreenMode(!0),0===this.TVList.data.length?setTimeout(function(){new CModalHint(IPTVChannels,_("No IPTV channels"),3e3)},5):this.TVList.activeItem&&this.TVList.Activate&&(this.TVList.SetPosition(this.TVList.activeItem),this.TVList.activeItem.focus());try{arr=JSON.parse(pvrManager.GetAllTasks())}catch(e){arr=[]}arr.length&&this.pvr.start()},IPTVChannels.pvr={id:null,run:!1,interval:6e4,arr:[],map:[],start:function(){this.check(),this.run||(this.id=window.setInterval(this.check,this.interval),this.run=!0)},stop:function(){this.run&&clearInterval(this.id),this.arr=[],this.map=[],IPTVChannels.domPVR.style.display="none"},check:function(noUpdate){var index,url,s1=0,s2=0,s3=0,s4=0;if(IPTVChannels.TVList.activeItem&&IPTVChannels.TVList.activeItem.data){if(!noUpdate){try{this.arr=JSON.parse(pvrManager.GetAllTasks())}catch(e){this.arr=[]}if(echo(this.arr,"PVR Array"),!this.arr.length)return void this.stop()}if(this.map=this.arr.map(function(item){return item.url}),echo(this.map,"Check map"),url=IPTVChannels.TVList.parentItem.data[IPTVChannels.TVList.activeItem.data.index].url,index=this.map.indexOf(url),-1!==index){for(var i=0;i<this.arr.length;i++)if(this.arr[i].url===url)switch(this.arr[i].state){case 1:s1++;break;case 2:s2++;break;case 3:s3++;break;case 4:s4++}s1>0?IPTVChannels.domPVRWait.classList.add("active"):IPTVChannels.domPVRWait.classList.remove("active"),s2>0?IPTVChannels.domPVRWrite.classList.add("active"):IPTVChannels.domPVRWrite.classList.remove("active"),s3>0?IPTVChannels.domPVRError.classList.add("active"):IPTVChannels.domPVRError.classList.remove("active"),s4>0?IPTVChannels.domPVRDone.classList.add("active"):IPTVChannels.domPVRDone.classList.remove("active"),IPTVChannels.domPVR.style.display="table"}else IPTVChannels.domPVR.style.display="none"}}},IPTVChannels.Reset=function(){function mapFun(item){return item.type===MEDIA_TYPE_GROUP?item.name:null}var map=null,index=-1;if(MediaPlayer.ts_on=environment.ts_on,this.TVList.Reset(),this.lastChannel&&this.lastChannel.length){this.TVList.parentItem={type:MEDIA_TYPE_TV_ROOT,data:this.TVList.data};for(var i=0;i<this.lastChannel.length-1;i++){if(map=this.TVList.parentItem.data.map(mapFun),index=map.indexOf(this.lastChannel[i].name),-1===index)return this.TVList.Open({type:MEDIA_TYPE_TV_ROOT,data:this.TVList.data}),void(IPTV_PLAYBACK_ON_START&&this.TVList.activeItem&&this.TVList.activeItem.data.type===MEDIA_TYPE_STREAM&&this.TVList.Open(this.TVList.activeItem.data,!1));this.TVList.path.push(this.TVList.parentItem),this.TVList.bcrumb.Push("/","media/type_"+this.TVList.parentItem.data[index].type+".png",this.TVList.parentItem.data[index].name?this.TVList.parentItem.data[index].name:""),this.TVList.parentItem=this.TVList.parentItem.data[index]}if(this.TVList.Open(this.TVList.parentItem),index=-1,this.lastChannel[this.lastChannel.length-1]&&(this.lastChannel[this.lastChannel.length-1].url?(map=this.TVList.parentItem.data.map(function(item){return item.type===MEDIA_TYPE_STREAM?item.name+" "+item.url:null}),index=map.indexOf(this.lastChannel[this.lastChannel.length-1].name+" "+this.lastChannel[this.lastChannel.length-1].url)):(map=this.TVList.parentItem.data.map(function(item){return item.type===MEDIA_TYPE_GROUP?item.name:null}),index=map.indexOf(this.lastChannel[this.lastChannel.length-1].name)),-1!==index))return this.TVList.Focused(this.TVList.handle.children[index+(this.TVList.handle.children[0].data.type===MEDIA_TYPE_BACK?1:0)],!0),void(this.lastChannel[this.lastChannel.length-1].url&&this.TVList.Open(this.TVList.activeItem.data,!1));IPTV_PLAYBACK_ON_START&&this.TVList.activeItem&&this.TVList.activeItem.data.type===MEDIA_TYPE_STREAM&&this.TVList.Open(this.TVList.activeItem.data,!1)}else this.TVList.Open({type:MEDIA_TYPE_TV_ROOT,data:this.TVList.data}),IPTV_PLAYBACK_ON_START&&this.TVList.activeItem&&this.TVList.activeItem.data.type===MEDIA_TYPE_STREAM&&this.TVList.Open(this.TVList.activeItem.data,!1)},IPTVChannels.EventHandler=function(event){if(IPTVChannels.SearchBar.EventHandler(event)!==!0)switch(event.code){case KEYS.OK:if(IPTVChannels.goToChFlag){clearTimeout(IPTVChannels.timer.goToChannel),IPTVChannels.TVList.goToChannel(parseInt(IPTVChannels.TVnumber,10)+IPTVChannels.TVList.channelStart),IPTVChannels.TVnumber="",IPTVChannels.goToChFlag=!1,IPTVChannels.domChannelNumber.style.display="none",MediaPlayer.domChannelNumber.style.display="none",event.preventDefault();break}case KEYS.HOME:case KEYS.END:case KEYS.PAGE_UP:case KEYS.PAGE_DOWN:case KEYS.UP:case KEYS.DOWN:case KEYS.LEFT:case KEYS.RIGHT:IPTVChannels.TVList.EventHandler(event);break;case KEYS.EXIT:IPTVChannels.actionExit();break;case KEYS.EPG:case KEYS.INFO:IPTVChannels.actionInfo();break;case KEYS.BACK:IPTVChannels.actionBack();break;case KEYS.REFRESH:IPTVChannels.actionRefresh();break;case KEYS.MENU:case KEYS.F1:case KEYS.F2:case KEYS.F3:IPTVChannels.BPanel.EventHandler(event);break;case KEYS.PLAY_PAUSE:IPTVChannels.actionPlayPause();break;case KEYS.STOP:IPTVChannels.TVList.activeItem.data.type===MEDIA_TYPE_STREAM&&MediaPlayer.end();break;case KEYS.NUM0:IPTVChannels.goToChannel("0");break;case KEYS.NUM1:IPTVChannels.goToChannel("1");break;case KEYS.NUM2:IPTVChannels.goToChannel("2");break;case KEYS.NUM3:IPTVChannels.goToChannel("3");break;case KEYS.NUM4:IPTVChannels.goToChannel("4");break;case KEYS.NUM5:IPTVChannels.goToChannel("5");break;case KEYS.NUM6:IPTVChannels.goToChannel("6");break;case KEYS.NUM7:IPTVChannels.goToChannel("7");break;case KEYS.NUM8:IPTVChannels.goToChannel("8");break;case KEYS.NUM9:IPTVChannels.goToChannel("9");break;default:event.preventDefault()}},IPTVChannels.actionExit=function(){var self=this;return this.TVList.path.length>1?void this.TVList.Open({type:MEDIA_TYPE_BACK}):(this.pvr.stop(),MediaPlayer.end()?this.needSave?(new CModalConfirm(this,_("IPTV channel list was changed"),_("Save updated IPTV channel list?"),_("Exit without saving"),function(){setTimeout(function(){var active=self.TVList.activeItem;self.needSave=!1,FAVORITES_CHANGED&&MediaBrowser.FavRestore(),self.loadChanels(),active&&self.TVList.Activate&&self.TVList.data.length&&(self.TVList.SetPosition(active),self.TVList.activeItem.focus()),self.actionExit()},5)},_("Save"),function(){setTimeout(function(){self.saveChanels(self.TVList.data),FAVORITES_CHANGED&&MediaBrowser.FavSave(),self.actionExit()},5)}),!1):FAVORITES_CHANGED?(new CModalConfirm(this,_("The list of favourite records has changed"),_("Save updated list of favourite records?"),_("Exit without saving"),function(){setTimeout(function(){MediaBrowser.FavRestore(),self.actionExit()},5)},_("Save"),function(){setTimeout(function(){MediaBrowser.FavSave(),self.actionExit()},5)}),!1):(clearTimeout(IPTVChannels.TVList.timer.OnFocusPlay),IPTVChannels.saveLastChannels(),void IPTVChannels.Show(!1)):!1)},IPTVChannels.saveLastChannels=function(){for(var last=JSON.stringify(this.lastChannel),now=[],nowSave="",active=this.TVList.activeItem?this.TVList.parentItem.data[this.TVList.activeItem.data.index]:null,i=1;i<this.TVList.path.length;i++)this.TVList.path[i].type===MEDIA_TYPE_GROUP?now.push({name:this.TVList.path[i].name}):now.push({name:this.TVList.path[i].name,url:this.TVList.path[i].url});active?active.type===MEDIA_TYPE_GROUP?now.push({name:active.name}):now.push({name:active.name,url:active.url}):now.push(null),echo(now,"TO SAVE POSITION"),nowSave=JSON.stringify(now),nowSave!==last&&(this.lastChannel=now,gSTB.SaveUserData("iptv.last.json",nowSave))},IPTVChannels.actionRefresh=function(){var number=-1;this.TVList.prevChannel&&(number=this.TVList.parentItem.data.indexOf(this.TVList.prevChannel),-1!==number&&this.TVList.goToChannel(number))},IPTVChannels.actionBack=function(){var self=this;if(IPTVChannels.goToChFlag)clearTimeout(IPTVChannels.timer.goToChannel),IPTVChannels.TVnumber.length>0&&(IPTVChannels.TVnumber=IPTVChannels.TVnumber.slice(0,IPTVChannels.TVnumber.length-1),IPTVChannels.domChannelNumber.innerHTML=IPTVChannels.TVnumber,MediaPlayer.domChannelNumber.innerHTML=IPTVChannels.TVnumber,IPTVChannels.TVnumber.length>0?IPTVChannels.timer.goToChannel=setTimeout(function(){IPTVChannels.TVList.goToChannel(parseInt(IPTVChannels.TVnumber,10)+IPTVChannels.TVList.channelStart),IPTVChannels.TVnumber="",IPTVChannels.goToChFlag=!1,IPTVChannels.domChannelNumber.style.display="none",MediaPlayer.domChannelNumber.style.display="none"},2e3):(IPTVChannels.domChannelNumber.style.display="none",MediaPlayer.domChannelNumber.style.display="none"));else{var items=this.TVList.ActiveItems();if(this.BPanel.btnF2.data.hidden||0===items.length)return;this.domURL.innerHTML="",this.domInfoTitle.innerHTML="",new CModalConfirm(this,_("Confirmation"),_("Are you sure you want to delete")+"<br>"+_(items.length>1?"all entries selected?":"current entry?"),_("Cancel"),function(){},_("Yes"),function(){setTimeout(function(){var arr=[],active=self.TVList.activeItem;items.forEach(function(item){arr.push(self.TVList.parentItem.data[item.data.index])}),items.some(function(item){return item===active?(clearTimeout(self.TVList.timer.OnFocusPlay),!0):void 0}),self.TVList.DeleteAll(items),self.actionFileDelete(arr,self.TVList.parentItem.data)},5)})}},IPTVChannels.actionMenu=function(){this.ModalMenu.Show(!0)},IPTVChannels.actionF1=function(){return configuration.mayPVR?void new CModalAddRecord(this,_("Recording channel")):!1},IPTVChannels.actionInfo=function(){configuration.mayEPG&&IPTVChannels.initEPG()},IPTVChannels.goToChannel=function(number){clearTimeout(this.timer.goToChannel),this.goToChFlag=!0,this.TVnumber+=number,this.domChannelNumber.innerHTML=this.TVnumber,MediaPlayer.domChannelNumber.innerHTML=this.TVnumber,this.domChannelNumber.style.display="block",MediaPlayer.domChannelNumber.style.display="block";var self=this;this.timer.goToChannel=setTimeout(function(){self.TVList.goToChannel(parseInt(self.TVnumber,10)+self.TVList.channelStart),self.TVnumber="",self.goToChFlag=!1,self.domChannelNumber.style.display="none",MediaPlayer.domChannelNumber.style.display="none"},2e3)},IPTVChannels.actionPlayPause=function(){MediaPlayer.playNow?MediaPlayer.playPause():this.TVList.activeItem.data.type===MEDIA_TYPE_STREAM&&MediaPlayer.preparePlayer(this.TVList.parentItem.data[this.TVList.activeItem.data.index],this,!0,!0,!1)},IPTVChannels.actionF2=function(move){if(!this.BPanel.btnF2.data.hidden){var item=this.TVList.Current();item.data.markable&&this.TVList.Marked(item,!item.marked)&&(move!==!1&&this.TVList.SetPosition(this.TVList.Next(),!0,!0),this.BPanel.btnF3add.data.hidden&&this.BPanel.btnF3del.data.hidden||(this.BPanel.Hidden(this.BPanel.btnF3add,!1),this.BPanel.Hidden(this.BPanel.btnF3del,!0)))}},IPTVChannels.actionF3add=function(){var self=this;if(!this.BPanel.btnF3add.data.hidden){var items=this.TVList.ActiveItems();items.length>0&&items.forEach(function(item){item.data.type!==MEDIA_TYPE_GROUP&&(self.TVList.SetStar(item,!0),MediaBrowser.FavAdd((self.TVList.parentItem.data[item.data.index].sol?self.TVList.parentItem.data[item.data.index].sol+" ":"")+self.TVList.parentItem.data[item.data.index].url,{name:self.TVList.parentItem.data[item.data.index].name,url:(self.TVList.parentItem.data[item.data.index].sol?self.TVList.parentItem.data[item.data.index].sol+" ":"")+self.TVList.parentItem.data[item.data.index].url,sol:self.TVList.parentItem.data[item.data.index].sol,type:self.TVList.parentItem.data[item.data.index].type,markable:!0}))})}},IPTVChannels.actionF3del=function(){var self=this;if(!this.BPanel.btnF3del.data.hidden){var items=this.TVList.ActiveItems();items.length>0&&items.forEach(function(item){MediaBrowser.FavRemove((self.TVList.parentItem.data[item.data.index].sol?self.TVList.parentItem.data[item.data.index].sol+" ":"")+self.TVList.parentItem.data[item.data.index].url),self.TVList.SetStar(item,!1)})}},IPTVChannels.actionFileDelete=function(data,list){var obj=null,deleteTrue=!0;list||(list=this.TVList.parentItem.data);for(var i=0;i<data.length;i++){var number=list.indexOf(data[i]);0>number?deleteTrue=!1:(data[i].type===MEDIA_TYPE_GROUP&&this.TVList.channelStart--,obj=list.splice(number,1))}return 0===this.TVList.parentItem.data.length&&(this.BPanel.Hidden(this.BPanel.btnF1,!0),this.BPanel.Hidden(this.BPanel.btnF2,!0),this.BPanel.Hidden(this.BPanel.btnF3add,!0),this.BPanel.Hidden(this.BPanel.btnF3del,!0),MediaPlayer.end()),this.needSave=!0,this.TVList.parentItem.data.length&&list===this.TVList.parentItem.data&&this.TVList.RefreshIndex(),deleteTrue},IPTVChannels.addChannels=function(arr,save){if(Array.isArray(arr)){var self=this,current_urls=this.TVList.data.map(function(el){return el.url});return arr=arr.filter(function(el){var index,test=!0;return-1!==(index=current_urls.indexOf(el.url))&&(self.TVList.data[index].changed||(self.TVList.data[index].name=el.name),test=!1),test}),this.TVList.data=this.TVList.data.concat(arr),IPTVChannels.checkSolution(this.TVList.data,!0),IPTVChannels.checkTS_data(this.TVList.data,!0),save&&IPTVChannels.saveChanels(this.TVList.data),arr.length}return!1},IPTVChannels.loadChanels=function(){try{var text=gSTB.LoadUserData("iptv.json"),data=null;""!==text?(data=JSON.parse(text),IPTVChannels.TVList.data=IPTVChannels.unescapeChanels(data)):IPTVChannels.TVList.data=[],text=gSTB.LoadUserData("iptv.last.json"),""!==text?this.lastChannel=JSON.parse(text):this.lastChannel=null}catch(e){echo(e,"TVChannels parse")}},IPTVChannels.saveChanels=function(data){var arr=this.escapeChanels(data||this.TVList.data);gSTB.SaveUserData("iptv.json",JSON.stringify(arr)),this.needSave=!1},IPTVChannels.exportChannels=function(data,tree){var i,text="#EXTM3U\r\n",temp="";for(i=0;i<data.length;i++)data[i].type!==MEDIA_TYPE_GROUP?(text+="#EXTINF:-1,"+data[i].name+"\r\n",text+=(data[i].sol?data[i].sol+" ":"")+data[i].url+"\r\n"):tree&&(temp=IPTVChannels.exportChannels(data[i].data,tree),text+=temp);return text},IPTVChannels.checkTS=function(data,check){var save=!1;if(configuration.mayTimeShift&&data.length>0){var arr=data.slice(),temp=IPTVChannels.checkTS_data(arr,check);save=temp.save,save&&IPTVChannels.saveChanels(temp.a)}},IPTVChannels.checkSolution=function(a,check){var i,l=a.length,save=!1;for(i=0;l>i;i++)if(a[i].type!==MEDIA_TYPE_GROUP){if("undefined"==typeof a[l-1].sol&&(save=!0,a[i].url)){var tempsource=a[i].url.trim().split(" ");if(tempsource.length>1&&validateUrl(tempsource[0]+" "+tempsource[1],!0)){a[i].url=tempsource[1];for(var j=2;j<tempsource.length;j++)a[i].url+=" "+tempsource[j];a[i].sol=tempsource[0]}}}else{var temp=IPTVChannels.checkSolution(a[i].data,check);a[i].data=temp.a,save=save?save:temp.save}return{a:a,save:save}},IPTVChannels.checkTS_data=function(a,check){var l=a.length,save=!1;if(!configuration.mayTimeShift)return{a:a,save:!1};for(var i=0;l>i;i++)if(a[i].type!==MEDIA_TYPE_GROUP){if(("undefined"==typeof a[l-1].tsOn||check)&&(save=!0,("undefined"==typeof a[i].tsOn||check)&&a[i].url)){var tempsource=a[i].url;/rtp\:|udp\:/.test(tempsource)||/ffrt\s/.test(tempsource)||"ffrt"===a[i].sol?a[i].tsOn=!0:a[i].tsOn=!1}}else{var temp=IPTVChannels.checkTS_data(a[i].data,check);a[i].data=temp.a,save=save?save:temp.save}return{a:a,save:save}},IPTVChannels.escapeChanels=function(arr){for(var data=JSON.parse(JSON.stringify(arr)),i=0;i<data.length;i++)data[i].data?(data[i].name=escape(data[i].name),data[i].data=IPTVChannels.escapeChanels(data[i].data)):(data[i].name=escape(data[i].name),data[i].url=escape(data[i].url));return data},IPTVChannels.unescapeChanels=function(arr){for(var data=JSON.parse(JSON.stringify(arr)),i=0;i<data.length;i++)data[i].data?(data[i].name=unescape(data[i].name),data[i].data=IPTVChannels.unescapeChanels(data[i].data)):(data[i].name=unescape(data[i].name),data[i].url=unescape(data[i].url));return data};var remoteControlButtonsImagesPath=configuration.newRemoteControl?PATH_IMG_SYSTEM+"buttons/new/":PATH_IMG_SYSTEM+"buttons/old/",DVBChannels=new CPage;DVBChannels.name="CPageDVBChannels",DVBChannels.menuId="dvbChannels",DVBChannels.onInit=function(){function onScanProgress(data){data.state===self.inputs[0].STATE_STOP||data.state===self.inputs[0].STATE_ERROR?(self.scanningInProgress=!1,self.domScanInProgress.style.display="none",!self.loadChannels(!0)||currCPage!==self&&MediaPlayer.parent!==self||self.Reset()):(self.domPercentScan.innerHTML=data.progress+"%",self.domTitleFreqScanText.innerHTML=data.frequency)}function onChannelFound(data){self.scanTotalFound++,self.domTitleTotalScanText.innerHTML=self.scanTotalFound,self.domTitleLastScanText.innerHTML=data.name}function onAntennaPower(state){state||(self.ModalMenu.Menu.gdvbAntena.slist.Marked(self.ModalMenu.Menu.gdvbAntena.ion,!1),self.ModalMenu.Menu.gdvbAntena.slist.Marked(self.ModalMenu.Menu.gdvbAntena.ioff,!0),currCPage&&MediaPlayer.dvbPowerManualOn&&new CModalHint(currCPage,_("Detected passive antenna type"),2e3),MediaPlayer.dvbPowerManualOn=!1)}var i,self=this;if(this.lastChannel=null,this.needSave=!1,this.goToChFlag=!1,this.TVnumber="",this.timer={},this.scanningInProgress=!1,this.scanTotalFound=0,this.inputs=[],this.list=null,!configuration.mayDVB)return 0;if(!window.stbDvbManager)return 0;if(this.inputs=stbDvbManager.inputs,0===this.inputs.length)return 0;for(dvbTypes=["DVB-C","DVB-T","DVB-T2","DVB-S/DVB-S2"],this.inputs[0].TYPE_DVB_C&&(dvbTypes[this.inputs[0].TYPE_DVB_C]="DVB-C"),this.inputs[0].TYPE_DVB_T&&(dvbTypes[this.inputs[0].TYPE_DVB_T]="DVB-T"),this.inputs[0].TYPE_DVB_T2&&(dvbTypes[this.inputs[0].TYPE_DVB_T2]="DVB-T2"),this.inputs[0].TYPE_DVB_S&&(dvbTypes[this.inputs[0].TYPE_DVB_S]="DVB-S"),this.inputs[0].TYPE_DVB_S2&&(dvbTypes[this.inputs[0].TYPE_DVB_S2]="DVB-S2"),this.DVBType=function(){self.inputs[0].currentScanTypes[0]}(),i=0;i<this.inputs.length;i++)this.inputs[i].capabilities.antennaPower&&(this.inputs[i].antennaPower=!0);for(i=0;i<this.inputs.length;i++)this.inputs[i].onScanProgress=onScanProgress,this.inputs[i].onChannelFound=onChannelFound,this.inputs[i].onAntennaPower=onAntennaPower;this.ModalMenu=new CModal(this),this.epgNow={id:null,now:[]},this.domPercentScan=this.handle.querySelector(".percentScan"),this.domChannelNumber=this.handle.querySelector(".channelNumber"),this.domScanInProgress=this.handle.querySelector(".scanInProgress"),this.domEpgNow=this.handle.querySelector(".epgNow"),this.domEpgNext=this.handle.querySelector(".epgNext"),this.domInfoTitle=this.handle.querySelector(".infoTitle"),this.domTitleFreqScanText=this.handle.querySelector(".titleFreqScanText"),this.domTitleLastScanText=this.handle.querySelector(".titleLastScanText"),this.domTitleTotalScanText=this.handle.querySelector(".titleTotalScanText"),this.handle.querySelector(".titleFreqScan").innerHTML="<b>"+_("Frequency")+":&nbsp;&nbsp;</b>",this.handle.querySelector(".titleTotalScan").innerHTML="<b>"+_("Total found")+":&nbsp;&nbsp;</b>",this.handle.querySelector(".titleLastScan").innerHTML="<b>"+_("Last found")+":&nbsp;&nbsp;</b>",this.ModalMenu.Menu=new CGroupMenu(this.ModalMenu),this.ModalMenu.Menu.Init(this.handle.querySelector("div.cgmenu-main")),this.ModalMenu.Init(element("div",{className:"cmodal-menu"},this.ModalMenu.Menu.handle)),this.ModalMenu.EventHandler=function(event){switch(event.code){case KEYS.EXIT:case KEYS.MENU:self.ModalMenu.Show(!1);break;default:self.ModalMenu.Menu.EventHandler(event)}},this.ModalMenu.Menu.gedit=this.ModalMenu.Menu.AddGroup("gedit",_("Operations"),{onclick:function(){switch(self.ModalMenu.Show(!1),this.iid){case MEDIA_ACTION_OPEN:self.DVBList.Open(self.DVBList.activeItem);break;case MEDIA_ACTION_DELETE:var items=self.DVBList.ActiveItems();new CModalConfirm(self,_("Confirm deletion"),_("Are you sure you want to delete")+"<br>"+_(items.length>1?"all entries selected?":"current entry?"),_("Cancel"),function(){},_("Yes"),function(){setTimeout(function(){var data=[],i=0;items.forEach(function(item){data[i]=item.data,(FAVORITES_NEW[data[i].uri]||FAVORITES[data[i].uri])&&MediaBrowser.FavRemove(data[i].uri),item.focused&&(self.domInfoTitle.innerHTML="",MediaPlayer.end(),self.clearEPG()),i++}),self.actionFileDelete(data)},5)})}return!1}}),this.ModalMenu.Menu.gedit.iopen=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_OPEN,_("Open"),{icon:remoteControlButtonsImagesPath+"ok.png"}),this.ModalMenu.Menu.gedit.idelete=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_DELETE,_("Delete")),this.ModalMenu.Menu.gdvb=this.ModalMenu.Menu.AddGroup("gdvb",_("DVB menu"),{onclick:function(){switch(self.ModalMenu.Show(!1),this.iid){case MEDIA_ACTION_DVB_EPG:self.actionInfo();break;case MEDIA_ACTION_AUTO_SCAN_DVB:new CModalScanDVB(self);break;case MEDIA_ACTION_MANUAL_SCAN_DVB:new CModalManualScanDVB(self);break;case MEDIA_ACTION_CLEAR_DVB:new CModalConfirm(self,_("Confirm deletion"),_("Are you sure you want to delete")+"<br>"+_("all entries?"),_("Cancel"),function(){},_("Yes"),function(){setTimeout(function(){self.DVBList.list.forEach(function(data){(FAVORITES_NEW[data.uri]||FAVORITES[data.uri])&&MediaBrowser.FavRemove(data.uri)}),self.DVBList.data=[],self.domInfoTitle.innerHTML="",stbDvbManager.channelList.clear(),MediaPlayer.end(),self.Reset(!0)},5)});break;case MEDIA_ACTION_DVB_EPG_GRID:self.loadEPGGrid()}return!1}}),this.ModalMenu.Menu.gdvb.gepg=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gdvb,MEDIA_ACTION_DVB_EPG,_("EPG"),{icon:remoteControlButtonsImagesPath+"info.png"}),this.ModalMenu.Menu.gdvb.gepggrid=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gdvb,MEDIA_ACTION_DVB_EPG_GRID,_("EPG grid ")),this.ModalMenu.Menu.gdvb.gascan=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gdvb,MEDIA_ACTION_AUTO_SCAN_DVB,_("Auto scan")),this.ModalMenu.Menu.gdvb.gmscan=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gdvb,MEDIA_ACTION_MANUAL_SCAN_DVB,_("Manual scan")),this.ModalMenu.Menu.gdvb.gclear=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gdvb,MEDIA_ACTION_CLEAR_DVB,_("Clear list")),(this.inputs.length&&this.inputs[0].capabilities.antennaPower||this.inputs.length>1)&&(this.ModalMenu.Menu.gdvbAntena=this.ModalMenu.Menu.AddGroup("gdvbAntena",_("Antenna type"),{onclick:function(){switch(this.data){case 1:for((self.ModalMenu.Menu.gdvbAntena.slist.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),i=0;i<self.inputs.length;i++)this.inputs[i].capabilities.antennaPower&&(self.inputs[i].antennaPower=!0);MediaPlayer.dvbPowerManualOn=!0;break;case 2:for((self.ModalMenu.Menu.gdvbAntena.slist.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),MediaPlayer.dvbPowerManualOn=!1,i=0;i<self.inputs.length;i++)this.inputs[i].capabilities.antennaPower&&(self.inputs[i].antennaPower=!1)}return self.ModalMenu.Show(!1),!1}}),this.ModalMenu.Menu.gdvbAntena.ion=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gdvbAntena,1,_("Active"),{data:1}),this.ModalMenu.Menu.gdvbAntena.ioff=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gdvbAntena,2,_("Passive"),{data:2})),this.ModalMenu.Menu.Switch(this.ModalMenu.Menu.gedit),this.ModalMenu.onShow=function(){var currentItem=self.DVBList.ActiveItem(),activeItems=self.DVBList.ActiveItems();currentItem?(this.Menu.Hidden(this.Menu.gedit,!1),this.Menu.gdvb.slist.Hidden(this.Menu.gdvb.gepg,!1),this.Menu.gdvb.slist.Hidden(this.Menu.gdvb.gepggrid,!1),this.Menu.gdvb.slist.Hidden(this.Menu.gdvb.gclear,!1)):(this.Menu.Hidden(this.Menu.gedit,!0),this.Menu.Switch(this.Menu.gdvb),this.Menu.gdvb.slist.Hidden(this.Menu.gdvb.gepg,!0),this.Menu.gdvb.slist.Hidden(this.Menu.gdvb.gepggrid,!0),this.Menu.gdvb.slist.Hidden(this.Menu.gdvb.gclear,!0)),this.Menu.gedit.slist.Hidden(this.Menu.gedit.idelete,0===activeItems.length),this.Menu.Activate(),this.Menu.ApplyArrows()},this.BCrumb=new CBreadCrumb(this),this.BCrumb.rightItems=720===WINDOW_WIDTH?1:2,this.BCrumb.Init(PATH_IMG_PUBLIC,this.handle.querySelector(".body .header .cbcrumb")),this.BCrumb.SetName(_("DVB channels")),this.SearchBar=new CFilterInput(this,{parent:this.handle.querySelector(".body .header .csbar"),hint:_("Enter name..."),folded:!0,events:{onEnter:function(){var filters,filter=this.GetValue();return filters=["ct","name",filter],self.DVBList.filterText=filter,""!==filter?(self.DVBList.path[self.DVBList.path.length-1].filterText&&(self.DVBList.path.pop(),self.BCrumb.Pop()),self.DVBList.filters=filters,self.DVBList.pageIndex=0,self.DVBList.itemIndex=0,self.DVBList.listIndex=0,self.DVBList.createList(),self.DVBList.loadChannels(!0,!0),self.DVBList.Open({type:MEDIA_TYPE_DVB_ROOT,data:self.DVBList.list,filterText:filter,filters:filters,count:self.DVBList.count})):self.DVBList.path.length>1&&self.DVBList.Open({type:MEDIA_TYPE_BACK}),self.BCrumb.Show(!0),this.Fold(!0),!0},onChange:function(){},onUnfold:function(){self.BCrumb.Show(!1)},onFold:function(){self.BCrumb.Show(!0)},onKey:function(){this.SetValue(self.DVBList.path[self.DVBList.path.length-1].filterText||"")}}}),this.SearchBar.timer=0,this.ExitBPanel=new CButtonPanel(this),this.ExitBPanel.Init(remoteControlButtonsImagesPath,this.handle.querySelector(".body .footer .exit div.cbpanel-main")),this.ExitBPanel.btnExit=this.ExitBPanel.Add(KEYS.EXIT,"exit.png",configuration.newRemoteControl?_("Exit"):"",function(){DVBChannels.actionExit()}),this.BPanel=new CButtonPanel(this),this.BPanel.Init(remoteControlButtonsImagesPath,this.handle.querySelector(".body .footer .main div.cbpanel-main")),this.BPanel.btnMenu=this.BPanel.Add(KEYS.MENU,"menu.png",configuration.newRemoteControl?_("Menu"):"",function(){self.actionMenu()}),this.BPanel.btnF3add=this.BPanel.Add(KEYS.F3,"f3.png",_("Add to<br>favorites"),function(){self.actionF3add()}),this.BPanel.btnF3del=this.BPanel.Add(KEYS.F3,"f3.png",_("Remove from<br>favorites"),function(){self.actionF3del()},!0),this.DVBList=new DVBList(this),this.DVBList.Init(this.handle.querySelector(".body .content .clist-main")),this.DVBList.SetBreadCrumb(this.BCrumb),this.DVBList.SetSearchBar(this.SearchBar),this.Tray=new CBase(this),this.Tray.Init(this.handle.querySelector(".header .tray")),this.Tray.Show(!1,!1),this.Tray.showAttr="table-cell",this.Tray.iconFilter=element("img"),this.Tray.iconBuffer=element("img",{className:"copy",src:PATH_IMG_PUBLIC+"ico_copy.png"})},DVBChannels.onShow=function(){MediaPlayer.changeScreenMode(!0)},DVBChannels.Reset=function(refresh){var index=this.DVBList.listIndex;return this.DVBList.Reset(),this.clearEPG(),refresh||(this.loadChannels(),0!==this.DVBList.list.length)?(refresh&&this.DVBList.SetPositionByIndex(index,!0),void this.DVBList.Open({type:MEDIA_TYPE_DVB_ROOT,data:this.DVBList.list,filters:this.DVBList.filters,count:this.DVBList.count})):(setTimeout(function(){new CModalConfirm(DVBChannels,_("No DVB channels"),_("Start auto scan?"),_("Cancel"),function(){},_("Start"),function(){new CModalScanDVB(currCPage)})},5),void this.DVBList.Open({type:MEDIA_TYPE_DVB_ROOT,data:this.DVBList.list}))},DVBChannels.EventHandler=function(event){if(DVBChannels.scanningInProgress&&event.code!==KEYS.EXIT)return event.preventDefault(),!1;if(this.SearchBar.EventHandler(event)!==!0)switch(event.code){case KEYS.OK:if(DVBChannels.goToChFlag){clearTimeout(DVBChannels.timer.goToChannel),DVBChannels.DVBList.goToChannel(parseInt(DVBChannels.TVnumber,10)),DVBChannels.TVnumber="",DVBChannels.goToChFlag=!1,DVBChannels.domChannelNumber.style.display="none",MediaPlayer.domChannelNumber.style.display="none",event.preventDefault();break}case KEYS.PAGE_UP:case KEYS.PAGE_DOWN:case KEYS.UP:case KEYS.DOWN:case KEYS.LEFT:case KEYS.RIGHT:
DVBChannels.DVBList.EventHandler(event);break;case KEYS.EXIT:DVBChannels.actionExit();break;case KEYS.EPG:case KEYS.INFO:DVBChannels.actionInfo();break;case KEYS.BACK:case KEYS.MENU:case KEYS.F1:case KEYS.F3:DVBChannels.BPanel.EventHandler(event);break;case KEYS.PLAY_PAUSE:DVBChannels.actionPlayPause();break;case KEYS.STOP:DVBChannels.DVBList.activeItem.data.type===MEDIA_TYPE_STREAM&&MediaPlayer.end();break;case KEYS.REFRESH:DVBChannels.actionRefresh();break;case KEYS.NUM0:DVBChannels.goToChannel("0");break;case KEYS.NUM1:DVBChannels.goToChannel("1");break;case KEYS.NUM2:DVBChannels.goToChannel("2");break;case KEYS.NUM3:DVBChannels.goToChannel("3");break;case KEYS.NUM4:DVBChannels.goToChannel("4");break;case KEYS.NUM5:DVBChannels.goToChannel("5");break;case KEYS.NUM6:DVBChannels.goToChannel("6");break;case KEYS.NUM7:DVBChannels.goToChannel("7");break;case KEYS.NUM8:DVBChannels.goToChannel("8");break;case KEYS.NUM9:DVBChannels.goToChannel("9");break;default:event.preventDefault()}},DVBChannels.actionExit=function(){var self=this;return this.scanningInProgress?void new CModalConfirm(this,_("Scanning"),_("Stop scanning?"),_("Cancel"),function(){},_("Stop"),function(){var i;for(DVBChannels.scanningInProgress=!1,DVBChannels.domScanInProgress.style.display="none",i=0;i<self.inputs.length;i++)self.inputs[i].stopScan();DVBChannels.Reset(!0)}):DVBChannels.DVBList.path.length>1?void DVBChannels.DVBList.Back():MediaPlayer.end()?FAVORITES_CHANGED?(new CModalConfirm(this,_("The list of favourite records has changed"),_("Save updated list of favourite records?"),_("Exit without saving"),function(){setTimeout(function(){MediaBrowser.FavRestore(),self.actionExit()},5)},_("Save"),function(){setTimeout(function(){MediaBrowser.FavSave(),self.actionExit()},5)}),!1):(clearTimeout(DVBChannels.DVBList.timer.OnFocusPlay),this.DVBList.Clear(),this.DVBList.filters=[],unTune(),void DVBChannels.Show(!1)):!1},DVBChannels.actionRefresh=function(){this.DVBList.prevChannel&&this.DVBList.goToChannel(this.DVBList.prevChannel.channelNumber)},DVBChannels.actionBack=function(){DVBChannels.goToChFlag&&(clearTimeout(DVBChannels.timer.goToChannel),DVBChannels.TVnumber.length>0&&(DVBChannels.TVnumber=DVBChannels.TVnumber.slice(0,DVBChannels.TVnumber.length-1),DVBChannels.domChannelNumber.innerHTML=DVBChannels.TVnumber,MediaPlayer.domChannelNumber.innerHTML=DVBChannels.TVnumber,DVBChannels.TVnumber.length>0?DVBChannels.timer.goToChannel=setTimeout(function(){DVBChannels.DVBList.goToChannel(parseInt(DVBChannels.TVnumber,10)),DVBChannels.TVnumber="",DVBChannels.goToChFlag=!1,DVBChannels.domChannelNumber.style.display="none",MediaPlayer.domChannelNumber.style.display="none"},2e3):(DVBChannels.domChannelNumber.style.display="none",MediaPlayer.domChannelNumber.style.display="none")))},DVBChannels.loadEPGGrid=function(parent){var data,i,list=[],delta=this.DVBList.filterText?1:0;for(data=this.DVBList.nativList.slice(0,this.DVBList.nativList.size),i=0;i<data.length;i++)list.push({id:data[i].id,name:data[i].name?data[i].name:data[i].id,channel_number:data[i].channelNumber});list.length&&(DVBEpg.EPGList.SetList(list),this.DVBList.activeItem&&this.DVBList.activeItem.data&&DVBEpg.EPGList.SetPosition(list[this.DVBList.listIndex-delta]),DVBEpg.Show(!0,parent?parent:this))},DVBChannels.actionInfo=function(){DVBChannels.initEPG()},DVBChannels.actionMenu=function(){this.ModalMenu.Show(!0)},DVBChannels.actionF1=function(){this.DVBList.activeItem.data.type===MEDIA_TYPE_STREAM&&new CModalAddRecord(this,_("Recording channel"),_("Group name")+":",{})},DVBChannels.goToChannel=function(number){clearTimeout(this.timer.goToChannel),this.goToChFlag=!0,this.TVnumber+=number,this.domChannelNumber.innerHTML=this.TVnumber,MediaPlayer.domChannelNumber.innerHTML=this.TVnumber,this.domChannelNumber.style.display="block",MediaPlayer.domChannelNumber.style.display="block";var self=this;this.timer.goToChannel=setTimeout(function(){self.DVBList.goToChannel(parseInt(self.TVnumber,10)),self.TVnumber="",self.goToChFlag=!1,self.domChannelNumber.style.display="none",MediaPlayer.domChannelNumber.style.display="none"},2e3)},DVBChannels.SetPosition=function(index){this.DVBList.SetPositionByIndex(index)},DVBChannels.actionPlayPause=function(){MediaPlayer.playNow?MediaPlayer.playPause():this.DVBList.activeItem.type===MEDIA_TYPE_DVB&&MediaPlayer.preparePlayer(this.DVBList.parentItem.data[this.DVBList.activeItem.data.index],this,!0,!0,!1)},DVBChannels.actionF3add=function(){var self=this;if(!this.BPanel.btnF3add.data.hidden){var items=this.DVBList.ActiveItems();items.length>0&&(items.forEach(function(item){item.data.type!==MEDIA_TYPE_GROUP&&(self.DVBList.SetStar(item,!0),MediaBrowser.FavAdd(item.data.uri,{name:item.data.name,url:item.data.uri,type:item.type,markable:!0}))}),this.BPanel.Hidden(this.BPanel.btnF3add,!0),this.BPanel.Hidden(this.BPanel.btnF3del,!1))}},DVBChannels.actionF3del=function(){var self=this;if(!this.BPanel.btnF3del.data.hidden){var items=this.DVBList.ActiveItems();items.length>0&&(items.forEach(function(item){MediaBrowser.FavRemove(item.data.uri),self.DVBList.SetStar(item,!1)}),this.BPanel.Hidden(this.BPanel.btnF3add,!1),this.BPanel.Hidden(this.BPanel.btnF3del,!0))}},DVBChannels.actionFileDelete=function(data){for(var reset=!1,i=0;i<data.length;i++)stbDvbManager.channelList.remove(data[i].id),this.DVBList.activeItem.data===data&&(reset=!0);return MediaPlayer.end(),this.DVBList.Refresh(),!0},DVBChannels.getListBlock=function(start,amount){var data,i,arr=[];for(data=this.DVBList.nativList.slice(start,amount),i=0;i<data.length;i++)data[i].channel_number=data[i].channelNumber,arr.push({name:data[i].name,channel_number:data[i].channelNumber,type:MEDIA_TYPE_DVB,id:data[i].id,url:data[i].uri});return arr},DVBChannels.loadChannels=function(refresh){var count=0;return this.DVBList.count=count,this.DVBList.createList(),this.DVBList.loadChannels(!1,!0),this.DVBList.list.length>0?this.handle.querySelector(".content").querySelector(".crop").className="crop":this.handle.querySelector(".content").querySelector(".crop").className="crop defImage",!0},DVBChannels.saveLastChannels=function(){for(var last=JSON.stringify(this.lastChannel),now=[],active=this.DVBList.activeItem?this.DVBList.parentItem.data[this.DVBList.activeItem.data.index]:null,i=1;i<this.DVBList.path.length;i++)this.DVBList.path[i].type===MEDIA_TYPE_GROUP?now.push({name:this.DVBList.path[i].name}):now.push({name:this.DVBList.path[i].name,id:this.DVBList.path[i].id});active?active.type===MEDIA_TYPE_GROUP?now.push({name:active.name}):now.push({name:active.name,id:active.id}):now.push(null),echo(now,"TO SAVE POSITION"),now=JSON.stringify(now),now!==last&&gSTB.SaveUserData("dvbtv.last.json",now)},DVBChannels.initEPGNow=function(channel){var data,date,sH,sM,eH,eM,init=!1;return this.DVBList.activeItem.type!==MEDIA_TYPE_DVB?void this.clearEPG():(channel||(channel=this.DVBList.activeItem.data),data=stbEpgManager.getBrief({uri:channel.uri}),data.length?(this.epgNow.id!==channel.id?(this.epgNow.id=channel.id,this.epgNow.now=data,init=!0):this.epgNow.now[0].start!==data[0].start&&(this.epgNow.now=data,init=!0),void(init&&(date=new Date(1e3*data[0].start),sH=date.getHours(),sH=sH>9?sH:"0"+sH,sM=date.getMinutes(),sM=sM>9?sM:"0"+sM,date.setTime(1e3*(data[0].start+data[0].duration)),eH=date.getHours(),eH=eH>9?eH:"0"+eH,eM=date.getMinutes(),eM=eM>9?eM:"0"+eM,this.domEpgNow.innerHTML="<b>"+sH+":"+sM+"-"+eH+":"+eM+"</b> "+data[0].name,data.length>1?(date.setTime(1e3*data[1].start),sH=date.getHours(),sH=sH>9?sH:"0"+sH,sM=date.getMinutes(),sM=sM>9?sM:"0"+sM,date.setTime(1e3*(data[1].start+data[1].duration)),eH=date.getHours(),eH=eH>9?eH:"0"+eH,eM=date.getMinutes(),eM=eM>9?eM:"0"+eM,this.domEpgNext.innerHTML="<b>"+sH+":"+sM+"-"+eH+":"+eM+"</b> "+data.name):this.domEpgNext.innerHTML=""))):void this.clearEPG())},DVBChannels.initEPG=function(){this.DVBList.activeItem.type===MEDIA_TYPE_DVB&&(currCPage===this||currCPage.parent===this)&&new CModalInitEPGInfo(currCPage===MediaPlayer?MediaPlayer:this,this.DVBList.activeItem.data.id)},DVBChannels.clearEPG=function(){this.epgNow={id:null,now:[]},this.domEpgNow.innerHTML="",this.domEpgNext.innerHTML=""},DVBChannels.startScan=function(config,input){input=input?input:0,this.scanTotalFound=0,this.domTitleTotalScanText.innerHTML="0",this.domTitleLastScanText.innerHTML="",MediaPlayer.end(),this.domPercentScan.innerHTML="0%";for(var i=0;i<DVBChannels.inputs.length;i++)DVBChannels.inputs[i].stopScan();window.setTimeout(function(){DVBChannels.inputs[input].startScan(config)},100),this.scanningInProgress=!0,this.domScanInProgress.style.display="block"};var CModalManualScanDVBtext=0;CModalAuth.prototype=Object.create(CModalAlert.prototype),CModalAuth.prototype.constructor=CModalAuth,CModalMount.prototype=Object.create(CModalBox.prototype),CModalMount.prototype.constructor=CModalMount,CModalUnmount.prototype=Object.create(CModalBox.prototype),CModalUnmount.prototype.constructor=CModalUnmount,CModalFormat.prototype=Object.create(CModalBox.prototype),CModalFormat.prototype.constructor=CModalFormat,CModalPlayListOpen.prototype=Object.create(CModalBox.prototype),CModalPlayListOpen.prototype.constructor=CModalPlayListOpen,CModalSubtitleOpen.prototype=Object.create(CModalAlert.prototype),CModalSubtitleOpen.prototype.constructor=CModalSubtitleOpen,CModalCreateGroup.prototype=Object.create(CModalBox.prototype),CModalCreateGroup.prototype.constructor=CModalCreateGroup,CModalAddRecord.prototype=Object.create(CModalBox.prototype),CModalAddRecord.prototype.constructor=CModalAddRecord,CModalChannelEdit.prototype=Object.create(CModalBox.prototype),CModalChannelEdit.prototype.constructor=CModalChannelEdit,CModalChannelExport.prototype=Object.create(CModalBox.prototype),CModalChannelExport.prototype.constructor=CModalChannelExport,CModalChannelsAdd.prototype=Object.create(CModalBox.prototype),CModalChannelsAdd.prototype.constructor=CModalChannelsAdd,CModalImportTVChannels.prototype=Object.create(CModalBox.prototype),CModalImportTVChannels.prototype.constructor=CModalImportTVChannels,CModalScanDVB.prototype=Object.create(CModalBox.prototype),CModalScanDVB.prototype.constructor=CModalScanDVB,CModalManualScanDVB.prototype=Object.create(CModalBox.prototype),CModalManualScanDVB.prototype.constructor=CModalManualScanDVB,CModalInitEPGInfo.prototype=Object.create(CModalBox.prototype),CModalInitEPGInfo.prototype.constructor=CModalInitEPGInfo,CModalEPGInfo.prototype=Object.create(CModalBox.prototype),CModalEPGInfo.prototype.constructor=CModalEPGInfo,EPGList.prototype=Object.create(CScrollList.prototype),EPGList.prototype.constructor=EPGList,EPGList.prototype.SetBreadCrumb=function(component){this.bcrumb=component},EPGList.prototype.SetSearchBar=function(component){this.sbar=component},EPGList.prototype.Add=function(obj,attrs){var date=new Date(1e3*obj.time),h=date.getHours(),m=date.getMinutes();h=h>9?h:"0"+h,m=m>9?m:"0"+m;var body=element("div",{className:"item"},[element("b",{},h+":"+m)," "+obj.name]);attrs.name||(attrs.name=obj.name);var item=CScrollList.prototype.Add.call(this,[body],{star:!1,data:attrs,onclick:function(){return!1},oncontextmenu:EMULATION?null:function(){return!1}});return item},EPGList.prototype.onFocus=function(item){this.parent.domText.innerHTML=this.data[item.data.index].details?this.data[item.data.index].details:this.data[item.data.index].info},EPGList.prototype.Back=function(){},EPGList.prototype.Open=function(data){if(data.type===MEDIA_TYPE_EPG_ROOT){this.Clear();for(var i=0;i<this.data.length;i++){var item=this.Add({name:this.data[i].name,index:i,time:this.data[i].start},{name:this.data[i].name,markable:!1,index:i});(this.parent.epgNow&&this.parent.epgNow.now.length&&0===this.parent.day&&this.data[i].start===this.parent.epgNow.now[0].start||0===i)&&this.Focused(item,!0)}this.isActive&&this.Activate(),echo(this.data[this.activeItem.data.index]),this.parent.domText.innerHTML=this.data[this.activeItem.data.index].details?this.data[this.activeItem.data.index].details:this.data[this.activeItem.data.index].info}},EPGList.prototype.SetPosition=function(data){if(data)for(var item,i=0,l=this.Length();l>i;i++)if(item=this.handleInner.children[i],data.index===item.data.index)return this.Focused(item,!0);return!1},EPGList.prototype.Marked=function(){return!1},EPGList.prototype.ActiveItems=function(){var items=this.states.marked?this.states.marked.slice():[];return 0===items.length&&this.activeItem&&this.activeItem.data.markable&&items.push(this.activeItem),items},CModalAntennaPower.prototype=Object.create(CModalBox.prototype),CModalAntennaPower.prototype.constructor=CModalAntennaPower,CModalStartPlay.prototype=Object.create(CModalBox.prototype),CModalStartPlay.prototype.constructor=CModalStartPlay,CModalAntennaPower.prototype=Object.create(CModalBox.prototype),CModalAntennaPower.prototype.constructor=CModalAntennaPower;var MediaPlayer=new CPage;MediaPlayer.name="CPageMediaPlayer",MediaPlayer.EVENT_START=1,MediaPlayer.EVENT_STOP=2,MediaPlayer.EVENT_PAUSE=3,MediaPlayer.EVENT_PROGRESS=4,MediaPlayer.EVENT_ERROR=5,MediaPlayer.EVENT_OK=6,MediaPlayer.EVENT_EXIT=7,MediaPlayer.TIME_HIDE_HINT=5e3,MediaPlayer.TIME_HIDE_INFO=5e3,MediaPlayer.onInit=function(){var self=this,remoteControlButtonsImagesPath=configuration.newRemoteControl?PATH_IMG_SYSTEM+"buttons/new/":PATH_IMG_SYSTEM+"buttons/old/";MediaPlayer.initPlayer(),this.currentRotation=0,this.subCModal=null,this.countError=0,this.errorTimer=null,this.errorTime=300,this.pos=0,this.posTime="",this.posMod=0,this.posIntervals=[0,10,20],this.curTime=0,this.totalTime=0,this.infoFlag=!0,this.showHls=!1,this.coord={},this.oldSol="",this.sol="auto",this.oldURL="",this.playNow=!1,this.startingPlay=!1,this.posModFlag=!1,this.favorites=!1,this.fullScreen=!0,this.next=!1,this.repeat=!1,this.type=null,this.obj=null,this.timer={},this.interval={},this.dataDVD={},this.slideOn=5,this.list=[],this.subList=[],this.inStandBy=!1,this.forcedSubtitles=null,this.isVideo=!0,this.audioPid=null,this.subtitlesPid=null,this.subscribers={},this.subtitlesData=null,this.subtitlesEncoding=null,this.SubscribersReset(),this.playListShow=!1,this.ts_inProgress=!1,this.ts_on=environment.ts_on,this.ts_endType=environment.ts_endType,this.subtitles_on=environment.subtitles_on,this.aspects=[{name:"fit",mode:16,text:_("Fit on")},{name:"big",mode:64,text:_("Zoom")},{name:"opt",mode:80,text:_("Optimal")},{name:"exp",mode:0,text:_("Stretch")}],this.activeAspect=0,this.initAspect(),this.progress={480:620,576:620,720:1180,1080:1770},this.domPlayerTotalTime=this.handle.querySelector("#playerTotalTime"),this.domPlayerCurrentTime=this.handle.querySelector("#playerCurrentTime"),this.domPlayerBar=this.handle.querySelector("#playerBar"),this.domPlayerTitle=this.handle.querySelector("#playerTitle"),this.domPlayerBufferBar=this.handle.querySelector("#playerBufferBar"),this.domPlayerProgressBar=this.handle.querySelector("#playerProgressBar"),this.domPlayerHeader=this.handle.querySelector("#playerHeader"),this.domPlayerFooter=this.handle.querySelector("#playerFooter"),this.domTSIndicator=this.handle.querySelector("#ts_indicator"),this.domPlayerList=this.handle.querySelector("#playerListBox"),this.domPlayerClock=this.handle.querySelector("#playerClock"),this.domPlayerClockOptional=this.handle.querySelector("#playerClockOptional"),environment.playerClock?this.domPlayerClockOptional.style.display="block":this.domPlayerClockOptional.style.display="none",this.domChannelNumber=this.handle.querySelector(".channelNumber"),this.domHeaderBlue=this.handle.querySelector("#playerHeaderBlue"),this.domAspectBlock=document.querySelector("#mediaHeader_Aspect"),this.domAspectText=this.domAspectBlock.querySelector("span"),this.domSlideContainer=this.handle.querySelector("#slideContainer"),configuration.newRemoteControl&&(this.handle.classList.contains("new-remote-control")||this.handle.classList.add("new-remote-control"),this.handle.querySelector("#playerHeaderExit").style.backgroundImage="url("+remoteControlButtonsImagesPath+"exit.png)",this.handle.querySelector("#playerHideplayer").style.backgroundImage="url("+remoteControlButtonsImagesPath+"info.png)",this.handle.querySelector("#playerHeaderSetting").style.backgroundImage="url("+remoteControlButtonsImagesPath+"menu.png)",this.handle.querySelector("#playerHeaderExit").innerHTML=_("Exit")),this.handle.querySelector("#playerHideplist").innerHTML=_("Show<br />playlist"),this.handle.querySelector("#playerHeaderSetting").innerHTML=_("Settings"),this.handle.querySelector("#playerHideplayer").innerHTML=_("Hide<br />player"),this.domHeaderBlue.innerHTML=_("Add to<br>favorites"),this.handle.querySelector("#playlistPrev").innerHTML=_("Previous<br />media"),this.handle.querySelector("#playlistNext").innerHTML=_("Next<br />media"),this.init=[],this.init[MEDIA_TYPE_VIDEO]=function(refresh){self.domPlayerTotalTime.innerHTML="00:00:00",self.domPlayerCurrentTime.innerHTML="00:00:00",self.domPlayerBufferBar.style.width="0px",self.domPlayerProgressBar.style.width="0px",refresh||(self.domPlayerBar.style.display="block",self.domPlayerCurrentTime.style.display="block",self.domPlayerBufferBar.style.display="none",self.domPlayerProgressBar.style.display="block",self.handle.querySelector("#playerPause").style.display="block",self.handle.querySelector("#playerREW").style.display="block",self.handle.querySelector("#playerFFWD").style.display="block",self.handle.querySelector("#playerTotalTime").style.display="block",self.handle.querySelector("#playerCurrentTime").style.display="block",self.handle.querySelector("#playerSlash").style.display="block"),self.curTime=0,self.totalTime=0,self.posIntervals=[0,10,20]},this.init[MEDIA_TYPE_RECORDS_ITEM]=this.init[MEDIA_TYPE_VIDEO],this.init[MEDIA_TYPE_AUDIO]=function(refresh){self.init[MEDIA_TYPE_VIDEO](refresh),self.domSlideContainer.style.display="block"},this.init[MEDIA_TYPE_CUE_ITEM]=this.init[MEDIA_TYPE_VIDEO],this.init[MEDIA_TYPE_STREAM]=function(refresh){refresh||(self.domPlayerBar.style.display="none",self.domPlayerCurrentTime.style.display="none",self.domPlayerBufferBar.style.display="none",self.domPlayerProgressBar.style.display="none",self.handle.querySelector("#playerHideplist").style.display="none",self.handle.querySelector("#playerPause").style.display="none",self.handle.querySelector("#playerREW").style.display="none",self.handle.querySelector("#playerFFWD").style.display="none",self.handle.querySelector("#playerTotalTime").style.display="none",self.handle.querySelector("#playerCurrentTime").style.display="none",self.handle.querySelector("#playerSlash").style.display="none")},this.init[MEDIA_TYPE_DVB]=function(refresh){self.init[MEDIA_TYPE_STREAM](refresh)},this.init[MEDIA_TYPE_STREAM_TS]=function(refresh){refresh||(self.init[MEDIA_TYPE_VIDEO](),self.domPlayerBufferBar.style.display="block",2===self.ts_endType?timeShift.SetSlidingMode(!1):timeShift.SetSlidingMode(!0));var curTime=self.parseTime(environment.ts_time);self.domPlayerTotalTime.innerHTML=curTime.hour+":"+curTime.min+":"+curTime.sec},this.init[MEDIA_TYPE_IMAGE]=function(){self.domPlayerBar.style.display="none",self.domPlayerCurrentTime.style.display="none",self.domPlayerBufferBar.style.display="none",self.domPlayerProgressBar.style.display="none",self.handle.querySelector("#playerPause").style.display="none",self.handle.querySelector("#playerREW").style.display="none",self.handle.querySelector("#playerFFWD").style.display="none",self.handle.querySelector("#playerTotalTime").style.display="none",self.handle.querySelector("#playerCurrentTime").style.display="none",self.handle.querySelector("#playerSlash").style.display="none"},this.init[MEDIA_TYPE_ISO]=function(refresh){refresh||self.init[MEDIA_TYPE_VIDEO]()},this.getTeletextDefaultCharset=function(lang){switch(environment.language){case"en":return 0;case"de":return 9;case"sv":case"fi":case"hu":return 10;case"it":return 11;case"fr":return 76;case"pt":case"es":return 21;case"cs":case"sk":return 14;case"pl":return 8;case"tr":return 22;case"sr":case"hr":case"sl":return 29;case"ro":return 31;case"et":return 34;case"lv":case"lt":return 35;case"ru":case"bg":return 36;case"uk":return 37;case"el":return 55;case"ar":return 135;default:return"auto"}},this.PlayList=new PlayList(this),this.PlayList.Init(this.handle.querySelector("#playerList")),stbEvent.onEvent=this.event,this.onShow=function(){var items=self.PlayList.handle.children||[],value=null;if(this.parent===IPTVChannels)for(var i=0;i<items.length;i++)value=self.list[self.PlayList.handle.children[i].data.index],self.PlayList.SetStar(self.PlayList.handle.children[i],FAVORITES_NEW[(value.sol?value.sol+" ":"")+value.url]);else for(var i=0;i<items.length;i++)self.PlayList.SetStar(self.PlayList.handle.children[i],FAVORITES_NEW[self.PlayList.handle.children[i].data.url]);self.PlayList.activeItem&&self.PlayList.activeItem.stared?self.domHeaderBlue.innerHTML=_("Remove from<br>favorites"):self.domHeaderBlue.innerHTML=_("Add to<br>favorites")},this.ModalMenu=new CModal(this),this.ModalMenu.Menu=new CGroupMenu(this.ModalMenu),this.ModalMenu.Menu.Init(this.handle.querySelector("div.cgmenu-main")),this.ModalMenu.onShow=function(){this.Menu.Activate()},this.ModalMenu.Init(element("div",{className:"cmodal-menu"},this.ModalMenu.Menu.handle)),this.ModalMenu.handle.onclick=function(){self.ModalMenu.Show(!1)},this.ModalMenu.EventHandler=function(event){switch(event.code){case KEYS.EXIT:case KEYS.MENU:self.ModalMenu.Show(!1);break;default:self.ModalMenu.Menu.EventHandler(event)}},this.ModalMenu.Menu.gaudio=this.ModalMenu.Menu.AddGroup("gaudio",_("Audio tracks"),{onclick:function(){return(self.ModalMenu.Menu.gaudio.slist.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),self.ModalMenu.Menu.gaudio.slist.Marked(this,!0),self.ModalMenu.Show(!1),self.audioPid=this.data,gSTB.SetAudioPID(this.data),clearTimeout(self.timer.audio),self.handle.querySelector("#audioType").src=PATH_IMG_PUBLIC+"codec/"+this.type+".png",self.handle.querySelector("#audioText").innerHTML=this.innerHTML,self.handle.querySelector("#cright").style.display="block",self.timer.audio=setTimeout(function(){MediaPlayer.handle.querySelector("#cright").style.display="none"},self.TIME_HIDE_HINT),!1}}),this.ModalMenu.Menu.gsubtitle=this.ModalMenu.Menu.AddGroup("gsubtitle",_("Subtitles"),{onclick:function(){switch(this.data.type){case 1:(self.ModalMenu.Menu.gsubtitle.slist.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),self.subtitles_on=!1,self.subtitlesPid=null,self.ModalMenu.Menu.gsubtitle.slist.Marked(this,!0),"OFF"===this.data.value&&gSTB.SetSubtitles(!1);break;case 2:self.subtitlesPid=this.data.value,gSTB.SetSubtitlePID(this.data.value),self.subtitles_on=!0,gSTB.SetSubtitles(!0),self.ModalMenu.Menu.gsubtitle.slist.Marked(this,!0),self.showSubtitleHint(this.data);break;case 3:self.ModalMenu.Show(!1),self.subtitles_on=!0;var item=this;return self.openSubtitle(self.subList[this.data.index],function(){self.ModalMenu.Menu.gsubtitle.slist.Marked(item,!0)}),!1}return self.ModalMenu.Show(!1),!1}}),this.ModalMenu.Menu.gsubtitle.slist.multipleSelection=!1,this.ModalMenu.Menu.gts=this.ModalMenu.Menu.AddGroup("gts",_("TimeShift"),{onclick:function(){return self.ModalMenu.Show(!1),this.data!==self.ts_on&&(self.ts_on=this.data,(self.ModalMenu.Menu.gts.slist.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),self.ModalMenu.Menu.gts.slist.Marked(this,!0),self.ts_on?self.ts_inProgress||self.type!==MEDIA_TYPE_STREAM||(self.checkUsb(environment.ts_path)?"extTimeShift"!==self.sol&&self.play():"true"===environment.mount_media_ro?new CModalAlert(currCPage,_("Warning!"),_('"Storage read only access mode" is enabled in System Settings'),_("Close")):new CModalConfirm(currCPage,_("Error"),_('No storage device selected as the "File location" in TimeShift settings. Disable TimeShift?'),_("No"),function(){},_("Yes"),function(){MediaPlayer.tsOnOff(!1)})):self.ts_inProgress&&self.tsExitCheck("stop")),!1}}),this.ModalMenu.Menu.gts.ion=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gts,MEDIA_ACTION_TS_ON,_("Enabled"),{data:!0}),this.ModalMenu.Menu.gts.ioff=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gts,MEDIA_ACTION_TS_OFF,_("Disabled"),{data:!1}),this.ModalMenu.Menu.gtsend=this.ModalMenu.Menu.AddGroup("gtsend",_("TimeShift buffer"),{onclick:function(){return this.data!==self.ts_endType&&(self.ts_endType=this.data,(self.ModalMenu.Menu.gtsend.slist.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),self.ModalMenu.Menu.gtsend.slist.Marked(this,!0),1===self.ts_endType?timeShift.SetSlidingMode(!0):timeShift.SetSlidingMode(!1)),self.ModalMenu.Show(!1),!1}}),this.ModalMenu.Menu.gtsend.iciclick=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gtsend,MEDIA_ACTION_TSEND_CICLICK,_("Cyclic recording mode"),{data:1}),this.ModalMenu.Menu.gtsend.istop=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gtsend,MEDIA_ACTION_TSEND_STOP,_("Stop when out of space"),{data:2}),this.ModalMenu.Menu.gepg=this.ModalMenu.Menu.AddGroup("gepg",_("EPG"),{onclick:function(){switch(self.ModalMenu.Show(!1),this.iid){case MEDIA_ACTION_DVB_EPG:"function"==typeof self.parent.initEPG&&self.parent.initEPG();break;case MEDIA_ACTION_DVB_EPG_GRID:"function"==typeof self.parent.loadEPGGrid&&self.parent.loadEPGGrid(self)}}}),this.ModalMenu.Menu.gepg.epg=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gepg,MEDIA_ACTION_DVB_EPG,_("EPG")),this.ModalMenu.Menu.gepg.gepggrid=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gepg,MEDIA_ACTION_DVB_EPG_GRID,_("EPG grid ")),this.ModalMenu.Menu.g3d=this.ModalMenu.Menu.AddGroup("g3d",_("3D mode"),{onclick:function(){return(self.ModalMenu.Menu.g3d.slist.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),self.ModalMenu.Menu.g3d.slist.Marked(this,!0),self.ModalMenu.Show(!1),gSTB.Set3DConversionMode(this.data),!1}}),this.ModalMenu.Menu.g3d.i1=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.g3d,1,_("Mode")+" 1",{data:0}),this.ModalMenu.Menu.g3d.i2=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.g3d,2,_("Mode")+" 2",{data:1}),this.ModalMenu.Menu.g3d.i3=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.g3d,3,_("Mode")+" 3",{data:2}),this.ModalMenu.Menu.g3d.i4=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.g3d,4,_("Mode")+" 4",{data:3}),this.ModalMenu.Menu.gslideOn=this.ModalMenu.Menu.AddGroup("gslideOn",_("Slide-show"),{onclick:function(){return(self.ModalMenu.Menu.gslideOn.slist.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),self.ModalMenu.Menu.gslideOn.slist.Marked(this,!0),self.ModalMenu.Show(!1),self.slideOn=this.data,clearTimeout(self.timer.slideShow),self.timer.slideShow=null,self.slideOn>0&&(self.timer.slideShow=setTimeout(function(){self.list.length>1&&self.fullScreen&&self.PlayList.playIndex+1<self.list.length&&(self.PlayList.playIndex++,(self.PlayList.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),self.PlayList.Marked(self.PlayList.handle.children[self.PlayList.playIndex],!0),self.prepare(self.list[self.PlayList.handle.children[self.PlayList.playIndex].data.index],!0,!0))},1e3*self.slideOn)),!1}}),this.ModalMenu.Menu.gslideOn.ioff=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gslideOn,1,_("Disabled"),{data:0}),this.ModalMenu.Menu.gslideOn.i3=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gslideOn,2,"3 "+_("sec."),{data:3}),this.ModalMenu.Menu.gslideOn.i5=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gslideOn,2,"5 "+_("sec."),{data:5,marked:!0}),this.ModalMenu.Menu.gslideOn.i10=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gslideOn,2,"10 "+_("sec."),{data:10}),this.ModalMenu.Menu.gslideOn.i20=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gslideOn,2,"20 "+_("sec."),{data:20}),this.ModalMenu.Menu.gslideOn.i30=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gslideOn,2,"30 "+_("sec."),{data:30}),this.ModalMenu.Menu.grotate=this.ModalMenu.Menu.AddGroup("grotate",_("Rotate"),{onclick:function(){return(self.ModalMenu.Menu.grotate.slist.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),self.ModalMenu.Menu.grotate.slist.Marked(this,!0),self.ModalMenu.Show(!1),MediaPlayer.actionRotate(this.data),!1}}),this.ModalMenu.Menu.grotate.iright=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.grotate,1,_("Left"),{data:-90,icon:remoteControlButtonsImagesPath+"f1.png"}),this.ModalMenu.Menu.grotate.ileft=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.grotate,2,_("Right"),{data:90,icon:remoteControlButtonsImagesPath+"f4.png"}),this.ModalMenu.Menu.gplay=this.ModalMenu.Menu.AddGroup("gplay",_("Play"),{onclick:function(){switch(this.data){case 1:(self.ModalMenu.Menu.gplay.slist.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),self.ModalMenu.Menu.gplay.slist.Marked(this,!0),self.next=!1,self.repeat=!1;break;case 2:(self.ModalMenu.Menu.gplay.slist.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),self.ModalMenu.Menu.gplay.slist.Marked(this,!0),self.next=!0,self.repeat=!1;break;case 3:self.mixList();break;case 4:(self.ModalMenu.Menu.gplay.slist.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),self.ModalMenu.Menu.gplay.slist.Marked(this,!0),self.next=!1,self.repeat=!0;break;case 5:(self.ModalMenu.Menu.gplay.slist.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),self.ModalMenu.Menu.gplay.slist.Marked(this,!0),self.next=!0,self.repeat=!0}return self.ModalMenu.Show(!1),!1}}),this.ModalMenu.Menu.gplay.ione=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gplay,1,_("One file once"),{data:1}),this.ModalMenu.Menu.gplay.ilist=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gplay,2,_("Each file once"),{data:2}),this.ModalMenu.Menu.gplay.ioner=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gplay,1,_("Repeat file"),{data:4}),this.ModalMenu.Menu.gplay.ilistr=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gplay,2,_("Repeat everything"),{data:5}),this.ModalMenu.Menu.gplay.imix=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gplay,2,_("Playlist shuffle"),{data:3}),gSTB.SetTeletext("on"===environment.teletext_on),""===environment.teletext_charset||"auto"===environment.teletext_charset||"disabled"===environment.teletext_charset?gSTB.ForceTtxCharset(0,!0):gSTB.ForceTtxCharset(+environment.teletext_charset,!1),this.ModalMenu.Menu.gTeletext=this.ModalMenu.Menu.AddGroup("gTeletext",_("Teletext"),{onclick:function(){var viewport={top:0,left:0,width:0,height:0};switch(this.data.type){case 2:if((self.ModalMenu.Menu.gTeletext.slist.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),echo(this.data.value,"SetTeletextPID"),gSTB.SetTeletextPID(this.data.value),gSTB.TeletextTransparency(environment.teletext_opacity),self.ModalMenu.Menu.gTeletext.editModal)switch(self.ModalMenu.Menu.gTeletext.editModal.elements[0].SelectById(environment.teletext_charset),VIDEO_MODE){case"480i":case"480p":case"576i":case"576p":self.ModalMenu.Menu.gTeletext.editModal.elements[1].SelectById(environment.teletext_ratio);break;default:self.ModalMenu.Menu.gTeletext.editModal.elements[1].SelectById(environment.teletext_ratio),self.ModalMenu.Menu.gTeletext.editModal.elements[2].SelectById(environment.teletext_opacity)}switch(VIDEO_MODE){case"480i":case"480p":viewport.top=24,viewport.height=432,viewport.left=47,viewport.width=640;break;case"576i":case"576p":viewport.top=24,viewport.height=528,viewport.left=55,viewport.width=636;break;case"720p":case"720p60":viewport.top=30,viewport.height=670,"0"===environment.teletext_ratio?(viewport.left=193,viewport.width=894):(viewport.left=40,viewport.width=1200);break;case"1080i":case"1080i60":case"1080p":case"1080p60":viewport.top=40,viewport.height=1e3,"0"===environment.teletext_ratio?(viewport.left=273,viewport.width=1374):(viewport.left=50,viewport.width=1820)}echo(viewport,"SetTeletextViewport"),gSTB.SetTeletextViewport(viewport.width,viewport.height,viewport.left,viewport.top),gSTB.TeletextShow(!0),MediaPlayer.showInfo(!1),self.ModalMenu.Menu.gTeletext.lastParams={viewport:viewport,opacity:environment.teletext_opacity,pid:this.data.value},self.ModalMenu.Menu.gTeletext.mediaHandler=MediaPlayer.EventHandler,
MediaPlayer.EventHandler=self.ModalMenu.Menu.gTeletext.teletextHandler}return self.ModalMenu.Show(!1),!1}}),this.ModalMenu.Menu.gTeletext.slist.multipleSelection=!1,this.ModalMenu.Menu.gTeletext.showEditModal=function(){var table,tRow,i,size,elem,self=this,arr=[];if(this.editModal)this.editModal.activeElementIndex=0,this.editModal.Show(!0),this.editModal.elements[self.editModal.activeElementIndex].handle.focus(),this.editModal.elements[self.editModal.activeElementIndex].SelectById(gSTB.GetForceTtxCharset());else{for(table=element("table"),this.editModal=new CModalBox(MediaPlayer),this.editModal.SetHeader(_("Current channel teletext settings")),this.editModal.bpanel=new CButtonPanel,this.editModal.bpanel.Init(MODAL_IMG_PATH),this.editModal.bpanel.Add(KEYS.EXIT,"exit.png",_("Close"),function(){self.editModal.Show(!1)}),this.editModal.bpanel.Add(KEYS.OK,"ok.png",_("Ok"),function(){var ratio,charset=self.editModal.elements[0].GetValue(),viewport={top:0,left:0,width:0,height:0};switch(gSTB.ForceTtxCharset("auto"===charset?0:+charset,"auto"===charset),MediaPlayer.ModalMenu.Menu.gTeletext.lastParams={viewport:null,opacity:null,pid:MediaPlayer.ModalMenu.Menu.gTeletext.lastParams.pid,charset:charset},VIDEO_MODE){case"720p":case"720p60":ratio=self.editModal.elements[1].GetValue(),viewport.top=30,viewport.height=670,"0"===ratio?(viewport.left=193,viewport.width=894):(viewport.left=40,viewport.width=1200),gSTB.SetTeletextViewport(viewport.width,viewport.height,viewport.left,viewport.top),gSTB.TeletextTransparency(self.editModal.elements[2].GetValue()),MediaPlayer.ModalMenu.Menu.gTeletext.lastParams.opacity=self.editModal.elements[2].GetValue();break;case"1080i":case"1080i60":case"1080p":case"1080p60":ratio=self.editModal.elements[1].GetValue(),viewport.top=40,viewport.height=1e3,"0"===ratio?(viewport.left=273,viewport.width=1374):(viewport.left=50,viewport.width=1820),gSTB.SetTeletextViewport(viewport.width,viewport.height,viewport.left,viewport.top),gSTB.TeletextTransparency(self.editModal.elements[2].GetValue()),MediaPlayer.ModalMenu.Menu.gTeletext.lastParams.opacity=self.editModal.elements[2].GetValue();break;default:gSTB.TeletextTransparency(self.editModal.elements[1].GetValue()),MediaPlayer.ModalMenu.Menu.gTeletext.lastParams.opacity=self.editModal.elements[1].GetValue()}MediaPlayer.ModalMenu.Menu.gTeletext.lastParams.viewport=viewport,self.editModal.Show(!1)}),arr.push({title:_("Force charset"),option:[{value:"auto",title:_("Auto")},{value:0,title:"English"},{value:5,title:"Portuguese/Spanish"},{value:8,title:"Polish"},{value:9,title:"German"},{value:10,title:"Swedish/Finnish/Hungarian"},{value:11,title:"Italian"},{value:12,title:"French"},{value:14,title:"Czech/Slovak"},{value:22,title:"Turkish"},{value:29,title:"Serbian/Croatian/Slovenian"},{value:31,title:"Rumanian"},{value:32,title:"Serbian/Croatian"},{value:34,title:"Estonian"},{value:35,title:"Lettish/Lithuanian"},{value:36,title:"Russian/Bulgarian"},{value:37,title:"Ukrainian"},{value:55,title:"Greek"},{value:128,title:"English/Arabic"},{value:132,title:"French/Arabic"},{value:135,title:"Arabic"},{value:149,title:"Hebrew/Arabic"},{value:151,title:"Arabic"}],selected:gSTB.GetForceTtxCharset()}),WINDOW_HEIGHT>=720&&arr.push({title:_("Aspect Ratio"),option:[{title:"4:3",value:"0"},{title:"16:9",value:"1"}],selected:environment.teletext_ratio}),arr.push({title:_("Opacity level"),option:[{value:"0",title:"0"},{value:"25",title:"10"},{value:"50",title:"20"},{value:"75",title:"30"},{value:"100",title:"40"},{value:"125",title:"50"},{value:"150",title:"60"},{value:"175",title:"70"},{value:"200",title:"80"},{value:"225",title:"90"},{value:"255",title:"100"}],selected:environment.teletext_opacity}),this.editModal.elements=[],i=0,size=arr.length;size>i;++i)elem=element("td"),tRow=element("tr"),tRow.appendChild(element("td",{innerHTML:arr[i].title})),tRow.appendChild(elem),self.editModal.elements[i]=new CSelectBox(MediaBrowser,{parent:elem,data:arr[i].option,idField:arr[i].idField?arr[i].idField:"value",nameField:arr[i].nameField?arr[i].nameField:"title",selectedId:arr[i].selected}),elchild(table,tRow);elchild(this.editModal.content,table),this.editModal.Init(),this.editModal.handleInner.classList.add("teletextSettings"),this.editModal.EventHandler=function(event){self.editModal.elements[self.editModal.activeElementIndex].EventHandler(event),self.editModal.elements[self.editModal.activeElementIndex].dropdown.isVisible||(event.code===KEYS.DOWN?(++self.editModal.activeElementIndex,self.editModal.activeElementIndex>=arr.length&&(self.editModal.activeElementIndex=0),echo(self.editModal.activeElementIndex,"self.editModal.activeElementIndex"),self.editModal.elements[self.editModal.activeElementIndex].handle.focus()):event.code===KEYS.UP&&(--self.editModal.activeElementIndex,self.editModal.activeElementIndex<0&&(self.editModal.activeElementIndex=2),echo(self.editModal.activeElementIndex,"self.editModal.activeElementIndex"),self.editModal.elements[self.editModal.activeElementIndex].handle.focus()),self.editModal.bpanel.EventHandler(event))},this.editModal.Show(!0),this.editModal.SetFooter(this.editModal.bpanel.handle),this.editModal.activeElementIndex=0,this.editModal.elements[0].Show(!0,!0)}},this.ModalMenu.Menu.gTeletext.teletextHandler=function(event){switch(event.code){case KEYS.NUM0:event.teletextCode=0;break;case KEYS.NUM1:event.teletextCode=1;break;case KEYS.NUM2:event.teletextCode=2;break;case KEYS.NUM3:event.teletextCode=3;break;case KEYS.NUM4:event.teletextCode=4;break;case KEYS.NUM5:event.teletextCode=5;break;case KEYS.NUM6:event.teletextCode=6;break;case KEYS.NUM7:event.teletextCode=7;break;case KEYS.NUM8:event.teletextCode=8;break;case KEYS.NUM9:event.teletextCode=9;break;case KEYS.UP:event.teletextCode=10;break;case KEYS.DOWN:event.teletextCode=11;break;case KEYS.RIGHT:event.teletextCode=12;break;case KEYS.LEFT:event.teletextCode=13;break;case KEYS.F1:event.teletextCode=14;break;case KEYS.F3:event.teletextCode=15;break;case KEYS.F4:event.teletextCode=16;break;case KEYS.F2:event.teletextCode=17;break;case KEYS.EXIT:gSTB.TeletextShow(!1),""===environment.teletext_charset||"auto"===environment.teletext_charset||"disabled"===environment.teletext_charset?gSTB.ForceTtxCharset(0,!0):gSTB.ForceTtxCharset(+environment.teletext_charset,!1),MediaPlayer.EventHandler=MediaPlayer.ModalMenu.Menu.gTeletext.mediaHandler;break;case KEYS.MENU:MediaPlayer.ModalMenu.Menu.gTeletext.showEditModal()}void 0!==event.teletextCode&&(echo(event.teletextCode,"TeletextCommand"),gSTB.TeletextCommand(event.teletextCode))},this.modalInit={},this.modalInit[MEDIA_TYPE_STREAM]=function(){self.ModalMenu.Menu.Hidden(self.ModalMenu.Menu.gaudio,!1),self.ModalMenu.Menu.Hidden(self.ModalMenu.Menu.gsubtitle,!1),"function"==typeof self.parent.initEPG&&self.ModalMenu.Menu.Hidden(self.ModalMenu.Menu.gepg,!1),configuration.mayTimeShift&&(self.ModalMenu.Menu.Hidden(self.ModalMenu.Menu.gts,!1),self.ModalMenu.Menu.Hidden(self.ModalMenu.Menu.gtsend,!1),self.ts_on?(self.ModalMenu.Menu.gts.slist.Marked(self.ModalMenu.Menu.gts.ion,!0),self.ModalMenu.Menu.gts.slist.Marked(self.ModalMenu.Menu.gts.ioff,!1)):(self.ModalMenu.Menu.gts.slist.Marked(self.ModalMenu.Menu.gts.ion,!1),self.ModalMenu.Menu.gts.slist.Marked(self.ModalMenu.Menu.gts.ioff,!0)),2===self.ts_endType?(self.ModalMenu.Menu.gtsend.slist.Marked(self.ModalMenu.Menu.gtsend.istop,!0),self.ModalMenu.Menu.gtsend.slist.Marked(self.ModalMenu.Menu.gtsend.iciclick,!1)):(self.ModalMenu.Menu.gtsend.slist.Marked(self.ModalMenu.Menu.gtsend.iciclick,!0),self.ModalMenu.Menu.gtsend.slist.Marked(self.ModalMenu.Menu.gtsend.istop,!1))),echo(environment.teletext_on,"environment.teletext_on"),self.ModalMenu.Menu.Hidden(self.ModalMenu.Menu.gTeletext,"on"===environment.teletext_on?!1:!0),self.ModalMenu.isVisible||self.ModalMenu.Menu.Switch(self.ModalMenu.Menu.gaudio)},this.modalInit[MEDIA_TYPE_DVB]=function(){dvbManager.GetAntennaPower();self.ModalMenu.Menu.Hidden(self.ModalMenu.Menu.gaudio,!1),self.ModalMenu.Menu.Hidden(self.ModalMenu.Menu.gsubtitle,!1),"function"==typeof self.parent.initEPG&&self.ModalMenu.Menu.Hidden(self.ModalMenu.Menu.gepg,!1),echo(environment.teletext_on,"environment.teletext_on"),self.ModalMenu.Menu.Hidden(self.ModalMenu.Menu.gTeletext,"on"===environment.teletext_on?!1:!0)},this.modalInit[MEDIA_TYPE_STREAM_TS]=this.modalInit[MEDIA_TYPE_STREAM],this.modalInit[MEDIA_TYPE_ISO]=function(){self.modalInit[MEDIA_TYPE_VIDEO]()},this.modalInit[MEDIA_TYPE_IMAGE]=function(){self.ModalMenu.Menu.Hidden(self.ModalMenu.Menu.gslideOn,!1),self.ModalMenu.Menu.Hidden(self.ModalMenu.Menu.grotate,!1),self.ModalMenu.Menu.Switch(self.ModalMenu.Menu.gslideOn)},this.modalInit[MEDIA_TYPE_AUDIO]=function(){self.ModalMenu.Menu.Hidden(self.ModalMenu.Menu.gplay,!1),(self.ModalMenu.Menu.gplay.slist.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),self.next?self.ModalMenu.Menu.gplay.slist.Marked(self.ModalMenu.Menu.gplay.ilist,!0):self.ModalMenu.Menu.gplay.slist.Marked(self.ModalMenu.Menu.gplay.ione,!0),self.ModalMenu.Menu.Switch(self.ModalMenu.Menu.gplay)},this.modalInit[MEDIA_TYPE_CUE_ITEM]=this.modalInit[MEDIA_TYPE_AUDIO],this.modalInit[MEDIA_TYPE_VIDEO]=function(){self.ModalMenu.Menu.Hidden(self.ModalMenu.Menu.gaudio,!1),self.ModalMenu.Menu.Hidden(self.ModalMenu.Menu.gsubtitle,!1),self.ModalMenu.Menu.Hidden(self.ModalMenu.Menu.g3d,!1),echo(environment.teletext_on,"environment.teletext_on"),self.ModalMenu.Menu.Hidden(self.ModalMenu.Menu.gTeletext,"on"===environment.teletext_on?!1:!0),(self.ModalMenu.Menu.g3d.slist.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),self.ModalMenu.Menu.Hidden(self.ModalMenu.Menu.gplay,!1),(self.ModalMenu.Menu.gplay.slist.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),self.next?self.ModalMenu.Menu.gplay.slist.Marked(self.ModalMenu.Menu.gplay.ilist,!0):self.ModalMenu.Menu.gplay.slist.Marked(self.ModalMenu.Menu.gplay.ione,!0),self.ModalMenu.Menu.g3d.slist.Marked(self.ModalMenu.Menu.g3d.i1,!0),self.ModalMenu.Menu.Switch(self.ModalMenu.Menu.gaudio)},this.modalInit[MEDIA_TYPE_RECORDS_ITEM]=this.modalInit[MEDIA_TYPE_VIDEO],this.ModalMenu.Menu.Switch(this.ModalMenu.Menu.gaudio),this.askedWindow=null,stbEvent.bind("player.play",function(message){var item={name:decodeURIComponent(message.data).split("/").pop(),url:message.data,type:getMediaType(message.data)};currCPage instanceof CModal&&currCPage.Show(!1),MediaPlayer.preparePlayer(item,currCPage,!0,!0,!0,!1),MediaPlayer.askedWindow=message.from,setTimeout(function(){stbWindowMgr.windowShow(stbWebWindow.windowId())},1e3)})},MediaPlayer.applyCAS=function(config){if(config){if(config.VM_IPTV_ENABLED){if(gSTB.SetCASParam(config.VM_IPTV_BOOT_HOST,config.VM_IPTV_BOOT_PORT,"",-1,-1),config.VM_IPTV_CAS_PARAM)for(var name in config.VM_IPTV_CAS_PARAM)config.VM_IPTV_CAS_PARAM.hasOwnProperty(name)&&gSTB.SetAdditionalCasParam(name,config.VM_IPTV_CAS_PARAM[name]);gSTB.SetCASType(1)}config.VM_OTT_ENABLED&&(gSTB.SetupWebCAS(config.VM_OTT_BOOT_SERVER,config.VM_OTT_COMPANY||""),gSTB.SetWebCASLogging(config.VM_OTT_LOG_ENABLED))}},MediaPlayer.initPlayer=function(){for(var defLang="",i=0;i<iso639.length;i++){for(var j=0;j<iso639[i].code.length;j++)if(iso639[i].code[j]===environment.language){defLang=iso639[i].code[0];break}if(""!==defLang)break}if(gSTB.InitPlayer(),configuration.maySecureM3u&&(gSTB.SetPlayerOption("HlsFastStart","1"),gSTB.SetPlayerOption("HlsStartQuality","1")),gSTB.SetAspect(16),gSTB.SetVideoControl(0),gSTB.SetVideoState(0),gSTB.SetTopWin(0),gSTB.SetMode(0),gSTB.SetWinAlphaLevel(0,255),gSTB.SetWinAlphaLevel(1,255),gSTB.SetDRC(255,255),gSTB.SetPIG(1,0,0,0),gSTB.SetAudioLangs(""===environment.lang_audiotracks?"":iso639[environment.lang_audiotracks].code[0],defLang),gSTB.SetSubtitleLangs(""===environment.lang_subtitles||-1===environment.lang_subtitles?"":iso639[environment.lang_subtitles].code[0],defLang),gSTB.SetSubtitlesFont("/usr/lib/fonts/Ubuntu.ttf"),this.dvbPowerManualOn=!1,environment.subtitlesColor&&gSTB.SetSubtitlesColor(environment.subtitlesColor),environment.subtitlesSize&&gSTB.SetSubtitlesSize(environment.subtitlesSize),!configuration.mayDVB||"DVB-T"!==environment.dvb_type&&"DVB-T2"!==environment.dvb_type||dvbManager.SetAntennaPower(!0,0),timeShift.SetMaxDuration(environment.ts_time),timeShift.SetTimeShiftFolder(environment.ts_path+"/records"),"576i"===VIDEO_MODE&&gSTB.SetFlicker(1,0,0),configuration.maySecureM3u)try{PLSCFG=JSON.parse(gSTB.LoadUserData("plscfg.json")||"{}"),MediaPlayer.applyCAS(PLSCFG)}catch(e){echo(e,"PLSCFG no data"),PLSCFG={}}},MediaPlayer.EventHandler=function(e){switch(e.code){case KEYS.UP:case KEYS.DOWN:MediaPlayer.playListShow&&MediaPlayer.infoFlag?MediaPlayer.PlayList.EventHandler(e):e.code===KEYS.DOWN?MediaPlayer.channelNext(e):MediaPlayer.channelPrev(e);break;case KEYS.PAGE_DOWN:MediaPlayer.nextMedia(e),e.preventDefault();break;case KEYS.PAGE_UP:MediaPlayer.prevMedia(e),e.preventDefault();break;case KEYS.OK:if(e.preventDefault(),MediaPlayer.posModFlag){clearTimeout(this.timer.setPos),echo(MediaPlayer.pos,"set pos:"),gSTB.SetPosTime(MediaPlayer.pos),MediaPlayer.curTime=MediaPlayer.pos,MediaPlayer.pos=0,MediaPlayer.posTime="",MediaPlayer.posMod=0,MediaPlayer.domPlayerCurrentTime.className="time_cur",gSTB.IsPlaying()||gSTB.Continue(),MediaPlayer.posModFlag=!1,MediaPlayer.timer.showInfo=setTimeout(function(){MediaPlayer.showInfo(!1)},5),MediaPlayer.obj.type===MEDIA_TYPE_ISO&&MediaPlayer.checkISOChapter();break}if(MediaPlayer.playListShow&&MediaPlayer.infoFlag){MediaPlayer.PlayList.EventHandler(e);break}switch(MediaPlayer.subscribers[MediaPlayer.EVENT_OK].forEach(function(subscriber){subscriber.subscribeEvents[MediaPlayer.EVENT_OK].call(subscriber)}),MediaPlayer.parent){case IPTVChannels:IPTVChannels.goToChFlag?(clearTimeout(IPTVChannels.timer.goToChannel),IPTVChannels.TVList.goToChannel(parseInt(IPTVChannels.TVnumber)+IPTVChannels.TVList.channelStart),IPTVChannels.TVnumber="",IPTVChannels.goToChFlag=!1,IPTVChannels.domChannelNumber.style.display="none",MediaPlayer.domChannelNumber.style.display="none"):MediaPlayer.Show(!1,!1);break;case DVBChannels:DVBChannels.goToChFlag?(clearTimeout(DVBChannels.timer.goToChannel),DVBChannels.DVBList.goToChannel(parseInt(DVBChannels.TVnumber,10)),DVBChannels.TVnumber="",DVBChannels.goToChFlag=!1,DVBChannels.domChannelNumber.style.display="none",MediaPlayer.domChannelNumber.style.display="none"):MediaPlayer.Show(!1)}break;case KEYS.INFO:MediaPlayer.showInfo();break;case KEYS.MENU:MediaPlayer.ModalMenu.Show(!0);break;case KEYS.BACK:IPTVChannels.goToChFlag&&MediaPlayer.parent===IPTVChannels&&IPTVChannels.actionBack();break;case KEYS.EPG:"function"==typeof MediaPlayer.parent.initEPG&&MediaPlayer.parent.initEPG();break;case KEYS.EXIT:if(e.preventDefault(),MediaPlayer.posModFlag){clearTimeout(this.timer.setPos),MediaPlayer.pos=0,MediaPlayer.posTime="",MediaPlayer.posMod=0,MediaPlayer.domPlayerCurrentTime.className="time_cur",MediaPlayer.posModFlag=!1,MediaPlayer.timer.showInfo=setTimeout(function(){MediaPlayer.showInfo(!1)},5);break}MediaPlayer.exit();break;case KEYS.FRAME:MediaPlayer.aspect();break;case KEYS.PLAY_PAUSE:MediaPlayer.playPause();break;case KEYS.STOP:switch(MediaPlayer.type){case MEDIA_TYPE_STREAM_TS:MediaPlayer.tsExitCheck("stop");break;default:MediaPlayer.exit()}break;case KEYS.LEFT:case KEYS.REWIND:switch(MediaPlayer.type){case MEDIA_TYPE_VIDEO:case MEDIA_TYPE_ISO:case MEDIA_TYPE_AUDIO:case MEDIA_TYPE_RECORDS_ITEM:case MEDIA_TYPE_STREAM_TS:MediaPlayer.setPos(-1)}break;case KEYS.RIGHT:case KEYS.FORWARD:switch(MediaPlayer.type){case MEDIA_TYPE_VIDEO:case MEDIA_TYPE_ISO:case MEDIA_TYPE_AUDIO:case MEDIA_TYPE_RECORDS_ITEM:case MEDIA_TYPE_STREAM_TS:MediaPlayer.setPos(1)}break;case KEYS.CHANNEL_NEXT:MediaPlayer.channelNext();break;case KEYS.CHANNEL_PREV:MediaPlayer.channelPrev();break;case KEYS.NUM0:case KEYS.NUM1:case KEYS.NUM2:case KEYS.NUM3:case KEYS.NUM4:case KEYS.NUM5:case KEYS.NUM6:case KEYS.NUM7:case KEYS.NUM8:case KEYS.NUM9:switch(MediaPlayer.parent){case IPTVChannels:MediaPlayer.ts_inProgress?MediaPlayer.setPosTime(""+(e.code-KEYS.NUM0)):IPTVChannels.goToChannel(""+(e.code-KEYS.NUM0));break;case DVBChannels:MediaPlayer.ts_inProgress?MediaPlayer.setPosTime(""+(e.code-KEYS.NUM0)):DVBChannels.goToChannel(""+(e.code-KEYS.NUM0));break;default:MediaPlayer.setPosTime(""+(e.code-KEYS.NUM0))}break;case KEYS.F1:if(MediaPlayer.parent===IPTVChannels&&!MediaPlayer.ts_inProgress){if("true"===environment.mount_media_ro)new CModalAlert(currCPage,_("Warning!"),_('"Storage read only access mode" is enabled in System Settings'),_("Close"));else{var item=IPTVChannels.TVList.Current();echo("F1 desicion "+(MediaPlayer.parent===IPTVChannels)+!MediaPlayer.ts_inProgress+(item.data.type===MEDIA_TYPE_STREAM)),item.data.type===MEDIA_TYPE_STREAM&&configuration.mayPVR&&new CModalAddRecord(this,_("Recording channel"),_("Group name")+":",{})}break}MediaPlayer.type===MEDIA_TYPE_IMAGE&&MediaPlayer.actionRotate(-90);break;case KEYS.F2:MediaPlayer.actionF2();break;case KEYS.F3:MediaPlayer.actionF3();break;case KEYS.F4:MediaPlayer.type===MEDIA_TYPE_IMAGE&&MediaPlayer.actionRotate(90);break;case KEYS.REFRESH:MediaPlayer.parent&&MediaPlayer.parent.actionRefresh&&MediaPlayer.parent.actionRefresh();break;case KEYS.AUDIO:MediaPlayer.showHlsInfo();break;default:e.preventDefault()}},MediaPlayer.nextMedia=function(){return MediaPlayer.list.length>1&&MediaPlayer.PlayList.playIndex+1<MediaPlayer.list.length&&(MediaPlayer.PlayList.playIndex++,echo(MediaPlayer.PlayList.playIndex,"prepare index"),(MediaPlayer.PlayList.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),MediaPlayer.PlayList.Marked(MediaPlayer.PlayList.handle.children[MediaPlayer.PlayList.playIndex],!0),MediaPlayer.prepare(MediaPlayer.list[MediaPlayer.PlayList.handle.children[MediaPlayer.PlayList.playIndex].data.index],!0)),!1},MediaPlayer.prevMedia=function(){return MediaPlayer.list.length>1&&MediaPlayer.PlayList.playIndex>0&&(MediaPlayer.PlayList.playIndex--,(MediaPlayer.PlayList.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),MediaPlayer.PlayList.Marked(MediaPlayer.PlayList.handle.children[MediaPlayer.PlayList.playIndex],!0),MediaPlayer.prepare(MediaPlayer.list[MediaPlayer.PlayList.handle.children[MediaPlayer.PlayList.playIndex].data.index],!0)),!1},MediaPlayer.channelNext=function(event){var item;switch(MediaPlayer.parent){case IPTVChannels:item=IPTVChannels.TVList.Next(!1,!1),item.data.type===MEDIA_TYPE_STREAM&&(clearTimeout(IPTVChannels.timer.goToChannel),MediaPlayer.domChannelNumber.innerHTML=item.data.index-IPTVChannels.TVList.channelStart,MediaPlayer.domChannelNumber.style.display="block",IPTVChannels.TVList.Focused(item,!0),IPTVChannels.timer.goToChannel=setTimeout(function(){MediaPlayer.domChannelNumber.style.display="none"},2e3));break;case DVBChannels:item=DVBChannels.DVBList.Next(),item.data.type===MEDIA_TYPE_DVB&&(clearTimeout(DVBChannels.timer.goToChannel),MediaPlayer.domChannelNumber.innerHTML=item.data.index-DVBChannels.DVBList.channelStart,MediaPlayer.domChannelNumber.style.display="block",DVBChannels.DVBList.Focused(item,!0),DVBChannels.timer.goToChannel=setTimeout(function(){MediaPlayer.domChannelNumber.style.display="none"},2e3));break;case MediaBrowser:MediaPlayer.nextMedia(event)}},MediaPlayer.channelPrev=function(event){var item;switch(MediaPlayer.parent){case IPTVChannels:item=IPTVChannels.TVList.Next(!1,!0),item.data.type===MEDIA_TYPE_STREAM&&(clearTimeout(IPTVChannels.timer.goToChannel),MediaPlayer.domChannelNumber.innerHTML=item.data.index-IPTVChannels.TVList.channelStart,MediaPlayer.domChannelNumber.style.display="block",IPTVChannels.TVList.Focused(item,!0),IPTVChannels.timer.goToChannel=setTimeout(function(){MediaPlayer.domChannelNumber.style.display="none"},2e3));break;case DVBChannels:item=DVBChannels.DVBList.Prev(),item.data.type===MEDIA_TYPE_DVB&&(clearTimeout(DVBChannels.timer.goToChannel),MediaPlayer.domChannelNumber.innerHTML=item.data.index-DVBChannels.DVBList.channelStart,MediaPlayer.domChannelNumber.style.display="block",DVBChannels.DVBList.Focused(item,!0),DVBChannels.timer.goToChannel=setTimeout(function(){MediaPlayer.domChannelNumber.style.display="none"},2e3));break;case MediaBrowser:MediaPlayer.prevMedia(event)}},MediaPlayer.actionRotate=function(d){return MediaPlayer.type===MEDIA_TYPE_IMAGE&&(this.currentRotation+=d,this.currentRotation<0&&(this.currentRotation+=360),this.currentRotation>360&&(this.currentRotation-=360),gSTB.Rotate(this.currentRotation)),!1},MediaPlayer.actionF2=function(){if(MediaPlayer.list.length>1){if(!MediaPlayer.infoFlag&&MediaPlayer.playListShow)return MediaPlayer.showInfo(!0),MediaPlayer.PlayList.Refresh(),!1;MediaPlayer.playListShow?(MediaPlayer.playListShow=!1,MediaPlayer.handle.querySelector("#playerHideplist").innerHTML=_("Show<br />playlist"),MediaPlayer.domPlayerList.style.visibility="hidden"):(MediaPlayer.playListShow=!0,MediaPlayer.handle.querySelector("#playerHideplist").innerHTML=_("Hide<br />playlist"),MediaPlayer.showInfo(!0),MediaPlayer.domPlayerList.style.visibility="visible",MediaPlayer.PlayList.Refresh())}return!1},MediaPlayer.actionF3=function(){return MediaPlayer.favorites&&(FAVORITES_NEW[(MediaPlayer.list[MediaPlayer.PlayList.playIndex].sol?MediaPlayer.list[MediaPlayer.PlayList.playIndex].sol+" ":"")+MediaPlayer.list[MediaPlayer.PlayList.playIndex].url]?MediaPlayer.actionF3del():MediaPlayer.actionF3add()),!1},MediaPlayer.actionF3add=function(){"function"==typeof this.parent.actionF3add?this.parent.actionF3add():MediaBrowser.FavAdd(this.list[this.PlayList.playIndex].url,{name:this.list[this.PlayList.playIndex].name,url:this.list[this.PlayList.playIndex].url,type:this.list[this.PlayList.playIndex].type,markable:!0}),this.domHeaderBlue.innerHTML=_("Remove from<br>favorites")},MediaPlayer.actionF3del=function(){"function"==typeof this.parent.actionF3del?this.parent.actionF3del():MediaBrowser.FavRemove(this.list[this.PlayList.playIndex].url),this.domHeaderBlue.innerHTML=_("Add to<br>favorites")},MediaPlayer.mixList=function(){var self=this,list=this.list.slice(),mixedList=[],i=1;for(mixedList[0]=list.splice(this.PlayList.playIndex,1)[0];;){if(0===list.length)break;mixedList[i]=list.splice(random(0,list.length-1),1)[0],i++}this.prepareList(mixedList),setTimeout(function(){self.PlayList.Focused(self.PlayList.handle.children[self.PlayList.playIndex],!1),self.PlayList.Marked(self.PlayList.handle.children[self.PlayList.playIndex],!0)},5)},MediaPlayer.showSubtitleHint=function(item){var self=this;self.handle.querySelector("#subText").innerHTML=item.name,self.handle.querySelector("#cright_bottom_sub").style.display="block",clearTimeout(self.timer.sub),self.timer.sub=setTimeout(function(){self.handle.querySelector("#cright_bottom_sub").style.display="none"},self.TIME_HIDE_HINT)},MediaPlayer.openSubtitle=function(sub,callback){var self=this;this.subtitlesPid=null,gSTB.IsFileUTF8Encoded(sub.url)||sub.encoding?self.loadSubtitles(sub,sub.encoding||"utf-8",callback)||new CModalHint(currCPage,_("Selected subtitle file is not available"),5e3):self.subCModal=new CModalSubtitleOpen(currCPage,{data:sub,closeParent:!0,item:this,onadd:function(options,encoding){self.loadSubtitles(options.data,encoding,callback)||new CModalHint(currCPage,_("Selected subtitle file is not available"),5e3)}})},MediaPlayer.loadSubtitles=function(data,encoding,callback){return data.url&&encoding&&gSTB.IsFileExist(data.url)?(gSTB.SetSubtitlesEncoding(encoding),gSTB.LoadExternalSubtitles(data.url),this.subtitles_on=!0,this.subtitlesData=data,this.subtitlesEncoding=encoding,gSTB.SetSubtitles(!0),this.showSubtitleHint(data),"function"==typeof callback&&callback(),!0):!1},MediaPlayer.setForcedSubtitles=function(data,encoding){this.forcedSubtitles=Object.create(data),this.forcedSubtitles.marked=!0,this.forcedSubtitles.encoding=encoding},MediaPlayer.prepareSubList=function(){var subList=[],marked=!1;null!==this.forcedSubtitles&&(subList.push(this.forcedSubtitles),marked=!0);for(var i=0;i<this.subList.length;i++)(null!==this.forcedSubtitles&&this.forcedSubtitles.url!==this.subList[i].url||null===this.forcedSubtitles)&&(this.obj.ext&&this.obj.ext.length&&this.obj.name.slice(0,-this.obj.ext.length)===this.subList[i].name.slice(0,-this.subList[i].ext.length)&&!marked?marked=this.subList[i].marked=!0:this.subList[i].marked=!1,subList.push(this.subList[i]));return this.forcedSubtitles=null,this.subList=subList,subList},MediaPlayer.setSubList=function(subList){return subList.length>0&&Array.isArray(subList)?(this.subList=subList,!0):(this.subList=[],!1)},MediaPlayer.prepareList=function(list,index){if(0===list.length||!Array.isArray(list))return!1;if(this.playNow&&this.type===MEDIA_TYPE_ISO)return!1;echo(index,"prepareList"),"undefined"!=typeof index?this.PlayList.playIndex=index:this.PlayList.playIndex=0,this.list=[],this.list=list,this.PlayList.Reset();for(var i=0;i<this.list.length;i++)this.PlayList.Add(list[i].name,{index:i,url:list[i].url},{stared:FAVORITES_NEW[list[i].url]?!0:!1});return!0},MediaPlayer.preparePlayer=function(obj,parent,fullScreen,show,favorites,next){var number=this.list.indexOf(obj);return echo(obj,"obj player"),show=!!show,-1===number&&(this.prepareList([obj]),number=0),this.audioPid=null,this.subtitlesPid=null,this.subtitles_on=environment.subtitles_on,this.PlayList.playIndex=number,(this.PlayList.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),this.PlayList.Focused(this.PlayList.handle.children[number],!0,show),this.PlayList.Marked(this.PlayList.handle.children[number],!0),0!==this.list.length&&parent&&obj?(this.playListShow=!1,this.domPlayerList.style.visibility="hidden",this.parent=parent,this.fullScreen=fullScreen!==!1,this.fullScreen=!this.fullScreen,this.favorites=favorites!==!1,this.next=!!next,this.repeat=!1,this.favorites?this.domHeaderBlue.style.display="block":this.domHeaderBlue.style.display="none",this.prepare(this.list[number],!0)?(this.list.length>1||this.type===MEDIA_TYPE_ISO?(this.handle.querySelector("#playerHideplist").style.display="block",this.handle.querySelector("#playerHideplist").innerHTML=_("Show<br />playlist")):this.handle.querySelector("#playerHideplist").style.display="none",this.resetModalMenu(),show&&this.Show(!0,parent),this.changeScreenMode(fullScreen),!0):!1):!1},MediaPlayer.resetModalMenu=function(){(this.ModalMenu.Menu.gplay.slist.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),this.next?this.repeat?this.ModalMenu.Menu.gplay.slist.Marked(this.ModalMenu.Menu.gplay.ilistr,!0):this.ModalMenu.Menu.gplay.slist.Marked(this.ModalMenu.Menu.gplay.ilist,!0):this.repeat?this.ModalMenu.Menu.gplay.slist.Marked(this.ModalMenu.Menu.gplay.ioner,!0):this.ModalMenu.Menu.gplay.slist.Marked(this.ModalMenu.Menu.gplay.ione,!0)},MediaPlayer.prepare=function(obj,play,noInfo){var tempUrl="";if(this.obj===obj||!obj||!obj.url)return!1;switch(clearTimeout(this.timer.showInfo),clearTimeout(this.timer.startPlaying),gSTB.Set3DConversionMode(0),this.domTSIndicator.style.display="none",this.domPlayerTotalTime.innerHTML="00:00:00",this.domPlayerCurrentTime.innerHTML="00:00:00",this.domPlayerBufferBar.style.width="0px",this.domPlayerProgressBar.style.width="0px",document.getElementById("cright").style.display="none",document.getElementById("cright_bottom_sub").style.display="none",document.getElementById("cright_bottom_tvtext").style.display="none",document.getElementById("cright_hls").style.display="none",this.audioPid=null,this.subtitlesPid=null,this.ModalMenu.Menu.gaudio.slist.Clear(),this.ModalMenu.Menu.gsubtitle.slist.Clear(),this.favorites&&(tempUrl=this.parent===IPTVChannels?(obj.sol?obj.sol+" ":"")+obj.url:obj.url,FAVORITES_NEW[tempUrl]?this.domHeaderBlue.innerHTML=_("Remove from<br>favorites"):this.domHeaderBlue.innerHTML=_("Add to<br>favorites")),this.pos=0,this.curTime=0,this.totalTime=0,this.infoFlag=noInfo?this.infoFlag:!1,this.ts_inProgress=!1,this.countError=0,clearTimeout(MediaPlayer.errorTimer),this.obj=obj,this.parent){case IPTVChannels:IPTVChannels.TVList.activeItem&&(this.domPlayerTitle.innerHTML="<span>"+IPTVChannels.TVList.activeItem.data.number+"</span>&nbsp;&nbsp;&nbsp;"+obj.name);break;case DVBChannels:DVBChannels.DVBList.activeItem&&(this.domPlayerTitle.innerHTML="<span>"+DVBChannels.DVBList.activeItem.data.channelNumber+"</span>&nbsp;&nbsp;&nbsp;"+obj.name);break;default:this.domPlayerTitle.innerHTML=obj.name}if(this.type!==obj.type){if(this.domSlideContainer.style.display="none",this.type=obj.type,"function"!=typeof this.init[this.type])return!1;this.init[this.type]();for(var a=0;a<this.ModalMenu.Menu.handleInner.children.length;a++)this.ModalMenu.Menu.Hidden(this.ModalMenu.Menu.handleInner.children[a],!0);if("function"!=typeof this.modalInit[this.type])return!1;this.modalInit[this.type]()}return play&&(this.runner.stop(),this.timer.startPlaying=setTimeout(function(){noInfo||MediaPlayer.showInfo(!0),MediaPlayer.play()},5)),!0},MediaPlayer.play=function(restore){var i,param="";if(this.obj){if(gSTB.GetStandByStatus())return void(this.inStandBy=!0);this.currentRotation=0,clearTimeout(this.timer.mono),this.handle.querySelector("#dualmono_indicator").style.display="none",this.sol=""!==this.obj.sol?this.obj.sol:"auto";for(i in this.obj.options)this.obj.options[i]&&(param+=" "+i+":"+this.obj.options[i]);switch(this.type){case MEDIA_TYPE_DVB:this.sol="dvb";break;case MEDIA_TYPE_STREAM:clearTimeout(this.timer.ts_timer),this.ModalMenu.Menu.gaudio.slist.Clear(),this.ModalMenu.Menu.gsubtitle.slist.Clear();var arr=this.obj.url.trim().split(" ");this.obj.url=this.obj.url.replace(/^[A-Za-z0-9]+\s/,""),arr.length>1&&-1===arr[0].indexOf("://")&&(this.obj.sol=arr[0],this.sol=this.obj.sol),this.oldSol=this.obj.sol,this.oldURL=this.obj.url,this.obj.tsOn&&this.ts_on&&(this.sol="extTimeShift",this.checkUsb(environment.ts_path)||restore||("true"===environment.mount_media_ro?new CModalAlert(currCPage,_("Warning!"),_('"Storage read only access mode" is enabled in System Settings'),_("Close")):new CModalConfirm(currCPage,_("Error"),_('No storage device selected as the "File location" in TimeShift settings. Disable TimeShift?'),_("No"),function(){},_("Yes"),function(){MediaPlayer.tsOnOff(!1)})));break;case MEDIA_TYPE_IMAGE:this.sol="jpeg";break;case MEDIA_TYPE_RECORDS_ITEM:this.sol="extTimeShiftPlayer";break;case MEDIA_TYPE_ISO:this.sol="extBDDVD";break;case MEDIA_TYPE_CUE_ITEM:param=" position:"+this.obj.time}this.playNow=!1,this.startingPlay=!0,this.isVideo=!0,echo("gSTB PLAY  "+(this.sol?this.sol+" ":"auto ")+this.obj.url+param),gSTB.Play((this.sol?this.sol+" ":"auto ")+this.obj.url+param)}},MediaPlayer.setPos=function(a){if(echo(this.playNow,"this.playNow "+a),this.playNow){this.posModFlag=!0,clearTimeout(this.timer.setPos),clearTimeout(this.timer.showInfo),this.posTime="",this.runner.stop(),0===this.pos&&(this.curTime=gSTB.GetPosTime(),this.showInfo(!0,0,!1),this.pos=this.curTime),this.posMod!==a?(this.posMod=a,this.posIntervals=[0,0,10]):(this.posIntervals.splice(0,1),echo(this.posIntervals,"splice"),this.posIntervals[this.posIntervals.length]=this.posIntervals[this.posIntervals.length-1]+10);for(var to=0,i=0;i<this.posIntervals.length;i++)to+=a*this.posIntervals[i];to>1800&&(to=1800),-1800>to&&(to=-1800),this.pos+=to,this.pos>this.totalTime&&(this.pos=this.totalTime-1),this.pos<0&&(this.pos=3);var curTime,px;return MediaPlayer.type===MEDIA_TYPE_STREAM_TS?(px=Math.round(this.pos/environment.ts_time*this.progress[WINDOW_HEIGHT]),curTime=this.parseTime(this.totalTime-this.pos),this.domPlayerCurrentTime.innerHTML="-"+curTime.hour+":"+curTime.min+":"+curTime.sec):(curTime=this.parseTime(this.pos),px=Math.round(this.pos/this.totalTime*this.progress[WINDOW_HEIGHT]),this.domPlayerCurrentTime.innerHTML=curTime.hour+":"+curTime.min+":"+curTime.sec),this.domPlayerProgressBar.style.width=px+"px",this.timer.setPos=setTimeout(function(){MediaPlayer.setPosTimeManual(MediaPlayer.pos)},2e3),!1}},MediaPlayer.setPosTimeManual=function(pos){if(this.curTime=gSTB.GetPosTime(),this.showInfo(!0,0,!1),this.pos=pos,
gSTB.SetPosTime(this.pos),UPnPRenderer.state&&stbUPnPRenderer.sendPosition(pos),this.curTime=this.pos,this.pos=0,this.domPlayerCurrentTime.className="time_cur",this.posMod=0,gSTB.IsPlaying()||gSTB.Continue(),this.posModFlag=!1,this.obj.type===MEDIA_TYPE_CUE_ITEM&&this.list.length>1)for(var i=0;i<this.list.length;i++)if(this.pos>this.list[i].time){this.PlayList.playIndex=i-1,this.PlayList.Focused(this.PlayList.handle.children[this.PlayList.playIndex],!0),this.obj=this.list[this.PlayList.activeItem.data.index],this.domPlayerTitle.innerHTML=this.obj.name;break}this.obj.type===MEDIA_TYPE_ISO&&this.checkISOChapter()},MediaPlayer.checkISOChapter=function(){for(this.PlayList.playIndex=0;this.PlayList.playIndex<MediaPlayer.list.length-1;this.PlayList.playIndex++)if(this.curTime>=this.dataDVD.titles[this.PlayList.parentIndex].chapters[this.PlayList.playIndex].startTime/1e3&&this.curTime<this.dataDVD.titles[this.PlayList.parentIndex].chapters[this.PlayList.playIndex+1].startTime/1e3){(this.PlayList.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),this.PlayList.Marked(this.PlayList.handle.children[this.dataDVD.titles[this.PlayList.parentIndex].chapters[this.PlayList.playIndex].chN],!0);break}},MediaPlayer.setPosTime=function(a){if(this.playNow){this.posModFlag=!0,this.showInfo(!0,0,!1),this.posMod=0,clearTimeout(this.timer.setPos),clearTimeout(this.timer.showInfo),this.runner.stop(),this.posTime+=a,echo(this.posTime,"this.posTime"),this.posTime=parseInt(this.posTime,10),this.pos=this.splitTime(this.posTime),this.pos>this.totalTime&&(this.pos=this.totalTime);var curTime,px;MediaPlayer.type===MEDIA_TYPE_STREAM_TS?(px=Math.round(this.pos/environment.ts_time*this.progress[WINDOW_HEIGHT]),curTime=this.parseTime(this.totalTime-this.pos),this.domPlayerCurrentTime.innerHTML="-"+curTime.hour+":"+curTime.min+":"+curTime.sec):(curTime=this.parseTime(this.pos),px=Math.round(this.pos/this.totalTime*this.progress[WINDOW_HEIGHT]),this.domPlayerCurrentTime.innerHTML=curTime.hour+":"+curTime.min+":"+curTime.sec),this.domPlayerCurrentTime.className="time_cur input",this.domPlayerProgressBar.style.width=px+"px",this.timer.setPos=setTimeout(function(){if(gSTB.SetPosTime(MediaPlayer.pos),MediaPlayer.curTime=MediaPlayer.pos,MediaPlayer.pos=0,MediaPlayer.posTime="",MediaPlayer.posMod=0,MediaPlayer.domPlayerCurrentTime.className="time_cur",gSTB.IsPlaying()||gSTB.Continue(),MediaPlayer.posModFlag=!1,MediaPlayer.obj.type===MEDIA_TYPE_CUE_ITEM&&MediaPlayer.list.length>1)for(var i=0;i<MediaPlayer.list.length;i++)if(MediaPlayer.pos>MediaPlayer.list[i].time){MediaPlayer.PlayList.playIndex=i-1,MediaPlayer.PlayList.Focused(MediaPlayer.PlayList.handle.children[MediaPlayer.PlayList.playIndex],!0),MediaPlayer.obj=MediaPlayer.list[MediaPlayer.PlayList.activeItem.data.index],MediaPlayer.domPlayerTitle.innerHTML=MediaPlayer.obj.name;break}MediaPlayer.obj.type===MEDIA_TYPE_ISO&&MediaPlayer.checkISOChapter()},2e3)}},MediaPlayer.playPause=function(pause){var self=this;if(!this.playNow){if(this.type!==MEDIA_TYPE_IMAGE)return;echo(this.timer.slideShow,"this.timer.slideShow"),echo(this.slideOn,"this.slideOn"),this.timer.slideShow?(echo("CLEAR TIMEOUT!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!11111111111111111111"),clearTimeout(this.timer.slideShow),this.timer.slideShow=null):this.slideOn>0&&(this.timer.slideShow=setTimeout(function(){echo(self.list.length>1&&self.fullScreen,"self.list.length > 1 && self.fullScreen"),self.list.length>1&&self.fullScreen&&self.PlayList.playIndex+1<self.list.length&&(self.PlayList.playIndex++,(self.PlayList.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),self.PlayList.Marked(self.PlayList.handle.children[self.PlayList.playIndex],!0),self.prepare(self.list[self.PlayList.handle.children[self.PlayList.playIndex].data.index],!0,!0))},1e3*this.slideOn),echo(this.timer.slideShow,"setTimeout"))}return clearTimeout(this.timer.showInfo),"extTimeShift"!==this.sol||this.ts_inProgress||this.type!==MEDIA_TYPE_STREAM?(echo(gSTB.IsPlaying()||pause,"gSTB.IsPlaying() || pause "),void(gSTB.IsPlaying()||pause?(this.showInfo(!0,0,!1),gSTB.Pause(),this.subscribers[this.EVENT_PAUSE].forEach(function(subscriber){subscriber.subscribeEvents[self.EVENT_PAUSE].call(subscriber,!0)}),this.type!==MEDIA_TYPE_STREAM_TS&&this.runner.stop()):(echo("gSTB CONTINUE!C C C C"),gSTB.Continue(),this.subscribers[this.EVENT_PAUSE].forEach(function(subscriber){subscriber.subscribeEvents[self.EVENT_PAUSE].call(subscriber,!1)}),this.type!==MEDIA_TYPE_STREAM_TS&&this.runner.start(),this.type!==MEDIA_TYPE_AUDIO&&(this.timer.showInfo=setTimeout(function(){MediaPlayer.showInfo(!1)},5))))):void(this.checkUsb(environment.ts_path)?(this.ts_start(0,!0),this.runner.start()):"true"===environment.mount_media_ro?new CModalAlert(currCPage,_("Warning!"),_('"Storage read only access mode" is enabled in System Settings'),_("Close")):new CModalConfirm(currCPage,_("Error"),_('No storage device selected as the "File location" in TimeShift settings. Disable TimeShift?'),_("No"),function(){},_("Yes"),function(){MediaPlayer.tsOnOff(!1)}))},MediaPlayer.event=function(e,info){switch(echo("event : "+e),e=parseInt(e,10)){case 1:switch(MediaPlayer.ModalMenu.Menu.gTeletext.mediaHandler&&(MediaPlayer.EventHandler=MediaPlayer.ModalMenu.Menu.gTeletext.mediaHandler),MediaPlayer.startingPlay=!1,MediaPlayer.type){case MEDIA_TYPE_STREAM:clearTimeout(MediaPlayer.errorTimer),MediaPlayer.errorTimer=window.setTimeout(function(){MediaPlayer.play(!0)},3e3);break;case MEDIA_TYPE_CUE_ITEM:currCPage===MediaPlayer||currCPage.parent===MediaPlayer?MediaPlayer.exit():MediaPlayer.end();break;case MEDIA_TYPE_ISO:if(MediaPlayer.PlayList.parentIndex+2<MediaPlayer.dataDVD.titles.length){MediaPlayer.PlayList.parentIndex++;var param="?title="+MediaPlayer.PlayList.parentIndex;echo((MediaPlayer.sol?MediaPlayer.sol+" ":"auto ")+MediaPlayer.obj.url+param,"TO PLAY"),MediaPlayer.playNow=!1,MediaPlayer.runner.stop(),gSTB.Play((MediaPlayer.sol?MediaPlayer.sol+" ":"auto ")+MediaPlayer.obj.url+param)}else currCPage===MediaPlayer?MediaPlayer.exit():MediaPlayer.end();break;default:if(MediaPlayer.next){if(MediaPlayer.list.length>1&&MediaPlayer.fullScreen){if(MediaPlayer.PlayList.playIndex+1<MediaPlayer.list.length){MediaPlayer.PlayList.playIndex++,(MediaPlayer.PlayList.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),MediaPlayer.PlayList.Marked(MediaPlayer.PlayList.handle.children[MediaPlayer.PlayList.playIndex],!0),MediaPlayer.prepare(MediaPlayer.list[MediaPlayer.PlayList.handle.children[MediaPlayer.PlayList.playIndex].data.index],!0);break}if(MediaPlayer.repeat){MediaPlayer.PlayList.playIndex=0,(MediaPlayer.PlayList.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),MediaPlayer.PlayList.Marked(MediaPlayer.PlayList.handle.children[MediaPlayer.PlayList.playIndex],!0),MediaPlayer.prepare(MediaPlayer.list[MediaPlayer.PlayList.handle.children[MediaPlayer.PlayList.playIndex].data.index],!0);break}}}else if(MediaPlayer.repeat){MediaPlayer.play();break}currCPage===MediaPlayer||currCPage.parent===MediaPlayer?MediaPlayer.exit():MediaPlayer.end()}break;case 2:switch(MediaPlayer.type){case MEDIA_TYPE_ISO:case MEDIA_TYPE_RECORDS_ITEM:case MEDIA_TYPE_AUDIO:case MEDIA_TYPE_CUE_ITEM:case MEDIA_TYPE_VIDEO:MediaPlayer.curTime=0,MediaPlayer.totalTime=gSTB.GetMediaLen();var curTime=MediaPlayer.parseTime(MediaPlayer.totalTime);MediaPlayer.domPlayerTotalTime.innerHTML=curTime.hour+":"+curTime.min+":"+curTime.sec}MediaPlayer.setAudioMenu(),MediaPlayer.initSubtitleMenu(),MediaPlayer.initTeletextMenu();break;case 4:switch(MediaPlayer.startingPlay=!1,MediaPlayer.playNow||MediaPlayer.subscribers[MediaPlayer.EVENT_START].forEach(function(subscriber){subscriber.subscribeEvents[MediaPlayer.EVENT_START].call(subscriber)}),MediaPlayer.type){case MEDIA_TYPE_ISO:MediaPlayer.playNow||MediaPlayer.setDVDInfo(),MediaPlayer.timer.showInfo=setTimeout(function(){MediaPlayer.showInfo(!1)},MediaPlayer.TIME_HIDE_INFO),MediaPlayer.isVideo||(MediaPlayer.domSlideContainer.style.display="block"),MediaPlayer.runner.start();break;case MEDIA_TYPE_AUDIO:MediaPlayer.isVideo||(MediaPlayer.domSlideContainer.style.display="block"),MediaPlayer.runner.start();break;case MEDIA_TYPE_VIDEO:case MEDIA_TYPE_STREAM_TS:case MEDIA_TYPE_RECORDS_ITEM:case MEDIA_TYPE_CUE_ITEM:case MEDIA_TYPE_DVB:MediaPlayer.runner.start(),MediaPlayer.timer.showInfo=setTimeout(function(){MediaPlayer.showInfo(!1)},MediaPlayer.TIME_HIDE_INFO);break;case MEDIA_TYPE_STREAM:clearTimeout(MediaPlayer.errorTimer),MediaPlayer.timer.showInfo=setTimeout(function(){MediaPlayer.showInfo(!1)},MediaPlayer.TIME_HIDE_INFO),MediaPlayer.obj.tsOn&&MediaPlayer.ts_on&&environment.ts_lag>0&&!MediaPlayer.ts_inProgress&&!MediaPlayer.playNow&&MediaPlayer.checkUsb(environment.ts_path)&&MediaPlayer.ts_start(environment.ts_lag)}MediaPlayer.playNow=gSTB.IsPlaying();break;case 5:switch(MediaPlayer.ModalMenu.Menu.gTeletext.mediaHandler&&(MediaPlayer.EventHandler=MediaPlayer.ModalMenu.Menu.gTeletext.mediaHandler),MediaPlayer.startingPlay=!1,MediaPlayer.runner.stop(),MediaPlayer.subscribers[MediaPlayer.EVENT_ERROR].forEach(function(subscriber){subscriber.subscribeEvents[MediaPlayer.EVENT_ERROR].call(subscriber)}),MediaPlayer.type){case MEDIA_TYPE_STREAM:clearTimeout(MediaPlayer.errorTimer),MediaPlayer.errorTimer=window.setTimeout(function(){MediaPlayer.play(!0)},3e3);break;case MEDIA_TYPE_STREAM_TS:case MEDIA_TYPE_VIDEO:case MEDIA_TYPE_DVB:case MEDIA_TYPE_AUDIO:if(MediaPlayer.next&&MediaPlayer.list.length>1&&MediaPlayer.fullScreen){if(MediaPlayer.PlayList.playIndex+1<MediaPlayer.list.length){MediaPlayer.PlayList.playIndex++,(MediaPlayer.PlayList.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),MediaPlayer.PlayList.Marked(MediaPlayer.PlayList.handle.children[MediaPlayer.PlayList.playIndex],!0),MediaPlayer.prepare(MediaPlayer.list[MediaPlayer.PlayList.handle.children[MediaPlayer.PlayList.playIndex].data.index],!0);break}if(MediaPlayer.repeat){MediaPlayer.PlayList.playIndex=0,(MediaPlayer.PlayList.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),MediaPlayer.PlayList.Marked(MediaPlayer.PlayList.handle.children[MediaPlayer.PlayList.playIndex],!0),MediaPlayer.prepare(MediaPlayer.list[MediaPlayer.PlayList.handle.children[MediaPlayer.PlayList.playIndex].data.index],!0);break}}currCPage===MediaPlayer||currCPage.parent===MediaPlayer?MediaPlayer.exit():MediaPlayer.end(),setTimeout(function(){new CModalHint(currCPage,_("Playing error"),3e3)},5);break;case MEDIA_TYPE_CUE_ITEM:case MEDIA_TYPE_ISO:currCPage===MediaPlayer||currCPage.parent===MediaPlayer?MediaPlayer.exit():MediaPlayer.end(),setTimeout(function(){new CModalHint(currCPage,_("Playing error"),3e3)},5);break;case MEDIA_TYPE_IMAGE:clearTimeout(MediaPlayer.timer.slideShow),MediaPlayer.timer.slideShow=null,MediaPlayer.slideOn>0&&MediaPlayer.list.length>1&&MediaPlayer.fullScreen&&MediaPlayer.PlayList.playIndex+1<MediaPlayer.list.length&&(MediaPlayer.PlayList.playIndex++,(MediaPlayer.PlayList.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),MediaPlayer.PlayList.Marked(MediaPlayer.PlayList.handle.children[MediaPlayer.PlayList.playIndex],!0),MediaPlayer.prepare(MediaPlayer.list[MediaPlayer.PlayList.handle.children[MediaPlayer.PlayList.playIndex].data.index],!0))}break;case 6:MediaPlayer.handle.querySelector("#dualmono_indicator").style.display="block",clearTimeout(MediaPlayer.timer.mono),MediaPlayer.timer.mono=window.setTimeout(function(){MediaPlayer.handle.querySelector("#dualmono_indicator").style.display="none"},3e3);break;case 7:switch(MediaPlayer.type){case MEDIA_TYPE_IMAGE:clearTimeout(MediaPlayer.timer.slideShow),MediaPlayer.timer.slideShow=null,MediaPlayer.slideOn>0&&(MediaPlayer.timer.slideShow=setTimeout(function(){MediaPlayer.list.length>1&&MediaPlayer.fullScreen&&MediaPlayer.PlayList.playIndex+1<MediaPlayer.list.length&&(MediaPlayer.PlayList.playIndex++,(MediaPlayer.PlayList.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),MediaPlayer.PlayList.Marked(MediaPlayer.PlayList.handle.children[MediaPlayer.PlayList.playIndex],!0),MediaPlayer.prepare(MediaPlayer.list[MediaPlayer.PlayList.handle.children[MediaPlayer.PlayList.playIndex].data.index],!0,!0))},1e3*MediaPlayer.slideOn));break;default:try{info=gSTB.GetVideoInfo(),info&&(info=info.replace(/,/g,'","').replace(/:/g,'":"').replace("{",'{"').replace("}",'"}').replace(/""/g,'"'),info=JSON.parse(info))}catch(e){echo(e,"gSTB.GetVideoInfo catch")}parseInt(info.pictureWidth,10)>0&&parseInt(info.pictureHeight,0)>0?(MediaPlayer.isVideo=!0,MediaPlayer.domSlideContainer.style.display="none"):MediaPlayer.isVideo=!1}break;case 9:MediaPlayer.initSubtitleMenu(),MediaPlayer.initTeletextMenu();break;case 32:stbWebWindow.messageSend(getWindowIdByName(WINDOWS.PORTAL),"video.mode.reload",""),"0"!==environment.hdmi_event_delay&&(clearTimeout(MediaPlayer.standByTimer),gSTB.GetStandByStatus()&&stbWebWindow.messageSend(getWindowIdByName(WINDOWS.PORTAL),"portal.standbyMode","hdmiEvent"));break;case 33:"0"!==environment.hdmi_event_delay&&(clearTimeout(MediaPlayer.standByTimer),MediaPlayer.standByTimer=setTimeout(function(){gSTB.GetStandByStatus()||stbWebWindow.messageSend(getWindowIdByName(WINDOWS.PORTAL),"portal.standbyMode","hdmiEvent")},1e3*environment.hdmi_event_delay));break;case 36:if(!info)return;if(info=JSON.parse(info),echo(info,"info"),!MediaPlayer.ts_inProgress||"TimeShift"!==info.ident)return;switch(info.event_code){case 1:break;case 2:break;case 3:gSTB.SetPosTime(12),gSTB.Continue();break;case 4:2===MediaPlayer.ts_endType&&(gSTB.SetPosTime(gSTB.GetPosTime()),new CModalHint(currCPage,_("Buffer is full"),3e3));break;case 5:MediaPlayer.showInfo(!0);break;case 6:switch(gSTB.IsPlaying()||gSTB.Continue(),parseInt(info.event_data,10)){case 1:IPTVChannels.TVList.activeItem&&(IPTVChannels.TVList.activeItem.querySelector(".timeshift").className="timeshift tsOn"),clearTimeout(MediaPlayer.timer.ts_timer),MediaPlayer.ts_inProgress=!1,MediaPlayer.sol=MediaPlayer.oldSol,MediaPlayer.obj.url=MediaPlayer.oldURL,MediaPlayer.type=MediaPlayer.obj.type,MediaPlayer.init[MediaPlayer.type](),environment.ts_icon&&(MediaPlayer.domTSIndicator.style.display="none"),new CModalConfirm(currCPage,_("Writing error"),_("Check storage device.<br />Disable TimeShift?"),_("No"),function(){},_("Yes"),function(){MediaPlayer.tsOnOff(!1)});break;case 2:MediaPlayer.tsExitCheck("error")}break;case 7:if(MediaPlayer.ts_inProgress&&2===MediaPlayer.ts_endType){gSTB.Pause(),document.getElementById("ts_playbutt").style.background="url(img/"+win.width+"/audioplay_pause.png) no-repeat";var del=ts_sol[win.width],wid=del[0]-del[1];document.getElementById("ts_curtime").innerHTML="-"+secondsToTimeString(0),document.getElementById("ts_progress").style.width="100%",document.getElementById("ts_runner").style.marginLeft=wid+"px",document.getElementById("ts_setpos_form").style.display="block",clearInterval(ts_runInterval)}}break;case 40:info=JSON.parse(info),echo(info,"Scanning DVB Channel in progress"),info.state&&"finished"===info.state?(DVBChannels.scanningInProgress=!1,DVBChannels.domScanInProgress.style.display="none",!DVBChannels.loadChanels(!0)||currCPage!==DVBChannels&&MediaPlayer.parent!==DVBChannels||DVBChannels.Reset()):(DVBChannels.domPercentScan.innerHTML=info.progress+"%",DVBChannels.domTitleFreqScanText.innerHTML=info.frequency);break;case 41:try{info=JSON.parse(info)}catch(error){echo(error,"Scanning DVB Channel found");break}echo(info,"Scanning DVB Channel found"),DVBChannels.scanTotalFound++,DVBChannels.domTitleTotalScanText.innerHTML=DVBChannels.scanTotalFound,DVBChannels.domTitleLastScanText.innerHTML=info.name;break;case 42:switch(echo(info,"info 42"),currCPage){case DVBEpg:DVBEpg.EPGList.CheckEPGData(),DVBEpg.previous===MediaPlayer?"function"==typeof MediaPlayer.parent.initEPGNow&&MediaPlayer.parent.initEPGNow():"function"==typeof DVBEpg.previous.initEPGNow&&DVBEpg.previous.initEPGNow();break;case MediaPlayer:"function"==typeof MediaPlayer.parent.initEPGNow&&MediaPlayer.parent.initEPGNow();break;case DVBChannels:DVBChannels.initEPGNow();break;case IPTVChannels:IPTVChannels.initEPGNow();break;default:(currCPage.parent===DVBChannels||currCPage.previous===DVBChannels)&&DVBChannels.initEPGNow(),(currCPage.parent===IPTVChannels||currCPage.previous===IPTVChannels)&&IPTVChannels.initEPGNow()}break;case 43:echo(info,"info 43"),DVBChannels.ModalMenu.Menu.gdvbAntena.slist.Marked(DVBChannels.ModalMenu.Menu.gdvbAntena.ion,!1),DVBChannels.ModalMenu.Menu.gdvbAntena.slist.Marked(DVBChannels.ModalMenu.Menu.gdvbAntena.ioff,!0),currCPage&&MediaPlayer.dvbPowerManualOn&&new CModalHint(currCPage,_("Detected passive antenna type"),2e3),MediaPlayer.dvbPowerManualOn=!1}},MediaPlayer.initAspect=function(){var i;if(environment.aspect||0===environment.aspect){for(i=0;i<this.aspects.length;i++)if(this.aspects[i].mode===environment.aspect){this.activeAspect=i;break}gSTB.SetAspect(this.aspects[this.activeAspect].mode)}},MediaPlayer.aspect=function(){clearTimeout(this.timer.hideAspect),this.activeAspect++,this.activeAspect>=this.aspects.length&&(this.activeAspect=0),gSTB.SetAspect(this.aspects[this.activeAspect].mode),this.domAspectText.innerHTML=this.aspects[this.activeAspect].text,document.getElementById("toolsPan").style.display="block",this.domAspectBlock.style.display="block",this.timer.hideAspect=function(block){return setTimeout(function(){block.style.display="none"},2e3)}(this.domAspectBlock)},MediaPlayer.tsOnOff=function(flag){this.ts_on!==flag&&(this.ts_on=flag,this.ts_on?(this.ModalMenu.Menu.gts.slist.Marked(this.ModalMenu.Menu.gts.ion,!0),this.ModalMenu.Menu.gts.slist.Marked(this.ModalMenu.Menu.gts.ioff,!1)):this.obj&&(this.sol=this.oldSol,this.obj.url=this.oldURL,this.type=this.obj.type,this.ModalMenu.Menu.gts.slist.Marked(this.ModalMenu.Menu.gts.ion,!1),this.ModalMenu.Menu.gts.slist.Marked(this.ModalMenu.Menu.gts.ioff,!0),this.init[this.type]()),this.play())},MediaPlayer.ts_start=function(start,stop){start||(start=0),clearTimeout(this.timer.ts_timer),this.timer.ts_timer=setTimeout(function(){var done=timeShift.EnterTimeShift();0===done?(MEDIA_TYPE_STREAM_TS!==MediaPlayer.type&&(MediaPlayer.type=MEDIA_TYPE_STREAM_TS,MediaPlayer.init[MEDIA_TYPE_STREAM_TS](),MediaPlayer.modalInit[MEDIA_TYPE_STREAM_TS]()),MediaPlayer.ts_inProgress=!0,environment.ts_icon&&(MediaPlayer.domTSIndicator.style.display="block"),IPTVChannels.TVList.activeItem.querySelector(".timeshift").className="timeshift tsActive",stop&&(gSTB.Pause(),MediaPlayer.showInfo(!0)),MediaPlayer.runner.start()):(MediaPlayer.tsExit("stop"),MediaPlayer.ts_inProgress=!1,new CModalAlert(currCPage,_("Error"),_("Start TimeShift error"),_("Close")))},1e3*start)},MediaPlayer.checkUsb=function(usb){for(var usbs=JSON.parse(gSTB.GetStorageInfo("{}")).result||[],i=0;i<usbs.length;i++)if(usb===usbs[i].mountPath&&0===usbs[i].isReadOnly)return!0;return!1},MediaPlayer.tsExitCheck=function(type,item){switch(gSTB.Pause(),MediaPlayer.runner.stop(),IPTVChannels.TVList.activeItem&&(IPTVChannels.TVList.activeItem.querySelector(".timeshift").className="timeshift tsOn"),environment.ts_icon&&(MediaPlayer.domTSIndicator.style.display="none"),clearTimeout(MediaPlayer.timer.ts_timer),this.ts_inProgress=!1,environment.ts_exitType){case 1:return MediaPlayer.tsExit(type,item),!1;case 2:return MediaPlayer.tsSave(type,item),!0;case 3:return"standByHDMI"===type?(MediaPlayer.tsExit(type,item),!0):(new CModalConfirm(currCPage,_("Request to save"),_("Save TimeShift buffer?"),_("No"),function(){MediaPlayer.tsExit(type,item)},_("Yes"),function(){MediaPlayer.tsSave(type,item)}),!0)}return!1},MediaPlayer.tsSave=function(type,item){var date=new Date,day=date.getDate(),mon=date.getMonth()+1,year=date.getFullYear(),min=date.getMinutes(),hour=date.getHours(),sec=date.getSeconds(),name=this.obj.name.replace(/\//g,"-").replace(/\>/g,"-").replace(/</g,"-").replace(/\|/g,"-").replace(/\?/g,"-").replace(/\*/g,"-").replace(/\\/g,"-").replace(/\:/g,"-"),cor=timeShift.ExitTimeShiftAndSave(environment.ts_path+"/records/"+name+"/"+year+"-"+(mon>9?mon:"0"+mon)+"-"+(day>9?day:"0"+day)+"/",(hour>9?hour:"0"+hour)+"-"+(min>9?min:"0"+min)+"-"+(sec>9?sec:"0"+sec));switch(0!==cor?setTimeout(function(){new CModalAlert("exit"===type?IPTVChannels:currCPage,_("Error"),_("Saving error"),_("Close"),function(){"exit"===type&&MediaPlayer.tsExit(type,item)})},200):setTimeout(function(){new CModalHint("exit"===type?IPTVChannels:currCPage,_("Save to:")+" Records/"+name+"/"+year+"-"+(mon>9?mon:"0"+mon)+"-"+(day>9?day:"0"+day)+"/"+(hour>9?hour:"0"+hour)+":"+(min>9?min:"0"+min)+":"+(sec>9?sec:"0"+sec)+".tspinf",3100)},200),type){case"error":"true"===environment.mount_media_ro?new CModalAlert(currCPage,_("Warning!"),_('"Storage read only access mode" is enabled in System Settings'),_("Close")):new CModalConfirm(currCPage,_("Error"),_('No storage device selected as the "File location" in TimeShift settings. Disable TimeShift?'),_("No"),function(){},_("Yes"),function(){MediaPlayer.tsOnOff(!1)});break;case"stop":MediaPlayer.obj.url=MediaPlayer.oldURL,MediaPlayer.sol=MediaPlayer.oldSol,MediaPlayer.type=MediaPlayer.obj.type,MediaPlayer.init[MediaPlayer.type](),MediaPlayer.play();break;case"exit":0===cor&&MediaPlayer.exit();break;case"focus":setTimeout(function(){IPTVChannels.TVList.Focused(item,!0,!0)},5);break;case"standByHDMI":case"standBy":gSTB.StandBy(!0),gSTB.ExecAction("front_panel led-on");break;case"upnpStart":stbUPnPRenderer.onPlay()}},MediaPlayer.tsExit=function(type,item){switch(timeShift.ExitTimeShift(),type){case"error":"true"===environment.mount_media_ro?new CModalAlert(currCPage,_("Warning!"),_('"Storage read only access mode" is enabled in System Settings'),_("Close")):new CModalConfirm(currCPage,_("Error"),_('No storage device selected as the "File location" in TimeShift settings. Disable TimeShift?'),_("No"),function(){},_("Yes"),function(){MediaPlayer.tsOnOff(!1)});break;case"stop":MediaPlayer.obj.url=MediaPlayer.oldURL,MediaPlayer.sol=MediaPlayer.oldSol,MediaPlayer.type=MediaPlayer.obj.type,MediaPlayer.init[MediaPlayer.type](),MediaPlayer.play();break;case"exit":setTimeout(function(){MediaPlayer.end(),currCPage===MediaPlayer&&MediaPlayer.exit()},5);break;case"focus":setTimeout(function(){IPTVChannels.TVList.Focused(item,!0,!0)},5);break;case"standByHDMI":case"standBy":gSTB.StandBy(!0),gSTB.ExecAction("front_panel led-on");break;case"upnpStart":stbUPnPRenderer.onPlay()}},MediaPlayer.end=function(silent,type){if(echo(this.obj,"end"),!this.obj)return!0;UPnPRenderer.state&&UPnPRendererClear(),clearTimeout(this.timer.mono),this.handle.querySelector("#dualmono_indicator").style.display="none",this.startingPlay=!1,echo("MediaPlayer.end"),clearTimeout(MediaPlayer.errorTimer),MediaPlayer.countError=0;var self=this;if(this.ts_inProgress&&this.tsExitCheck(type?type:"exit"))return!1;silent||this.subscribers[this.EVENT_STOP].forEach(function(subscriber){subscriber.subscribeEvents[self.EVENT_STOP].call(subscriber)}),null!==this.askedWindow&&(stbWebWindow.messageSend(this.askedWindow,"player.end",""),this.askedWindow=null),this.obj=null,this.type=null,this.runner.stop();var i;for(i in this.timer)this.timer.hasOwnProperty(i)&&clearTimeout(this.timer[i]);for(i in this.interval)this.interval.hasOwnProperty(i)&&clearInterval(this.interval[i]);return document.getElementById("toolsPan").style.display="none",this.domAspectBlock.style.display="none",this.ModalMenu.isVisible&&this.ModalMenu.Show(!1,!1),gSTB.Stop(),echo("gSTB.Stop()"),this.subtitlesData=null,this.subtitlesEncoding=null,this.subList=[],this.playNow=!1,!0},MediaPlayer.exit=function(type){echo("MediaPlayer.exit");var self=this;return this.subCModal&&this.subCModal.Show(!1),this.handle.querySelector("#cright").style.display="none",this.playListShow=!1,this.handle.querySelector("#playerHideplist").innerHTML=_("Show<br />playlist"),this.domPlayerList.style.visibility="hidden",this.end(!1,type)?(environment.ts_icon&&(this.domTSIndicator.style.display="none"),this.subscribers[this.EVENT_EXIT].forEach(function(subscriber){subscriber.subscribeEvents[self.EVENT_EXIT].call(subscriber)}),(currCPage===this||currCPage.parent===this)&&this.Show(!1),!0):!1},MediaPlayer.setCoord=function(x,y,a,b){x&&(this.coord.x=x),y&&(this.coord.y=y),a&&(this.coord.a=a),b&&(this.coord.b=b)},MediaPlayer.changeScreenMode=function(fullScreen){if(echo(this.fullScreen+"/"+fullScreen,"MediaPlayer.changeScreenMode (fullScreen old/new)"),fullScreen===!0||fullScreen===!1){if(this.fullScreen===fullScreen)return;this.fullScreen=fullScreen}else this.fullScreen=!this.fullScreen;this.fullScreen?gSTB.SetPIG(1,0,0,0):this.coord.a&&this.coord.b&&(echo("SET VIEW PORT TO WINDOW"),gSTB.SetViewport(this.coord.a,this.coord.b,this.coord.x,this.coord.y))},MediaPlayer.hlsInfo=function(){var data=JSON.parse(gSTB.GetHLSInfo()),text="";echo(data),data&&data.variants&&data.variants.length&&(data.variants[data.currentVariant]='<div style="color:red">'+data.variants[data.currentVariant]+"</div>",text=data.variants.join(", ")),hlsInfo.innerHTML="Bitrate: "+(text||"n/a")},MediaPlayer.showHlsInfo=function(){configuration.maySecureM3u&&(this.showHls?(this.handle.querySelector("#cright_hls").style.display="none",hlsInfo.innerHTML="Bitrate: n/a",clearInterval(this.timer.hlsInfo)):(MediaPlayer.hlsInfo(),this.handle.querySelector("#cright_hls").style.display="block",this.timer.hlsInfo=setInterval(MediaPlayer.hlsInfo,3e3)),this.showHls=!this.showHls)},MediaPlayer.showInfo=function(show,hidetime,showHeader){if(clearTimeout(this.timer.showInfo),show===!1||show===!0){if(show===this.infoFlag)return void(hidetime&&(this.timer.showInfo=setTimeout(function(){MediaPlayer.showInfo(!MediaPlayer.infoFlag)},hidetime)));this.infoFlag=!show}return this.infoFlag?(this.domPlayerHeader.style.visibility="hidden",this.domPlayerList.style.visibility="hidden",this.domPlayerFooter.style.visibility="hidden",this.type===MEDIA_TYPE_AUDIO&&(this.domSlideContainer.style.display="none")):(showHeader!==!1?(this.domPlayerHeader.style.visibility="visible",this.playListShow&&(this.domPlayerList.style.visibility="visible",this.PlayList.Refresh()),this.type===MEDIA_TYPE_AUDIO&&(this.domSlideContainer.style.display="block")):this.domPlayerHeader.style.visibility="hidden",this.domPlayerFooter.style.visibility="visible"),this.infoFlag=!this.infoFlag,hidetime&&(this.timer.showInfo=setTimeout(function(){MediaPlayer.showInfo(!MediaPlayer.infoFlag)},hidetime)),!1},MediaPlayer.parseTime=function(a){var h,m,s;return a>=0?(h=Math.floor(a/3600),m=Math.floor((a-3600*h)/60),s=a-3600*h-60*m,10>h&&(h="0"+h),10>s&&(s="0"+s),10>m&&(m="0"+m)):(a=Math.abs(a),h=Math.floor(a/3600),m=Math.floor((a-3600*h)/60),s=a-3600*h-60*m,10>h&&(h="0"+h),10>s&&(s="0"+s),10>m&&(m="0"+m),h="-"+h),{hour:h,min:m,sec:s}},MediaPlayer.splitTime=function(a){a=parseInt(a,10);var s=a%100,m=(a%1e4-s)/100,h=Math.floor(a/1e4);return s>59&&(s=59),m>59&&(m=59),s+60*m+3600*h},MediaPlayer.runner={id:{},run:!1,start:function(){var px,curTime,persent,buf;this.run||(MediaPlayer.curTime=gSTB.GetPosTime(),MediaPlayer.type===MEDIA_TYPE_STREAM_TS?(MediaPlayer.totalTime=gSTB.GetMediaLen(),MediaPlayer.totalTime>environment.ts_time&&(MediaPlayer.totalTime=environment.ts_time),MediaPlayer.curTime>MediaPlayer.totalTime&&(MediaPlayer.curTime=MediaPlayer.totalTime),MediaPlayer.curTime<0&&(MediaPlayer.curTime=0),px=Math.round(MediaPlayer.curTime/environment.ts_time*MediaPlayer.progress[WINDOW_HEIGHT]),buf=Math.round(MediaPlayer.totalTime/environment.ts_time*MediaPlayer.progress[WINDOW_HEIGHT]),MediaPlayer.domPlayerBufferBar.style.width=buf+"px",curTime=MediaPlayer.parseTime(MediaPlayer.totalTime-MediaPlayer.curTime),MediaPlayer.domPlayerCurrentTime.innerHTML="-"+curTime.hour+":"+curTime.min+":"+curTime.sec):(MediaPlayer.curTime>MediaPlayer.totalTime&&(MediaPlayer.curTime=MediaPlayer.totalTime),MediaPlayer.curTime<0&&(MediaPlayer.curTime=0),px=Math.round(MediaPlayer.curTime/MediaPlayer.totalTime*MediaPlayer.progress[WINDOW_HEIGHT]),curTime=MediaPlayer.parseTime(MediaPlayer.curTime),persent=Math.round(MediaPlayer.curTime/MediaPlayer.totalTime*100),MediaPlayer.subscribers[MediaPlayer.EVENT_PROGRESS].forEach(function(subscriber){subscriber.subscribeEvents[MediaPlayer.EVENT_PROGRESS].call(subscriber,persent)}),MediaPlayer.domPlayerCurrentTime.innerHTML=curTime.hour+":"+curTime.min+":"+curTime.sec,MediaPlayer.type===MEDIA_TYPE_CUE_ITEM&&MediaPlayer.activeCUE(),MediaPlayer.type===MEDIA_TYPE_ISO&&MediaPlayer.activeDVD()),MediaPlayer.domPlayerProgressBar.style.width=px+"px",this.id=window.setInterval(function(){MediaPlayer.curTime=gSTB.GetPosTime(),MediaPlayer.type===MEDIA_TYPE_STREAM_TS?(MediaPlayer.totalTime=gSTB.GetMediaLen(),MediaPlayer.totalTime>environment.ts_time&&(MediaPlayer.totalTime=environment.ts_time),MediaPlayer.curTime>MediaPlayer.totalTime&&(MediaPlayer.curTime=MediaPlayer.totalTime-20),echo("MediaPlayer.curTime : "+MediaPlayer.curTime+" MediaPlayer.totalTime : "+MediaPlayer.totalTime),px=Math.round(MediaPlayer.curTime/environment.ts_time*MediaPlayer.progress[WINDOW_HEIGHT]),buf=Math.round(MediaPlayer.totalTime/environment.ts_time*MediaPlayer.progress[WINDOW_HEIGHT]),MediaPlayer.domPlayerBufferBar.style.width=buf+"px",curTime=MediaPlayer.parseTime(MediaPlayer.totalTime-MediaPlayer.curTime),MediaPlayer.domPlayerCurrentTime.innerHTML="-"+curTime.hour+":"+curTime.min+":"+curTime.sec):(MediaPlayer.curTime>MediaPlayer.totalTime&&(MediaPlayer.curTime=MediaPlayer.totalTime),MediaPlayer.curTime<0&&(MediaPlayer.curTime=0),persent=Math.round(MediaPlayer.curTime/MediaPlayer.totalTime*100),MediaPlayer.subscribers[MediaPlayer.EVENT_PROGRESS].forEach(function(subscriber){subscriber.subscribeEvents[MediaPlayer.EVENT_PROGRESS].call(subscriber,persent)}),px=Math.round(MediaPlayer.curTime/MediaPlayer.totalTime*MediaPlayer.progress[WINDOW_HEIGHT]),curTime=MediaPlayer.parseTime(MediaPlayer.curTime),MediaPlayer.domPlayerCurrentTime.innerHTML=curTime.hour+":"+curTime.min+":"+curTime.sec,MediaPlayer.type===MEDIA_TYPE_CUE_ITEM&&MediaPlayer.activeCUE(),MediaPlayer.type===MEDIA_TYPE_ISO&&MediaPlayer.activeDVD()),MediaPlayer.domPlayerProgressBar.style.width=px+"px"},1e3),this.run=!0)},stop:function(){this.run&&(this.run=!1,clearInterval(this.id))}},MediaPlayer.activeCUE=function(){this.PlayList.playIndex+1<this.list.length&&this.curTime>=this.list[this.PlayList.playIndex+1].time&&(this.PlayList.playIndex++,(this.PlayList.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),this.PlayList.Marked(this.PlayList.handle.children[this.PlayList.playIndex],!0),this.obj=this.list[this.PlayList.activeItem.data.index],this.domPlayerTitle.innerHTML=this.obj.name)},MediaPlayer.activeDVD=function(){this.PlayList.playIndex+1<this.dataDVD.titles[this.PlayList.parentIndex].chapters.length&&this.curTime>=this.dataDVD.titles[this.PlayList.parentIndex].chapters[this.PlayList.playIndex+1].startTime/1e3&&(this.PlayList.playIndex++,(this.PlayList.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),this.PlayList.Marked(this.PlayList.handle.children[this.dataDVD.titles[this.PlayList.parentIndex].chapters[this.PlayList.playIndex].chN],!0))},MediaPlayer.SubscribersReset=function(){this.subscribers[this.EVENT_START]=[],this.subscribers[this.EVENT_STOP]=[],this.subscribers[this.EVENT_PAUSE]=[],this.subscribers[this.EVENT_PROGRESS]=[],this.subscribers[this.EVENT_ERROR]=[],this.subscribers[this.EVENT_OK]=[],this.subscribers[this.EVENT_EXIT]=[]},MediaPlayer.Subscribe=function(subscriber,eventType){subscriber.subscribeEvents&&"function"==typeof subscriber.subscribeEvents[eventType]&&-1===this.subscribers[eventType].indexOf(subscriber)&&this.subscribers[eventType].push(subscriber)},MediaPlayer.Unsubscribe=function(subscriber,eventType){var index=this.subscribers[eventType].indexOf(subscriber);-1!==index&&this.subscribers[eventType].splice(index,1)},MediaPlayer.setAudioMenu=function(){function timeout(){MediaPlayer.handle.querySelector("#cright").style.display="none"}var audArr,types=["","mpeg2audio","mp3","DD","AAC","LinearPCM","Ogg","dts","DD"];
try{audArr=eval(gSTB.GetAudioPIDsEx())}catch(e){audArr=[],echo(e)}echo(audArr,"audArr"),this.audioPid&&gSTB.SetAudioPID(this.audioPid);var currAud=gSTB.GetAudioPID();if(this.ModalMenu.Menu.gaudio.slist.Clear(),audArr.length>0&&audArr[0]&&(audArr[0].pid||0===audArr[0].pid))for(var i=0;i<audArr.length;i++){var lang_info=getLanguageNameByCode(audArr[i].lang);lang_info||(lang_info=[],lang_info[0]="",lang_info[1]="null"),audArr[i].title&&(lang_info[0]=audArr[i].title);var fl=currAud===audArr[i].pid;if(this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gaudio,lang_info[1],""!==lang_info[0]?lang_info[0]+(audArr[i].type?" ("+types[audArr[i].type]+")":""):_("unknown")+(audArr[i].type?" ("+types[audArr[i].type]+")":""),{data:audArr[i].pid,marked:fl,type:audArr[i].type}),fl){if(clearTimeout(this.timer.audio),""===lang_info[0]&&0===audArr[i].type)continue;this.handle.querySelector("#audioType").src=PATH_IMG_PUBLIC+"codec/"+audArr[i].type+".png",this.handle.querySelector("#audioText").innerHTML=""!==lang_info[0]?lang_info[0]:types[audArr[i].type],this.handle.querySelector("#cright").style.display="block",this.timer.audio=setTimeout(timeout,MediaPlayer.TIME_HIDE_HINT)}}else this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gaudio,"no",_("No"),{disabled:!0})},MediaPlayer.initSubtitleMenu=function(){function timeout(){MediaPlayer.handle.querySelector("#cright_bottom_sub").style.display="none"}var subArr,currSub,lang_info,marked,i;this.subtitlesPid&&"OFF"!==this.subtitlesPid&&(gSTB.SetSubtitles(!0),gSTB.SetSubtitlePID(this.subtitlesPid)),currSub=this.subtitlesPid&&"OFF"!==this.subtitlesPid?this.subtitlesPid:gSTB.GetSubtitlePID();try{subArr=eval(gSTB.GetSubtitlePIDs())}catch(e){subArr=[],echo(e,"subtitle parse error")}if(this.ModalMenu.Menu.gsubtitle.slist.Clear(),gSTB.SetSubtitles(this.subtitles_on===!0),echo(subArr,"subArr"),subArr.length>0)for(this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gsubtitle,"OFF",_("Disabled"),{data:{type:1,value:"OFF"},marked:!this.subtitles_on,focused:!this.subtitles_on}),i=0;i<subArr.length;i++)8192!==subArr[i].pid&&(lang_info=getLanguageNameByCode(subArr[i].lang),lang_info||(lang_info=[],lang_info[0]=_("unknown")+' ("'+getIso639LangCode(subArr[i].lang)+'")',lang_info[1]="null"),marked=!this.extSubtitles&&currSub===subArr[i].pid&&this.subtitles_on===!0,this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gsubtitle,lang_info[1],lang_info[0],{data:{type:2,value:subArr[i].pid,name:lang_info[0]},marked:marked,focused:marked}),marked&&(clearTimeout(this.timer.sub),this.handle.querySelector("#subText").innerHTML=lang_info[0],this.handle.querySelector("#cright_bottom_sub").style.display="block",this.timer.sub=setTimeout(timeout,MediaPlayer.TIME_HIDE_HINT)));else this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gsubtitle,"OFF",_("Disabled"),{data:{type:1,value:"OFF"},marked:!0,focused:!0});if(echo("initSubtitleMenu"),this.prepareSubList(),this.subList.length>0){this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gsubtitle,"ext",_("External subtitles:"),{disabled:!0});var item=null;for(i=0;i<this.subList.length;i++)item=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gsubtitle,this.subList[i].url,this.subList[i].name,{data:{index:i,type:3},marked:this.subList[i].marked===!0,focused:this.subList[i].marked===!0}),this.subList[i].marked===!0&&this.openSubtitle(this.subList[i])}},MediaPlayer.initTeletextMenu=function(){function timeout(){MediaPlayer.handle.querySelector("#cright_bottom_tvtext").style.display="none"}var self=this,pids=gSTB.GetTeletextPIDs(),lang;try{pids=eval(pids)}catch(e){pids=[]}clearTimeout(this.timer.teletext),this.ModalMenu.Menu.gTeletext.slist.Clear(),"on"!==environment.teletext_on?(self.ModalMenu.Menu.Switch(self.ModalMenu.Menu.Next({hidden:!1},!0),!0),MediaPlayer.ModalMenu.Menu.Hidden(self.ModalMenu.Menu.gTeletext,!0)):pids.length>0?(self.timer.teletext=setTimeout(timeout,MediaPlayer.TIME_HIDE_HINT),MediaPlayer.handle.querySelector("#cright_bottom_tvtext").style.display="block",pids.forEach(function(item){lang=item.lang&&item.lang.length>0?item.lang[0]:_("unknown"),self.ModalMenu.Menu.AddItem(self.ModalMenu.Menu.gTeletext,lang,lang,{data:{type:2,value:item.pid},marked:!1,focused:!0})})):this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gTeletext,"OFF",_("Disabled"),{data:{type:1,value:"OFF"},marked:!0,focused:!0}),echo("initTeletextMenu")},MediaPlayer.setDVDInfo=function(){var temp=gSTB.GetMetadataInfo(),y=1,chN=0;if(this.PlayList.Reset(),this.list=[],this.PlayList.parentIndex=0,!temp||"{}"===temp)return void echo("GetMetadataInfo has not data");try{this.dataDVD=JSON.parse(temp)}catch(e){this.dataDVD={},echo(e)}if(this.dataDVD.titles)for(var i=0;i<this.dataDVD.titles.length;i++)if(this.dataDVD.titles[i].Titleduration>1e4){var cTitle=i===this.dataDVD.infoCurtitle;if(cTitle&&(this.PlayList.parentIndex=i),this.list.push(this.dataDVD.titles[i]),this.PlayList.Add(_("Title")+" "+y,{disabled:!0},{stared:!1}),chN++,this.dataDVD.titles[i].chapters)for(var j=0;j<this.dataDVD.titles[i].chapters.length;j++){this.list.push(this.dataDVD.titles[i].chapters[j]);var time=this.parseTime(parseInt((this.dataDVD.titles[i].chapters[j].startTime||0)/1e3,10));this.PlayList.Add(_("Chapter")+" "+(j+1)+" "+time.hour+":"+time.min+":"+time.sec,{index:j,parentI:i,marked:0===j&&cTitle,focused:0===j&&cTitle,pos:this.dataDVD.titles[i].chapters[j].startTime||0,disabled:!1},{stared:!1}),this.dataDVD.titles[i].chapters[j].chN=chN,chN++}y++}this.PlayList.playIndex=0},MediaPlayer.onClick=function(){MediaPlayer.showInfo()},MediaPlayer.standByOn=function(hdmiEvent){switch(this.parent){case IPTVChannels:IPTVChannels.saveLastChannels();break;case DVBChannels:DVBChannels.saveLastChannels()}if(this.playNow||this.startingPlay){this.inStandBy=!0,this.runner.stop();var i;for(i in this.timer)this.timer.hasOwnProperty(i)&&clearTimeout(this.timer[i]);for(i in this.interval)this.interval.hasOwnProperty(i)&&clearInterval(this.interval[i]);switch(document.getElementById("toolsPan").style.display="none",this.domAspectBlock.style.display="none",this.ModalMenu.isVisible&&this.ModalMenu.Show(!1,!1),this.type){case MEDIA_TYPE_DVB:case MEDIA_TYPE_STREAM:case MEDIA_TYPE_IMAGE:gSTB.Stop(),this.playNow=!1,this.pos=0;break;case MEDIA_TYPE_STREAM_TS:if(this.pos=0,this.obj.sol=this.oldSol,this.obj.url=this.oldURL,this.type=this.obj.type,this.init[this.obj.type](),this.modalInit[this.obj.type](),this.playNow=!1,this.ts_inProgress&&this.tsExitCheck(hdmiEvent?"standByHDMI":"standBy"))return!0;gSTB.Stop();break;default:if(gSTB.GetPosTime()>0&&(this.pos=gSTB.GetPosTime()),!this.playNow){if(this.type!==MEDIA_TYPE_IMAGE)return;clearTimeout(this.timer.slideShow),this.timer.slideShow=null}clearTimeout(this.timer.showInfo),this.showInfo(!0,0,!1),gSTB.Stop(),this.runner.stop()}return gSTB.ExecAction("front_panel led-on"),gSTB.StandBy(!0),!0}return!1},MediaPlayer.standByOff=function(manual){var lastTeletextParams;return this.inStandBy||manual?(this.inStandBy=!1,this.ModalMenu.Menu.gaudio.slist.Clear(),this.ModalMenu.Menu.gsubtitle.slist.Clear(),this.playNow||this.startingPlay?(this.subtitles_on&&this.subtitlesData&&this.subtitlesEncoding&&(gSTB.SetSubtitlesEncoding(this.subtitlesEncoding),gSTB.LoadExternalSubtitles(this.subtitlesData.url),gSTB.SetSubtitles(!0)),this.playNow=!1,this.startingPlay=!0,manual&&(this.pos=gSTB.GetPosTime()),gSTB.Play((this.sol?this.sol+" ":"auto ")+this.obj.url+" position:"+this.pos),MediaPlayer.EventHandler===MediaPlayer.ModalMenu.Menu.gTeletext.teletextHandler&&(lastTeletextParams=MediaPlayer.ModalMenu.Menu.gTeletext.lastParams,lastTeletextParams.charset&&gSTB.ForceTtxCharset("auto"===lastTeletextParams.charset?0:+lastTeletextParams.charset,"auto"!==lastTeletextParams.charset),gSTB.SetTeletextPID(lastTeletextParams.pid),gSTB.TeletextTransparency(lastTeletextParams.opacity),gSTB.SetTeletextViewport(lastTeletextParams.viewport.width,lastTeletextParams.viewport.height,lastTeletextParams.viewport.left,lastTeletextParams.viewport.top),gSTB.TeletextShow(!0),MediaPlayer.showInfo(!1))):manual||this.play(),!0):!1},PlayList.prototype=Object.create(CScrollList.prototype),PlayList.prototype.constructor=PlayList,PlayList.prototype.Add=function(name,attrs,states){var body=element("div",{className:"data"},name),star=element("div",{className:"star"}),item=CScrollList.prototype.Add.call(this,[body,star],{star:star,data:{index:attrs.index||0===attrs.index?attrs.index:"",url:attrs.url?attrs.url:"",pos:attrs.pos||0===attrs.pos?attrs.pos:"",parentI:attrs.parentI||0===attrs.parentI?attrs.parentI:"",sol:attrs.sol},disabled:attrs.disabled?!0:!1,focused:attrs.focused?!0:!1,marked:attrs.marked?!0:!1,onclick:function(){return this.self.Open(this.data),MediaPlayer.playListShow&&(MediaPlayer.domPlayerList.style.visibility="hidden",MediaPlayer.handle.querySelector("#playerHideplist").innerHTML=_("Show<br />playlist"),MediaPlayer.playListShow=!1),!1},oncontextmenu:EMULATION?null:function(){return!1}});return states&&states.stared&&item.self.SetStar(item,!0),item},PlayList.prototype.SetStar=function(item,state){item.stared!==state&&this.SetState(item,"stared",state)},PlayList.prototype.onFocus=null,PlayList.prototype.Clear=function(){CScrollList.prototype.Clear.call(this),this.filterType=MEDIA_TYPE_NONE,this.filterText="",this.mtypes=[]},PlayList.prototype.Open=function(data){switch((this.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),this.Marked(this.activeItem,!0),MediaPlayer.timer.slideShow&&clearTimeout(MediaPlayer.timer.slideShow),MediaPlayer.obj.type){case MEDIA_TYPE_CUE_ITEM:MediaPlayer.obj=MediaPlayer.list[this.activeItem.data.index],MediaPlayer.domPlayerTitle.innerHTML=MediaPlayer.obj.name,gSTB.SetPosTime(MediaPlayer.obj.time);break;case MEDIA_TYPE_ISO:if((this.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),this.Marked(this.states.focused[0],!0),this.parentIndex===data.parentI)this.playIndex!==data.index&&gSTB.SetPosTime(parseInt(MediaPlayer.dataDVD.titles[data.parentI].chapters[data.index].startTime/1e3,10));else{var param="?title="+data.parentI+" position:"+parseInt(MediaPlayer.dataDVD.titles[data.parentI].chapters[data.index].startTime/1e3,10);MediaPlayer.playNow=!1,MediaPlayer.runner.stop(),gSTB.Play((MediaPlayer.sol?MediaPlayer.sol+" ":"auto ")+MediaPlayer.obj.url+param)}break;default:MediaPlayer.prepare(MediaPlayer.list[data.index],!0)}this.playIndex=data.index,this.parentIndex=data.parentI,this.parent.parent===MediaBrowser&&MediaBrowser.FileList.Reposition(this.parent.obj)},PlayList.prototype.Reset=function(){this.parentItem=null,this.path=[],this.Clear()},PlayList.prototype.Refresh=function(){this.Activate(),this.states.marked&&this.states.marked[0]?this.Focused(this.states.marked[0],!0):this.Focused(this.handle.children[0],!0)},PlayList.prototype.PreparePosition=function(item){this.activeItem!==item&&this.itemsPerPage%2===0&&(this.handleInner.scrollTop=item.offsetTop-this.itemsPerPage/2*this.itemHeight)};var UPnPRenderer={state:!1,data:null,meta:{}},UPnPRendererClear=function(){UPnPRenderer={state:!1,data:null,meta:{}}};window.stbUPnPRenderer,1;